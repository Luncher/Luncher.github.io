{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/favicon.ico","path":"favicon.ico","modified":0,"renderable":0},{"_id":"themes/jacman/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/jquery.fancybox.js","path":"fancybox/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.eot","path":"font/coveredbyyourgrace-webfont.eot","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/FontAwesome.otf","path":"font/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.ttf","path":"font/coveredbyyourgrace-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.woff","path":"font/coveredbyyourgrace-webfont.woff","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontawesome-webfont.eot","path":"font/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontawesome-webfont.woff","path":"font/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontdiao.eot","path":"font/fontdiao.eot","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontdiao.ttf","path":"font/fontdiao.ttf","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontdiao.woff","path":"font/fontdiao.woff","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-by-nc-nd.svg","path":"img/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/author.jpg","path":"img/author.jpg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-by-nc-sa.svg","path":"img/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-by-nc.svg","path":"img/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-by-nd.svg","path":"img/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-by-sa.svg","path":"img/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-by.svg","path":"img/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-zero.svg","path":"img/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/favicon.ico","path":"img/favicon.ico","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/jacman.jpg","path":"img/jacman.jpg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/logo.svg","path":"img/logo.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/scrollup.png","path":"img/scrollup.png","modified":0,"renderable":1},{"_id":"themes/jacman/source/js/gallery.js","path":"js/gallery.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/js/jquery.imagesloaded.min.js","path":"js/jquery.imagesloaded.min.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/js/jquery.qrcode-0.12.0.min.js","path":"js/jquery.qrcode-0.12.0.min.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/js/totop.js","path":"js/totop.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.svg","path":"font/coveredbyyourgrace-webfont.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontawesome-webfont.ttf","path":"font/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontdiao.svg","path":"font/fontdiao.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/logo.png","path":"img/logo.png","modified":0,"renderable":1},{"_id":"themes/jacman/source/js/jquery-2.0.3.min.js","path":"js/jquery-2.0.3.min.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/helpers/fancybox_buttons.png","path":"fancybox/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-buttons.css","path":"fancybox/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-buttons.js","path":"fancybox/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-media.js","path":"fancybox/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-thumbs.css","path":"fancybox/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-thumbs.js","path":"fancybox/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontawesome-webfont.svg","path":"font/fontawesome-webfont.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/banner.jpg","path":"img/banner.jpg","modified":0,"renderable":1}],"Cache":[{"_id":"source/__Front-matter.js","hash":"14b45991bbf5866656cecb40a56d9fc434764c28","modified":1517155028000},{"_id":"themes/jacman/.gitignore","hash":"7d65523f2a5afb69d76824dd1dfa62a34faa3197","modified":1517154064000},{"_id":"themes/jacman/LICENSE","hash":"931516aa36c53eb7843c83d82662eb50cc3c4367","modified":1517154064000},{"_id":"themes/jacman/README.md","hash":"098545637b0aeb27b14707c15e429470c603d78d","modified":1517154064000},{"_id":"themes/jacman/README_zh.md","hash":"9c73931bca4883de13eedd4be254da547d4ca52e","modified":1517154064000},{"_id":"themes/jacman/_config.yml","hash":"ced6bf08c68e82a58904a3e175e46e628ec030ff","modified":1517156704000},{"_id":"source/_posts/Base64.md","hash":"8a8ed18c23cdca1d32573752ca86f550955fe22d","modified":1517155028000},{"_id":"source/_posts/CSS-background.md","hash":"d292e8b8ba85e125633c2fa8a8adb6ce9ad1d9d8","modified":1517155028000},{"_id":"source/_posts/Blob.md","hash":"689ed287dd2a7b8fa68c30387314dc53790451ce","modified":1517155028000},{"_id":"source/_posts/CSS-动画详解.md","hash":"a5850ab2cf5dc1424358d39097d35f4fa2c423b1","modified":1517155028000},{"_id":"source/_posts/CSSMastery读书笔记一-基础知识.md","hash":"737750f1903a68bfcbcbf562a57fba8313ead4d8","modified":1517155028000},{"_id":"source/_posts/CSSMastery读书笔记三-可视化格式模型.md","hash":"6ec9d2d1bc2c37cb71f1162ae469706d86b01546","modified":1517155028000},{"_id":"source/_posts/CSSMastery读书笔记二为-样式找到应用目标.md","hash":"cf2b4511f74091d61a36befb1f334d85baa30081","modified":1517155028000},{"_id":"source/_posts/SVG学习笔记.md","hash":"a9a65fc5ec716a00b171afd7286775f6401c4694","modified":1517155028000},{"_id":"source/_posts/ScrollTo动画.md","hash":"7c51cd4ff11fa41fe451853027c364dac8a298b9","modified":1517155028000},{"_id":"source/_posts/Session-&-Cookie.md","hash":"02a93d126a7643c4fbeb8ff3a6da5e11540da819","modified":1517155028000},{"_id":"source/_posts/async-tutorial.md","hash":"e38c1c34058af6818c7d01773f442b4bdf41e1f7","modified":1517155028000},{"_id":"source/_posts/TextMate snippet.md","hash":"c01b58ef0c8ef3a98fd506cd3475c9a6da2b2e4d","modified":1517155028000},{"_id":"source/_posts/URL编解码.md","hash":"ec6863b0917604cfc80ae18116f9063c3be5e8bb","modified":1517155028000},{"_id":"source/_posts/css视觉格式化1.md","hash":"a212a5d58ef3d188240cc26053fea5856501a6c5","modified":1517155028000},{"_id":"source/_posts/darling-md.md","hash":"84203a3355f73f6eb66b7aee4ca1a432d2da00bf","modified":1517155028000},{"_id":"source/_posts/electron-研究笔记.md","hash":"4bc02d498eac2e797100da5d1104527335814c16","modified":1517155028000},{"_id":"source/_posts/electron-打包web应用.md","hash":"bde17f616f8da1b82a8808162dcf6f0bd45f35c6","modified":1517155028000},{"_id":"source/_posts/flex-box-xmind.md","hash":"71cfb14e6adf59aeb3ad70b79c407563c1cb104c","modified":1517155028000},{"_id":"source/_posts/iptables配置.md","hash":"ff1440831d6585f7c318859802d48e384b00b4d0","modified":1517155028000},{"_id":"source/_posts/nodejs-Modules-(一).md","hash":"f2032f32ee431094d11ee0b12c80350423c98a4f","modified":1517155028000},{"_id":"source/_posts/javascript模块管理.md","hash":"db48b715b7a59157a64af3e00f8e2a089c17caf4","modified":1517155028000},{"_id":"source/_posts/table.md","hash":"408c8574d8ad4eebdcb9e61bef0ff68b5f0f4b05","modified":1517155028000},{"_id":"source/_posts/npm-的工作原理.md","hash":"80de7b4b08d11f791ac2806a4c7d5f4600615662","modified":1517155028000},{"_id":"source/_posts/vscode开发环境配置.md","hash":"18833a544dbd7c4674b1e989c9805f00ed5d6ab2","modified":1517155028000},{"_id":"source/_posts/position.md","hash":"e526c2ba9c52bc711da5d126a01f670350d9124a","modified":1517155028000},{"_id":"source/_posts/从这个劫持页面我学到了什么.md","hash":"32671cc625f2709c30e82d0be8426e5464931f88","modified":1517155028000},{"_id":"source/_posts/vscode编辑器进阶.md","hash":"e950c843e3e3b08223b37ac73e0ccf6f65a33970","modified":1517155028000},{"_id":"source/_posts/你不知道的Javascript上卷-阅读笔记.md","hash":"80dc8071b1bdd6ba25f9aae655e654c3a3d7c863","modified":1517155028000},{"_id":"source/_posts/你不知道的box-shadow.md","hash":"820775c638c9509d7f4af745e3cc988c54424b60","modified":1517155028000},{"_id":"source/_posts/关于express下session的几个注意事项.md","hash":"bde1b202abbd87ef9f4695e9685e324bf10b8270","modified":1517155028000},{"_id":"source/_posts/使用passport管理第三方授权认证.md","hash":"a7d066344c4b25946e1d1e5a19febf22ae47f2bb","modified":1517155028000},{"_id":"source/_posts/修复npm安装全局模块权限问题.md","hash":"2f6951024d2ee52fe6bddb17bd8aff9efad4e807","modified":1517155028000},{"_id":"source/_posts/块级元素于行内元素.md","hash":"9a40cacebefbeb7e1a48ddc84bd58c9582f8f0cd","modified":1517155028000},{"_id":"source/_posts/如何设计一个数据字典.md","hash":"a2f5dc59468214486af79f6defdd25eae2e6ac3c","modified":1517155028000},{"_id":"source/about/index.md","hash":"10bf1d6a64cb4c764405e91556b86d95ea0912e9","modified":1517155028000},{"_id":"source/_posts/译-视觉格式化模型的细节.md","hash":"85f6db8c334377f4cac95279da3b408715ca39b5","modified":1517155028000},{"_id":"source/categories/index.md","hash":"c65b647a3de0cc10697d3f1cb2a44b38cf999ef0","modified":1517155028000},{"_id":"themes/jacman/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1517154064000},{"_id":"source/tags/index.md","hash":"99694da0d5a58ff84c32ae390eebd0b2062d6d9f","modified":1517155028000},{"_id":"themes/jacman/.git/config","hash":"2d3ae691d19a816889480acb832a3813f5ad7605","modified":1517154064000},{"_id":"themes/jacman/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1517154040000},{"_id":"themes/jacman/.git/index","hash":"fe4c0f820f94e9589ae6819f24b2d16f7c2f506e","modified":1517154064000},{"_id":"themes/jacman/.git/packed-refs","hash":"eb948a69bbff23c124d0145a66341b1af0f885d9","modified":1517154064000},{"_id":"themes/jacman/scripts/fancybox.js","hash":"aa411cd072399df1ddc8e2181a3204678a5177d9","modified":1517154064000},{"_id":"source/favicon.ico","hash":"785e9066e2b823124818b2b0c14c73790c908de0","modified":1517155028000},{"_id":"themes/jacman/languages/default.yml","hash":"eea72d6138497287c0b3f4bd93e4f6f62b7aff37","modified":1517154064000},{"_id":"themes/jacman/languages/zh-CN.yml","hash":"1f3b9d00dd4322352b0c9c82a76dc9865a616d41","modified":1517154064000},{"_id":"themes/jacman/languages/zh-TW.yml","hash":"61a02ba818d641579a86fcd7f5926ab1e6ab5f70","modified":1517154064000},{"_id":"themes/jacman/layout/archive.ejs","hash":"a18842e3d719fe3ca9b977a6995f8facc75c8673","modified":1517154064000},{"_id":"themes/jacman/layout/category.ejs","hash":"9b740fc33f6f028df60f0bc4312bf3ebd03aa8ea","modified":1517154064000},{"_id":"themes/jacman/layout/index.ejs","hash":"75cef2172c286994af412e11ab7f4f5a0daaf1f5","modified":1517154064000},{"_id":"themes/jacman/layout/layout.ejs","hash":"5b4289a4526899809b9c2facea535367ff51ba2b","modified":1517154064000},{"_id":"themes/jacman/layout/page.ejs","hash":"bd6bbf2ea8e183bd835867ff617dc6366b56748c","modified":1517154064000},{"_id":"themes/jacman/layout/post.ejs","hash":"3114134775bdde5a83cf14feb019606fa2b2b2be","modified":1517154064000},{"_id":"themes/jacman/layout/tag.ejs","hash":"45150a2365768b6b67880193c9264ad2bb4814db","modified":1517154064000},{"_id":"themes/jacman/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1517154040000},{"_id":"themes/jacman/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1517154040000},{"_id":"themes/jacman/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1517154040000},{"_id":"themes/jacman/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1517154040000},{"_id":"themes/jacman/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1517154040000},{"_id":"themes/jacman/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1517154040000},{"_id":"themes/jacman/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1517154040000},{"_id":"themes/jacman/.git/hooks/pre-rebase.sample","hash":"5885a56ab4fca8075a05a562d005e922cde9853b","modified":1517154040000},{"_id":"themes/jacman/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1517154040000},{"_id":"themes/jacman/.git/hooks/prepare-commit-msg.sample","hash":"2b6275eda365cad50d167fe3a387c9bc9fedd54f","modified":1517154040000},{"_id":"themes/jacman/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1517154040000},{"_id":"themes/jacman/.git/logs/HEAD","hash":"d0e18cee7d5c2bde1177311d2d207b1d90ea8835","modified":1517154064000},{"_id":"themes/jacman/source/css/style.styl","hash":"a0a45af186a72ae68979bf26f2a5d0d2303189ca","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1517154064000},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.eot","hash":"a17d0f10534303e40f210c506ebb8703fa23b7de","modified":1517154064000},{"_id":"themes/jacman/source/font/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1517154064000},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.ttf","hash":"194ccb4acf77a03dc25bcc174edb266143704fec","modified":1517154064000},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.woff","hash":"c6f8dc1a2f6ce914f120e80a876b8fd77b98888e","modified":1517154064000},{"_id":"themes/jacman/source/font/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1517154064000},{"_id":"themes/jacman/source/font/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1517154064000},{"_id":"themes/jacman/source/font/fontdiao.eot","hash":"9544a0d7ba208989302bc4da5a184faeb0e883c9","modified":1517154064000},{"_id":"themes/jacman/source/font/fontdiao.ttf","hash":"ee9fd7be2493c9bf6d2841044e69a0830d9d3fab","modified":1517154064000},{"_id":"themes/jacman/source/font/fontdiao.woff","hash":"71f54eb6e98aa28cafeb04aab71c0e5b349ea89f","modified":1517154064000},{"_id":"themes/jacman/source/img/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1517154064000},{"_id":"themes/jacman/source/img/author.jpg","hash":"30c9c9d462bbed8206c865298e6ed8d411cde7b4","modified":1517157131000},{"_id":"themes/jacman/source/img/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1517154064000},{"_id":"themes/jacman/source/img/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1517154064000},{"_id":"themes/jacman/source/img/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1517154064000},{"_id":"themes/jacman/source/img/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1517154064000},{"_id":"themes/jacman/source/img/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1517154064000},{"_id":"themes/jacman/source/img/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1517154064000},{"_id":"themes/jacman/source/img/favicon.ico","hash":"785e9066e2b823124818b2b0c14c73790c908de0","modified":1517156953000},{"_id":"themes/jacman/source/img/jacman.jpg","hash":"0ba14a4a5e3be012826fc713c33479912126d34e","modified":1517154064000},{"_id":"themes/jacman/source/img/logo.svg","hash":"9ae38f7225c38624faeb7b74996efa9de7bf065b","modified":1517154064000},{"_id":"themes/jacman/source/img/scrollup.png","hash":"2137d4f1739aa8aa3fcb0348c3ddf1e41d62f2e3","modified":1517154064000},{"_id":"themes/jacman/source/js/gallery.js","hash":"f8a4ba7fb8349cca374a3c69fff9b2bf21f742ed","modified":1517154064000},{"_id":"themes/jacman/source/js/jquery.imagesloaded.min.js","hash":"4109837b1f6477bacc6b095a863b1b95b1b3693f","modified":1517154064000},{"_id":"themes/jacman/source/js/jquery.qrcode-0.12.0.min.js","hash":"57c3987166a26415a71292162690e82c21e315ad","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/after_footer.ejs","hash":"3e1f1d8dc38b1e17c523d1176f7ee503fc648045","modified":1517154064000},{"_id":"themes/jacman/source/js/totop.js","hash":"cad23c5ea7163d1e5c05a0fd3ef9233469da10cb","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/archive.ejs","hash":"2c7395e7563fe016521712a645c28a13f952d52a","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/article.ejs","hash":"261ecacb8456f4cb972632b6a9103860fa63b9a3","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/analytics.ejs","hash":"697601996220fe0a0f9cd628be67dec3c86ae2aa","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/article_row.ejs","hash":"4cb855d91ece7f67b2ca0992fffa55472d0b9c93","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/categories.ejs","hash":"8a52d0344d5bce1925cf586ed73c11192925209b","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/footer.ejs","hash":"5f80bf6c6ddcf8c28c4599cd1540b14b25d54f18","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/header.ejs","hash":"18515612344ff048b9372b91b7eef6f3b143801f","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/head.ejs","hash":"761941be4922cd3c177c8130296b909bf7db5c09","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/mathjax.ejs","hash":"d42994ac696f52ba99c1cbac382cd76d5b04a3e8","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/pagination.ejs","hash":"6146ac37dfb4f8613090bc52b3fc8cfa911a186a","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/search.ejs","hash":"1083824a6c6c3df02767f2f3b727aee78ebb76ec","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/totop.ejs","hash":"bea5bb7cb9350b8af7d97a8d223af63a5b30ab78","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/sidebar.ejs","hash":"c4f527fff0070fbe65919053a16224412317f40d","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/tinysou_search.ejs","hash":"06ecddc8a9d40b480fe2e958af1dab857a9d5441","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/tags.ejs","hash":"b33b2b5d08f1d53a8de25a95f660f7f1cea7b3cb","modified":1517154064000},{"_id":"themes/jacman/layout/_widget/category.ejs","hash":"c1fae96b5053da021bcc04ab2ce5c2c8d30de8a2","modified":1517154064000},{"_id":"themes/jacman/layout/_widget/douban.ejs","hash":"e3820c36169e88663e6c9177666b2904c1ce47e6","modified":1517154064000},{"_id":"themes/jacman/layout/_widget/links.ejs","hash":"e49868063439c2092cdf9a8ec82cc295b0e42f66","modified":1517154064000},{"_id":"themes/jacman/layout/_widget/archive.ejs","hash":"39ea6b7888406fbd1b4cf236ebd718e881493374","modified":1517154064000},{"_id":"themes/jacman/layout/_widget/github-card.ejs","hash":"d49a8d609c5fbafa9e7ad328163565af03306519","modified":1517154064000},{"_id":"themes/jacman/layout/_widget/rss.ejs","hash":"0a4b5f2a2e36a1d504fe2e7c6c8372cbb4628aab","modified":1517154064000},{"_id":"themes/jacman/layout/_widget/tag.ejs","hash":"7e82ad9c916b9ce871b2f65ce8f283c5ba47947b","modified":1517154064000},{"_id":"themes/jacman/layout/_widget/weibo.ejs","hash":"a31c2b223d0feb2a227e203cac9e5d13b7d328a8","modified":1517154064000},{"_id":"themes/jacman/layout/_widget/tagcloud.ejs","hash":"10a1001189d5c28ce6d42494563b9637c302b454","modified":1517154064000},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.svg","hash":"eabdb262d8e246865dfb56031f01ff6e8d2f9d53","modified":1517154064000},{"_id":"themes/jacman/source/font/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1517154064000},{"_id":"themes/jacman/source/font/fontdiao.svg","hash":"334a94e6a66a8b089be7315d876bec93efe38d2b","modified":1517154064000},{"_id":"themes/jacman/source/img/logo.png","hash":"30c9c9d462bbed8206c865298e6ed8d411cde7b4","modified":1517157189000},{"_id":"themes/jacman/source/js/jquery-2.0.3.min.js","hash":"a0ae3697b0ab8c0e8bd3186c80db42abd6d97a8d","modified":1517154064000},{"_id":"themes/jacman/.git/refs/heads/master","hash":"cdf7ebb26811b17304103dcf164bb82b88b4f841","modified":1517154064000},{"_id":"themes/jacman/source/css/_base/font.styl","hash":"c8a0faf43b08e37ad07a5669db76d595da966159","modified":1517154064000},{"_id":"themes/jacman/source/css/_base/public.styl","hash":"f016180726019927b9a835ed01e04d153f27a149","modified":1517154064000},{"_id":"themes/jacman/source/css/_base/variable.styl","hash":"cb652eb83c28a208743fabab92de896f8b7cbf7b","modified":1517154064000},{"_id":"themes/jacman/source/css/_partial/article.styl","hash":"c69641b4a34a8c62986b335414413dbde26de25e","modified":1517154064000},{"_id":"themes/jacman/.git/objects/pack/pack-1c4a599ad6a3ef23bb9c7386d84aa8560351438a.idx","hash":"5df235b79d54883044b817d9ea80aab780440172","modified":1517154064000},{"_id":"themes/jacman/source/css/_partial/aside.styl","hash":"506fde1d67ce750452cbe84bee01a19c7d027c5e","modified":1517154064000},{"_id":"themes/jacman/source/css/_partial/duoshuo.styl","hash":"e85f1192283f043115c272a9deb3cb6ced793990","modified":1517154064000},{"_id":"themes/jacman/source/css/_partial/footer.styl","hash":"1911613a19b605a58f801c21b03b5d4c83b90f9c","modified":1517154064000},{"_id":"themes/jacman/source/css/_partial/gallery.styl","hash":"7246809f4ce3166ec1b259bf475cae1a48e29aad","modified":1517154064000},{"_id":"themes/jacman/source/css/_partial/header.styl","hash":"5121ceb712be3f2dde98b8b6e589b546e19eab8f","modified":1517154064000},{"_id":"themes/jacman/source/css/_partial/totop.styl","hash":"96363d7c5aaed5f649667fc0752a62620a67e872","modified":1517154064000},{"_id":"themes/jacman/source/css/_partial/helper.styl","hash":"1136600932b97534b88465bf05ef313630b2de3d","modified":1517154064000},{"_id":"themes/jacman/source/css/_partial/index.styl","hash":"a72ff14effd276015264f870f47ed8f8413bf5d3","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1517154064000},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/post/catetags.ejs","hash":"0e37bababc8f4659f5b59a552a946b46d89e4158","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/post/article.ejs","hash":"b09e3acea7076e1f01dfe0c2295e19951ea09437","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/post/gallery.ejs","hash":"fafc2501d7e65983b0f5c2b58151ca12e57c0574","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/post/comment.ejs","hash":"548c69c570d5aac567bc6f088e9ee0c02223b088","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/post/footer.ejs","hash":"b12ec08a5845a3d8c01257614f1dfead879c87d2","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/post/pagination.ejs","hash":"7de9c07a4c968429a8088c31a28b7f3a993ded1b","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/post/header.ejs","hash":"36a705942b691abe0d643ea8afa339981b32f6f2","modified":1517154064000},{"_id":"themes/jacman/layout/_partial/post/jiathis.ejs","hash":"d7f5960039ac74924559ab6ba03c64457b8f0966","modified":1517154064000},{"_id":"themes/jacman/source/font/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1517154064000},{"_id":"themes/jacman/source/img/banner.jpg","hash":"5104860c4f8b2e84ef734ba6c37fe7a288bf0d74","modified":1517154064000},{"_id":"themes/jacman/.git/logs/refs/heads/master","hash":"d0e18cee7d5c2bde1177311d2d207b1d90ea8835","modified":1517154064000},{"_id":"themes/jacman/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1517154064000},{"_id":"themes/jacman/source/css/_base/highlight/highlight.styl","hash":"91b62bfc58390b0d5db782a75be6965ee3665eb3","modified":1517154064000},{"_id":"themes/jacman/source/css/_base/highlight/theme.styl","hash":"e3a59bd427ba37a54ead9eeba9a5356b3f720a48","modified":1517154064000},{"_id":"themes/jacman/.git/logs/refs/remotes/origin/HEAD","hash":"d0e18cee7d5c2bde1177311d2d207b1d90ea8835","modified":1517154064000},{"_id":"themes/jacman/.git/objects/pack/pack-1c4a599ad6a3ef23bb9c7386d84aa8560351438a.pack","hash":"48902f949d08b6e8e8e2107d41299d1fb9d9691b","modified":1517154064000},{"_id":"public/about/index.html","hash":"caea87fedd0bfb2459b508d4b2c1053c208ffe9d","modified":1517157234181},{"_id":"public/categories/index.html","hash":"891e847a7a58b87a85a701aab9d4966cae4d09ff","modified":1517157234181},{"_id":"public/tags/index.html","hash":"233b1c76c702a6b54942422986a974855e9a542b","modified":1517157234182},{"_id":"public/2016/06/22/darling-md/index.html","hash":"07550c8546b0237b521402166e906da7067e4dad","modified":1517157234182},{"_id":"public/archives/index.html","hash":"0b0591e9b60fc00f4f84d559a32001b0e42871f5","modified":1517157234182},{"_id":"public/archives/page/2/index.html","hash":"20ddba2c197714b897c4f2589e4c08bb9f9dc7da","modified":1517157234182},{"_id":"public/archives/page/3/index.html","hash":"88b76776655d1ed2f0a399726c82d657d83ab19e","modified":1517157234182},{"_id":"public/archives/page/4/index.html","hash":"8f72e4677689f6724ac469463afe1e534d46ff30","modified":1517157234182},{"_id":"public/archives/2016/index.html","hash":"be1e8c3671d919890c2da63bbc5c4c676aaf3c69","modified":1517157234183},{"_id":"public/archives/2016/page/2/index.html","hash":"ba853a8e4a77e8f7b44758d30cebb1954752c340","modified":1517157234183},{"_id":"public/archives/2016/06/index.html","hash":"97ef9d5bad5e748cad6e577d3fa8e9380bd838ef","modified":1517157234184},{"_id":"public/archives/2016/07/index.html","hash":"f1736877aeac764eb7b515dc20a4d0c89f3a6c24","modified":1517157234185},{"_id":"public/archives/2016/08/index.html","hash":"8c9d99afc256a3a4418612355b97fb56582f9c86","modified":1517157234185},{"_id":"public/archives/2016/08/page/2/index.html","hash":"5dad024e85bc967bc87f290edf4da8cf87ff4e9d","modified":1517157234185},{"_id":"public/archives/2016/09/index.html","hash":"dd0ba19f37a6fd93f1fc34ccd80a9d8ac3b0d211","modified":1517157234185},{"_id":"public/archives/2016/10/index.html","hash":"e2b4b8169f8c2f2943c29b1f0f27406318c71fe5","modified":1517157234185},{"_id":"public/archives/2018/index.html","hash":"6396a369a41a5c0bdf6b69e29c5a11077abf9227","modified":1517157234185},{"_id":"public/archives/2018/page/2/index.html","hash":"ad486bb07651113bc3386ef6b181a25049201e09","modified":1517157234185},{"_id":"public/archives/2018/01/index.html","hash":"49b636a40dfdbcc3e41536398b315b4db0c4f391","modified":1517157234185},{"_id":"public/archives/2018/01/page/2/index.html","hash":"7ffeb15a742dac555068d5d631a67fdb06ce62ad","modified":1517157234185},{"_id":"public/categories/web/index.html","hash":"753cbfe65326f71b6886a19c65b17de6089d1de9","modified":1517157234182},{"_id":"public/categories/web/page/2/index.html","hash":"69459722c478bf6d0123ae84a01d808d9d0c506c","modified":1517157234182},{"_id":"public/categories/web/page/3/index.html","hash":"6387be2906e9934713fef53513a3521fe9d21163","modified":1517157234182},{"_id":"public/categories/server/index.html","hash":"cf1dbc11e68ffa79a2f4c2373e7e43643826aaf0","modified":1517157234182},{"_id":"public/categories/vscode/index.html","hash":"bf37983e1c6d4d21417810821448fbe37fa0dfaf","modified":1517157234182},{"_id":"public/categories/life/index.html","hash":"cb971f9e41c60ff9f20b090a887faab5e43d8664","modified":1517157234182},{"_id":"public/tags/css-background/index.html","hash":"124656022140bc40370bc9604b286b07003b13db","modified":1517157234186},{"_id":"public/tags/css-mastery/index.html","hash":"35f5297a6024562841c53b96a47bc463c2ab3346","modified":1517157234186},{"_id":"public/tags/transition-animation/index.html","hash":"09f371ad655c5f74a71eb0ae5aa01515a3c186ff","modified":1517157234186},{"_id":"public/tags/css-CSSMastery/index.html","hash":"ff4c212036121633436a9d415bb763953df7cb3c","modified":1517157234186},{"_id":"public/tags/SVG/index.html","hash":"e83e2a9f42578ac84d5948cee06111149f337ce8","modified":1517157234186},{"_id":"public/tags/css-scrollTo/index.html","hash":"c3655487c6ef46dfa40c2c3c3d1c7f17aaa4f498","modified":1517157234186},{"_id":"public/tags/line-box-inline-block/index.html","hash":"a4769a39fbc3cad9eac54a7be18560035b467f63","modified":1517157234186},{"_id":"public/tags/love/index.html","hash":"f255a132f34fd9282934edbc045ad4a8232cbd97","modified":1517157234186},{"_id":"public/tags/flexbox-xmind/index.html","hash":"82eb0d16e0133275e0aecd17ecd193467da16c19","modified":1517157234188},{"_id":"public/tags/AMD、CMD、commonjs/index.html","hash":"bef9bbdf6e086b09ce2d1fbc3517fb2a2c3f3126","modified":1517157234188},{"_id":"public/tags/css-html-table/index.html","hash":"ebbd79a5ed0f8393e0dd6db41c08b89e6f703fb5","modified":1517157234188},{"_id":"public/tags/position-layout/index.html","hash":"9f30447acc435672de845280edd5245fdf6721cc","modified":1517157234188},{"_id":"public/tags/h5/index.html","hash":"ed792f2d27b66ef26c7c572ca68699cc27741b4f","modified":1517157234189},{"_id":"public/tags/javascript/index.html","hash":"cb8c893fe453da2ffeadcf4c84e0393060cb3253","modified":1517157234189},{"_id":"public/tags/box-shadow/index.html","hash":"f307ee729f36c393dcf33d3a900e239e82aa7ae5","modified":1517157234189},{"_id":"public/tags/inline-element-block-element/index.html","hash":"86a2452610cf7a011bdebfab973846127ae5f773","modified":1517157234189},{"_id":"public/tags/visual-formatting-model/index.html","hash":"a678f634bba484aa5da2470af29d50b22a5b6fa5","modified":1517157234189},{"_id":"public/2018/01/28/async-tutorial/index.html","hash":"f3660c36cf196f353605b157074850ca6d2c3026","modified":1517157234189},{"_id":"public/2018/01/28/Base64/index.html","hash":"53bbf0c923ad400a0985c51f727bbf207ed966d8","modified":1517157234189},{"_id":"public/2018/01/28/修复npm安装全局模块权限问题/index.html","hash":"8e1a6cdf4b8e867f17a39c14365c5295b6fee2c8","modified":1517157234189},{"_id":"public/2018/01/28/使用passport管理第三方授权认证/index.html","hash":"34821f214bde2d98aafd258d622b350fb5eadfbd","modified":1517157234189},{"_id":"public/2018/01/28/关于express下session的几个注意事项/index.html","hash":"7aeb6ddca9a63011d6bbf7daf1960195bca10432","modified":1517157234189},{"_id":"public/2018/01/28/iptables配置/index.html","hash":"599c1b78cd3300095590a82868b02f4f69956a27","modified":1517157234189},{"_id":"public/2018/01/28/vscode编辑器进阶/index.html","hash":"c5d7096883a687928c9d4e3d45d76e6336643151","modified":1517157234189},{"_id":"public/2018/01/28/Blob/index.html","hash":"b07c52af81b23d1e48f38c6528dc6f38b8dab305","modified":1517157234189},{"_id":"public/2018/01/28/Session-&-Cookie/index.html","hash":"797edf0f2782a7950b0725d9c0afd3b88eac4d3c","modified":1517157234189},{"_id":"public/2018/01/28/如何设计一个数据字典/index.html","hash":"2e623410da9f84908420e859ae2c52358d4e2731","modified":1517157234190},{"_id":"public/2018/01/28/TextMate snippet/index.html","hash":"ce793c2d919607f6c00fa9dc40483d9c07692fb0","modified":1517157234190},{"_id":"public/2018/01/28/URL编解码/index.html","hash":"bc492c8b81f068d2f29fd84e776e3a2fda7cec69","modified":1517157234190},{"_id":"public/2018/01/28/vscode开发环境配置/index.html","hash":"8d307196f868ee9f4581fd45e8246d2ab213345b","modified":1517157234190},{"_id":"public/2018/01/28/npm-的工作原理/index.html","hash":"9cf66339a56db6ad263a6e6b033608b3a89e49f3","modified":1517157234190},{"_id":"public/2018/01/28/electron-研究笔记/index.html","hash":"9bf640bef0e81c904abfe59c1072df6febf6ef10","modified":1517157234190},{"_id":"public/2018/01/28/electron-打包web应用/index.html","hash":"74b0a59ba49068bd7fae03fca245e874f3333c9b","modified":1517157234190},{"_id":"public/2018/01/28/nodejs-Modules-(一)/index.html","hash":"82039582ca5760cd17d92b2d45b8ce0ac1aded22","modified":1517157234190},{"_id":"public/2016/10/08/你不知道的Javascript上卷-阅读笔记/index.html","hash":"7d074a5571570347163e140381d1034ab3c3e520","modified":1517157234190},{"_id":"public/2016/09/07/从这个劫持页面我学到了什么/index.html","hash":"114869bce98a87d9a0e87c3420f345ba2811c37b","modified":1517157234190},{"_id":"public/2016/09/05/译-视觉格式化模型的细节/index.html","hash":"b59571fa9e1ca21e9cc5d11ccc34e05c582ead05","modified":1517157234190},{"_id":"public/2016/09/03/你不知道的box-shadow/index.html","hash":"05ecb5042ce6bcf9d203c6a491c5156f9fd54715","modified":1517157234190},{"_id":"public/2016/08/30/CSS-动画详解/index.html","hash":"bc4d8ba2a71f8cfea18d5a13e4fd52afe38fdadb","modified":1517157234190},{"_id":"public/2016/08/29/SVG学习笔记/index.html","hash":"d6903a9245da725bea17af18359aa94ec94fd374","modified":1517157234190},{"_id":"public/2016/08/26/ScrollTo动画/index.html","hash":"a73f7d21f93b5bc9b235358607ae0744c87b5944","modified":1517157234190},{"_id":"public/2016/08/25/CSS-background/index.html","hash":"3c61b3bfa4c900df8ec965e05258ad14546026a4","modified":1517157234190},{"_id":"public/2016/08/22/CSSMastery读书笔记三-可视化格式模型/index.html","hash":"6903c9667ee363eb95ab4e98bf3363d74e266fba","modified":1517157234190},{"_id":"public/2016/08/21/CSSMastery读书笔记二为-样式找到应用目标/index.html","hash":"199e2136c2fe442f7221def285a7cbfb50a2159f","modified":1517157234190},{"_id":"public/2016/08/20/CSSMastery读书笔记一-基础知识/index.html","hash":"5d05bf9e02344c6fbf47d106504b4e96c9355c57","modified":1517157234190},{"_id":"public/2016/08/18/css视觉格式化1/index.html","hash":"8992c731187bd63d5a40b37877ffec0c75295a78","modified":1517157234190},{"_id":"public/2016/08/15/javascript模块管理/index.html","hash":"b67d92bae345d388ae60b287b3352ef9257123f0","modified":1517157234190},{"_id":"public/2016/08/12/块级元素于行内元素/index.html","hash":"7c1515cabf34831289986cd8721f6c8b22909f97","modified":1517157234191},{"_id":"public/2016/08/07/table/index.html","hash":"9a4a353e6fd440369f66a0bc0a3d9dc7f8540b44","modified":1517157234191},{"_id":"public/2016/08/02/position/index.html","hash":"c07f70b372918ddaf2526a1f7062f77c8a5807aa","modified":1517157234191},{"_id":"public/2016/07/31/flex-box-xmind/index.html","hash":"a4005265ab8b72c7e31f6a4edb5c171dbb2e5729","modified":1517157234182},{"_id":"public/index.html","hash":"5600137c78fc5f73192212eb3a2d06c6fd297597","modified":1517157234191},{"_id":"public/page/2/index.html","hash":"3e4637a5ed37ca1be2fbe5b0b2bb9c7bc29c497c","modified":1517157234191},{"_id":"public/page/3/index.html","hash":"97a22885ebe7ecf352edffbc15ca664b38b36c74","modified":1517157234191},{"_id":"public/page/4/index.html","hash":"75dff5aa63ba1781aebd3156c5b918eebe5fb98c","modified":1517157234192},{"_id":"public/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1517155965817},{"_id":"public/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1517155965817},{"_id":"public/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1517155965817},{"_id":"public/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1517155965817},{"_id":"public/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1517155965817},{"_id":"public/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1517155965817},{"_id":"public/font/coveredbyyourgrace-webfont.eot","hash":"a17d0f10534303e40f210c506ebb8703fa23b7de","modified":1517155965817},{"_id":"public/font/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1517155965817},{"_id":"public/font/coveredbyyourgrace-webfont.ttf","hash":"194ccb4acf77a03dc25bcc174edb266143704fec","modified":1517155965817},{"_id":"public/font/coveredbyyourgrace-webfont.woff","hash":"c6f8dc1a2f6ce914f120e80a876b8fd77b98888e","modified":1517155965818},{"_id":"public/font/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1517155965818},{"_id":"public/font/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1517155965818},{"_id":"public/font/fontdiao.eot","hash":"9544a0d7ba208989302bc4da5a184faeb0e883c9","modified":1517155965818},{"_id":"public/font/fontdiao.ttf","hash":"ee9fd7be2493c9bf6d2841044e69a0830d9d3fab","modified":1517155965818},{"_id":"public/font/fontdiao.woff","hash":"71f54eb6e98aa28cafeb04aab71c0e5b349ea89f","modified":1517155965818},{"_id":"public/img/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1517155965818},{"_id":"public/img/author.jpg","hash":"30c9c9d462bbed8206c865298e6ed8d411cde7b4","modified":1517157234205},{"_id":"public/img/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1517155965818},{"_id":"public/img/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1517155965818},{"_id":"public/img/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1517155965818},{"_id":"public/img/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1517155965818},{"_id":"public/img/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1517155965818},{"_id":"public/img/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1517155965818},{"_id":"public/img/favicon.ico","hash":"2d22a3e0c7905a894e832c831dd91c29c209c7a5","modified":1517155965818},{"_id":"public/img/logo.svg","hash":"9ae38f7225c38624faeb7b74996efa9de7bf065b","modified":1517155965818},{"_id":"public/img/jacman.jpg","hash":"0ba14a4a5e3be012826fc713c33479912126d34e","modified":1517155965818},{"_id":"public/img/scrollup.png","hash":"2137d4f1739aa8aa3fcb0348c3ddf1e41d62f2e3","modified":1517155965818},{"_id":"public/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1517155965818},{"_id":"public/font/coveredbyyourgrace-webfont.svg","hash":"eabdb262d8e246865dfb56031f01ff6e8d2f9d53","modified":1517155966557},{"_id":"public/font/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1517155966559},{"_id":"public/font/fontdiao.svg","hash":"334a94e6a66a8b089be7315d876bec93efe38d2b","modified":1517155966560},{"_id":"public/img/logo.png","hash":"30c9c9d462bbed8206c865298e6ed8d411cde7b4","modified":1517157234205},{"_id":"public/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1517155966564},{"_id":"public/js/gallery.js","hash":"f8a4ba7fb8349cca374a3c69fff9b2bf21f742ed","modified":1517155966565},{"_id":"public/js/jquery.imagesloaded.min.js","hash":"4109837b1f6477bacc6b095a863b1b95b1b3693f","modified":1517155966565},{"_id":"public/js/totop.js","hash":"cad23c5ea7163d1e5c05a0fd3ef9233469da10cb","modified":1517155966565},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1517155966565},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1517155966565},{"_id":"public/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1517155966565},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1517155966565},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1517155966565},{"_id":"public/css/style.css","hash":"1737965b2ad2e4999c93bfa7657bdfc9990675f3","modified":1517155966565},{"_id":"public/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1517155966565},{"_id":"public/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1517155966565},{"_id":"public/js/jquery.qrcode-0.12.0.min.js","hash":"57c3987166a26415a71292162690e82c21e315ad","modified":1517155966565},{"_id":"public/js/jquery-2.0.3.min.js","hash":"a0ae3697b0ab8c0e8bd3186c80db42abd6d97a8d","modified":1517155966565},{"_id":"public/favicon.ico","hash":"785e9066e2b823124818b2b0c14c73790c908de0","modified":1517155966565},{"_id":"public/font/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1517155966572},{"_id":"public/img/banner.jpg","hash":"5104860c4f8b2e84ef734ba6c37fe7a288bf0d74","modified":1517155966573}],"Category":[{"name":"web","_id":"cjcyzhlwm00049co72o2mgua5"},{"name":"server","_id":"cjcyzhlxf000r9co7w7s1jhwg"},{"name":"vscode","_id":"cjcyzhlxq00169co7cxo0wy5q"},{"name":"life","_id":"cjcyzhlxs001e9co7y1qlez06"}],"Data":[],"Page":[{"title":"about","date":"2016-06-29T10:18:17.000Z","_content":"\n## `Nodejs` `javascript` `PHP` `GUI`\n","source":"about/index.md","raw":"---\ntitle: about\ndate: 2016-06-29 18:18:17\n---\n\n## `Nodejs` `javascript` `PHP` `GUI`\n","updated":"2018-01-28T15:57:08.000Z","path":"about/index.html","comments":1,"layout":"page","_id":"cjcyzhlwh00019co7bs3vbnh6","content":"<h2 id=\"Nodejs-javascript-PHP-GUI\"><a href=\"#Nodejs-javascript-PHP-GUI\" class=\"headerlink\" title=\"Nodejs javascript PHP GUI\"></a><code>Nodejs</code> <code>javascript</code> <code>PHP</code> <code>GUI</code></h2>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Nodejs-javascript-PHP-GUI\"><a href=\"#Nodejs-javascript-PHP-GUI\" class=\"headerlink\" title=\"Nodejs javascript PHP GUI\"></a><code>Nodejs</code> <code>javascript</code> <code>PHP</code> <code>GUI</code></h2>"},{"title":"categories","date":"2016-06-29T10:16:36.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2016-06-29 18:16:36\ntype: \"categories\"\n---\n","updated":"2018-01-28T15:57:08.000Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cjcyzhlwl00039co7rn49ybwx","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2016-06-29T10:14:27.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2016-06-29 18:14:27\ntype: \"tags\"\n---\n","updated":"2018-01-28T15:57:08.000Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cjcyzhlys00379co7ewivl397","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Base64","_content":"&nbsp;&nbsp;&nbsp;&nbsp;说到Base64相信大家都不陌生，在`web`开发过程中经常可以见到它的身影。Base64是一种编码方式，常用于表示、传输、与存储二进制数据。用64个可打印字符来表示二进制数据，从而解决一些二进制数据无法使用的场景。`Base64`最初主要用户多用途互联网邮件扩展(`MIME Email`), `MIME`规定了用于表示各式各样数据(非英文符号数据)的符号化方法，而`Base64`编码就作为内容传输编码方式之一(`charset`)。`http`协议就是采用了`MIME`的框架。\n\n&nbsp;&nbsp;&nbsp;&nbsp;由于`2^6=64`所以最经济的方式就是把`6bit`作为一个编码单元，对应一个可打印字符来完成编码工作。来看看`Base64`编码表：\n\n![Base64编码表](http://www.tangide.com/storage/read.php?path=qq/A/A84CE7A6466CC40FAC339261A8361B91/2015-12-19%2016:12:20%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png)\n\n`Base64`编码规则：\n\n> Base64编码的时候将三个byte的数据先后放入一个24bit的缓冲区中，先来的byte占高位。然后，每次取出6个bit参照编码码表得出编码。如果被编码字符的长度不能被3整除，那么就在编码输出的末尾补上`=`号。比如说，如果待编码的字符长度是4个字节，那么编码输出会有两个等号。如果待编码字符的长度是8个字节那么编码输出末尾会补上一个等号。如果待编码的比特位不足一个编码单元(`6bit`)的时候，则需要在低位补全。当最后剩余一个八位字节（一个byte）时，最后一个6位的base64字节块有四位是0值。\n\n说到这里你可能已经想到编码后的数据比原始数据略长，为原来的4/3。下面来看看`Base64`编码的应用。\n\n###Canvas\n\n&nbsp;&nbsp;&nbsp;&nbsp;`canvas`有一个toDataURL接口用于把当前的`canvas`转换为`data url`数据格式的图片。\n> canvas.toDataURL(type, encoderOptions);\n\n+ `type`属性设置转换的图片格式，默认为`image/png`。\n+ `encoderOptions`为一个数字范围从`0-1`，用于设置图片的质量。\n\n`dataURL`格式定义：\n>data:[mediatype][;base64],<data>\n\n+ mediatype 为一个`MIME`格式定义的字符串，如`image/jpeg`表示jpeg图片。\n+ base64字段表示后面的数据编码方式。\n\n举个例子：\n```javascript\n<script type=\"text/javascript\">\nwindow.onload = function() {\n\tvar canvas = document.getElementById('main-canvas');\n\tvar context = canvas.getContext('2d');\n\tcontext.fillRect(0, 0, canvas.width, canvas.height);\n\tvar dataURL = canvas.toDataURL();\n\tconsole.log(dataURL);\n}\n</script>\n```\n\n将会得到如下输出:\n``` javascript\ndata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAALQCAYAAABIRqOlAAAc9UlEQ…AAgUBAgAN0kwQIECBAQID9AAECBAgQCAQEOEA3SYAAAQIELrSX0B9Umz4MAAAAAElFTkSuQmCC\n```\n\n此外，`linux/mac`系统有一个命令行工具: `uuencode`可以把文件转换成`Base64`格式输出, 先把当前的`canvas`另存为一个图片，然后运行命令行程序可以得到如下结论，与toDataURL结果一致：\n\n```\n[luncher@localhost ~]$ uuencode -m 123.png 123-base \nbegin-base64 640 123-base\niVBORw0KGgoAAAANSUhEUgAAAeAAAALQCAYAAABIRqOlAAAc9UlEQVR4Xu3V\nwQkAMAzEsGT/oVvoEPVHWeBABLwzc8YRIECAAAECXwVWgL96GyNAgAABAk9A\ngD0CAQIECBAIBAQ4QDdJgAABAgQE2A8QIECAAIFAQIADdJMECBAgQECA/QAB\nAgQIEAgEBDhAN0mAAAECBATYDxAgQIAAgUBAgAN0kwQIECBAQID9AAECBAgQ\nCAQEOEA3SYAAAQIEBNgPECBAgACBQECAA3STBAgQIEBAgP0AAQIECBAIBAQ4\nQDdJgAABAgQE2A8QIECAAIFAQIADdJMECBAgQECA/QABAgQIEAgEBDhAN0mA\n\n```\n\n\n\n","source":"_posts/Base64.md","raw":"---\ntitle: Base64\ncategories: web\n---\n&nbsp;&nbsp;&nbsp;&nbsp;说到Base64相信大家都不陌生，在`web`开发过程中经常可以见到它的身影。Base64是一种编码方式，常用于表示、传输、与存储二进制数据。用64个可打印字符来表示二进制数据，从而解决一些二进制数据无法使用的场景。`Base64`最初主要用户多用途互联网邮件扩展(`MIME Email`), `MIME`规定了用于表示各式各样数据(非英文符号数据)的符号化方法，而`Base64`编码就作为内容传输编码方式之一(`charset`)。`http`协议就是采用了`MIME`的框架。\n\n&nbsp;&nbsp;&nbsp;&nbsp;由于`2^6=64`所以最经济的方式就是把`6bit`作为一个编码单元，对应一个可打印字符来完成编码工作。来看看`Base64`编码表：\n\n![Base64编码表](http://www.tangide.com/storage/read.php?path=qq/A/A84CE7A6466CC40FAC339261A8361B91/2015-12-19%2016:12:20%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png)\n\n`Base64`编码规则：\n\n> Base64编码的时候将三个byte的数据先后放入一个24bit的缓冲区中，先来的byte占高位。然后，每次取出6个bit参照编码码表得出编码。如果被编码字符的长度不能被3整除，那么就在编码输出的末尾补上`=`号。比如说，如果待编码的字符长度是4个字节，那么编码输出会有两个等号。如果待编码字符的长度是8个字节那么编码输出末尾会补上一个等号。如果待编码的比特位不足一个编码单元(`6bit`)的时候，则需要在低位补全。当最后剩余一个八位字节（一个byte）时，最后一个6位的base64字节块有四位是0值。\n\n说到这里你可能已经想到编码后的数据比原始数据略长，为原来的4/3。下面来看看`Base64`编码的应用。\n\n###Canvas\n\n&nbsp;&nbsp;&nbsp;&nbsp;`canvas`有一个toDataURL接口用于把当前的`canvas`转换为`data url`数据格式的图片。\n> canvas.toDataURL(type, encoderOptions);\n\n+ `type`属性设置转换的图片格式，默认为`image/png`。\n+ `encoderOptions`为一个数字范围从`0-1`，用于设置图片的质量。\n\n`dataURL`格式定义：\n>data:[mediatype][;base64],<data>\n\n+ mediatype 为一个`MIME`格式定义的字符串，如`image/jpeg`表示jpeg图片。\n+ base64字段表示后面的数据编码方式。\n\n举个例子：\n```javascript\n<script type=\"text/javascript\">\nwindow.onload = function() {\n\tvar canvas = document.getElementById('main-canvas');\n\tvar context = canvas.getContext('2d');\n\tcontext.fillRect(0, 0, canvas.width, canvas.height);\n\tvar dataURL = canvas.toDataURL();\n\tconsole.log(dataURL);\n}\n</script>\n```\n\n将会得到如下输出:\n``` javascript\ndata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAALQCAYAAABIRqOlAAAc9UlEQ…AAgUBAgAN0kwQIECBAQID9AAECBAgQCAQEOEA3SYAAAQIELrSX0B9Umz4MAAAAAElFTkSuQmCC\n```\n\n此外，`linux/mac`系统有一个命令行工具: `uuencode`可以把文件转换成`Base64`格式输出, 先把当前的`canvas`另存为一个图片，然后运行命令行程序可以得到如下结论，与toDataURL结果一致：\n\n```\n[luncher@localhost ~]$ uuencode -m 123.png 123-base \nbegin-base64 640 123-base\niVBORw0KGgoAAAANSUhEUgAAAeAAAALQCAYAAABIRqOlAAAc9UlEQVR4Xu3V\nwQkAMAzEsGT/oVvoEPVHWeBABLwzc8YRIECAAAECXwVWgL96GyNAgAABAk9A\ngD0CAQIECBAIBAQ4QDdJgAABAgQE2A8QIECAAIFAQIADdJMECBAgQECA/QAB\nAgQIEAgEBDhAN0mAAAECBATYDxAgQIAAgUBAgAN0kwQIECBAQID9AAECBAgQ\nCAQEOEA3SYAAAQIEBNgPECBAgACBQECAA3STBAgQIEBAgP0AAQIECBAIBAQ4\nQDdJgAABAgQE2A8QIECAAIFAQIADdJMECBAgQECA/QABAgQIEAgEBDhAN0mA\n\n```\n\n\n\n","slug":"Base64","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlwa00009co7v0iqnxks","content":"<p>&nbsp;&nbsp;&nbsp;&nbsp;说到Base64相信大家都不陌生，在<code>web</code>开发过程中经常可以见到它的身影。Base64是一种编码方式，常用于表示、传输、与存储二进制数据。用64个可打印字符来表示二进制数据，从而解决一些二进制数据无法使用的场景。<code>Base64</code>最初主要用户多用途互联网邮件扩展(<code>MIME Email</code>), <code>MIME</code>规定了用于表示各式各样数据(非英文符号数据)的符号化方法，而<code>Base64</code>编码就作为内容传输编码方式之一(<code>charset</code>)。<code>http</code>协议就是采用了<code>MIME</code>的框架。</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;由于<code>2^6=64</code>所以最经济的方式就是把<code>6bit</code>作为一个编码单元，对应一个可打印字符来完成编码工作。来看看<code>Base64</code>编码表：</p>\n<p><img src=\"http://www.tangide.com/storage/read.php?path=qq/A/A84CE7A6466CC40FAC339261A8361B91/2015-12-19%2016:12:20%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png\" alt=\"Base64编码表\"></p>\n<p><code>Base64</code>编码规则：</p>\n<blockquote>\n<p>Base64编码的时候将三个byte的数据先后放入一个24bit的缓冲区中，先来的byte占高位。然后，每次取出6个bit参照编码码表得出编码。如果被编码字符的长度不能被3整除，那么就在编码输出的末尾补上<code>=</code>号。比如说，如果待编码的字符长度是4个字节，那么编码输出会有两个等号。如果待编码字符的长度是8个字节那么编码输出末尾会补上一个等号。如果待编码的比特位不足一个编码单元(<code>6bit</code>)的时候，则需要在低位补全。当最后剩余一个八位字节（一个byte）时，最后一个6位的base64字节块有四位是0值。</p>\n</blockquote>\n<p>说到这里你可能已经想到编码后的数据比原始数据略长，为原来的4/3。下面来看看<code>Base64</code>编码的应用。</p>\n<p>###Canvas</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;<code>canvas</code>有一个toDataURL接口用于把当前的<code>canvas</code>转换为<code>data url</code>数据格式的图片。</p>\n<blockquote>\n<p>canvas.toDataURL(type, encoderOptions);</p>\n</blockquote>\n<ul>\n<li><code>type</code>属性设置转换的图片格式，默认为<code>image/png</code>。</li>\n<li><code>encoderOptions</code>为一个数字范围从<code>0-1</code>，用于设置图片的质量。</li>\n</ul>\n<p><code>dataURL</code>格式定义：</p>\n<blockquote>\n<p>data:[mediatype][;base64],<data></data></p>\n</blockquote>\n<ul>\n<li>mediatype 为一个<code>MIME</code>格式定义的字符串，如<code>image/jpeg</code>表示jpeg图片。</li>\n<li>base64字段表示后面的数据编码方式。</li>\n</ul>\n<p>举个例子：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span>&gt;</span><br><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'main-canvas'</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> context = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">\tcontext.fillRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height);</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> dataURL = canvas.toDataURL();</span><br><span class=\"line\">\t<span class=\"built_in\">console</span>.log(dataURL);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>将会得到如下输出:<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAALQCAYAAABIRqOlAAAc9UlEQ…AAgUBAgAN0kwQIECBAQID9AAECBAgQCAQEOEA3SYAAAQIELrSX0B9Umz4MAAAAAElFTkSuQmCC</span><br></pre></td></tr></table></figure></p>\n<p>此外，<code>linux/mac</code>系统有一个命令行工具: <code>uuencode</code>可以把文件转换成<code>Base64</code>格式输出, 先把当前的<code>canvas</code>另存为一个图片，然后运行命令行程序可以得到如下结论，与toDataURL结果一致：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[luncher@localhost ~]$ uuencode -m 123.png 123-base </span><br><span class=\"line\">begin-base64 640 123-base</span><br><span class=\"line\">iVBORw0KGgoAAAANSUhEUgAAAeAAAALQCAYAAABIRqOlAAAc9UlEQVR4Xu3V</span><br><span class=\"line\">wQkAMAzEsGT/oVvoEPVHWeBABLwzc8YRIECAAAECXwVWgL96GyNAgAABAk9A</span><br><span class=\"line\">gD0CAQIECBAIBAQ4QDdJgAABAgQE2A8QIECAAIFAQIADdJMECBAgQECA/QAB</span><br><span class=\"line\">AgQIEAgEBDhAN0mAAAECBATYDxAgQIAAgUBAgAN0kwQIECBAQID9AAECBAgQ</span><br><span class=\"line\">CAQEOEA3SYAAAQIEBNgPECBAgACBQECAA3STBAgQIEBAgP0AAQIECBAIBAQ4</span><br><span class=\"line\">QDdJgAABAgQE2A8QIECAAIFAQIADdJMECBAgQECA/QABAgQIEAgEBDhAN0mA</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p>&nbsp;&nbsp;&nbsp;&nbsp;说到Base64相信大家都不陌生，在<code>web</code>开发过程中经常可以见到它的身影。Base64是一种编码方式，常用于表示、传输、与存储二进制数据。用64个可打印字符来表示二进制数据，从而解决一些二进制数据无法使用的场景。<code>Base64</code>最初主要用户多用途互联网邮件扩展(<code>MIME Email</code>), <code>MIME</code>规定了用于表示各式各样数据(非英文符号数据)的符号化方法，而<code>Base64</code>编码就作为内容传输编码方式之一(<code>charset</code>)。<code>http</code>协议就是采用了<code>MIME</code>的框架。</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;由于<code>2^6=64</code>所以最经济的方式就是把<code>6bit</code>作为一个编码单元，对应一个可打印字符来完成编码工作。来看看<code>Base64</code>编码表：</p>\n<p><img src=\"http://www.tangide.com/storage/read.php?path=qq/A/A84CE7A6466CC40FAC339261A8361B91/2015-12-19%2016:12:20%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png\" alt=\"Base64编码表\"></p>\n<p><code>Base64</code>编码规则：</p>\n<blockquote>\n<p>Base64编码的时候将三个byte的数据先后放入一个24bit的缓冲区中，先来的byte占高位。然后，每次取出6个bit参照编码码表得出编码。如果被编码字符的长度不能被3整除，那么就在编码输出的末尾补上<code>=</code>号。比如说，如果待编码的字符长度是4个字节，那么编码输出会有两个等号。如果待编码字符的长度是8个字节那么编码输出末尾会补上一个等号。如果待编码的比特位不足一个编码单元(<code>6bit</code>)的时候，则需要在低位补全。当最后剩余一个八位字节（一个byte）时，最后一个6位的base64字节块有四位是0值。</p>\n</blockquote>\n<p>说到这里你可能已经想到编码后的数据比原始数据略长，为原来的4/3。下面来看看<code>Base64</code>编码的应用。</p>\n<p>###Canvas</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;<code>canvas</code>有一个toDataURL接口用于把当前的<code>canvas</code>转换为<code>data url</code>数据格式的图片。</p>\n<blockquote>\n<p>canvas.toDataURL(type, encoderOptions);</p>\n</blockquote>\n<ul>\n<li><code>type</code>属性设置转换的图片格式，默认为<code>image/png</code>。</li>\n<li><code>encoderOptions</code>为一个数字范围从<code>0-1</code>，用于设置图片的质量。</li>\n</ul>\n<p><code>dataURL</code>格式定义：</p>\n<blockquote>\n<p>data:[mediatype][;base64],<data></data></p>\n</blockquote>\n<ul>\n<li>mediatype 为一个<code>MIME</code>格式定义的字符串，如<code>image/jpeg</code>表示jpeg图片。</li>\n<li>base64字段表示后面的数据编码方式。</li>\n</ul>\n<p>举个例子：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span>&gt;</span><br><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'main-canvas'</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> context = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">\tcontext.fillRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height);</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> dataURL = canvas.toDataURL();</span><br><span class=\"line\">\t<span class=\"built_in\">console</span>.log(dataURL);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>将会得到如下输出:<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAALQCAYAAABIRqOlAAAc9UlEQ…AAgUBAgAN0kwQIECBAQID9AAECBAgQCAQEOEA3SYAAAQIELrSX0B9Umz4MAAAAAElFTkSuQmCC</span><br></pre></td></tr></table></figure></p>\n<p>此外，<code>linux/mac</code>系统有一个命令行工具: <code>uuencode</code>可以把文件转换成<code>Base64</code>格式输出, 先把当前的<code>canvas</code>另存为一个图片，然后运行命令行程序可以得到如下结论，与toDataURL结果一致：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[luncher@localhost ~]$ uuencode -m 123.png 123-base </span><br><span class=\"line\">begin-base64 640 123-base</span><br><span class=\"line\">iVBORw0KGgoAAAANSUhEUgAAAeAAAALQCAYAAABIRqOlAAAc9UlEQVR4Xu3V</span><br><span class=\"line\">wQkAMAzEsGT/oVvoEPVHWeBABLwzc8YRIECAAAECXwVWgL96GyNAgAABAk9A</span><br><span class=\"line\">gD0CAQIECBAIBAQ4QDdJgAABAgQE2A8QIECAAIFAQIADdJMECBAgQECA/QAB</span><br><span class=\"line\">AgQIEAgEBDhAN0mAAAECBATYDxAgQIAAgUBAgAN0kwQIECBAQID9AAECBAgQ</span><br><span class=\"line\">CAQEOEA3SYAAAQIEBNgPECBAgACBQECAA3STBAgQIEBAgP0AAQIECBAIBAQ4</span><br><span class=\"line\">QDdJgAABAgQE2A8QIECAAIFAQIADdJMECBAgQECA/QABAgQIEAgEBDhAN0mA</span><br></pre></td></tr></table></figure>\n"},{"title":"Blob","_content":"&nbsp;&nbsp;&nbsp;&nbsp;`Blob`(Binary Large Object)术语最初来自数据库，早期数据库因为要存储声音、图片、以及可执行程序等二进制数据对象所以给该类对象取名为`Blob`。\n&nbsp;&nbsp;&nbsp;&nbsp;在`Web`领域，`Blob`被定义为包含只读数据的类文件对象。`Blob`中的数据不一定是`js`原生数据形式。常见的`File`接口就继承自`Blob`，并扩展它用于支持用户系统的本地文件。\n\n&nbsp;&nbsp;&nbsp;&nbsp;构建一个`Blob`对象通常有三种方式：1、通过`Blob`对象的构造函数来构建。2、从已有的`Blob`对象调用`slice`接口切出一个新的`Blob`对象。3、`canvas` API toBlob方法，把当前绘制信息转为一个`Blob`对象。下面分别看看3种方式的实现：\n\n--\n构造函数：\nvar blob = new Blob(array[optional], options[optional]);\n>\narray(可选): 一个数组。数组元素可以是：`ArrayBuffer`、`ArrayBufferView`、`Blob`、`DOMString`.或者他们的组合。\noptions(可选): 一个对象。用于指定`Blob`对象的属性，可选的参数有：\n+ type: Content-Type,用于指定将要放入`Blob`中的数据的类型(`MIME`)。\n\n<br>\n`Blob`对象的基本属性：\n>\nsize : `Blob`对象包含的字节数。(只读)<br>\ntype : `Blob`对象包含的数据类型`MIME`，如果类型未知则返回空字符串。\n\n<br>\n`Blob`对象的基本方法：\n`Blob.slice([start, [end, [content-type]]])`\n>\n`slice`方法与数组的`slice`类似。\n\n--\n\n**原生对象构建`Blob`**\n\n```javascript\n\n<script type=\"text/javascript\">\nwindow.onload = function() {\n    var blob = new Blob(1234);\n}\n</script>\n\n```\n**提示出错：**\n>Uncaught TypeError: Failed to construct 'Blob': The 1st argument is neither an array, nor does it have indexed properties.\n\n原因在于`Blob`构造函数要求第一个参数必须是数组，而这里第一个参数既不是一个数组，也没有可索引的属性。既然这里提到了对象的可索引属性，让我联想到了类数组的概念，而`Arguments`就是一个很好的例子。来试一试：\n``` javascript\n<script type=\"text/javascript\">\nfunction testArgumentsBlob() {\n    var blob = new Blob(arguments);\n    console.log(blob.size);//3\n    console.log(blob.type);//\"\"\n}\nwindow.onload = function() {\n    testArgumentsBlob(1, 2, 3);\n}\n</script>\n\n```\n可以看到即使是类数组对象，而数组元素类型是`Number`也能得出正确的结论，猜想大概是由于构造函数内部把`Number`转化为`String`的缘故吧！\n\n再来试一试其他的参数类型：\n```javascript\nwindow.onload = function() {\n  var arg = {hello: \"2016\"};\n  var blob = new Blob([JSON.stringify(arg, null, \"\\t\")], {type: \"application/json\"});\n  console.log(blob.type);//application/json\n  console.log(blob.size);//20\n}\n```\nblob.type等于application/json没问题。`arg`转为字符串后的长度为16加上制表符`\\t`的宽度4个字节等于20。\n\n--\n\n**用`slice`切出一个`Blob`对象**\n``` javascript\nwindow.onload = function() {\n    var arg = {hello: \"2016\"};\n    var str = JSON.stringify(arg, null, \"\\t\");\n    var blob = new Blob([str], {type: \"application/json\"});\n    var blob2 = blob.slice();\n            \n    console.log(blob2.size);//20\n    console.log(blob2.type);//\"\"\n}\n```\n可以看到，原始的`Blob`对象的`type`属性并不能传递给新的`Blob`对象，所以还是要自己指定。\n\n``` javascript\nwindow.onload = function() {\n    var arg = {hello: \"2016\"};\n    var str = JSON.stringify(arg, null, \"\\t\");\n    var blob = new Blob([str], {type: \"application/json\"});\n    var blob2 = blob.slice(0, blob.size, \"application/json\");\n    console.log(blob2.size);//20\n    console.log(blob2.type);//application/json\n}\n```\n--\n\n**`canvas` toBlob接口**\n\n函数原型：\n>void canvas.toBlob(callback, type, encoderOptions);\n\n+ callback: 一个回调函数，新建的`blob`对象是唯一的参数`\n+ type: 图片格式，默认为`image/png`，默认`dpi`: 96\n+ encoderOptions: 0~1之间的数值。当`type`为image/jpeg 或 image/webp的时候，用于指定图片质量\n\n来个`DEMO`:\n```javascript\nwindow.onload = function() {\n    var canvas = document.getElementById(\"main\");\n    canvas.toBlob(function(blob) {\n        var img = document.createElement(\"img\");         \n        var url = URL.createObjectURL(blob);\n        img.onload = function() {\n            URL.revokeObjectURL(url);\n        }\n        img.src = url;\n        document.body.appendChild(img);\n    });\n}\n</script>\n```\n得出错误：\n>Uncaught TypeError: canvas.toBlob is not a function.\n\n一开始觉得自己写错了，`Google`了下才发现`Chrome`居然不支持这个接口。给个`polyfill`[Canvas toBlob](https://github.com/X-Builder/JavaScript-Canvas-to-Blob/blob/master/js/canvas-to-blob.js)。\n\n--\n\n**Blob基本运用**\n\n知道了`Blob`对象的基本属性，以及构建的方法，来看几个具体的运用。\n\n--\n\n**利用`Blob`显示对象`**\n```javascript\n\nvar blob = new Blob([1, 2, 3]);\nvar src = URL.createObjectURL(blob);\nconsole.log(src);//blob:http%3A//localhost%3A8003/a47ea163-c253-471a-9d9e-877fe345b60f\nvar img = document.createElement('img');\nimg.onload = function() {\n    URL.invokeObjectURL(img.src);\n}\nimg.src = src;\ndocument.body.appendChild(img);\n\n```\n\n由于`blob`对象不是一个有效的文件，所以不能正常显示图片。上面的`demo`提到了一个`URL.createObjectURL`接口，顺便来学习以下：\n>objectURL = URL.createObjectURL(blob);\n\n主要用于根据一个`Blob`对象(或者`File`,因为`File`继承自`Blob`)，创建一个`URL`用于表示该对象。需要注意的是即使对同一个对象调用两次也会得到不同的`URL`。如果该`URL`不用了需要调用`URL.invokeObjectURL`来进行释放。浏览器会在当前`document unloaded`的时候自动把该`URL`释放。`URL`格式：\n> blob:http%3A//localhost%3A8003/a47ea163-c253-471a-9d9e-877fe345b60f\n\n\n最后来看一个正常点的`DEMO`，利用`URL.createObjectURL`读取本地图片文件，并创建缩略图。\n\n--\n\n**利用`Blob`显示缩略图`**\n\n``` javascript\n var input = document.createElement(\"input\");\n input.type = \"file\";\n input.accept = \"image/*\";\n input.multiple = true;\n input.style.display = \"none\";\n document.body.appendChild(input);\n\n var fileSelect = document.createElement(\"a\");\n fileSelect.href = \"#\";\n fileSelect.appendChild(document.createTextNode(\"Choose files\"));\n document.body.appendChild(fileSelect);\n\n var imgList = document.createElement(\"div\");\n imgList.innerHTML = \"<p>No file Selected!</p>\"\n document.body.appendChild(imgList);\n\n input.addEventListener(\"change\", function(e) {\n var files = this.files;\n if(!files.length) {\n    return;\n }\n imgList.innerHTML = \"\";\n var list = document.createElement(\"ul\");\n imgList.appendChild(list);\n for(var i = 0; i < files.length; i++) {\n     var li = document.createElement(\"li\"); \n     list.appendChild(li);\n\n     var img = document.createElement(\"img\");\n     img.src = window.URL.createObjectURL(files[i]);\n     img.height = 60;\n     img.width  = 60;\n     img.onload = function() {\n         window.URL.revokeObjectURL(this.src);\n     }\n     li.appendChild(img);\n     var info = document.createElement(\"span\");\n     info.innerHTML = files[i].name + \":\" + files[i].size + \" bytes\";\n     li.appendChild(info);\n  }\n}, false);\n\nfileSelect.addEventListener(\"click\", function(e) {\n  input.click();     \n       e.preventDefault();\n}, false);\n\n```\n\n由于`File`对象继承自`Blob`,所以我们可以很方便的利用`File`对象加载本地系统图片文件，并通过`createObjectURL`生成一个`URL`并加以显示。\n\n参考文献：\n+  [Blob](https://developer.mozilla.org/en-US/docs/Web/API/Blob)\n+  [Using_files_from_web](https://developer.mozilla.org/en-US/docs/Using_files_from_web_applications)\n\n","source":"_posts/Blob.md","raw":"---\ntitle: Blob\ncategories: web\n---\n&nbsp;&nbsp;&nbsp;&nbsp;`Blob`(Binary Large Object)术语最初来自数据库，早期数据库因为要存储声音、图片、以及可执行程序等二进制数据对象所以给该类对象取名为`Blob`。\n&nbsp;&nbsp;&nbsp;&nbsp;在`Web`领域，`Blob`被定义为包含只读数据的类文件对象。`Blob`中的数据不一定是`js`原生数据形式。常见的`File`接口就继承自`Blob`，并扩展它用于支持用户系统的本地文件。\n\n&nbsp;&nbsp;&nbsp;&nbsp;构建一个`Blob`对象通常有三种方式：1、通过`Blob`对象的构造函数来构建。2、从已有的`Blob`对象调用`slice`接口切出一个新的`Blob`对象。3、`canvas` API toBlob方法，把当前绘制信息转为一个`Blob`对象。下面分别看看3种方式的实现：\n\n--\n构造函数：\nvar blob = new Blob(array[optional], options[optional]);\n>\narray(可选): 一个数组。数组元素可以是：`ArrayBuffer`、`ArrayBufferView`、`Blob`、`DOMString`.或者他们的组合。\noptions(可选): 一个对象。用于指定`Blob`对象的属性，可选的参数有：\n+ type: Content-Type,用于指定将要放入`Blob`中的数据的类型(`MIME`)。\n\n<br>\n`Blob`对象的基本属性：\n>\nsize : `Blob`对象包含的字节数。(只读)<br>\ntype : `Blob`对象包含的数据类型`MIME`，如果类型未知则返回空字符串。\n\n<br>\n`Blob`对象的基本方法：\n`Blob.slice([start, [end, [content-type]]])`\n>\n`slice`方法与数组的`slice`类似。\n\n--\n\n**原生对象构建`Blob`**\n\n```javascript\n\n<script type=\"text/javascript\">\nwindow.onload = function() {\n    var blob = new Blob(1234);\n}\n</script>\n\n```\n**提示出错：**\n>Uncaught TypeError: Failed to construct 'Blob': The 1st argument is neither an array, nor does it have indexed properties.\n\n原因在于`Blob`构造函数要求第一个参数必须是数组，而这里第一个参数既不是一个数组，也没有可索引的属性。既然这里提到了对象的可索引属性，让我联想到了类数组的概念，而`Arguments`就是一个很好的例子。来试一试：\n``` javascript\n<script type=\"text/javascript\">\nfunction testArgumentsBlob() {\n    var blob = new Blob(arguments);\n    console.log(blob.size);//3\n    console.log(blob.type);//\"\"\n}\nwindow.onload = function() {\n    testArgumentsBlob(1, 2, 3);\n}\n</script>\n\n```\n可以看到即使是类数组对象，而数组元素类型是`Number`也能得出正确的结论，猜想大概是由于构造函数内部把`Number`转化为`String`的缘故吧！\n\n再来试一试其他的参数类型：\n```javascript\nwindow.onload = function() {\n  var arg = {hello: \"2016\"};\n  var blob = new Blob([JSON.stringify(arg, null, \"\\t\")], {type: \"application/json\"});\n  console.log(blob.type);//application/json\n  console.log(blob.size);//20\n}\n```\nblob.type等于application/json没问题。`arg`转为字符串后的长度为16加上制表符`\\t`的宽度4个字节等于20。\n\n--\n\n**用`slice`切出一个`Blob`对象**\n``` javascript\nwindow.onload = function() {\n    var arg = {hello: \"2016\"};\n    var str = JSON.stringify(arg, null, \"\\t\");\n    var blob = new Blob([str], {type: \"application/json\"});\n    var blob2 = blob.slice();\n            \n    console.log(blob2.size);//20\n    console.log(blob2.type);//\"\"\n}\n```\n可以看到，原始的`Blob`对象的`type`属性并不能传递给新的`Blob`对象，所以还是要自己指定。\n\n``` javascript\nwindow.onload = function() {\n    var arg = {hello: \"2016\"};\n    var str = JSON.stringify(arg, null, \"\\t\");\n    var blob = new Blob([str], {type: \"application/json\"});\n    var blob2 = blob.slice(0, blob.size, \"application/json\");\n    console.log(blob2.size);//20\n    console.log(blob2.type);//application/json\n}\n```\n--\n\n**`canvas` toBlob接口**\n\n函数原型：\n>void canvas.toBlob(callback, type, encoderOptions);\n\n+ callback: 一个回调函数，新建的`blob`对象是唯一的参数`\n+ type: 图片格式，默认为`image/png`，默认`dpi`: 96\n+ encoderOptions: 0~1之间的数值。当`type`为image/jpeg 或 image/webp的时候，用于指定图片质量\n\n来个`DEMO`:\n```javascript\nwindow.onload = function() {\n    var canvas = document.getElementById(\"main\");\n    canvas.toBlob(function(blob) {\n        var img = document.createElement(\"img\");         \n        var url = URL.createObjectURL(blob);\n        img.onload = function() {\n            URL.revokeObjectURL(url);\n        }\n        img.src = url;\n        document.body.appendChild(img);\n    });\n}\n</script>\n```\n得出错误：\n>Uncaught TypeError: canvas.toBlob is not a function.\n\n一开始觉得自己写错了，`Google`了下才发现`Chrome`居然不支持这个接口。给个`polyfill`[Canvas toBlob](https://github.com/X-Builder/JavaScript-Canvas-to-Blob/blob/master/js/canvas-to-blob.js)。\n\n--\n\n**Blob基本运用**\n\n知道了`Blob`对象的基本属性，以及构建的方法，来看几个具体的运用。\n\n--\n\n**利用`Blob`显示对象`**\n```javascript\n\nvar blob = new Blob([1, 2, 3]);\nvar src = URL.createObjectURL(blob);\nconsole.log(src);//blob:http%3A//localhost%3A8003/a47ea163-c253-471a-9d9e-877fe345b60f\nvar img = document.createElement('img');\nimg.onload = function() {\n    URL.invokeObjectURL(img.src);\n}\nimg.src = src;\ndocument.body.appendChild(img);\n\n```\n\n由于`blob`对象不是一个有效的文件，所以不能正常显示图片。上面的`demo`提到了一个`URL.createObjectURL`接口，顺便来学习以下：\n>objectURL = URL.createObjectURL(blob);\n\n主要用于根据一个`Blob`对象(或者`File`,因为`File`继承自`Blob`)，创建一个`URL`用于表示该对象。需要注意的是即使对同一个对象调用两次也会得到不同的`URL`。如果该`URL`不用了需要调用`URL.invokeObjectURL`来进行释放。浏览器会在当前`document unloaded`的时候自动把该`URL`释放。`URL`格式：\n> blob:http%3A//localhost%3A8003/a47ea163-c253-471a-9d9e-877fe345b60f\n\n\n最后来看一个正常点的`DEMO`，利用`URL.createObjectURL`读取本地图片文件，并创建缩略图。\n\n--\n\n**利用`Blob`显示缩略图`**\n\n``` javascript\n var input = document.createElement(\"input\");\n input.type = \"file\";\n input.accept = \"image/*\";\n input.multiple = true;\n input.style.display = \"none\";\n document.body.appendChild(input);\n\n var fileSelect = document.createElement(\"a\");\n fileSelect.href = \"#\";\n fileSelect.appendChild(document.createTextNode(\"Choose files\"));\n document.body.appendChild(fileSelect);\n\n var imgList = document.createElement(\"div\");\n imgList.innerHTML = \"<p>No file Selected!</p>\"\n document.body.appendChild(imgList);\n\n input.addEventListener(\"change\", function(e) {\n var files = this.files;\n if(!files.length) {\n    return;\n }\n imgList.innerHTML = \"\";\n var list = document.createElement(\"ul\");\n imgList.appendChild(list);\n for(var i = 0; i < files.length; i++) {\n     var li = document.createElement(\"li\"); \n     list.appendChild(li);\n\n     var img = document.createElement(\"img\");\n     img.src = window.URL.createObjectURL(files[i]);\n     img.height = 60;\n     img.width  = 60;\n     img.onload = function() {\n         window.URL.revokeObjectURL(this.src);\n     }\n     li.appendChild(img);\n     var info = document.createElement(\"span\");\n     info.innerHTML = files[i].name + \":\" + files[i].size + \" bytes\";\n     li.appendChild(info);\n  }\n}, false);\n\nfileSelect.addEventListener(\"click\", function(e) {\n  input.click();     \n       e.preventDefault();\n}, false);\n\n```\n\n由于`File`对象继承自`Blob`,所以我们可以很方便的利用`File`对象加载本地系统图片文件，并通过`createObjectURL`生成一个`URL`并加以显示。\n\n参考文献：\n+  [Blob](https://developer.mozilla.org/en-US/docs/Web/API/Blob)\n+  [Using_files_from_web](https://developer.mozilla.org/en-US/docs/Using_files_from_web_applications)\n\n","slug":"Blob","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlwj00029co7cjtru4j6","content":"<p>&nbsp;&nbsp;&nbsp;&nbsp;<code>Blob</code>(Binary Large Object)术语最初来自数据库，早期数据库因为要存储声音、图片、以及可执行程序等二进制数据对象所以给该类对象取名为<code>Blob</code>。<br>&nbsp;&nbsp;&nbsp;&nbsp;在<code>Web</code>领域，<code>Blob</code>被定义为包含只读数据的类文件对象。<code>Blob</code>中的数据不一定是<code>js</code>原生数据形式。常见的<code>File</code>接口就继承自<code>Blob</code>，并扩展它用于支持用户系统的本地文件。</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;构建一个<code>Blob</code>对象通常有三种方式：1、通过<code>Blob</code>对象的构造函数来构建。2、从已有的<code>Blob</code>对象调用<code>slice</code>接口切出一个新的<code>Blob</code>对象。3、<code>canvas</code> API toBlob方法，把当前绘制信息转为一个<code>Blob</code>对象。下面分别看看3种方式的实现：</p>\n<p>–<br>构造函数：<br>var blob = new Blob(array[optional], options[optional]);<br>&gt;<br>array(可选): 一个数组。数组元素可以是：<code>ArrayBuffer</code>、<code>ArrayBufferView</code>、<code>Blob</code>、<code>DOMString</code>.或者他们的组合。<br>options(可选): 一个对象。用于指定<code>Blob</code>对象的属性，可选的参数有：</p>\n<ul>\n<li>type: Content-Type,用于指定将要放入<code>Blob</code>中的数据的类型(<code>MIME</code>)。</li>\n</ul>\n<p><br><br><code>Blob</code>对象的基本属性：<br>&gt;<br>size : <code>Blob</code>对象包含的字节数。(只读)<br><br>type : <code>Blob</code>对象包含的数据类型<code>MIME</code>，如果类型未知则返回空字符串。</p>\n<p><br><br><code>Blob</code>对象的基本方法：<br><code>Blob.slice([start, [end, [content-type]]])</code><br>&gt;<br><code>slice</code>方法与数组的<code>slice</code>类似。</p>\n<p>–</p>\n<p><strong>原生对象构建<code>Blob</code></strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span>&gt;</span><br><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob(<span class=\"number\">1234</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure>\n<p><strong>提示出错：</strong></p>\n<blockquote>\n<p>Uncaught TypeError: Failed to construct ‘Blob’: The 1st argument is neither an array, nor does it have indexed properties.</p>\n</blockquote>\n<p>原因在于<code>Blob</code>构造函数要求第一个参数必须是数组，而这里第一个参数既不是一个数组，也没有可索引的属性。既然这里提到了对象的可索引属性，让我联想到了类数组的概念，而<code>Arguments</code>就是一个很好的例子。来试一试：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span>&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">testArgumentsBlob</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob(<span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(blob.size);<span class=\"comment\">//3</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(blob.type);<span class=\"comment\">//\"\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    testArgumentsBlob(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>可以看到即使是类数组对象，而数组元素类型是<code>Number</code>也能得出正确的结论，猜想大概是由于构造函数内部把<code>Number</code>转化为<code>String</code>的缘故吧！</p>\n<p>再来试一试其他的参数类型：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> arg = &#123;<span class=\"attr\">hello</span>: <span class=\"string\">\"2016\"</span>&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([<span class=\"built_in\">JSON</span>.stringify(arg, <span class=\"literal\">null</span>, <span class=\"string\">\"\\t\"</span>)], &#123;<span class=\"attr\">type</span>: <span class=\"string\">\"application/json\"</span>&#125;);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(blob.type);<span class=\"comment\">//application/json</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(blob.size);<span class=\"comment\">//20</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>blob.type等于application/json没问题。<code>arg</code>转为字符串后的长度为16加上制表符<code>\\t</code>的宽度4个字节等于20。</p>\n<p>–</p>\n<p><strong>用<code>slice</code>切出一个<code>Blob</code>对象</strong><br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arg = &#123;<span class=\"attr\">hello</span>: <span class=\"string\">\"2016\"</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> str = <span class=\"built_in\">JSON</span>.stringify(arg, <span class=\"literal\">null</span>, <span class=\"string\">\"\\t\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([str], &#123;<span class=\"attr\">type</span>: <span class=\"string\">\"application/json\"</span>&#125;);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob2 = blob.slice();</span><br><span class=\"line\">            </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(blob2.size);<span class=\"comment\">//20</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(blob2.type);<span class=\"comment\">//\"\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>可以看到，原始的<code>Blob</code>对象的<code>type</code>属性并不能传递给新的<code>Blob</code>对象，所以还是要自己指定。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arg = &#123;<span class=\"attr\">hello</span>: <span class=\"string\">\"2016\"</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> str = <span class=\"built_in\">JSON</span>.stringify(arg, <span class=\"literal\">null</span>, <span class=\"string\">\"\\t\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([str], &#123;<span class=\"attr\">type</span>: <span class=\"string\">\"application/json\"</span>&#125;);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob2 = blob.slice(<span class=\"number\">0</span>, blob.size, <span class=\"string\">\"application/json\"</span>);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(blob2.size);<span class=\"comment\">//20</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(blob2.type);<span class=\"comment\">//application/json</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>–</p>\n<p><strong><code>canvas</code> toBlob接口</strong></p>\n<p>函数原型：</p>\n<blockquote>\n<p>void canvas.toBlob(callback, type, encoderOptions);</p>\n</blockquote>\n<ul>\n<li>callback: 一个回调函数，新建的<code>blob</code>对象是唯一的参数`</li>\n<li>type: 图片格式，默认为<code>image/png</code>，默认<code>dpi</code>: 96</li>\n<li>encoderOptions: 0~1之间的数值。当<code>type</code>为image/jpeg 或 image/webp的时候，用于指定图片质量</li>\n</ul>\n<p>来个<code>DEMO</code>:<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"main\"</span>);</span><br><span class=\"line\">    canvas.toBlob(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">blob</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"img\"</span>);         </span><br><span class=\"line\">        <span class=\"keyword\">var</span> url = URL.createObjectURL(blob);</span><br><span class=\"line\">        img.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            URL.revokeObjectURL(url);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        img.src = url;</span><br><span class=\"line\">        <span class=\"built_in\">document</span>.body.appendChild(img);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>得出错误：</p>\n<blockquote>\n<p>Uncaught TypeError: canvas.toBlob is not a function.</p>\n</blockquote>\n<p>一开始觉得自己写错了，<code>Google</code>了下才发现<code>Chrome</code>居然不支持这个接口。给个<code>polyfill</code><a href=\"https://github.com/X-Builder/JavaScript-Canvas-to-Blob/blob/master/js/canvas-to-blob.js\" target=\"_blank\" rel=\"noopener\">Canvas toBlob</a>。</p>\n<p>–</p>\n<p><strong>Blob基本运用</strong></p>\n<p>知道了<code>Blob</code>对象的基本属性，以及构建的方法，来看几个具体的运用。</p>\n<p>–</p>\n<p><strong>利用<code>Blob</code>显示对象`</strong><br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]);</span><br><span class=\"line\"><span class=\"keyword\">var</span> src = URL.createObjectURL(blob);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(src);<span class=\"comment\">//blob:http%3A//localhost%3A8003/a47ea163-c253-471a-9d9e-877fe345b60f</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">img.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    URL.invokeObjectURL(img.src);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">img.src = src;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(img);</span><br></pre></td></tr></table></figure></p>\n<p>由于<code>blob</code>对象不是一个有效的文件，所以不能正常显示图片。上面的<code>demo</code>提到了一个<code>URL.createObjectURL</code>接口，顺便来学习以下：</p>\n<blockquote>\n<p>objectURL = URL.createObjectURL(blob);</p>\n</blockquote>\n<p>主要用于根据一个<code>Blob</code>对象(或者<code>File</code>,因为<code>File</code>继承自<code>Blob</code>)，创建一个<code>URL</code>用于表示该对象。需要注意的是即使对同一个对象调用两次也会得到不同的<code>URL</code>。如果该<code>URL</code>不用了需要调用<code>URL.invokeObjectURL</code>来进行释放。浏览器会在当前<code>document unloaded</code>的时候自动把该<code>URL</code>释放。<code>URL</code>格式：</p>\n<blockquote>\n<p>blob:http%3A//localhost%3A8003/a47ea163-c253-471a-9d9e-877fe345b60f</p>\n</blockquote>\n<p>最后来看一个正常点的<code>DEMO</code>，利用<code>URL.createObjectURL</code>读取本地图片文件，并创建缩略图。</p>\n<p>–</p>\n<p><strong>利用<code>Blob</code>显示缩略图`</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">var</span> input = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"input\"</span>);</span><br><span class=\"line\"> input.type = <span class=\"string\">\"file\"</span>;</span><br><span class=\"line\"> input.accept = <span class=\"string\">\"image/*\"</span>;</span><br><span class=\"line\"> input.multiple = <span class=\"literal\">true</span>;</span><br><span class=\"line\"> input.style.display = <span class=\"string\">\"none\"</span>;</span><br><span class=\"line\"> <span class=\"built_in\">document</span>.body.appendChild(input);</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">var</span> fileSelect = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"a\"</span>);</span><br><span class=\"line\"> fileSelect.href = <span class=\"string\">\"#\"</span>;</span><br><span class=\"line\"> fileSelect.appendChild(<span class=\"built_in\">document</span>.createTextNode(<span class=\"string\">\"Choose files\"</span>));</span><br><span class=\"line\"> <span class=\"built_in\">document</span>.body.appendChild(fileSelect);</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">var</span> imgList = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"div\"</span>);</span><br><span class=\"line\"> imgList.innerHTML = <span class=\"string\">\"&lt;p&gt;No file Selected!&lt;/p&gt;\"</span></span><br><span class=\"line\"> <span class=\"built_in\">document</span>.body.appendChild(imgList);</span><br><span class=\"line\"></span><br><span class=\"line\"> input.addEventListener(<span class=\"string\">\"change\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\"> <span class=\"keyword\">var</span> files = <span class=\"keyword\">this</span>.files;</span><br><span class=\"line\"> <span class=\"keyword\">if</span>(!files.length) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> imgList.innerHTML = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"> <span class=\"keyword\">var</span> list = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"ul\"</span>);</span><br><span class=\"line\"> imgList.appendChild(list);</span><br><span class=\"line\"> <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; files.length; i++) &#123;</span><br><span class=\"line\">     <span class=\"keyword\">var</span> li = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"li\"</span>); </span><br><span class=\"line\">     list.appendChild(li);</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"img\"</span>);</span><br><span class=\"line\">     img.src = <span class=\"built_in\">window</span>.URL.createObjectURL(files[i]);</span><br><span class=\"line\">     img.height = <span class=\"number\">60</span>;</span><br><span class=\"line\">     img.width  = <span class=\"number\">60</span>;</span><br><span class=\"line\">     img.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">         <span class=\"built_in\">window</span>.URL.revokeObjectURL(<span class=\"keyword\">this</span>.src);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     li.appendChild(img);</span><br><span class=\"line\">     <span class=\"keyword\">var</span> info = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"span\"</span>);</span><br><span class=\"line\">     info.innerHTML = files[i].name + <span class=\"string\">\":\"</span> + files[i].size + <span class=\"string\">\" bytes\"</span>;</span><br><span class=\"line\">     li.appendChild(info);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">fileSelect.addEventListener(<span class=\"string\">\"click\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  input.click();     </span><br><span class=\"line\">       e.preventDefault();</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);</span><br></pre></td></tr></table></figure>\n<p>由于<code>File</code>对象继承自<code>Blob</code>,所以我们可以很方便的利用<code>File</code>对象加载本地系统图片文件，并通过<code>createObjectURL</code>生成一个<code>URL</code>并加以显示。</p>\n<p>参考文献：</p>\n<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Blob\" target=\"_blank\" rel=\"noopener\">Blob</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Using_files_from_web_applications\" target=\"_blank\" rel=\"noopener\">Using_files_from_web</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>&nbsp;&nbsp;&nbsp;&nbsp;<code>Blob</code>(Binary Large Object)术语最初来自数据库，早期数据库因为要存储声音、图片、以及可执行程序等二进制数据对象所以给该类对象取名为<code>Blob</code>。<br>&nbsp;&nbsp;&nbsp;&nbsp;在<code>Web</code>领域，<code>Blob</code>被定义为包含只读数据的类文件对象。<code>Blob</code>中的数据不一定是<code>js</code>原生数据形式。常见的<code>File</code>接口就继承自<code>Blob</code>，并扩展它用于支持用户系统的本地文件。</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;构建一个<code>Blob</code>对象通常有三种方式：1、通过<code>Blob</code>对象的构造函数来构建。2、从已有的<code>Blob</code>对象调用<code>slice</code>接口切出一个新的<code>Blob</code>对象。3、<code>canvas</code> API toBlob方法，把当前绘制信息转为一个<code>Blob</code>对象。下面分别看看3种方式的实现：</p>\n<p>–<br>构造函数：<br>var blob = new Blob(array[optional], options[optional]);<br>&gt;<br>array(可选): 一个数组。数组元素可以是：<code>ArrayBuffer</code>、<code>ArrayBufferView</code>、<code>Blob</code>、<code>DOMString</code>.或者他们的组合。<br>options(可选): 一个对象。用于指定<code>Blob</code>对象的属性，可选的参数有：</p>\n<ul>\n<li>type: Content-Type,用于指定将要放入<code>Blob</code>中的数据的类型(<code>MIME</code>)。</li>\n</ul>\n<p><br><br><code>Blob</code>对象的基本属性：<br>&gt;<br>size : <code>Blob</code>对象包含的字节数。(只读)<br><br>type : <code>Blob</code>对象包含的数据类型<code>MIME</code>，如果类型未知则返回空字符串。</p>\n<p><br><br><code>Blob</code>对象的基本方法：<br><code>Blob.slice([start, [end, [content-type]]])</code><br>&gt;<br><code>slice</code>方法与数组的<code>slice</code>类似。</p>\n<p>–</p>\n<p><strong>原生对象构建<code>Blob</code></strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span>&gt;</span><br><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob(<span class=\"number\">1234</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure>\n<p><strong>提示出错：</strong></p>\n<blockquote>\n<p>Uncaught TypeError: Failed to construct ‘Blob’: The 1st argument is neither an array, nor does it have indexed properties.</p>\n</blockquote>\n<p>原因在于<code>Blob</code>构造函数要求第一个参数必须是数组，而这里第一个参数既不是一个数组，也没有可索引的属性。既然这里提到了对象的可索引属性，让我联想到了类数组的概念，而<code>Arguments</code>就是一个很好的例子。来试一试：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span>&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">testArgumentsBlob</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob(<span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(blob.size);<span class=\"comment\">//3</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(blob.type);<span class=\"comment\">//\"\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    testArgumentsBlob(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>可以看到即使是类数组对象，而数组元素类型是<code>Number</code>也能得出正确的结论，猜想大概是由于构造函数内部把<code>Number</code>转化为<code>String</code>的缘故吧！</p>\n<p>再来试一试其他的参数类型：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> arg = &#123;<span class=\"attr\">hello</span>: <span class=\"string\">\"2016\"</span>&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([<span class=\"built_in\">JSON</span>.stringify(arg, <span class=\"literal\">null</span>, <span class=\"string\">\"\\t\"</span>)], &#123;<span class=\"attr\">type</span>: <span class=\"string\">\"application/json\"</span>&#125;);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(blob.type);<span class=\"comment\">//application/json</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(blob.size);<span class=\"comment\">//20</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>blob.type等于application/json没问题。<code>arg</code>转为字符串后的长度为16加上制表符<code>\\t</code>的宽度4个字节等于20。</p>\n<p>–</p>\n<p><strong>用<code>slice</code>切出一个<code>Blob</code>对象</strong><br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arg = &#123;<span class=\"attr\">hello</span>: <span class=\"string\">\"2016\"</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> str = <span class=\"built_in\">JSON</span>.stringify(arg, <span class=\"literal\">null</span>, <span class=\"string\">\"\\t\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([str], &#123;<span class=\"attr\">type</span>: <span class=\"string\">\"application/json\"</span>&#125;);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob2 = blob.slice();</span><br><span class=\"line\">            </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(blob2.size);<span class=\"comment\">//20</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(blob2.type);<span class=\"comment\">//\"\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>可以看到，原始的<code>Blob</code>对象的<code>type</code>属性并不能传递给新的<code>Blob</code>对象，所以还是要自己指定。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arg = &#123;<span class=\"attr\">hello</span>: <span class=\"string\">\"2016\"</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> str = <span class=\"built_in\">JSON</span>.stringify(arg, <span class=\"literal\">null</span>, <span class=\"string\">\"\\t\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([str], &#123;<span class=\"attr\">type</span>: <span class=\"string\">\"application/json\"</span>&#125;);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob2 = blob.slice(<span class=\"number\">0</span>, blob.size, <span class=\"string\">\"application/json\"</span>);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(blob2.size);<span class=\"comment\">//20</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(blob2.type);<span class=\"comment\">//application/json</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>–</p>\n<p><strong><code>canvas</code> toBlob接口</strong></p>\n<p>函数原型：</p>\n<blockquote>\n<p>void canvas.toBlob(callback, type, encoderOptions);</p>\n</blockquote>\n<ul>\n<li>callback: 一个回调函数，新建的<code>blob</code>对象是唯一的参数`</li>\n<li>type: 图片格式，默认为<code>image/png</code>，默认<code>dpi</code>: 96</li>\n<li>encoderOptions: 0~1之间的数值。当<code>type</code>为image/jpeg 或 image/webp的时候，用于指定图片质量</li>\n</ul>\n<p>来个<code>DEMO</code>:<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"main\"</span>);</span><br><span class=\"line\">    canvas.toBlob(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">blob</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"img\"</span>);         </span><br><span class=\"line\">        <span class=\"keyword\">var</span> url = URL.createObjectURL(blob);</span><br><span class=\"line\">        img.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            URL.revokeObjectURL(url);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        img.src = url;</span><br><span class=\"line\">        <span class=\"built_in\">document</span>.body.appendChild(img);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>得出错误：</p>\n<blockquote>\n<p>Uncaught TypeError: canvas.toBlob is not a function.</p>\n</blockquote>\n<p>一开始觉得自己写错了，<code>Google</code>了下才发现<code>Chrome</code>居然不支持这个接口。给个<code>polyfill</code><a href=\"https://github.com/X-Builder/JavaScript-Canvas-to-Blob/blob/master/js/canvas-to-blob.js\" target=\"_blank\" rel=\"noopener\">Canvas toBlob</a>。</p>\n<p>–</p>\n<p><strong>Blob基本运用</strong></p>\n<p>知道了<code>Blob</code>对象的基本属性，以及构建的方法，来看几个具体的运用。</p>\n<p>–</p>\n<p><strong>利用<code>Blob</code>显示对象`</strong><br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]);</span><br><span class=\"line\"><span class=\"keyword\">var</span> src = URL.createObjectURL(blob);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(src);<span class=\"comment\">//blob:http%3A//localhost%3A8003/a47ea163-c253-471a-9d9e-877fe345b60f</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">img.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    URL.invokeObjectURL(img.src);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">img.src = src;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(img);</span><br></pre></td></tr></table></figure></p>\n<p>由于<code>blob</code>对象不是一个有效的文件，所以不能正常显示图片。上面的<code>demo</code>提到了一个<code>URL.createObjectURL</code>接口，顺便来学习以下：</p>\n<blockquote>\n<p>objectURL = URL.createObjectURL(blob);</p>\n</blockquote>\n<p>主要用于根据一个<code>Blob</code>对象(或者<code>File</code>,因为<code>File</code>继承自<code>Blob</code>)，创建一个<code>URL</code>用于表示该对象。需要注意的是即使对同一个对象调用两次也会得到不同的<code>URL</code>。如果该<code>URL</code>不用了需要调用<code>URL.invokeObjectURL</code>来进行释放。浏览器会在当前<code>document unloaded</code>的时候自动把该<code>URL</code>释放。<code>URL</code>格式：</p>\n<blockquote>\n<p>blob:http%3A//localhost%3A8003/a47ea163-c253-471a-9d9e-877fe345b60f</p>\n</blockquote>\n<p>最后来看一个正常点的<code>DEMO</code>，利用<code>URL.createObjectURL</code>读取本地图片文件，并创建缩略图。</p>\n<p>–</p>\n<p><strong>利用<code>Blob</code>显示缩略图`</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">var</span> input = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"input\"</span>);</span><br><span class=\"line\"> input.type = <span class=\"string\">\"file\"</span>;</span><br><span class=\"line\"> input.accept = <span class=\"string\">\"image/*\"</span>;</span><br><span class=\"line\"> input.multiple = <span class=\"literal\">true</span>;</span><br><span class=\"line\"> input.style.display = <span class=\"string\">\"none\"</span>;</span><br><span class=\"line\"> <span class=\"built_in\">document</span>.body.appendChild(input);</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">var</span> fileSelect = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"a\"</span>);</span><br><span class=\"line\"> fileSelect.href = <span class=\"string\">\"#\"</span>;</span><br><span class=\"line\"> fileSelect.appendChild(<span class=\"built_in\">document</span>.createTextNode(<span class=\"string\">\"Choose files\"</span>));</span><br><span class=\"line\"> <span class=\"built_in\">document</span>.body.appendChild(fileSelect);</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">var</span> imgList = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"div\"</span>);</span><br><span class=\"line\"> imgList.innerHTML = <span class=\"string\">\"&lt;p&gt;No file Selected!&lt;/p&gt;\"</span></span><br><span class=\"line\"> <span class=\"built_in\">document</span>.body.appendChild(imgList);</span><br><span class=\"line\"></span><br><span class=\"line\"> input.addEventListener(<span class=\"string\">\"change\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\"> <span class=\"keyword\">var</span> files = <span class=\"keyword\">this</span>.files;</span><br><span class=\"line\"> <span class=\"keyword\">if</span>(!files.length) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> imgList.innerHTML = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\"> <span class=\"keyword\">var</span> list = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"ul\"</span>);</span><br><span class=\"line\"> imgList.appendChild(list);</span><br><span class=\"line\"> <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; files.length; i++) &#123;</span><br><span class=\"line\">     <span class=\"keyword\">var</span> li = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"li\"</span>); </span><br><span class=\"line\">     list.appendChild(li);</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"img\"</span>);</span><br><span class=\"line\">     img.src = <span class=\"built_in\">window</span>.URL.createObjectURL(files[i]);</span><br><span class=\"line\">     img.height = <span class=\"number\">60</span>;</span><br><span class=\"line\">     img.width  = <span class=\"number\">60</span>;</span><br><span class=\"line\">     img.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">         <span class=\"built_in\">window</span>.URL.revokeObjectURL(<span class=\"keyword\">this</span>.src);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     li.appendChild(img);</span><br><span class=\"line\">     <span class=\"keyword\">var</span> info = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"span\"</span>);</span><br><span class=\"line\">     info.innerHTML = files[i].name + <span class=\"string\">\":\"</span> + files[i].size + <span class=\"string\">\" bytes\"</span>;</span><br><span class=\"line\">     li.appendChild(info);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">fileSelect.addEventListener(<span class=\"string\">\"click\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  input.click();     </span><br><span class=\"line\">       e.preventDefault();</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);</span><br></pre></td></tr></table></figure>\n<p>由于<code>File</code>对象继承自<code>Blob</code>,所以我们可以很方便的利用<code>File</code>对象加载本地系统图片文件，并通过<code>createObjectURL</code>生成一个<code>URL</code>并加以显示。</p>\n<p>参考文献：</p>\n<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Blob\" target=\"_blank\" rel=\"noopener\">Blob</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Using_files_from_web_applications\" target=\"_blank\" rel=\"noopener\">Using_files_from_web</a></li>\n</ul>\n"},{"title":"CSS-background","date":"2016-08-25T02:44:09.000Z","_content":"\n# CSS`background`属性总结\n\n## 基本属性\n\n- background-color\n- background-image\n- background-size\n- background-position\n- background-origin\n- background-attachment\n- background-clip\n\n---\n\n## `background-color`\n\n顾名思义`background-color`用于设置元素的背景颜色,这应该是最好理解的属性之一了。但是有几点需要注意：\n\n>- 1、背景颜色涵盖了边框、padding、以及`content`区域(通过-background-clip属性控制,后面会看到) \n>- 2、背景颜色、边框、背景图片的层次从下到上顺序为：背景颜色=》背景图片=》边框，所以如果把边框样式设置伪`dashed`可以看到透过的背景颜色与图片.\n\n---\n\n## `background-image`\n\n`image`属性用于指定元素背景图片，除了图片还可以用`radial-gradient`或者`linear-gradient`函数创建一个渐变的图像对象。还可以给一个元素设置多个图像，后设置的图像在上面一层。\n\n---\n\n## `background-position`\n\n`position`属性用于控制背景图片的位置，有三种类型的值可以设置：\n\n>- 1、直接设置关键字,水平方向：`left`、`center`、`right`,垂直方向：`top`、`center`、`bottom`.可以把背景图片看成相对于背景区域绝对定位，这样就比较好理解了。\n>- 2、使用像素值控制位置, 使用像素值的时候可以想像把背景图片相对定位，即：默认状态图片的位置为背景区域的左上角，这个时候修改背景图片的位置实际上是相对于背景区域的左上角做偏移。\n>- 3、使用百分比定位，这个属性不太好理解，简单说来一句话：`把背景图片百分比的位置放置到背景区域对应百分比的位置`.百分比定位的一个好处就在于，背景图片根据背景区域的放大而适配。\n\n注意：\n>如果只设置了一个值，另外一个值将会是`50%`。不管是何种方式都是如此。\n\n---\n\n## `background-origin`\n\n`origin`属性指定了背景图片属性的原点相对位置，默认值：`padding-box`,可选值有：\n\n- `content-box`,元素内容区域\n- `border-box`,元素边框以内区域\n- `padding-box`,元素内边距以内区域\n\n注意：\n>如果`background-attachment`设置为`fixed`则忽略该属性。\n\n---\n\n## `background-attachment`\n\n`attachment`属性决定背景图片滚动或者固定。可选属性：\n\n- `fixed`,固定，相对视口做定位，类似于position属性的`fixed`。\n- `scroll`,**相对元素自身的位置固定**，不根据元素内容滚动。\n- `local`,**相对元素内容的位置固定**，根据元素内容滚动。\n\n在线demo:[scroll local fixed](http://jsfiddle.net/n88cZ/1/)\n\n---\n\n## `background-size`\n\n`size`控制背景图片的显示区域大小，可以指定具体的宽高、也可以设置关键字、\n\n### `background-size`关键字\n\n- auto\n  默认值，背景图片大小等与图片本身的大小。\n\n- contain\n  包含，背景区域确保能放下整个图片，这样有可能造成背景图片没有涵盖整个背景区域的效果，但是图片能得到完整显示。\n\n- cover\n  覆盖，用背景图片覆盖背景区域，这样会造成背景图片显示不全的情况，但是整个背景区域能被背景图片覆盖。\n\n### `background-size`指定大小\n\n- 指定一个值\n  这个时候另外一个属性会按照元素宽高比例缩放\n\n- 指定两个值\n  这个时候背景图片会被缩放到指定大小。\n\n---\n\n## `background-clip`\n\n\n`clip`属性用于控制，**背景图片和颜色**延伸的区域，可选属性：\n\n- border-box\n  默认值，允许背景图片和颜色延伸到边框\n\n- padding-box\n  允许背景图片和颜色延伸到内边距\n\n- content-box\n  允许背景图片和颜色延伸到内容区\n\n- inherit\n  继承\n","source":"_posts/CSS-background.md","raw":"---\ntitle: CSS-background\ndate: 2016-08-25 10:44:09\ntags: css background\ncategories: web\n---\n\n# CSS`background`属性总结\n\n## 基本属性\n\n- background-color\n- background-image\n- background-size\n- background-position\n- background-origin\n- background-attachment\n- background-clip\n\n---\n\n## `background-color`\n\n顾名思义`background-color`用于设置元素的背景颜色,这应该是最好理解的属性之一了。但是有几点需要注意：\n\n>- 1、背景颜色涵盖了边框、padding、以及`content`区域(通过-background-clip属性控制,后面会看到) \n>- 2、背景颜色、边框、背景图片的层次从下到上顺序为：背景颜色=》背景图片=》边框，所以如果把边框样式设置伪`dashed`可以看到透过的背景颜色与图片.\n\n---\n\n## `background-image`\n\n`image`属性用于指定元素背景图片，除了图片还可以用`radial-gradient`或者`linear-gradient`函数创建一个渐变的图像对象。还可以给一个元素设置多个图像，后设置的图像在上面一层。\n\n---\n\n## `background-position`\n\n`position`属性用于控制背景图片的位置，有三种类型的值可以设置：\n\n>- 1、直接设置关键字,水平方向：`left`、`center`、`right`,垂直方向：`top`、`center`、`bottom`.可以把背景图片看成相对于背景区域绝对定位，这样就比较好理解了。\n>- 2、使用像素值控制位置, 使用像素值的时候可以想像把背景图片相对定位，即：默认状态图片的位置为背景区域的左上角，这个时候修改背景图片的位置实际上是相对于背景区域的左上角做偏移。\n>- 3、使用百分比定位，这个属性不太好理解，简单说来一句话：`把背景图片百分比的位置放置到背景区域对应百分比的位置`.百分比定位的一个好处就在于，背景图片根据背景区域的放大而适配。\n\n注意：\n>如果只设置了一个值，另外一个值将会是`50%`。不管是何种方式都是如此。\n\n---\n\n## `background-origin`\n\n`origin`属性指定了背景图片属性的原点相对位置，默认值：`padding-box`,可选值有：\n\n- `content-box`,元素内容区域\n- `border-box`,元素边框以内区域\n- `padding-box`,元素内边距以内区域\n\n注意：\n>如果`background-attachment`设置为`fixed`则忽略该属性。\n\n---\n\n## `background-attachment`\n\n`attachment`属性决定背景图片滚动或者固定。可选属性：\n\n- `fixed`,固定，相对视口做定位，类似于position属性的`fixed`。\n- `scroll`,**相对元素自身的位置固定**，不根据元素内容滚动。\n- `local`,**相对元素内容的位置固定**，根据元素内容滚动。\n\n在线demo:[scroll local fixed](http://jsfiddle.net/n88cZ/1/)\n\n---\n\n## `background-size`\n\n`size`控制背景图片的显示区域大小，可以指定具体的宽高、也可以设置关键字、\n\n### `background-size`关键字\n\n- auto\n  默认值，背景图片大小等与图片本身的大小。\n\n- contain\n  包含，背景区域确保能放下整个图片，这样有可能造成背景图片没有涵盖整个背景区域的效果，但是图片能得到完整显示。\n\n- cover\n  覆盖，用背景图片覆盖背景区域，这样会造成背景图片显示不全的情况，但是整个背景区域能被背景图片覆盖。\n\n### `background-size`指定大小\n\n- 指定一个值\n  这个时候另外一个属性会按照元素宽高比例缩放\n\n- 指定两个值\n  这个时候背景图片会被缩放到指定大小。\n\n---\n\n## `background-clip`\n\n\n`clip`属性用于控制，**背景图片和颜色**延伸的区域，可选属性：\n\n- border-box\n  默认值，允许背景图片和颜色延伸到边框\n\n- padding-box\n  允许背景图片和颜色延伸到内边距\n\n- content-box\n  允许背景图片和颜色延伸到内容区\n\n- inherit\n  继承\n","slug":"CSS-background","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlwq00059co7xt2i4tuy","content":"<h1 id=\"CSSbackground属性总结\"><a href=\"#CSSbackground属性总结\" class=\"headerlink\" title=\"CSSbackground属性总结\"></a>CSS<code>background</code>属性总结</h1><h2 id=\"基本属性\"><a href=\"#基本属性\" class=\"headerlink\" title=\"基本属性\"></a>基本属性</h2><ul>\n<li>background-color</li>\n<li>background-image</li>\n<li>background-size</li>\n<li>background-position</li>\n<li>background-origin</li>\n<li>background-attachment</li>\n<li>background-clip</li>\n</ul>\n<hr>\n<h2 id=\"background-color\"><a href=\"#background-color\" class=\"headerlink\" title=\"background-color\"></a><code>background-color</code></h2><p>顾名思义<code>background-color</code>用于设置元素的背景颜色,这应该是最好理解的属性之一了。但是有几点需要注意：</p>\n<blockquote>\n<ul>\n<li>1、背景颜色涵盖了边框、padding、以及<code>content</code>区域(通过-background-clip属性控制,后面会看到) </li>\n<li>2、背景颜色、边框、背景图片的层次从下到上顺序为：背景颜色=》背景图片=》边框，所以如果把边框样式设置伪<code>dashed</code>可以看到透过的背景颜色与图片.</li>\n</ul>\n</blockquote>\n<hr>\n<h2 id=\"background-image\"><a href=\"#background-image\" class=\"headerlink\" title=\"background-image\"></a><code>background-image</code></h2><p><code>image</code>属性用于指定元素背景图片，除了图片还可以用<code>radial-gradient</code>或者<code>linear-gradient</code>函数创建一个渐变的图像对象。还可以给一个元素设置多个图像，后设置的图像在上面一层。</p>\n<hr>\n<h2 id=\"background-position\"><a href=\"#background-position\" class=\"headerlink\" title=\"background-position\"></a><code>background-position</code></h2><p><code>position</code>属性用于控制背景图片的位置，有三种类型的值可以设置：</p>\n<blockquote>\n<ul>\n<li>1、直接设置关键字,水平方向：<code>left</code>、<code>center</code>、<code>right</code>,垂直方向：<code>top</code>、<code>center</code>、<code>bottom</code>.可以把背景图片看成相对于背景区域绝对定位，这样就比较好理解了。</li>\n<li>2、使用像素值控制位置, 使用像素值的时候可以想像把背景图片相对定位，即：默认状态图片的位置为背景区域的左上角，这个时候修改背景图片的位置实际上是相对于背景区域的左上角做偏移。</li>\n<li>3、使用百分比定位，这个属性不太好理解，简单说来一句话：<code>把背景图片百分比的位置放置到背景区域对应百分比的位置</code>.百分比定位的一个好处就在于，背景图片根据背景区域的放大而适配。</li>\n</ul>\n</blockquote>\n<p>注意：</p>\n<blockquote>\n<p>如果只设置了一个值，另外一个值将会是<code>50%</code>。不管是何种方式都是如此。</p>\n</blockquote>\n<hr>\n<h2 id=\"background-origin\"><a href=\"#background-origin\" class=\"headerlink\" title=\"background-origin\"></a><code>background-origin</code></h2><p><code>origin</code>属性指定了背景图片属性的原点相对位置，默认值：<code>padding-box</code>,可选值有：</p>\n<ul>\n<li><code>content-box</code>,元素内容区域</li>\n<li><code>border-box</code>,元素边框以内区域</li>\n<li><code>padding-box</code>,元素内边距以内区域</li>\n</ul>\n<p>注意：</p>\n<blockquote>\n<p>如果<code>background-attachment</code>设置为<code>fixed</code>则忽略该属性。</p>\n</blockquote>\n<hr>\n<h2 id=\"background-attachment\"><a href=\"#background-attachment\" class=\"headerlink\" title=\"background-attachment\"></a><code>background-attachment</code></h2><p><code>attachment</code>属性决定背景图片滚动或者固定。可选属性：</p>\n<ul>\n<li><code>fixed</code>,固定，相对视口做定位，类似于position属性的<code>fixed</code>。</li>\n<li><code>scroll</code>,<strong>相对元素自身的位置固定</strong>，不根据元素内容滚动。</li>\n<li><code>local</code>,<strong>相对元素内容的位置固定</strong>，根据元素内容滚动。</li>\n</ul>\n<p>在线demo:<a href=\"http://jsfiddle.net/n88cZ/1/\" target=\"_blank\" rel=\"noopener\">scroll local fixed</a></p>\n<hr>\n<h2 id=\"background-size\"><a href=\"#background-size\" class=\"headerlink\" title=\"background-size\"></a><code>background-size</code></h2><p><code>size</code>控制背景图片的显示区域大小，可以指定具体的宽高、也可以设置关键字、</p>\n<h3 id=\"background-size关键字\"><a href=\"#background-size关键字\" class=\"headerlink\" title=\"background-size关键字\"></a><code>background-size</code>关键字</h3><ul>\n<li><p>auto<br>默认值，背景图片大小等与图片本身的大小。</p>\n</li>\n<li><p>contain<br>包含，背景区域确保能放下整个图片，这样有可能造成背景图片没有涵盖整个背景区域的效果，但是图片能得到完整显示。</p>\n</li>\n<li><p>cover<br>覆盖，用背景图片覆盖背景区域，这样会造成背景图片显示不全的情况，但是整个背景区域能被背景图片覆盖。</p>\n</li>\n</ul>\n<h3 id=\"background-size指定大小\"><a href=\"#background-size指定大小\" class=\"headerlink\" title=\"background-size指定大小\"></a><code>background-size</code>指定大小</h3><ul>\n<li><p>指定一个值<br>这个时候另外一个属性会按照元素宽高比例缩放</p>\n</li>\n<li><p>指定两个值<br>这个时候背景图片会被缩放到指定大小。</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"background-clip\"><a href=\"#background-clip\" class=\"headerlink\" title=\"background-clip\"></a><code>background-clip</code></h2><p><code>clip</code>属性用于控制，<strong>背景图片和颜色</strong>延伸的区域，可选属性：</p>\n<ul>\n<li><p>border-box<br>默认值，允许背景图片和颜色延伸到边框</p>\n</li>\n<li><p>padding-box<br>允许背景图片和颜色延伸到内边距</p>\n</li>\n<li><p>content-box<br>允许背景图片和颜色延伸到内容区</p>\n</li>\n<li><p>inherit<br>继承</p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"CSSbackground属性总结\"><a href=\"#CSSbackground属性总结\" class=\"headerlink\" title=\"CSSbackground属性总结\"></a>CSS<code>background</code>属性总结</h1><h2 id=\"基本属性\"><a href=\"#基本属性\" class=\"headerlink\" title=\"基本属性\"></a>基本属性</h2><ul>\n<li>background-color</li>\n<li>background-image</li>\n<li>background-size</li>\n<li>background-position</li>\n<li>background-origin</li>\n<li>background-attachment</li>\n<li>background-clip</li>\n</ul>\n<hr>\n<h2 id=\"background-color\"><a href=\"#background-color\" class=\"headerlink\" title=\"background-color\"></a><code>background-color</code></h2><p>顾名思义<code>background-color</code>用于设置元素的背景颜色,这应该是最好理解的属性之一了。但是有几点需要注意：</p>\n<blockquote>\n<ul>\n<li>1、背景颜色涵盖了边框、padding、以及<code>content</code>区域(通过-background-clip属性控制,后面会看到) </li>\n<li>2、背景颜色、边框、背景图片的层次从下到上顺序为：背景颜色=》背景图片=》边框，所以如果把边框样式设置伪<code>dashed</code>可以看到透过的背景颜色与图片.</li>\n</ul>\n</blockquote>\n<hr>\n<h2 id=\"background-image\"><a href=\"#background-image\" class=\"headerlink\" title=\"background-image\"></a><code>background-image</code></h2><p><code>image</code>属性用于指定元素背景图片，除了图片还可以用<code>radial-gradient</code>或者<code>linear-gradient</code>函数创建一个渐变的图像对象。还可以给一个元素设置多个图像，后设置的图像在上面一层。</p>\n<hr>\n<h2 id=\"background-position\"><a href=\"#background-position\" class=\"headerlink\" title=\"background-position\"></a><code>background-position</code></h2><p><code>position</code>属性用于控制背景图片的位置，有三种类型的值可以设置：</p>\n<blockquote>\n<ul>\n<li>1、直接设置关键字,水平方向：<code>left</code>、<code>center</code>、<code>right</code>,垂直方向：<code>top</code>、<code>center</code>、<code>bottom</code>.可以把背景图片看成相对于背景区域绝对定位，这样就比较好理解了。</li>\n<li>2、使用像素值控制位置, 使用像素值的时候可以想像把背景图片相对定位，即：默认状态图片的位置为背景区域的左上角，这个时候修改背景图片的位置实际上是相对于背景区域的左上角做偏移。</li>\n<li>3、使用百分比定位，这个属性不太好理解，简单说来一句话：<code>把背景图片百分比的位置放置到背景区域对应百分比的位置</code>.百分比定位的一个好处就在于，背景图片根据背景区域的放大而适配。</li>\n</ul>\n</blockquote>\n<p>注意：</p>\n<blockquote>\n<p>如果只设置了一个值，另外一个值将会是<code>50%</code>。不管是何种方式都是如此。</p>\n</blockquote>\n<hr>\n<h2 id=\"background-origin\"><a href=\"#background-origin\" class=\"headerlink\" title=\"background-origin\"></a><code>background-origin</code></h2><p><code>origin</code>属性指定了背景图片属性的原点相对位置，默认值：<code>padding-box</code>,可选值有：</p>\n<ul>\n<li><code>content-box</code>,元素内容区域</li>\n<li><code>border-box</code>,元素边框以内区域</li>\n<li><code>padding-box</code>,元素内边距以内区域</li>\n</ul>\n<p>注意：</p>\n<blockquote>\n<p>如果<code>background-attachment</code>设置为<code>fixed</code>则忽略该属性。</p>\n</blockquote>\n<hr>\n<h2 id=\"background-attachment\"><a href=\"#background-attachment\" class=\"headerlink\" title=\"background-attachment\"></a><code>background-attachment</code></h2><p><code>attachment</code>属性决定背景图片滚动或者固定。可选属性：</p>\n<ul>\n<li><code>fixed</code>,固定，相对视口做定位，类似于position属性的<code>fixed</code>。</li>\n<li><code>scroll</code>,<strong>相对元素自身的位置固定</strong>，不根据元素内容滚动。</li>\n<li><code>local</code>,<strong>相对元素内容的位置固定</strong>，根据元素内容滚动。</li>\n</ul>\n<p>在线demo:<a href=\"http://jsfiddle.net/n88cZ/1/\" target=\"_blank\" rel=\"noopener\">scroll local fixed</a></p>\n<hr>\n<h2 id=\"background-size\"><a href=\"#background-size\" class=\"headerlink\" title=\"background-size\"></a><code>background-size</code></h2><p><code>size</code>控制背景图片的显示区域大小，可以指定具体的宽高、也可以设置关键字、</p>\n<h3 id=\"background-size关键字\"><a href=\"#background-size关键字\" class=\"headerlink\" title=\"background-size关键字\"></a><code>background-size</code>关键字</h3><ul>\n<li><p>auto<br>默认值，背景图片大小等与图片本身的大小。</p>\n</li>\n<li><p>contain<br>包含，背景区域确保能放下整个图片，这样有可能造成背景图片没有涵盖整个背景区域的效果，但是图片能得到完整显示。</p>\n</li>\n<li><p>cover<br>覆盖，用背景图片覆盖背景区域，这样会造成背景图片显示不全的情况，但是整个背景区域能被背景图片覆盖。</p>\n</li>\n</ul>\n<h3 id=\"background-size指定大小\"><a href=\"#background-size指定大小\" class=\"headerlink\" title=\"background-size指定大小\"></a><code>background-size</code>指定大小</h3><ul>\n<li><p>指定一个值<br>这个时候另外一个属性会按照元素宽高比例缩放</p>\n</li>\n<li><p>指定两个值<br>这个时候背景图片会被缩放到指定大小。</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"background-clip\"><a href=\"#background-clip\" class=\"headerlink\" title=\"background-clip\"></a><code>background-clip</code></h2><p><code>clip</code>属性用于控制，<strong>背景图片和颜色</strong>延伸的区域，可选属性：</p>\n<ul>\n<li><p>border-box<br>默认值，允许背景图片和颜色延伸到边框</p>\n</li>\n<li><p>padding-box<br>允许背景图片和颜色延伸到内边距</p>\n</li>\n<li><p>content-box<br>允许背景图片和颜色延伸到内容区</p>\n</li>\n<li><p>inherit<br>继承</p>\n</li>\n</ul>\n"},{"title":"CSSMastery读书笔记(一)","date":"2016-08-20T07:04:29.000Z","_content":"\n\n# 基础知识\n\n## 1、语义化编程\n\n>`html`每个标签都有特殊含义，不建议混乱使用标签，这样有利于搜索引擎抓取页面信息，以及更好的维护代码。\n\n## 2、HTML4和HTML5\n\n>`html4`提供了一些简单的文档标记元素，而`html5`在此基础之上提供更多的元素如：`header`、`nav`等，满足`web`页面的`UI`特性。\n\n## 3、元素类以及`id`\n\n>类命名应该根据元素`是什么`而不是元素的外观来命名、类名和`id`区分大小写，最好的方式是使用连接符号把单词分隔。\n\n## 4、多类症以及多`div`症\n\n> 应该谨慎的使用类名、例如一些元素的样式可以通过使用选择器来设置，而不用为每个元素都设置一个类。`div`元素的语义表示一个区域、一块。对于一些不需要`div`包装的元素则不应该使用`div`，\n譬如说：`nav`元素构建一个导航条，里面多个`li`元素构成的条目，此时不需要用`div`来把`nav`包装起来。\n\n## 5、微格式\n\n>微格式解决了`html`元素不能表示特定信息的缺点：如`日期`等。\n\n## 6、`html`与`xhtml`\n\n>1999发布了`html4.01`而对应的`xml`版本为`xhtml1.0`,两个差异在于\n- xml元素属性必须用引号包裹\n- xml元素必须封闭\n\n## 7、DOCTYPE的作用\n\n>web页面都会有一个`DOCTYPE`声明，浏览器根据其来了解使用哪个版本的`DTD`来解析页面，由此也知道使用的是哪个版本的`html`。\n`DTD`又分为严格模式和过渡模式，严格模式不允许使用已经废弃的元素如`font`等，而过渡模式有助于引导开发者过渡到新版本的`html`。\n总结一下`DOCTYPE`声明的作用：\n- 浏览器验证页面的有效性\n- 浏览器模式切换(标准/混杂)实现向后兼容","source":"_posts/CSSMastery读书笔记一-基础知识.md","raw":"---\ntitle: CSSMastery读书笔记(一)\ndate: 2016-08-20 15:04:29\ntags: css-mastery\ncategories: web\n---\n\n\n# 基础知识\n\n## 1、语义化编程\n\n>`html`每个标签都有特殊含义，不建议混乱使用标签，这样有利于搜索引擎抓取页面信息，以及更好的维护代码。\n\n## 2、HTML4和HTML5\n\n>`html4`提供了一些简单的文档标记元素，而`html5`在此基础之上提供更多的元素如：`header`、`nav`等，满足`web`页面的`UI`特性。\n\n## 3、元素类以及`id`\n\n>类命名应该根据元素`是什么`而不是元素的外观来命名、类名和`id`区分大小写，最好的方式是使用连接符号把单词分隔。\n\n## 4、多类症以及多`div`症\n\n> 应该谨慎的使用类名、例如一些元素的样式可以通过使用选择器来设置，而不用为每个元素都设置一个类。`div`元素的语义表示一个区域、一块。对于一些不需要`div`包装的元素则不应该使用`div`，\n譬如说：`nav`元素构建一个导航条，里面多个`li`元素构成的条目，此时不需要用`div`来把`nav`包装起来。\n\n## 5、微格式\n\n>微格式解决了`html`元素不能表示特定信息的缺点：如`日期`等。\n\n## 6、`html`与`xhtml`\n\n>1999发布了`html4.01`而对应的`xml`版本为`xhtml1.0`,两个差异在于\n- xml元素属性必须用引号包裹\n- xml元素必须封闭\n\n## 7、DOCTYPE的作用\n\n>web页面都会有一个`DOCTYPE`声明，浏览器根据其来了解使用哪个版本的`DTD`来解析页面，由此也知道使用的是哪个版本的`html`。\n`DTD`又分为严格模式和过渡模式，严格模式不允许使用已经废弃的元素如`font`等，而过渡模式有助于引导开发者过渡到新版本的`html`。\n总结一下`DOCTYPE`声明的作用：\n- 浏览器验证页面的有效性\n- 浏览器模式切换(标准/混杂)实现向后兼容","slug":"CSSMastery读书笔记一-基础知识","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlwu00069co7x4vwrtsf","content":"<h1 id=\"基础知识\"><a href=\"#基础知识\" class=\"headerlink\" title=\"基础知识\"></a>基础知识</h1><h2 id=\"1、语义化编程\"><a href=\"#1、语义化编程\" class=\"headerlink\" title=\"1、语义化编程\"></a>1、语义化编程</h2><blockquote>\n<p><code>html</code>每个标签都有特殊含义，不建议混乱使用标签，这样有利于搜索引擎抓取页面信息，以及更好的维护代码。</p>\n</blockquote>\n<h2 id=\"2、HTML4和HTML5\"><a href=\"#2、HTML4和HTML5\" class=\"headerlink\" title=\"2、HTML4和HTML5\"></a>2、HTML4和HTML5</h2><blockquote>\n<p><code>html4</code>提供了一些简单的文档标记元素，而<code>html5</code>在此基础之上提供更多的元素如：<code>header</code>、<code>nav</code>等，满足<code>web</code>页面的<code>UI</code>特性。</p>\n</blockquote>\n<h2 id=\"3、元素类以及id\"><a href=\"#3、元素类以及id\" class=\"headerlink\" title=\"3、元素类以及id\"></a>3、元素类以及<code>id</code></h2><blockquote>\n<p>类命名应该根据元素<code>是什么</code>而不是元素的外观来命名、类名和<code>id</code>区分大小写，最好的方式是使用连接符号把单词分隔。</p>\n</blockquote>\n<h2 id=\"4、多类症以及多div症\"><a href=\"#4、多类症以及多div症\" class=\"headerlink\" title=\"4、多类症以及多div症\"></a>4、多类症以及多<code>div</code>症</h2><blockquote>\n<p>应该谨慎的使用类名、例如一些元素的样式可以通过使用选择器来设置，而不用为每个元素都设置一个类。<code>div</code>元素的语义表示一个区域、一块。对于一些不需要<code>div</code>包装的元素则不应该使用<code>div</code>，<br>譬如说：<code>nav</code>元素构建一个导航条，里面多个<code>li</code>元素构成的条目，此时不需要用<code>div</code>来把<code>nav</code>包装起来。</p>\n</blockquote>\n<h2 id=\"5、微格式\"><a href=\"#5、微格式\" class=\"headerlink\" title=\"5、微格式\"></a>5、微格式</h2><blockquote>\n<p>微格式解决了<code>html</code>元素不能表示特定信息的缺点：如<code>日期</code>等。</p>\n</blockquote>\n<h2 id=\"6、html与xhtml\"><a href=\"#6、html与xhtml\" class=\"headerlink\" title=\"6、html与xhtml\"></a>6、<code>html</code>与<code>xhtml</code></h2><blockquote>\n<p>1999发布了<code>html4.01</code>而对应的<code>xml</code>版本为<code>xhtml1.0</code>,两个差异在于</p>\n<ul>\n<li>xml元素属性必须用引号包裹</li>\n<li>xml元素必须封闭</li>\n</ul>\n</blockquote>\n<h2 id=\"7、DOCTYPE的作用\"><a href=\"#7、DOCTYPE的作用\" class=\"headerlink\" title=\"7、DOCTYPE的作用\"></a>7、DOCTYPE的作用</h2><blockquote>\n<p>web页面都会有一个<code>DOCTYPE</code>声明，浏览器根据其来了解使用哪个版本的<code>DTD</code>来解析页面，由此也知道使用的是哪个版本的<code>html</code>。<br><code>DTD</code>又分为严格模式和过渡模式，严格模式不允许使用已经废弃的元素如<code>font</code>等，而过渡模式有助于引导开发者过渡到新版本的<code>html</code>。<br>总结一下<code>DOCTYPE</code>声明的作用：</p>\n<ul>\n<li>浏览器验证页面的有效性</li>\n<li>浏览器模式切换(标准/混杂)实现向后兼容</li>\n</ul>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"基础知识\"><a href=\"#基础知识\" class=\"headerlink\" title=\"基础知识\"></a>基础知识</h1><h2 id=\"1、语义化编程\"><a href=\"#1、语义化编程\" class=\"headerlink\" title=\"1、语义化编程\"></a>1、语义化编程</h2><blockquote>\n<p><code>html</code>每个标签都有特殊含义，不建议混乱使用标签，这样有利于搜索引擎抓取页面信息，以及更好的维护代码。</p>\n</blockquote>\n<h2 id=\"2、HTML4和HTML5\"><a href=\"#2、HTML4和HTML5\" class=\"headerlink\" title=\"2、HTML4和HTML5\"></a>2、HTML4和HTML5</h2><blockquote>\n<p><code>html4</code>提供了一些简单的文档标记元素，而<code>html5</code>在此基础之上提供更多的元素如：<code>header</code>、<code>nav</code>等，满足<code>web</code>页面的<code>UI</code>特性。</p>\n</blockquote>\n<h2 id=\"3、元素类以及id\"><a href=\"#3、元素类以及id\" class=\"headerlink\" title=\"3、元素类以及id\"></a>3、元素类以及<code>id</code></h2><blockquote>\n<p>类命名应该根据元素<code>是什么</code>而不是元素的外观来命名、类名和<code>id</code>区分大小写，最好的方式是使用连接符号把单词分隔。</p>\n</blockquote>\n<h2 id=\"4、多类症以及多div症\"><a href=\"#4、多类症以及多div症\" class=\"headerlink\" title=\"4、多类症以及多div症\"></a>4、多类症以及多<code>div</code>症</h2><blockquote>\n<p>应该谨慎的使用类名、例如一些元素的样式可以通过使用选择器来设置，而不用为每个元素都设置一个类。<code>div</code>元素的语义表示一个区域、一块。对于一些不需要<code>div</code>包装的元素则不应该使用<code>div</code>，<br>譬如说：<code>nav</code>元素构建一个导航条，里面多个<code>li</code>元素构成的条目，此时不需要用<code>div</code>来把<code>nav</code>包装起来。</p>\n</blockquote>\n<h2 id=\"5、微格式\"><a href=\"#5、微格式\" class=\"headerlink\" title=\"5、微格式\"></a>5、微格式</h2><blockquote>\n<p>微格式解决了<code>html</code>元素不能表示特定信息的缺点：如<code>日期</code>等。</p>\n</blockquote>\n<h2 id=\"6、html与xhtml\"><a href=\"#6、html与xhtml\" class=\"headerlink\" title=\"6、html与xhtml\"></a>6、<code>html</code>与<code>xhtml</code></h2><blockquote>\n<p>1999发布了<code>html4.01</code>而对应的<code>xml</code>版本为<code>xhtml1.0</code>,两个差异在于</p>\n<ul>\n<li>xml元素属性必须用引号包裹</li>\n<li>xml元素必须封闭</li>\n</ul>\n</blockquote>\n<h2 id=\"7、DOCTYPE的作用\"><a href=\"#7、DOCTYPE的作用\" class=\"headerlink\" title=\"7、DOCTYPE的作用\"></a>7、DOCTYPE的作用</h2><blockquote>\n<p>web页面都会有一个<code>DOCTYPE</code>声明，浏览器根据其来了解使用哪个版本的<code>DTD</code>来解析页面，由此也知道使用的是哪个版本的<code>html</code>。<br><code>DTD</code>又分为严格模式和过渡模式，严格模式不允许使用已经废弃的元素如<code>font</code>等，而过渡模式有助于引导开发者过渡到新版本的<code>html</code>。<br>总结一下<code>DOCTYPE</code>声明的作用：</p>\n<ul>\n<li>浏览器验证页面的有效性</li>\n<li>浏览器模式切换(标准/混杂)实现向后兼容</li>\n</ul>\n</blockquote>\n"},{"title":"CSS-动画详解","date":"2016-08-30T02:16:04.000Z","_content":"\n\n# `CSS`动画详解\n\n一直不喜欢一知半解的感觉，决心改变不求甚解的学习习惯。`CSS animation`使用十分广泛，特此来做一个详细的总结。\n\n---\n\n## 通过`transiton`属性控制动画\n\n基本语法：\n\n`transition: width 2s 1s ease;` `width`属性受到动画影响，动画持续时间为`2s`，动画延迟`1s`播出，动画插值算法采用`ease`。多个属性可以用逗号分隔。例如：`transition: width 2s, height 1s;`。\n\n\n`transiton`控制动画应该是最简单的方式之一了，和其他属性类似`transiton`也是一个复合属性由以下几个属性组成：\n\n- transiton-delay: 动画延时播放，默认为0\n- transiton-timing-function: 动画插值函数,默认为`ease`\n- transiton-property: 指明要发生变化的属性\n- transiton-duration: 指明动画周期(持续时间),默认为0\n\n### 动画延时\n\n  看一个`demo`,子元素宽度从0到填充父控件，延时`1s`。\n{% jsfiddle fnao3q2t css,result light 100% 400px %}\n\n鼠标进入和离开控件的时候都有`1s`延迟,这就是`transiton-delay`的效果。\n\n### 动画速度变更函数(插值函数)\n\n  `transiton-timing-function`属性用于改变动画的速度曲线。可选值有：\n\n- ease：默认参数\n- linear\n- ease-in\n- ease-out\n- ease-in-out\n- cubic-bezier\n\n关于插值函数对应的效果可以[看这里](http://easings.net/zh-cn)。\n\n说说`cubic-bezier`,由于`css`内值动画曲线比较有限，所以可以根据`cubic-bezier`规划一条贝赛尔曲线。\n{% jsfiddle k3jtsn9v css,result light 100% 400px %}\n\n推荐一个贝塞尔曲线在线编辑器：[`cubic-bezier`](http://cubic-bezier.com)。\n\n### 动画属性\n\n顾名思义，设置受到动画影响的属性。如果所有属性都受到影响，可以指定一个`all`参数。需要注意的是，`css`规定一些属性不受`transiton`影响，例如：`display`等。具体看`W3C`上[一个对应表](https://www.w3.org/TR/css3-transitions/#animatable-properties)。值得一提的是，`display`属性虽然不受影响，但是`visibility`属性会受影响。\n\n\n### 动画持续时间\n\n设置动画延迟播放时间，*注意默认为0*，除了以`s`为单位，也可以以`ms`为单位。\n\n\n>`transition`属性虽然使用方便，但是也有它的局限性:\n\n- 动画需要事件触发，无法自动播放\n- 无法重复播放，除非一直触发\n- 无法为多个属性指定同样的变化规则(写起来比较麻烦)\n- 只能控制开始和结束状态、无法定义中间态\n\n---\n\n\n## 通过`animation`属性控制动画\n\n和`transition`类似，`animation`也是一个复合属性。它提供了比较多的属性来控制动画，从而实现更加细致的控制。\n\n基本格式：\n\n`@keyframes`关键字用于定义动画的细节，比例动画名称，动画在某一时刻的状态属性值等。\n\n```css\n@keyframes anim {\n  from: {background: red;}\n  to: {background: blue;}\n}\n```\n\n上面一段`css`定义了一个动画，名称为`anim`,动画从背景红色过渡到背景蓝色，`from`表示起始时刻动画状态，`to`表示结束时刻动画状态。还可以换成百分比的形式从`0%`到`100%`。\n从而实现了在不同时刻控制动画状态的目的。\n\n{% jsfiddle Lhpfxbrm css,result light 100% 400px %}\n\n---\n\n基本属性：\n\n- animation-duration\n- animation-direction\n- animation-delay\n- animation-name\n- animation-iteration-count\n- animation-timing-function\n- animation-play-state\n- animation-fill-mode\n\n### 动画时长\n\n`animation-duration`和`transition-duration`类似，不做过多介绍，用于控制动画的时间长度。\n\n### 动画播放延时\n\n`animation-delay`和`transition-delay`类似控制动画首次播放的延时。\n\n### 动画名称\n\n`animation-name`指定元素引用哪个动画，名称通过`@keyframes`指定。\n\n### 动画方向\n\n`animation-direction`控制动画循环播放的时候状态的变更次序。看个`demo`:\n\n{% jsfiddle Lhpfxbrm css,result light 100% 400px %}\n\n可选的属性：\n\n- normal: 每次都从起始状态变更到终止状态\n- reverse: 每次都从终止状态变更到起始状态\n- alternate: 奇数次从起始状态变更到结束状态、偶数次从结束状态变更到起始状态\n- alternate-reverse: 与`alternate`相反\n\n### 动画结束的状态\n\n`animation-fill-mode`属性控制动画结束播放时候的状态，看个`demo`：\n\n{% jsfiddle geLw2de5 css,result light 100% 400px %}\n\n- forwards: 让动画停留在最后一帧\n- backwards: 让动画停留在第一帧\n- both: 根据`animation-direction`控制使用`forwards`或者`backwards`。\n\n### 动画播放次数\n\n`animation-iteration-count`属性控制动画播放次数，默认为`1次`, 设置`infinite`表示无限循环播放。\n\n\n### 动画插值函数\n\n`animation-timing-function`控制动画插值函数，和`transition-timing-function`类似。\n\n### 控制动画状态\n\n`animation-play-state`属性用于控制动画播放的状态，默认情况，自动开始播放，通过设置该属性，可以控制动画播放。\n\n看一个`demo`\n\n{% jsfiddle 2Law411w css,result light 100% 400px %}\n\n只有鼠标移动到方块上的时候动画才会继续播放。\n\n---\n\n参考文献：\n\n- [CSS动画简介](http://www.ruanyifeng.com/blog/2014/02/css_transition_and_animation.html)\n- [W3C css animation](https://www.w3.org/TR/css3-animations/)","source":"_posts/CSS-动画详解.md","raw":"---\ntitle: CSS-动画详解\ndate: 2016-08-30 10:16:04\ntags: transition animation\ncategories: web\n---\n\n\n# `CSS`动画详解\n\n一直不喜欢一知半解的感觉，决心改变不求甚解的学习习惯。`CSS animation`使用十分广泛，特此来做一个详细的总结。\n\n---\n\n## 通过`transiton`属性控制动画\n\n基本语法：\n\n`transition: width 2s 1s ease;` `width`属性受到动画影响，动画持续时间为`2s`，动画延迟`1s`播出，动画插值算法采用`ease`。多个属性可以用逗号分隔。例如：`transition: width 2s, height 1s;`。\n\n\n`transiton`控制动画应该是最简单的方式之一了，和其他属性类似`transiton`也是一个复合属性由以下几个属性组成：\n\n- transiton-delay: 动画延时播放，默认为0\n- transiton-timing-function: 动画插值函数,默认为`ease`\n- transiton-property: 指明要发生变化的属性\n- transiton-duration: 指明动画周期(持续时间),默认为0\n\n### 动画延时\n\n  看一个`demo`,子元素宽度从0到填充父控件，延时`1s`。\n{% jsfiddle fnao3q2t css,result light 100% 400px %}\n\n鼠标进入和离开控件的时候都有`1s`延迟,这就是`transiton-delay`的效果。\n\n### 动画速度变更函数(插值函数)\n\n  `transiton-timing-function`属性用于改变动画的速度曲线。可选值有：\n\n- ease：默认参数\n- linear\n- ease-in\n- ease-out\n- ease-in-out\n- cubic-bezier\n\n关于插值函数对应的效果可以[看这里](http://easings.net/zh-cn)。\n\n说说`cubic-bezier`,由于`css`内值动画曲线比较有限，所以可以根据`cubic-bezier`规划一条贝赛尔曲线。\n{% jsfiddle k3jtsn9v css,result light 100% 400px %}\n\n推荐一个贝塞尔曲线在线编辑器：[`cubic-bezier`](http://cubic-bezier.com)。\n\n### 动画属性\n\n顾名思义，设置受到动画影响的属性。如果所有属性都受到影响，可以指定一个`all`参数。需要注意的是，`css`规定一些属性不受`transiton`影响，例如：`display`等。具体看`W3C`上[一个对应表](https://www.w3.org/TR/css3-transitions/#animatable-properties)。值得一提的是，`display`属性虽然不受影响，但是`visibility`属性会受影响。\n\n\n### 动画持续时间\n\n设置动画延迟播放时间，*注意默认为0*，除了以`s`为单位，也可以以`ms`为单位。\n\n\n>`transition`属性虽然使用方便，但是也有它的局限性:\n\n- 动画需要事件触发，无法自动播放\n- 无法重复播放，除非一直触发\n- 无法为多个属性指定同样的变化规则(写起来比较麻烦)\n- 只能控制开始和结束状态、无法定义中间态\n\n---\n\n\n## 通过`animation`属性控制动画\n\n和`transition`类似，`animation`也是一个复合属性。它提供了比较多的属性来控制动画，从而实现更加细致的控制。\n\n基本格式：\n\n`@keyframes`关键字用于定义动画的细节，比例动画名称，动画在某一时刻的状态属性值等。\n\n```css\n@keyframes anim {\n  from: {background: red;}\n  to: {background: blue;}\n}\n```\n\n上面一段`css`定义了一个动画，名称为`anim`,动画从背景红色过渡到背景蓝色，`from`表示起始时刻动画状态，`to`表示结束时刻动画状态。还可以换成百分比的形式从`0%`到`100%`。\n从而实现了在不同时刻控制动画状态的目的。\n\n{% jsfiddle Lhpfxbrm css,result light 100% 400px %}\n\n---\n\n基本属性：\n\n- animation-duration\n- animation-direction\n- animation-delay\n- animation-name\n- animation-iteration-count\n- animation-timing-function\n- animation-play-state\n- animation-fill-mode\n\n### 动画时长\n\n`animation-duration`和`transition-duration`类似，不做过多介绍，用于控制动画的时间长度。\n\n### 动画播放延时\n\n`animation-delay`和`transition-delay`类似控制动画首次播放的延时。\n\n### 动画名称\n\n`animation-name`指定元素引用哪个动画，名称通过`@keyframes`指定。\n\n### 动画方向\n\n`animation-direction`控制动画循环播放的时候状态的变更次序。看个`demo`:\n\n{% jsfiddle Lhpfxbrm css,result light 100% 400px %}\n\n可选的属性：\n\n- normal: 每次都从起始状态变更到终止状态\n- reverse: 每次都从终止状态变更到起始状态\n- alternate: 奇数次从起始状态变更到结束状态、偶数次从结束状态变更到起始状态\n- alternate-reverse: 与`alternate`相反\n\n### 动画结束的状态\n\n`animation-fill-mode`属性控制动画结束播放时候的状态，看个`demo`：\n\n{% jsfiddle geLw2de5 css,result light 100% 400px %}\n\n- forwards: 让动画停留在最后一帧\n- backwards: 让动画停留在第一帧\n- both: 根据`animation-direction`控制使用`forwards`或者`backwards`。\n\n### 动画播放次数\n\n`animation-iteration-count`属性控制动画播放次数，默认为`1次`, 设置`infinite`表示无限循环播放。\n\n\n### 动画插值函数\n\n`animation-timing-function`控制动画插值函数，和`transition-timing-function`类似。\n\n### 控制动画状态\n\n`animation-play-state`属性用于控制动画播放的状态，默认情况，自动开始播放，通过设置该属性，可以控制动画播放。\n\n看一个`demo`\n\n{% jsfiddle 2Law411w css,result light 100% 400px %}\n\n只有鼠标移动到方块上的时候动画才会继续播放。\n\n---\n\n参考文献：\n\n- [CSS动画简介](http://www.ruanyifeng.com/blog/2014/02/css_transition_and_animation.html)\n- [W3C css animation](https://www.w3.org/TR/css3-animations/)","slug":"CSS-动画详解","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlwz00089co7drd6z7cr","content":"<h1 id=\"CSS动画详解\"><a href=\"#CSS动画详解\" class=\"headerlink\" title=\"CSS动画详解\"></a><code>CSS</code>动画详解</h1><p>一直不喜欢一知半解的感觉，决心改变不求甚解的学习习惯。<code>CSS animation</code>使用十分广泛，特此来做一个详细的总结。</p>\n<hr>\n<h2 id=\"通过transiton属性控制动画\"><a href=\"#通过transiton属性控制动画\" class=\"headerlink\" title=\"通过transiton属性控制动画\"></a>通过<code>transiton</code>属性控制动画</h2><p>基本语法：</p>\n<p><code>transition: width 2s 1s ease;</code> <code>width</code>属性受到动画影响，动画持续时间为<code>2s</code>，动画延迟<code>1s</code>播出，动画插值算法采用<code>ease</code>。多个属性可以用逗号分隔。例如：<code>transition: width 2s, height 1s;</code>。</p>\n<p><code>transiton</code>控制动画应该是最简单的方式之一了，和其他属性类似<code>transiton</code>也是一个复合属性由以下几个属性组成：</p>\n<ul>\n<li>transiton-delay: 动画延时播放，默认为0</li>\n<li>transiton-timing-function: 动画插值函数,默认为<code>ease</code></li>\n<li>transiton-property: 指明要发生变化的属性</li>\n<li>transiton-duration: 指明动画周期(持续时间),默认为0</li>\n</ul>\n<h3 id=\"动画延时\"><a href=\"#动画延时\" class=\"headerlink\" title=\"动画延时\"></a>动画延时</h3><p>  看一个<code>demo</code>,子元素宽度从0到填充父控件，延时<code>1s</code>。<br><iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/fnao3q2t/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe></p>\n<p>鼠标进入和离开控件的时候都有<code>1s</code>延迟,这就是<code>transiton-delay</code>的效果。</p>\n<h3 id=\"动画速度变更函数-插值函数\"><a href=\"#动画速度变更函数-插值函数\" class=\"headerlink\" title=\"动画速度变更函数(插值函数)\"></a>动画速度变更函数(插值函数)</h3><p>  <code>transiton-timing-function</code>属性用于改变动画的速度曲线。可选值有：</p>\n<ul>\n<li>ease：默认参数</li>\n<li>linear</li>\n<li>ease-in</li>\n<li>ease-out</li>\n<li>ease-in-out</li>\n<li>cubic-bezier</li>\n</ul>\n<p>关于插值函数对应的效果可以<a href=\"http://easings.net/zh-cn\" target=\"_blank\" rel=\"noopener\">看这里</a>。</p>\n<p>说说<code>cubic-bezier</code>,由于<code>css</code>内值动画曲线比较有限，所以可以根据<code>cubic-bezier</code>规划一条贝赛尔曲线。<br><iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/k3jtsn9v/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe></p>\n<p>推荐一个贝塞尔曲线在线编辑器：<a href=\"http://cubic-bezier.com\" target=\"_blank\" rel=\"noopener\"><code>cubic-bezier</code></a>。</p>\n<h3 id=\"动画属性\"><a href=\"#动画属性\" class=\"headerlink\" title=\"动画属性\"></a>动画属性</h3><p>顾名思义，设置受到动画影响的属性。如果所有属性都受到影响，可以指定一个<code>all</code>参数。需要注意的是，<code>css</code>规定一些属性不受<code>transiton</code>影响，例如：<code>display</code>等。具体看<code>W3C</code>上<a href=\"https://www.w3.org/TR/css3-transitions/#animatable-properties\" target=\"_blank\" rel=\"noopener\">一个对应表</a>。值得一提的是，<code>display</code>属性虽然不受影响，但是<code>visibility</code>属性会受影响。</p>\n<h3 id=\"动画持续时间\"><a href=\"#动画持续时间\" class=\"headerlink\" title=\"动画持续时间\"></a>动画持续时间</h3><p>设置动画延迟播放时间，<em>注意默认为0</em>，除了以<code>s</code>为单位，也可以以<code>ms</code>为单位。</p>\n<blockquote>\n<p><code>transition</code>属性虽然使用方便，但是也有它的局限性:</p>\n</blockquote>\n<ul>\n<li>动画需要事件触发，无法自动播放</li>\n<li>无法重复播放，除非一直触发</li>\n<li>无法为多个属性指定同样的变化规则(写起来比较麻烦)</li>\n<li>只能控制开始和结束状态、无法定义中间态</li>\n</ul>\n<hr>\n<h2 id=\"通过animation属性控制动画\"><a href=\"#通过animation属性控制动画\" class=\"headerlink\" title=\"通过animation属性控制动画\"></a>通过<code>animation</code>属性控制动画</h2><p>和<code>transition</code>类似，<code>animation</code>也是一个复合属性。它提供了比较多的属性来控制动画，从而实现更加细致的控制。</p>\n<p>基本格式：</p>\n<p><code>@keyframes</code>关键字用于定义动画的细节，比例动画名称，动画在某一时刻的状态属性值等。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">keyframes</span> anim &#123;</span><br><span class=\"line\">  <span class=\"selector-tag\">from</span>: &#123;<span class=\"attribute\">background</span>: red;&#125;</span><br><span class=\"line\">  <span class=\"selector-tag\">to</span>: &#123;<span class=\"attribute\">background</span>: blue;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面一段<code>css</code>定义了一个动画，名称为<code>anim</code>,动画从背景红色过渡到背景蓝色，<code>from</code>表示起始时刻动画状态，<code>to</code>表示结束时刻动画状态。还可以换成百分比的形式从<code>0%</code>到<code>100%</code>。<br>从而实现了在不同时刻控制动画状态的目的。</p>\n<iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/Lhpfxbrm/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<hr>\n<p>基本属性：</p>\n<ul>\n<li>animation-duration</li>\n<li>animation-direction</li>\n<li>animation-delay</li>\n<li>animation-name</li>\n<li>animation-iteration-count</li>\n<li>animation-timing-function</li>\n<li>animation-play-state</li>\n<li>animation-fill-mode</li>\n</ul>\n<h3 id=\"动画时长\"><a href=\"#动画时长\" class=\"headerlink\" title=\"动画时长\"></a>动画时长</h3><p><code>animation-duration</code>和<code>transition-duration</code>类似，不做过多介绍，用于控制动画的时间长度。</p>\n<h3 id=\"动画播放延时\"><a href=\"#动画播放延时\" class=\"headerlink\" title=\"动画播放延时\"></a>动画播放延时</h3><p><code>animation-delay</code>和<code>transition-delay</code>类似控制动画首次播放的延时。</p>\n<h3 id=\"动画名称\"><a href=\"#动画名称\" class=\"headerlink\" title=\"动画名称\"></a>动画名称</h3><p><code>animation-name</code>指定元素引用哪个动画，名称通过<code>@keyframes</code>指定。</p>\n<h3 id=\"动画方向\"><a href=\"#动画方向\" class=\"headerlink\" title=\"动画方向\"></a>动画方向</h3><p><code>animation-direction</code>控制动画循环播放的时候状态的变更次序。看个<code>demo</code>:</p>\n<iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/Lhpfxbrm/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<p>可选的属性：</p>\n<ul>\n<li>normal: 每次都从起始状态变更到终止状态</li>\n<li>reverse: 每次都从终止状态变更到起始状态</li>\n<li>alternate: 奇数次从起始状态变更到结束状态、偶数次从结束状态变更到起始状态</li>\n<li>alternate-reverse: 与<code>alternate</code>相反</li>\n</ul>\n<h3 id=\"动画结束的状态\"><a href=\"#动画结束的状态\" class=\"headerlink\" title=\"动画结束的状态\"></a>动画结束的状态</h3><p><code>animation-fill-mode</code>属性控制动画结束播放时候的状态，看个<code>demo</code>：</p>\n<iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/geLw2de5/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<ul>\n<li>forwards: 让动画停留在最后一帧</li>\n<li>backwards: 让动画停留在第一帧</li>\n<li>both: 根据<code>animation-direction</code>控制使用<code>forwards</code>或者<code>backwards</code>。</li>\n</ul>\n<h3 id=\"动画播放次数\"><a href=\"#动画播放次数\" class=\"headerlink\" title=\"动画播放次数\"></a>动画播放次数</h3><p><code>animation-iteration-count</code>属性控制动画播放次数，默认为<code>1次</code>, 设置<code>infinite</code>表示无限循环播放。</p>\n<h3 id=\"动画插值函数\"><a href=\"#动画插值函数\" class=\"headerlink\" title=\"动画插值函数\"></a>动画插值函数</h3><p><code>animation-timing-function</code>控制动画插值函数，和<code>transition-timing-function</code>类似。</p>\n<h3 id=\"控制动画状态\"><a href=\"#控制动画状态\" class=\"headerlink\" title=\"控制动画状态\"></a>控制动画状态</h3><p><code>animation-play-state</code>属性用于控制动画播放的状态，默认情况，自动开始播放，通过设置该属性，可以控制动画播放。</p>\n<p>看一个<code>demo</code></p>\n<iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/2Law411w/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<p>只有鼠标移动到方块上的时候动画才会继续播放。</p>\n<hr>\n<p>参考文献：</p>\n<ul>\n<li><a href=\"http://www.ruanyifeng.com/blog/2014/02/css_transition_and_animation.html\" target=\"_blank\" rel=\"noopener\">CSS动画简介</a></li>\n<li><a href=\"https://www.w3.org/TR/css3-animations/\" target=\"_blank\" rel=\"noopener\">W3C css animation</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"CSS动画详解\"><a href=\"#CSS动画详解\" class=\"headerlink\" title=\"CSS动画详解\"></a><code>CSS</code>动画详解</h1><p>一直不喜欢一知半解的感觉，决心改变不求甚解的学习习惯。<code>CSS animation</code>使用十分广泛，特此来做一个详细的总结。</p>\n<hr>\n<h2 id=\"通过transiton属性控制动画\"><a href=\"#通过transiton属性控制动画\" class=\"headerlink\" title=\"通过transiton属性控制动画\"></a>通过<code>transiton</code>属性控制动画</h2><p>基本语法：</p>\n<p><code>transition: width 2s 1s ease;</code> <code>width</code>属性受到动画影响，动画持续时间为<code>2s</code>，动画延迟<code>1s</code>播出，动画插值算法采用<code>ease</code>。多个属性可以用逗号分隔。例如：<code>transition: width 2s, height 1s;</code>。</p>\n<p><code>transiton</code>控制动画应该是最简单的方式之一了，和其他属性类似<code>transiton</code>也是一个复合属性由以下几个属性组成：</p>\n<ul>\n<li>transiton-delay: 动画延时播放，默认为0</li>\n<li>transiton-timing-function: 动画插值函数,默认为<code>ease</code></li>\n<li>transiton-property: 指明要发生变化的属性</li>\n<li>transiton-duration: 指明动画周期(持续时间),默认为0</li>\n</ul>\n<h3 id=\"动画延时\"><a href=\"#动画延时\" class=\"headerlink\" title=\"动画延时\"></a>动画延时</h3><p>  看一个<code>demo</code>,子元素宽度从0到填充父控件，延时<code>1s</code>。<br><iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/fnao3q2t/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe></p>\n<p>鼠标进入和离开控件的时候都有<code>1s</code>延迟,这就是<code>transiton-delay</code>的效果。</p>\n<h3 id=\"动画速度变更函数-插值函数\"><a href=\"#动画速度变更函数-插值函数\" class=\"headerlink\" title=\"动画速度变更函数(插值函数)\"></a>动画速度变更函数(插值函数)</h3><p>  <code>transiton-timing-function</code>属性用于改变动画的速度曲线。可选值有：</p>\n<ul>\n<li>ease：默认参数</li>\n<li>linear</li>\n<li>ease-in</li>\n<li>ease-out</li>\n<li>ease-in-out</li>\n<li>cubic-bezier</li>\n</ul>\n<p>关于插值函数对应的效果可以<a href=\"http://easings.net/zh-cn\" target=\"_blank\" rel=\"noopener\">看这里</a>。</p>\n<p>说说<code>cubic-bezier</code>,由于<code>css</code>内值动画曲线比较有限，所以可以根据<code>cubic-bezier</code>规划一条贝赛尔曲线。<br><iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/k3jtsn9v/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe></p>\n<p>推荐一个贝塞尔曲线在线编辑器：<a href=\"http://cubic-bezier.com\" target=\"_blank\" rel=\"noopener\"><code>cubic-bezier</code></a>。</p>\n<h3 id=\"动画属性\"><a href=\"#动画属性\" class=\"headerlink\" title=\"动画属性\"></a>动画属性</h3><p>顾名思义，设置受到动画影响的属性。如果所有属性都受到影响，可以指定一个<code>all</code>参数。需要注意的是，<code>css</code>规定一些属性不受<code>transiton</code>影响，例如：<code>display</code>等。具体看<code>W3C</code>上<a href=\"https://www.w3.org/TR/css3-transitions/#animatable-properties\" target=\"_blank\" rel=\"noopener\">一个对应表</a>。值得一提的是，<code>display</code>属性虽然不受影响，但是<code>visibility</code>属性会受影响。</p>\n<h3 id=\"动画持续时间\"><a href=\"#动画持续时间\" class=\"headerlink\" title=\"动画持续时间\"></a>动画持续时间</h3><p>设置动画延迟播放时间，<em>注意默认为0</em>，除了以<code>s</code>为单位，也可以以<code>ms</code>为单位。</p>\n<blockquote>\n<p><code>transition</code>属性虽然使用方便，但是也有它的局限性:</p>\n</blockquote>\n<ul>\n<li>动画需要事件触发，无法自动播放</li>\n<li>无法重复播放，除非一直触发</li>\n<li>无法为多个属性指定同样的变化规则(写起来比较麻烦)</li>\n<li>只能控制开始和结束状态、无法定义中间态</li>\n</ul>\n<hr>\n<h2 id=\"通过animation属性控制动画\"><a href=\"#通过animation属性控制动画\" class=\"headerlink\" title=\"通过animation属性控制动画\"></a>通过<code>animation</code>属性控制动画</h2><p>和<code>transition</code>类似，<code>animation</code>也是一个复合属性。它提供了比较多的属性来控制动画，从而实现更加细致的控制。</p>\n<p>基本格式：</p>\n<p><code>@keyframes</code>关键字用于定义动画的细节，比例动画名称，动画在某一时刻的状态属性值等。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">keyframes</span> anim &#123;</span><br><span class=\"line\">  <span class=\"selector-tag\">from</span>: &#123;<span class=\"attribute\">background</span>: red;&#125;</span><br><span class=\"line\">  <span class=\"selector-tag\">to</span>: &#123;<span class=\"attribute\">background</span>: blue;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面一段<code>css</code>定义了一个动画，名称为<code>anim</code>,动画从背景红色过渡到背景蓝色，<code>from</code>表示起始时刻动画状态，<code>to</code>表示结束时刻动画状态。还可以换成百分比的形式从<code>0%</code>到<code>100%</code>。<br>从而实现了在不同时刻控制动画状态的目的。</p>\n<iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/Lhpfxbrm/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<hr>\n<p>基本属性：</p>\n<ul>\n<li>animation-duration</li>\n<li>animation-direction</li>\n<li>animation-delay</li>\n<li>animation-name</li>\n<li>animation-iteration-count</li>\n<li>animation-timing-function</li>\n<li>animation-play-state</li>\n<li>animation-fill-mode</li>\n</ul>\n<h3 id=\"动画时长\"><a href=\"#动画时长\" class=\"headerlink\" title=\"动画时长\"></a>动画时长</h3><p><code>animation-duration</code>和<code>transition-duration</code>类似，不做过多介绍，用于控制动画的时间长度。</p>\n<h3 id=\"动画播放延时\"><a href=\"#动画播放延时\" class=\"headerlink\" title=\"动画播放延时\"></a>动画播放延时</h3><p><code>animation-delay</code>和<code>transition-delay</code>类似控制动画首次播放的延时。</p>\n<h3 id=\"动画名称\"><a href=\"#动画名称\" class=\"headerlink\" title=\"动画名称\"></a>动画名称</h3><p><code>animation-name</code>指定元素引用哪个动画，名称通过<code>@keyframes</code>指定。</p>\n<h3 id=\"动画方向\"><a href=\"#动画方向\" class=\"headerlink\" title=\"动画方向\"></a>动画方向</h3><p><code>animation-direction</code>控制动画循环播放的时候状态的变更次序。看个<code>demo</code>:</p>\n<iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/Lhpfxbrm/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<p>可选的属性：</p>\n<ul>\n<li>normal: 每次都从起始状态变更到终止状态</li>\n<li>reverse: 每次都从终止状态变更到起始状态</li>\n<li>alternate: 奇数次从起始状态变更到结束状态、偶数次从结束状态变更到起始状态</li>\n<li>alternate-reverse: 与<code>alternate</code>相反</li>\n</ul>\n<h3 id=\"动画结束的状态\"><a href=\"#动画结束的状态\" class=\"headerlink\" title=\"动画结束的状态\"></a>动画结束的状态</h3><p><code>animation-fill-mode</code>属性控制动画结束播放时候的状态，看个<code>demo</code>：</p>\n<iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/geLw2de5/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<ul>\n<li>forwards: 让动画停留在最后一帧</li>\n<li>backwards: 让动画停留在第一帧</li>\n<li>both: 根据<code>animation-direction</code>控制使用<code>forwards</code>或者<code>backwards</code>。</li>\n</ul>\n<h3 id=\"动画播放次数\"><a href=\"#动画播放次数\" class=\"headerlink\" title=\"动画播放次数\"></a>动画播放次数</h3><p><code>animation-iteration-count</code>属性控制动画播放次数，默认为<code>1次</code>, 设置<code>infinite</code>表示无限循环播放。</p>\n<h3 id=\"动画插值函数\"><a href=\"#动画插值函数\" class=\"headerlink\" title=\"动画插值函数\"></a>动画插值函数</h3><p><code>animation-timing-function</code>控制动画插值函数，和<code>transition-timing-function</code>类似。</p>\n<h3 id=\"控制动画状态\"><a href=\"#控制动画状态\" class=\"headerlink\" title=\"控制动画状态\"></a>控制动画状态</h3><p><code>animation-play-state</code>属性用于控制动画播放的状态，默认情况，自动开始播放，通过设置该属性，可以控制动画播放。</p>\n<p>看一个<code>demo</code></p>\n<iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/2Law411w/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<p>只有鼠标移动到方块上的时候动画才会继续播放。</p>\n<hr>\n<p>参考文献：</p>\n<ul>\n<li><a href=\"http://www.ruanyifeng.com/blog/2014/02/css_transition_and_animation.html\" target=\"_blank\" rel=\"noopener\">CSS动画简介</a></li>\n<li><a href=\"https://www.w3.org/TR/css3-animations/\" target=\"_blank\" rel=\"noopener\">W3C css animation</a></li>\n</ul>\n"},{"title":"CSSMastery读书笔记三-可视化格式模型","date":"2016-08-22T07:28:32.000Z","_content":"\n# 可视化格式模型\n\n---\n\n## 盒模型概念\n\n>`内容区域`、`边框`、`内边距`、`外边距`\n\n*全局reset可能会造成一定的副作用(对`option`等元素).*\n\n\n## 外边距离叠加\n\n+ 外边距叠加一般指的是垂直外边距\n+ 一个元素出现在另一个元素上面时会发生叠加\n+ 一个元素包含在另一个元素中时会发生叠加\n+ 如果两个外边距都是负，浏览器取绝对值比较大的那个数\n+ 如果一正一负，浏览器会用正外边距减去负外边距的绝对值\n+ 行内框、浮动定位、和绝对定位元素之间的外边距不会叠加\n\n---\n\n## 定位概述\n\n### 可视化格式模型\n\n>见`css视觉格式化`\n\n### 相对定位\n\n  元素还处于文档流中，相对于元素本来位置定位。\n  **无论是否移动，元素仍然占据原来的框，这会导致覆盖其他元素。**\n\n### 绝对定位\n\n  元素不属于文档流，相对于父级已定位元素定位，如果没有就相对于包含块定位(`canvas`或者`html`元素)\n\n### 固定定位\n\n  是绝对定位的一种相对于`viewport`定位。\n\n### 浮动\n\n浮动元素不属于文档流，所以普通文档流的块框表现的好像浮动框不存在。\n\n+ 1、浮动框旁边的文档流元素会围绕浮动框\n+ 2、普通块框要包含浮动框，需要对浮动清理、或者把包含块也浮动\n+ 3、常见的清理浮动的方式：\n\n``` css\n  .clear:after {\n    content: '.';\n    height: 0;\n    visibility: none;\n    display: block;\n    clear: both;\n  }\n```","source":"_posts/CSSMastery读书笔记三-可视化格式模型.md","raw":"---\ntitle: CSSMastery读书笔记三-可视化格式模型\ndate: 2016-08-22 15:28:32\ntags: css CSSMastery \ncategories: web\n---\n\n# 可视化格式模型\n\n---\n\n## 盒模型概念\n\n>`内容区域`、`边框`、`内边距`、`外边距`\n\n*全局reset可能会造成一定的副作用(对`option`等元素).*\n\n\n## 外边距离叠加\n\n+ 外边距叠加一般指的是垂直外边距\n+ 一个元素出现在另一个元素上面时会发生叠加\n+ 一个元素包含在另一个元素中时会发生叠加\n+ 如果两个外边距都是负，浏览器取绝对值比较大的那个数\n+ 如果一正一负，浏览器会用正外边距减去负外边距的绝对值\n+ 行内框、浮动定位、和绝对定位元素之间的外边距不会叠加\n\n---\n\n## 定位概述\n\n### 可视化格式模型\n\n>见`css视觉格式化`\n\n### 相对定位\n\n  元素还处于文档流中，相对于元素本来位置定位。\n  **无论是否移动，元素仍然占据原来的框，这会导致覆盖其他元素。**\n\n### 绝对定位\n\n  元素不属于文档流，相对于父级已定位元素定位，如果没有就相对于包含块定位(`canvas`或者`html`元素)\n\n### 固定定位\n\n  是绝对定位的一种相对于`viewport`定位。\n\n### 浮动\n\n浮动元素不属于文档流，所以普通文档流的块框表现的好像浮动框不存在。\n\n+ 1、浮动框旁边的文档流元素会围绕浮动框\n+ 2、普通块框要包含浮动框，需要对浮动清理、或者把包含块也浮动\n+ 3、常见的清理浮动的方式：\n\n``` css\n  .clear:after {\n    content: '.';\n    height: 0;\n    visibility: none;\n    display: block;\n    clear: both;\n  }\n```","slug":"CSSMastery读书笔记三-可视化格式模型","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlx3000a9co7n7cpnttv","content":"<h1 id=\"可视化格式模型\"><a href=\"#可视化格式模型\" class=\"headerlink\" title=\"可视化格式模型\"></a>可视化格式模型</h1><hr>\n<h2 id=\"盒模型概念\"><a href=\"#盒模型概念\" class=\"headerlink\" title=\"盒模型概念\"></a>盒模型概念</h2><blockquote>\n<p><code>内容区域</code>、<code>边框</code>、<code>内边距</code>、<code>外边距</code></p>\n</blockquote>\n<p><em>全局reset可能会造成一定的副作用(对<code>option</code>等元素).</em></p>\n<h2 id=\"外边距离叠加\"><a href=\"#外边距离叠加\" class=\"headerlink\" title=\"外边距离叠加\"></a>外边距离叠加</h2><ul>\n<li>外边距叠加一般指的是垂直外边距</li>\n<li>一个元素出现在另一个元素上面时会发生叠加</li>\n<li>一个元素包含在另一个元素中时会发生叠加</li>\n<li>如果两个外边距都是负，浏览器取绝对值比较大的那个数</li>\n<li>如果一正一负，浏览器会用正外边距减去负外边距的绝对值</li>\n<li>行内框、浮动定位、和绝对定位元素之间的外边距不会叠加</li>\n</ul>\n<hr>\n<h2 id=\"定位概述\"><a href=\"#定位概述\" class=\"headerlink\" title=\"定位概述\"></a>定位概述</h2><h3 id=\"可视化格式模型-1\"><a href=\"#可视化格式模型-1\" class=\"headerlink\" title=\"可视化格式模型\"></a>可视化格式模型</h3><blockquote>\n<p>见<code>css视觉格式化</code></p>\n</blockquote>\n<h3 id=\"相对定位\"><a href=\"#相对定位\" class=\"headerlink\" title=\"相对定位\"></a>相对定位</h3><p>  元素还处于文档流中，相对于元素本来位置定位。<br>  <strong>无论是否移动，元素仍然占据原来的框，这会导致覆盖其他元素。</strong></p>\n<h3 id=\"绝对定位\"><a href=\"#绝对定位\" class=\"headerlink\" title=\"绝对定位\"></a>绝对定位</h3><p>  元素不属于文档流，相对于父级已定位元素定位，如果没有就相对于包含块定位(<code>canvas</code>或者<code>html</code>元素)</p>\n<h3 id=\"固定定位\"><a href=\"#固定定位\" class=\"headerlink\" title=\"固定定位\"></a>固定定位</h3><p>  是绝对定位的一种相对于<code>viewport</code>定位。</p>\n<h3 id=\"浮动\"><a href=\"#浮动\" class=\"headerlink\" title=\"浮动\"></a>浮动</h3><p>浮动元素不属于文档流，所以普通文档流的块框表现的好像浮动框不存在。</p>\n<ul>\n<li>1、浮动框旁边的文档流元素会围绕浮动框</li>\n<li>2、普通块框要包含浮动框，需要对浮动清理、或者把包含块也浮动</li>\n<li>3、常见的清理浮动的方式：</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.clear</span><span class=\"selector-pseudo\">:after</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>: <span class=\"string\">'.'</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">visibility</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">  <span class=\"attribute\">clear</span>: both;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"可视化格式模型\"><a href=\"#可视化格式模型\" class=\"headerlink\" title=\"可视化格式模型\"></a>可视化格式模型</h1><hr>\n<h2 id=\"盒模型概念\"><a href=\"#盒模型概念\" class=\"headerlink\" title=\"盒模型概念\"></a>盒模型概念</h2><blockquote>\n<p><code>内容区域</code>、<code>边框</code>、<code>内边距</code>、<code>外边距</code></p>\n</blockquote>\n<p><em>全局reset可能会造成一定的副作用(对<code>option</code>等元素).</em></p>\n<h2 id=\"外边距离叠加\"><a href=\"#外边距离叠加\" class=\"headerlink\" title=\"外边距离叠加\"></a>外边距离叠加</h2><ul>\n<li>外边距叠加一般指的是垂直外边距</li>\n<li>一个元素出现在另一个元素上面时会发生叠加</li>\n<li>一个元素包含在另一个元素中时会发生叠加</li>\n<li>如果两个外边距都是负，浏览器取绝对值比较大的那个数</li>\n<li>如果一正一负，浏览器会用正外边距减去负外边距的绝对值</li>\n<li>行内框、浮动定位、和绝对定位元素之间的外边距不会叠加</li>\n</ul>\n<hr>\n<h2 id=\"定位概述\"><a href=\"#定位概述\" class=\"headerlink\" title=\"定位概述\"></a>定位概述</h2><h3 id=\"可视化格式模型-1\"><a href=\"#可视化格式模型-1\" class=\"headerlink\" title=\"可视化格式模型\"></a>可视化格式模型</h3><blockquote>\n<p>见<code>css视觉格式化</code></p>\n</blockquote>\n<h3 id=\"相对定位\"><a href=\"#相对定位\" class=\"headerlink\" title=\"相对定位\"></a>相对定位</h3><p>  元素还处于文档流中，相对于元素本来位置定位。<br>  <strong>无论是否移动，元素仍然占据原来的框，这会导致覆盖其他元素。</strong></p>\n<h3 id=\"绝对定位\"><a href=\"#绝对定位\" class=\"headerlink\" title=\"绝对定位\"></a>绝对定位</h3><p>  元素不属于文档流，相对于父级已定位元素定位，如果没有就相对于包含块定位(<code>canvas</code>或者<code>html</code>元素)</p>\n<h3 id=\"固定定位\"><a href=\"#固定定位\" class=\"headerlink\" title=\"固定定位\"></a>固定定位</h3><p>  是绝对定位的一种相对于<code>viewport</code>定位。</p>\n<h3 id=\"浮动\"><a href=\"#浮动\" class=\"headerlink\" title=\"浮动\"></a>浮动</h3><p>浮动元素不属于文档流，所以普通文档流的块框表现的好像浮动框不存在。</p>\n<ul>\n<li>1、浮动框旁边的文档流元素会围绕浮动框</li>\n<li>2、普通块框要包含浮动框，需要对浮动清理、或者把包含块也浮动</li>\n<li>3、常见的清理浮动的方式：</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.clear</span><span class=\"selector-pseudo\">:after</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>: <span class=\"string\">'.'</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">visibility</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">  <span class=\"attribute\">clear</span>: both;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"CSSMastery读书笔记二-为样式找到应用目标","date":"2016-08-21T13:47:52.000Z","_content":"\n# 为样式找到应用目标\n\n---\n\n## 常用的选择器\n\n### 元素选择器\n\n  `body`\n\n### 后代选择器\n\n  `nav li`中间有空格\n\n### 伪类\n\n- 链接伪类：`link`、`visited`\n- 动态伪类：`hover`、`active`、`focus`、`first-child`、`lang`\n\n### 伪元素\n\n- before\n- after\n- first-letter\n- first-line\n\n>伪类与伪元素的区别\n伪类：对某些选择器添加特殊样式.\n伪元素：同于将特殊效果添加到某些选择器.\n伪类前面有一个冒号，伪元素前面有两个冒号.\n\n---\n\n## 通用选择器(`*`)\n\n- 通配符匹配所有元素\n- 对所有后代或者跳过某一级别设置样式\n\n---\n\n## 高级选择器\n\n### 子元素选择器\n\n  `nav>li`中间可以有空格\n\n### 兄弟选择器\n\n  `h2+p`中间可以有空格\n\n### 属性选择器\n\n- 根据属性是否存在\n  `span[title]`:对存在`title`属性的`span`元素设置属性\n\n- 根据属性值\n  - `span[title='foo']`: 完全等于\n  - `span[title~='foo']`:分词匹配\n  - `span[title^='foo']`:以`foo`开头\n  - `span[title$='foo']`:以`foo`结尾\n  - `span[title*='foo']`:通配存在字符`foo`\n\n---\n\n## 层叠和样式\n\n### 层叠的重要性排序\n\n- 持有`!important`的用户样式\n- 持有`!important`的作者样式\n- 作者样式\n- 用户样式\n- 浏览器默认样式\n\n### 样式特殊性规则\n\n`a、b、c、d`四个权重\n\n- 内联样式：             1 0 0 0\n- `id`选择器：           0 1 0 0\n- 类、伪类、属性选择器：   0 0 1 0\n- 类型选择器、元素选择器：  0 0 0 1\n\n>由于继承而来的样式的特殊性为0，所以直接应用于元素的任何样式都会覆盖继承而来的样式。\n\n#### **特殊性使用规则：**\n\n>一般样式非常一般、特殊样式尽可能特殊\n\n---\n\n## 规划组织可维护的样式表\n\n### 对文档应用样式的方式：\n\n- 导入样式(`import`)\n- 链接样式(`link`元素)\n\n### 一个好的样式文档结构：\n\n- 1、一般性样式\n  - 主体\n  - `reset`\n  - 链接\n  - 标题\n  - 其他元素\n\n- 2、辅助样式\n  - 表单\n  - 通知和错误\n  - 页面结构\n  - 一致的条目\n\n- 3、页面结构\n  - 标题、页脚和导航\n  - 布局\n  - 其他页面结构元素\n\n- 4、页面组件\n  - 各个页面\n\n- 5、覆盖\n\n---\n\n## 一些好的实践\n\n- 文件开头放置一些常用的预定义：如颜色值\n- 利用`cssDoc`注释`css`","source":"_posts/CSSMastery读书笔记二为-样式找到应用目标.md","raw":"---\ntitle: CSSMastery读书笔记二-为样式找到应用目标\ndate: 2016-08-21 21:47:52\ntags: css-mastery\ncategories: web\n---\n\n# 为样式找到应用目标\n\n---\n\n## 常用的选择器\n\n### 元素选择器\n\n  `body`\n\n### 后代选择器\n\n  `nav li`中间有空格\n\n### 伪类\n\n- 链接伪类：`link`、`visited`\n- 动态伪类：`hover`、`active`、`focus`、`first-child`、`lang`\n\n### 伪元素\n\n- before\n- after\n- first-letter\n- first-line\n\n>伪类与伪元素的区别\n伪类：对某些选择器添加特殊样式.\n伪元素：同于将特殊效果添加到某些选择器.\n伪类前面有一个冒号，伪元素前面有两个冒号.\n\n---\n\n## 通用选择器(`*`)\n\n- 通配符匹配所有元素\n- 对所有后代或者跳过某一级别设置样式\n\n---\n\n## 高级选择器\n\n### 子元素选择器\n\n  `nav>li`中间可以有空格\n\n### 兄弟选择器\n\n  `h2+p`中间可以有空格\n\n### 属性选择器\n\n- 根据属性是否存在\n  `span[title]`:对存在`title`属性的`span`元素设置属性\n\n- 根据属性值\n  - `span[title='foo']`: 完全等于\n  - `span[title~='foo']`:分词匹配\n  - `span[title^='foo']`:以`foo`开头\n  - `span[title$='foo']`:以`foo`结尾\n  - `span[title*='foo']`:通配存在字符`foo`\n\n---\n\n## 层叠和样式\n\n### 层叠的重要性排序\n\n- 持有`!important`的用户样式\n- 持有`!important`的作者样式\n- 作者样式\n- 用户样式\n- 浏览器默认样式\n\n### 样式特殊性规则\n\n`a、b、c、d`四个权重\n\n- 内联样式：             1 0 0 0\n- `id`选择器：           0 1 0 0\n- 类、伪类、属性选择器：   0 0 1 0\n- 类型选择器、元素选择器：  0 0 0 1\n\n>由于继承而来的样式的特殊性为0，所以直接应用于元素的任何样式都会覆盖继承而来的样式。\n\n#### **特殊性使用规则：**\n\n>一般样式非常一般、特殊样式尽可能特殊\n\n---\n\n## 规划组织可维护的样式表\n\n### 对文档应用样式的方式：\n\n- 导入样式(`import`)\n- 链接样式(`link`元素)\n\n### 一个好的样式文档结构：\n\n- 1、一般性样式\n  - 主体\n  - `reset`\n  - 链接\n  - 标题\n  - 其他元素\n\n- 2、辅助样式\n  - 表单\n  - 通知和错误\n  - 页面结构\n  - 一致的条目\n\n- 3、页面结构\n  - 标题、页脚和导航\n  - 布局\n  - 其他页面结构元素\n\n- 4、页面组件\n  - 各个页面\n\n- 5、覆盖\n\n---\n\n## 一些好的实践\n\n- 文件开头放置一些常用的预定义：如颜色值\n- 利用`cssDoc`注释`css`","slug":"CSSMastery读书笔记二为-样式找到应用目标","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlx5000b9co71zbc8quz","content":"<h1 id=\"为样式找到应用目标\"><a href=\"#为样式找到应用目标\" class=\"headerlink\" title=\"为样式找到应用目标\"></a>为样式找到应用目标</h1><hr>\n<h2 id=\"常用的选择器\"><a href=\"#常用的选择器\" class=\"headerlink\" title=\"常用的选择器\"></a>常用的选择器</h2><h3 id=\"元素选择器\"><a href=\"#元素选择器\" class=\"headerlink\" title=\"元素选择器\"></a>元素选择器</h3><p>  <code>body</code></p>\n<h3 id=\"后代选择器\"><a href=\"#后代选择器\" class=\"headerlink\" title=\"后代选择器\"></a>后代选择器</h3><p>  <code>nav li</code>中间有空格</p>\n<h3 id=\"伪类\"><a href=\"#伪类\" class=\"headerlink\" title=\"伪类\"></a>伪类</h3><ul>\n<li>链接伪类：<code>link</code>、<code>visited</code></li>\n<li>动态伪类：<code>hover</code>、<code>active</code>、<code>focus</code>、<code>first-child</code>、<code>lang</code></li>\n</ul>\n<h3 id=\"伪元素\"><a href=\"#伪元素\" class=\"headerlink\" title=\"伪元素\"></a>伪元素</h3><ul>\n<li>before</li>\n<li>after</li>\n<li>first-letter</li>\n<li>first-line</li>\n</ul>\n<blockquote>\n<p>伪类与伪元素的区别<br>伪类：对某些选择器添加特殊样式.<br>伪元素：同于将特殊效果添加到某些选择器.<br>伪类前面有一个冒号，伪元素前面有两个冒号.</p>\n</blockquote>\n<hr>\n<h2 id=\"通用选择器\"><a href=\"#通用选择器\" class=\"headerlink\" title=\"通用选择器(*)\"></a>通用选择器(<code>*</code>)</h2><ul>\n<li>通配符匹配所有元素</li>\n<li>对所有后代或者跳过某一级别设置样式</li>\n</ul>\n<hr>\n<h2 id=\"高级选择器\"><a href=\"#高级选择器\" class=\"headerlink\" title=\"高级选择器\"></a>高级选择器</h2><h3 id=\"子元素选择器\"><a href=\"#子元素选择器\" class=\"headerlink\" title=\"子元素选择器\"></a>子元素选择器</h3><p>  <code>nav&gt;li</code>中间可以有空格</p>\n<h3 id=\"兄弟选择器\"><a href=\"#兄弟选择器\" class=\"headerlink\" title=\"兄弟选择器\"></a>兄弟选择器</h3><p>  <code>h2+p</code>中间可以有空格</p>\n<h3 id=\"属性选择器\"><a href=\"#属性选择器\" class=\"headerlink\" title=\"属性选择器\"></a>属性选择器</h3><ul>\n<li><p>根据属性是否存在<br><code>span[title]</code>:对存在<code>title</code>属性的<code>span</code>元素设置属性</p>\n</li>\n<li><p>根据属性值</p>\n<ul>\n<li><code>span[title=&#39;foo&#39;]</code>: 完全等于</li>\n<li><code>span[title~=&#39;foo&#39;]</code>:分词匹配</li>\n<li><code>span[title^=&#39;foo&#39;]</code>:以<code>foo</code>开头</li>\n<li><code>span[title$=&#39;foo&#39;]</code>:以<code>foo</code>结尾</li>\n<li><code>span[title*=&#39;foo&#39;]</code>:通配存在字符<code>foo</code></li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"层叠和样式\"><a href=\"#层叠和样式\" class=\"headerlink\" title=\"层叠和样式\"></a>层叠和样式</h2><h3 id=\"层叠的重要性排序\"><a href=\"#层叠的重要性排序\" class=\"headerlink\" title=\"层叠的重要性排序\"></a>层叠的重要性排序</h3><ul>\n<li>持有<code>!important</code>的用户样式</li>\n<li>持有<code>!important</code>的作者样式</li>\n<li>作者样式</li>\n<li>用户样式</li>\n<li>浏览器默认样式</li>\n</ul>\n<h3 id=\"样式特殊性规则\"><a href=\"#样式特殊性规则\" class=\"headerlink\" title=\"样式特殊性规则\"></a>样式特殊性规则</h3><p><code>a、b、c、d</code>四个权重</p>\n<ul>\n<li>内联样式：             1 0 0 0</li>\n<li><code>id</code>选择器：           0 1 0 0</li>\n<li>类、伪类、属性选择器：   0 0 1 0</li>\n<li>类型选择器、元素选择器：  0 0 0 1</li>\n</ul>\n<blockquote>\n<p>由于继承而来的样式的特殊性为0，所以直接应用于元素的任何样式都会覆盖继承而来的样式。</p>\n</blockquote>\n<h4 id=\"特殊性使用规则：\"><a href=\"#特殊性使用规则：\" class=\"headerlink\" title=\"特殊性使用规则：\"></a><strong>特殊性使用规则：</strong></h4><blockquote>\n<p>一般样式非常一般、特殊样式尽可能特殊</p>\n</blockquote>\n<hr>\n<h2 id=\"规划组织可维护的样式表\"><a href=\"#规划组织可维护的样式表\" class=\"headerlink\" title=\"规划组织可维护的样式表\"></a>规划组织可维护的样式表</h2><h3 id=\"对文档应用样式的方式：\"><a href=\"#对文档应用样式的方式：\" class=\"headerlink\" title=\"对文档应用样式的方式：\"></a>对文档应用样式的方式：</h3><ul>\n<li>导入样式(<code>import</code>)</li>\n<li>链接样式(<code>link</code>元素)</li>\n</ul>\n<h3 id=\"一个好的样式文档结构：\"><a href=\"#一个好的样式文档结构：\" class=\"headerlink\" title=\"一个好的样式文档结构：\"></a>一个好的样式文档结构：</h3><ul>\n<li><p>1、一般性样式</p>\n<ul>\n<li>主体</li>\n<li><code>reset</code></li>\n<li>链接</li>\n<li>标题</li>\n<li>其他元素</li>\n</ul>\n</li>\n<li><p>2、辅助样式</p>\n<ul>\n<li>表单</li>\n<li>通知和错误</li>\n<li>页面结构</li>\n<li>一致的条目</li>\n</ul>\n</li>\n<li><p>3、页面结构</p>\n<ul>\n<li>标题、页脚和导航</li>\n<li>布局</li>\n<li>其他页面结构元素</li>\n</ul>\n</li>\n<li><p>4、页面组件</p>\n<ul>\n<li>各个页面</li>\n</ul>\n</li>\n<li><p>5、覆盖</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"一些好的实践\"><a href=\"#一些好的实践\" class=\"headerlink\" title=\"一些好的实践\"></a>一些好的实践</h2><ul>\n<li>文件开头放置一些常用的预定义：如颜色值</li>\n<li>利用<code>cssDoc</code>注释<code>css</code></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"为样式找到应用目标\"><a href=\"#为样式找到应用目标\" class=\"headerlink\" title=\"为样式找到应用目标\"></a>为样式找到应用目标</h1><hr>\n<h2 id=\"常用的选择器\"><a href=\"#常用的选择器\" class=\"headerlink\" title=\"常用的选择器\"></a>常用的选择器</h2><h3 id=\"元素选择器\"><a href=\"#元素选择器\" class=\"headerlink\" title=\"元素选择器\"></a>元素选择器</h3><p>  <code>body</code></p>\n<h3 id=\"后代选择器\"><a href=\"#后代选择器\" class=\"headerlink\" title=\"后代选择器\"></a>后代选择器</h3><p>  <code>nav li</code>中间有空格</p>\n<h3 id=\"伪类\"><a href=\"#伪类\" class=\"headerlink\" title=\"伪类\"></a>伪类</h3><ul>\n<li>链接伪类：<code>link</code>、<code>visited</code></li>\n<li>动态伪类：<code>hover</code>、<code>active</code>、<code>focus</code>、<code>first-child</code>、<code>lang</code></li>\n</ul>\n<h3 id=\"伪元素\"><a href=\"#伪元素\" class=\"headerlink\" title=\"伪元素\"></a>伪元素</h3><ul>\n<li>before</li>\n<li>after</li>\n<li>first-letter</li>\n<li>first-line</li>\n</ul>\n<blockquote>\n<p>伪类与伪元素的区别<br>伪类：对某些选择器添加特殊样式.<br>伪元素：同于将特殊效果添加到某些选择器.<br>伪类前面有一个冒号，伪元素前面有两个冒号.</p>\n</blockquote>\n<hr>\n<h2 id=\"通用选择器\"><a href=\"#通用选择器\" class=\"headerlink\" title=\"通用选择器(*)\"></a>通用选择器(<code>*</code>)</h2><ul>\n<li>通配符匹配所有元素</li>\n<li>对所有后代或者跳过某一级别设置样式</li>\n</ul>\n<hr>\n<h2 id=\"高级选择器\"><a href=\"#高级选择器\" class=\"headerlink\" title=\"高级选择器\"></a>高级选择器</h2><h3 id=\"子元素选择器\"><a href=\"#子元素选择器\" class=\"headerlink\" title=\"子元素选择器\"></a>子元素选择器</h3><p>  <code>nav&gt;li</code>中间可以有空格</p>\n<h3 id=\"兄弟选择器\"><a href=\"#兄弟选择器\" class=\"headerlink\" title=\"兄弟选择器\"></a>兄弟选择器</h3><p>  <code>h2+p</code>中间可以有空格</p>\n<h3 id=\"属性选择器\"><a href=\"#属性选择器\" class=\"headerlink\" title=\"属性选择器\"></a>属性选择器</h3><ul>\n<li><p>根据属性是否存在<br><code>span[title]</code>:对存在<code>title</code>属性的<code>span</code>元素设置属性</p>\n</li>\n<li><p>根据属性值</p>\n<ul>\n<li><code>span[title=&#39;foo&#39;]</code>: 完全等于</li>\n<li><code>span[title~=&#39;foo&#39;]</code>:分词匹配</li>\n<li><code>span[title^=&#39;foo&#39;]</code>:以<code>foo</code>开头</li>\n<li><code>span[title$=&#39;foo&#39;]</code>:以<code>foo</code>结尾</li>\n<li><code>span[title*=&#39;foo&#39;]</code>:通配存在字符<code>foo</code></li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"层叠和样式\"><a href=\"#层叠和样式\" class=\"headerlink\" title=\"层叠和样式\"></a>层叠和样式</h2><h3 id=\"层叠的重要性排序\"><a href=\"#层叠的重要性排序\" class=\"headerlink\" title=\"层叠的重要性排序\"></a>层叠的重要性排序</h3><ul>\n<li>持有<code>!important</code>的用户样式</li>\n<li>持有<code>!important</code>的作者样式</li>\n<li>作者样式</li>\n<li>用户样式</li>\n<li>浏览器默认样式</li>\n</ul>\n<h3 id=\"样式特殊性规则\"><a href=\"#样式特殊性规则\" class=\"headerlink\" title=\"样式特殊性规则\"></a>样式特殊性规则</h3><p><code>a、b、c、d</code>四个权重</p>\n<ul>\n<li>内联样式：             1 0 0 0</li>\n<li><code>id</code>选择器：           0 1 0 0</li>\n<li>类、伪类、属性选择器：   0 0 1 0</li>\n<li>类型选择器、元素选择器：  0 0 0 1</li>\n</ul>\n<blockquote>\n<p>由于继承而来的样式的特殊性为0，所以直接应用于元素的任何样式都会覆盖继承而来的样式。</p>\n</blockquote>\n<h4 id=\"特殊性使用规则：\"><a href=\"#特殊性使用规则：\" class=\"headerlink\" title=\"特殊性使用规则：\"></a><strong>特殊性使用规则：</strong></h4><blockquote>\n<p>一般样式非常一般、特殊样式尽可能特殊</p>\n</blockquote>\n<hr>\n<h2 id=\"规划组织可维护的样式表\"><a href=\"#规划组织可维护的样式表\" class=\"headerlink\" title=\"规划组织可维护的样式表\"></a>规划组织可维护的样式表</h2><h3 id=\"对文档应用样式的方式：\"><a href=\"#对文档应用样式的方式：\" class=\"headerlink\" title=\"对文档应用样式的方式：\"></a>对文档应用样式的方式：</h3><ul>\n<li>导入样式(<code>import</code>)</li>\n<li>链接样式(<code>link</code>元素)</li>\n</ul>\n<h3 id=\"一个好的样式文档结构：\"><a href=\"#一个好的样式文档结构：\" class=\"headerlink\" title=\"一个好的样式文档结构：\"></a>一个好的样式文档结构：</h3><ul>\n<li><p>1、一般性样式</p>\n<ul>\n<li>主体</li>\n<li><code>reset</code></li>\n<li>链接</li>\n<li>标题</li>\n<li>其他元素</li>\n</ul>\n</li>\n<li><p>2、辅助样式</p>\n<ul>\n<li>表单</li>\n<li>通知和错误</li>\n<li>页面结构</li>\n<li>一致的条目</li>\n</ul>\n</li>\n<li><p>3、页面结构</p>\n<ul>\n<li>标题、页脚和导航</li>\n<li>布局</li>\n<li>其他页面结构元素</li>\n</ul>\n</li>\n<li><p>4、页面组件</p>\n<ul>\n<li>各个页面</li>\n</ul>\n</li>\n<li><p>5、覆盖</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"一些好的实践\"><a href=\"#一些好的实践\" class=\"headerlink\" title=\"一些好的实践\"></a>一些好的实践</h2><ul>\n<li>文件开头放置一些常用的预定义：如颜色值</li>\n<li>利用<code>cssDoc</code>注释<code>css</code></li>\n</ul>\n"},{"title":"SVG学习笔记","date":"2016-08-29T05:38:13.000Z","_content":"\n## SVG是什么\n\n>SVG意为可缩放的矢量图形，采用`XML`语言格式来标记图像信息。最新版本为`1.1`。\n\n---\n\n## SVG基本作用\n\n> 用于绘制图形以及文字，支持旋转、滤镜、裁剪、渐变等效果。\n\n---\n\n## 基本属性及语法\n\n- `html`文档嵌入`svg`\n  - 对于新的`html5`标准可以直接在`html`文档内嵌入\n  - 使用其他元素嵌入：`<object data=\"image.svg\" type=\"image/svg+xml\" />`\n\n- 语法规范\n  - SVG元素属性区分大小写(和`html`不同)\n  - SVG元素属性值必须用双引号引起来\n\n---\n\n## 基本使用\n\n### 坐标系统\n\n  类似于`canvas`，可以通过`viewBox`定义`用户坐标系统`, 达到缩放的结果。例如：\n\n  ``` html\n  <svg width=\"200\" height=\"200\" viewBox=\"0 0 100 100\">\n  ```\n  这里定义了视口(`viewport`)大小为: `200*200`, `viewBox`属性定义了画布上可以显示区域，这个区域会放大到画布`200*200`上显示。这里可以类比`canvas`里面类似的概念，`canvas`里面通过`style`属性定义的宽高为显示区域，用户坐标系统，直接给`canvas`元素设置的宽高为视口大小。既然有缩放，就得控制缩放比例，以及对齐方式。\n  `preserveAspectRatio`属性用于定义`viewBox`相对于`viewport`对齐方式以及缩放属性：\n  >preserveAspectRatio=\"xMidYMid meet\",意味着把`viewBox`的中心相对于`viewport`中心对齐，同时保持纵横比缩放`viewBox`适应`viewport`。其实这也就是默认值。\n  \n  preserveAspectRatio前半部分参数：\n  - xMin|xMid|xMax\n  - YMin|YMid|YMax\n\n  preserveAspectRatio后半部分对齐方式：\n  - meet:保持`viewBox`的纵横比，让`viewBox`在`viewport`内完全显示。\n  - slice:保持`viewBox`的纵横比，用`viewBox`最大化填充`viewport`。\n  - none: 水平和垂直都拉申填充`viewport`。\n\n  [SVG-Demo](git@github.com:Luncher/svg-demo.git),下载后可以直接编辑并用`SVG`查看器打开查看。\n\n### 绘制图形\n  \n  `SVG`包含[内值基本元素](https://developer.mozilla.org/en-US/docs/Web/SVG/Element),可以直接绘制基本图形例如：`rect`、`circle`等。还可以以类似于`canvas`路径的形式绘制图像：强大的路径支持绘制任意的元素。\n\n### 着色\n\n  着色类似于`canvas`分为填充与描边。通过设置`fill`于`stroke`属性控制颜色，`fill-opacity`和`stroke-opacity`控制透明度,以及一些其他属性控制描边的风格。\n\n---\n\n## 参考\n\n[MDN-SVG](https://developer.mozilla.org/en-US/docs/Web/SVG)\n[MDN-SVG Tutorial](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Tutorial)\n[理解SVG的viewport,viewBox](http://www.zhangxinxu.com/wordpress/2014/08/svg-viewport-viewbox-preserveaspectratio/)","source":"_posts/SVG学习笔记.md","raw":"---\ntitle: SVG学习笔记\ndate: 2016-08-29 13:38:13\ntags: SVG\ncategories: web\n---\n\n## SVG是什么\n\n>SVG意为可缩放的矢量图形，采用`XML`语言格式来标记图像信息。最新版本为`1.1`。\n\n---\n\n## SVG基本作用\n\n> 用于绘制图形以及文字，支持旋转、滤镜、裁剪、渐变等效果。\n\n---\n\n## 基本属性及语法\n\n- `html`文档嵌入`svg`\n  - 对于新的`html5`标准可以直接在`html`文档内嵌入\n  - 使用其他元素嵌入：`<object data=\"image.svg\" type=\"image/svg+xml\" />`\n\n- 语法规范\n  - SVG元素属性区分大小写(和`html`不同)\n  - SVG元素属性值必须用双引号引起来\n\n---\n\n## 基本使用\n\n### 坐标系统\n\n  类似于`canvas`，可以通过`viewBox`定义`用户坐标系统`, 达到缩放的结果。例如：\n\n  ``` html\n  <svg width=\"200\" height=\"200\" viewBox=\"0 0 100 100\">\n  ```\n  这里定义了视口(`viewport`)大小为: `200*200`, `viewBox`属性定义了画布上可以显示区域，这个区域会放大到画布`200*200`上显示。这里可以类比`canvas`里面类似的概念，`canvas`里面通过`style`属性定义的宽高为显示区域，用户坐标系统，直接给`canvas`元素设置的宽高为视口大小。既然有缩放，就得控制缩放比例，以及对齐方式。\n  `preserveAspectRatio`属性用于定义`viewBox`相对于`viewport`对齐方式以及缩放属性：\n  >preserveAspectRatio=\"xMidYMid meet\",意味着把`viewBox`的中心相对于`viewport`中心对齐，同时保持纵横比缩放`viewBox`适应`viewport`。其实这也就是默认值。\n  \n  preserveAspectRatio前半部分参数：\n  - xMin|xMid|xMax\n  - YMin|YMid|YMax\n\n  preserveAspectRatio后半部分对齐方式：\n  - meet:保持`viewBox`的纵横比，让`viewBox`在`viewport`内完全显示。\n  - slice:保持`viewBox`的纵横比，用`viewBox`最大化填充`viewport`。\n  - none: 水平和垂直都拉申填充`viewport`。\n\n  [SVG-Demo](git@github.com:Luncher/svg-demo.git),下载后可以直接编辑并用`SVG`查看器打开查看。\n\n### 绘制图形\n  \n  `SVG`包含[内值基本元素](https://developer.mozilla.org/en-US/docs/Web/SVG/Element),可以直接绘制基本图形例如：`rect`、`circle`等。还可以以类似于`canvas`路径的形式绘制图像：强大的路径支持绘制任意的元素。\n\n### 着色\n\n  着色类似于`canvas`分为填充与描边。通过设置`fill`于`stroke`属性控制颜色，`fill-opacity`和`stroke-opacity`控制透明度,以及一些其他属性控制描边的风格。\n\n---\n\n## 参考\n\n[MDN-SVG](https://developer.mozilla.org/en-US/docs/Web/SVG)\n[MDN-SVG Tutorial](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Tutorial)\n[理解SVG的viewport,viewBox](http://www.zhangxinxu.com/wordpress/2014/08/svg-viewport-viewbox-preserveaspectratio/)","slug":"SVG学习笔记","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlx8000g9co74qirr8xt","content":"<h2 id=\"SVG是什么\"><a href=\"#SVG是什么\" class=\"headerlink\" title=\"SVG是什么\"></a>SVG是什么</h2><blockquote>\n<p>SVG意为可缩放的矢量图形，采用<code>XML</code>语言格式来标记图像信息。最新版本为<code>1.1</code>。</p>\n</blockquote>\n<hr>\n<h2 id=\"SVG基本作用\"><a href=\"#SVG基本作用\" class=\"headerlink\" title=\"SVG基本作用\"></a>SVG基本作用</h2><blockquote>\n<p>用于绘制图形以及文字，支持旋转、滤镜、裁剪、渐变等效果。</p>\n</blockquote>\n<hr>\n<h2 id=\"基本属性及语法\"><a href=\"#基本属性及语法\" class=\"headerlink\" title=\"基本属性及语法\"></a>基本属性及语法</h2><ul>\n<li><p><code>html</code>文档嵌入<code>svg</code></p>\n<ul>\n<li>对于新的<code>html5</code>标准可以直接在<code>html</code>文档内嵌入</li>\n<li>使用其他元素嵌入：<code>&lt;object data=&quot;image.svg&quot; type=&quot;image/svg+xml&quot; /&gt;</code></li>\n</ul>\n</li>\n<li><p>语法规范</p>\n<ul>\n<li>SVG元素属性区分大小写(和<code>html</code>不同)</li>\n<li>SVG元素属性值必须用双引号引起来</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"基本使用\"><a href=\"#基本使用\" class=\"headerlink\" title=\"基本使用\"></a>基本使用</h2><h3 id=\"坐标系统\"><a href=\"#坐标系统\" class=\"headerlink\" title=\"坐标系统\"></a>坐标系统</h3><p>  类似于<code>canvas</code>，可以通过<code>viewBox</code>定义<code>用户坐标系统</code>, 达到缩放的结果。例如：</p>\n  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">\"200\"</span> <span class=\"attr\">height</span>=<span class=\"string\">\"200\"</span> <span class=\"attr\">viewBox</span>=<span class=\"string\">\"0 0 100 100\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>  这里定义了视口(<code>viewport</code>)大小为: <code>200*200</code>, <code>viewBox</code>属性定义了画布上可以显示区域，这个区域会放大到画布<code>200*200</code>上显示。这里可以类比<code>canvas</code>里面类似的概念，<code>canvas</code>里面通过<code>style</code>属性定义的宽高为显示区域，用户坐标系统，直接给<code>canvas</code>元素设置的宽高为视口大小。既然有缩放，就得控制缩放比例，以及对齐方式。<br>  <code>preserveAspectRatio</code>属性用于定义<code>viewBox</code>相对于<code>viewport</code>对齐方式以及缩放属性：</p>\n<blockquote>\n<p>preserveAspectRatio=”xMidYMid meet”,意味着把<code>viewBox</code>的中心相对于<code>viewport</code>中心对齐，同时保持纵横比缩放<code>viewBox</code>适应<code>viewport</code>。其实这也就是默认值。</p>\n</blockquote>\n<p>  preserveAspectRatio前半部分参数：</p>\n<ul>\n<li>xMin|xMid|xMax</li>\n<li><p>YMin|YMid|YMax</p>\n<p>preserveAspectRatio后半部分对齐方式：</p>\n</li>\n<li>meet:保持<code>viewBox</code>的纵横比，让<code>viewBox</code>在<code>viewport</code>内完全显示。</li>\n<li>slice:保持<code>viewBox</code>的纵横比，用<code>viewBox</code>最大化填充<code>viewport</code>。</li>\n<li><p>none: 水平和垂直都拉申填充<code>viewport</code>。</p>\n<p><a href=\"git@github.com:Luncher/svg-demo.git\">SVG-Demo</a>,下载后可以直接编辑并用<code>SVG</code>查看器打开查看。</p>\n</li>\n</ul>\n<h3 id=\"绘制图形\"><a href=\"#绘制图形\" class=\"headerlink\" title=\"绘制图形\"></a>绘制图形</h3><p>  <code>SVG</code>包含<a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Element\" target=\"_blank\" rel=\"noopener\">内值基本元素</a>,可以直接绘制基本图形例如：<code>rect</code>、<code>circle</code>等。还可以以类似于<code>canvas</code>路径的形式绘制图像：强大的路径支持绘制任意的元素。</p>\n<h3 id=\"着色\"><a href=\"#着色\" class=\"headerlink\" title=\"着色\"></a>着色</h3><p>  着色类似于<code>canvas</code>分为填充与描边。通过设置<code>fill</code>于<code>stroke</code>属性控制颜色，<code>fill-opacity</code>和<code>stroke-opacity</code>控制透明度,以及一些其他属性控制描边的风格。</p>\n<hr>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG\" target=\"_blank\" rel=\"noopener\">MDN-SVG</a><br><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/SVG/Tutorial\" target=\"_blank\" rel=\"noopener\">MDN-SVG Tutorial</a><br><a href=\"http://www.zhangxinxu.com/wordpress/2014/08/svg-viewport-viewbox-preserveaspectratio/\" target=\"_blank\" rel=\"noopener\">理解SVG的viewport,viewBox</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"SVG是什么\"><a href=\"#SVG是什么\" class=\"headerlink\" title=\"SVG是什么\"></a>SVG是什么</h2><blockquote>\n<p>SVG意为可缩放的矢量图形，采用<code>XML</code>语言格式来标记图像信息。最新版本为<code>1.1</code>。</p>\n</blockquote>\n<hr>\n<h2 id=\"SVG基本作用\"><a href=\"#SVG基本作用\" class=\"headerlink\" title=\"SVG基本作用\"></a>SVG基本作用</h2><blockquote>\n<p>用于绘制图形以及文字，支持旋转、滤镜、裁剪、渐变等效果。</p>\n</blockquote>\n<hr>\n<h2 id=\"基本属性及语法\"><a href=\"#基本属性及语法\" class=\"headerlink\" title=\"基本属性及语法\"></a>基本属性及语法</h2><ul>\n<li><p><code>html</code>文档嵌入<code>svg</code></p>\n<ul>\n<li>对于新的<code>html5</code>标准可以直接在<code>html</code>文档内嵌入</li>\n<li>使用其他元素嵌入：<code>&lt;object data=&quot;image.svg&quot; type=&quot;image/svg+xml&quot; /&gt;</code></li>\n</ul>\n</li>\n<li><p>语法规范</p>\n<ul>\n<li>SVG元素属性区分大小写(和<code>html</code>不同)</li>\n<li>SVG元素属性值必须用双引号引起来</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"基本使用\"><a href=\"#基本使用\" class=\"headerlink\" title=\"基本使用\"></a>基本使用</h2><h3 id=\"坐标系统\"><a href=\"#坐标系统\" class=\"headerlink\" title=\"坐标系统\"></a>坐标系统</h3><p>  类似于<code>canvas</code>，可以通过<code>viewBox</code>定义<code>用户坐标系统</code>, 达到缩放的结果。例如：</p>\n  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">\"200\"</span> <span class=\"attr\">height</span>=<span class=\"string\">\"200\"</span> <span class=\"attr\">viewBox</span>=<span class=\"string\">\"0 0 100 100\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>  这里定义了视口(<code>viewport</code>)大小为: <code>200*200</code>, <code>viewBox</code>属性定义了画布上可以显示区域，这个区域会放大到画布<code>200*200</code>上显示。这里可以类比<code>canvas</code>里面类似的概念，<code>canvas</code>里面通过<code>style</code>属性定义的宽高为显示区域，用户坐标系统，直接给<code>canvas</code>元素设置的宽高为视口大小。既然有缩放，就得控制缩放比例，以及对齐方式。<br>  <code>preserveAspectRatio</code>属性用于定义<code>viewBox</code>相对于<code>viewport</code>对齐方式以及缩放属性：</p>\n<blockquote>\n<p>preserveAspectRatio=”xMidYMid meet”,意味着把<code>viewBox</code>的中心相对于<code>viewport</code>中心对齐，同时保持纵横比缩放<code>viewBox</code>适应<code>viewport</code>。其实这也就是默认值。</p>\n</blockquote>\n<p>  preserveAspectRatio前半部分参数：</p>\n<ul>\n<li>xMin|xMid|xMax</li>\n<li><p>YMin|YMid|YMax</p>\n<p>preserveAspectRatio后半部分对齐方式：</p>\n</li>\n<li>meet:保持<code>viewBox</code>的纵横比，让<code>viewBox</code>在<code>viewport</code>内完全显示。</li>\n<li>slice:保持<code>viewBox</code>的纵横比，用<code>viewBox</code>最大化填充<code>viewport</code>。</li>\n<li><p>none: 水平和垂直都拉申填充<code>viewport</code>。</p>\n<p><a href=\"git@github.com:Luncher/svg-demo.git\">SVG-Demo</a>,下载后可以直接编辑并用<code>SVG</code>查看器打开查看。</p>\n</li>\n</ul>\n<h3 id=\"绘制图形\"><a href=\"#绘制图形\" class=\"headerlink\" title=\"绘制图形\"></a>绘制图形</h3><p>  <code>SVG</code>包含<a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Element\" target=\"_blank\" rel=\"noopener\">内值基本元素</a>,可以直接绘制基本图形例如：<code>rect</code>、<code>circle</code>等。还可以以类似于<code>canvas</code>路径的形式绘制图像：强大的路径支持绘制任意的元素。</p>\n<h3 id=\"着色\"><a href=\"#着色\" class=\"headerlink\" title=\"着色\"></a>着色</h3><p>  着色类似于<code>canvas</code>分为填充与描边。通过设置<code>fill</code>于<code>stroke</code>属性控制颜色，<code>fill-opacity</code>和<code>stroke-opacity</code>控制透明度,以及一些其他属性控制描边的风格。</p>\n<hr>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG\" target=\"_blank\" rel=\"noopener\">MDN-SVG</a><br><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/SVG/Tutorial\" target=\"_blank\" rel=\"noopener\">MDN-SVG Tutorial</a><br><a href=\"http://www.zhangxinxu.com/wordpress/2014/08/svg-viewport-viewbox-preserveaspectratio/\" target=\"_blank\" rel=\"noopener\">理解SVG的viewport,viewBox</a></p>\n"},{"title":"ScrollTo动画","date":"2016-08-26T02:05:18.000Z","_content":"\n\n# 简单的ScrollTo动画实现\n\n在页面导航栏目设置几个标题按钮，按下的时候调转到对应的位置，这大概是浏览器页面开发最基本的动效之一了。看了一下很多页面都是基于`jquery`来实现，我不想用它，所以要自己造一个轮子。我们知道浏览器页面滚动都是基于`window.scrollTo`函数来实现的，还有一个函数叫`window.scrollBy`,用于滚动到某个相对坐标位置。\n\n---\n\n## 锚元素点击事件\n\n``` javascript\n\n let anchors = document.querySelectorAll('nav > a');\n  anchors.forEach(function(element) {\n    element.addEventListener('click', function(e) {\n      e.preventDefault();\n      scrollTo(this, document.getElementById(this.href.split('#')[1]), 2000);\n    });\n  }, this);\n\n```\n\n滚动时长设置为`2s`固定值。\n\n---\n\n## 滚动函数实现\n\n``` javascript\n\nfunction scrollTo(element, to, delay) {\n    var difference = to.getBoundingClientRect().top - element.getBoundingClientRect().top - 80;\n    var stepTime = 8;\n    var stepDis = difference*stepTime / delay ;\n    var count = Math.ceil(difference/stepDis);\n    var index = 0;\n\n    var outQuart = function(n){\n      return 1 - (--n * n * n * n);\n    };\n\n    function stepFunc() {\n      index++;\n      setTimeout(function() {\n        var diff = outQuart(index/count)*difference;\n        if(count >= index) {\n          window.scrollTo(0, diff);\n          stepFunc();\n        }\n      }, stepTime);\n    }\n\n    stepFunc();\n}\n\n```\n\n`getBoundingClientRect`函数用于获取元素大小和相对视口的位置。为了让屏幕滚动更加平滑一些，这里借助了`outQuart`插值算法，如果想要其他效果可以看[插值算法对照表](http://easings.net/zh-cn),\n赠送一个[插值算法库](https://github.com/component/ease)。","source":"_posts/ScrollTo动画.md","raw":"---\ntitle: ScrollTo动画\ndate: 2016-08-26 10:05:18\ntags: css scrollTo\ncategories: web\n---\n\n\n# 简单的ScrollTo动画实现\n\n在页面导航栏目设置几个标题按钮，按下的时候调转到对应的位置，这大概是浏览器页面开发最基本的动效之一了。看了一下很多页面都是基于`jquery`来实现，我不想用它，所以要自己造一个轮子。我们知道浏览器页面滚动都是基于`window.scrollTo`函数来实现的，还有一个函数叫`window.scrollBy`,用于滚动到某个相对坐标位置。\n\n---\n\n## 锚元素点击事件\n\n``` javascript\n\n let anchors = document.querySelectorAll('nav > a');\n  anchors.forEach(function(element) {\n    element.addEventListener('click', function(e) {\n      e.preventDefault();\n      scrollTo(this, document.getElementById(this.href.split('#')[1]), 2000);\n    });\n  }, this);\n\n```\n\n滚动时长设置为`2s`固定值。\n\n---\n\n## 滚动函数实现\n\n``` javascript\n\nfunction scrollTo(element, to, delay) {\n    var difference = to.getBoundingClientRect().top - element.getBoundingClientRect().top - 80;\n    var stepTime = 8;\n    var stepDis = difference*stepTime / delay ;\n    var count = Math.ceil(difference/stepDis);\n    var index = 0;\n\n    var outQuart = function(n){\n      return 1 - (--n * n * n * n);\n    };\n\n    function stepFunc() {\n      index++;\n      setTimeout(function() {\n        var diff = outQuart(index/count)*difference;\n        if(count >= index) {\n          window.scrollTo(0, diff);\n          stepFunc();\n        }\n      }, stepTime);\n    }\n\n    stepFunc();\n}\n\n```\n\n`getBoundingClientRect`函数用于获取元素大小和相对视口的位置。为了让屏幕滚动更加平滑一些，这里借助了`outQuart`插值算法，如果想要其他效果可以看[插值算法对照表](http://easings.net/zh-cn),\n赠送一个[插值算法库](https://github.com/component/ease)。","slug":"ScrollTo动画","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxb000i9co7uuf78g2d","content":"<h1 id=\"简单的ScrollTo动画实现\"><a href=\"#简单的ScrollTo动画实现\" class=\"headerlink\" title=\"简单的ScrollTo动画实现\"></a>简单的ScrollTo动画实现</h1><p>在页面导航栏目设置几个标题按钮，按下的时候调转到对应的位置，这大概是浏览器页面开发最基本的动效之一了。看了一下很多页面都是基于<code>jquery</code>来实现，我不想用它，所以要自己造一个轮子。我们知道浏览器页面滚动都是基于<code>window.scrollTo</code>函数来实现的，还有一个函数叫<code>window.scrollBy</code>,用于滚动到某个相对坐标位置。</p>\n<hr>\n<h2 id=\"锚元素点击事件\"><a href=\"#锚元素点击事件\" class=\"headerlink\" title=\"锚元素点击事件\"></a>锚元素点击事件</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> anchors = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'nav &gt; a'</span>);</span><br><span class=\"line\"> anchors.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">element</span>) </span>&#123;</span><br><span class=\"line\">   element.addEventListener(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">     e.preventDefault();</span><br><span class=\"line\">     scrollTo(<span class=\"keyword\">this</span>, <span class=\"built_in\">document</span>.getElementById(<span class=\"keyword\">this</span>.href.split(<span class=\"string\">'#'</span>)[<span class=\"number\">1</span>]), <span class=\"number\">2000</span>);</span><br><span class=\"line\">   &#125;);</span><br><span class=\"line\"> &#125;, <span class=\"keyword\">this</span>);</span><br></pre></td></tr></table></figure>\n<p>滚动时长设置为<code>2s</code>固定值。</p>\n<hr>\n<h2 id=\"滚动函数实现\"><a href=\"#滚动函数实现\" class=\"headerlink\" title=\"滚动函数实现\"></a>滚动函数实现</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">scrollTo</span>(<span class=\"params\">element, to, delay</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> difference = to.getBoundingClientRect().top - element.getBoundingClientRect().top - <span class=\"number\">80</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> stepTime = <span class=\"number\">8</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> stepDis = difference*stepTime / delay ;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> count = <span class=\"built_in\">Math</span>.ceil(difference/stepDis);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> index = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> outQuart = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">n</span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">1</span> - (--n * n * n * n);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">stepFunc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      index++;</span><br><span class=\"line\">      setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> diff = outQuart(index/count)*difference;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(count &gt;= index) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.scrollTo(<span class=\"number\">0</span>, diff);</span><br><span class=\"line\">          stepFunc();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;, stepTime);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    stepFunc();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>getBoundingClientRect</code>函数用于获取元素大小和相对视口的位置。为了让屏幕滚动更加平滑一些，这里借助了<code>outQuart</code>插值算法，如果想要其他效果可以看<a href=\"http://easings.net/zh-cn\" target=\"_blank\" rel=\"noopener\">插值算法对照表</a>,<br>赠送一个<a href=\"https://github.com/component/ease\" target=\"_blank\" rel=\"noopener\">插值算法库</a>。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"简单的ScrollTo动画实现\"><a href=\"#简单的ScrollTo动画实现\" class=\"headerlink\" title=\"简单的ScrollTo动画实现\"></a>简单的ScrollTo动画实现</h1><p>在页面导航栏目设置几个标题按钮，按下的时候调转到对应的位置，这大概是浏览器页面开发最基本的动效之一了。看了一下很多页面都是基于<code>jquery</code>来实现，我不想用它，所以要自己造一个轮子。我们知道浏览器页面滚动都是基于<code>window.scrollTo</code>函数来实现的，还有一个函数叫<code>window.scrollBy</code>,用于滚动到某个相对坐标位置。</p>\n<hr>\n<h2 id=\"锚元素点击事件\"><a href=\"#锚元素点击事件\" class=\"headerlink\" title=\"锚元素点击事件\"></a>锚元素点击事件</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> anchors = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'nav &gt; a'</span>);</span><br><span class=\"line\"> anchors.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">element</span>) </span>&#123;</span><br><span class=\"line\">   element.addEventListener(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">     e.preventDefault();</span><br><span class=\"line\">     scrollTo(<span class=\"keyword\">this</span>, <span class=\"built_in\">document</span>.getElementById(<span class=\"keyword\">this</span>.href.split(<span class=\"string\">'#'</span>)[<span class=\"number\">1</span>]), <span class=\"number\">2000</span>);</span><br><span class=\"line\">   &#125;);</span><br><span class=\"line\"> &#125;, <span class=\"keyword\">this</span>);</span><br></pre></td></tr></table></figure>\n<p>滚动时长设置为<code>2s</code>固定值。</p>\n<hr>\n<h2 id=\"滚动函数实现\"><a href=\"#滚动函数实现\" class=\"headerlink\" title=\"滚动函数实现\"></a>滚动函数实现</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">scrollTo</span>(<span class=\"params\">element, to, delay</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> difference = to.getBoundingClientRect().top - element.getBoundingClientRect().top - <span class=\"number\">80</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> stepTime = <span class=\"number\">8</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> stepDis = difference*stepTime / delay ;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> count = <span class=\"built_in\">Math</span>.ceil(difference/stepDis);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> index = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> outQuart = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">n</span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">1</span> - (--n * n * n * n);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">stepFunc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      index++;</span><br><span class=\"line\">      setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> diff = outQuart(index/count)*difference;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(count &gt;= index) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.scrollTo(<span class=\"number\">0</span>, diff);</span><br><span class=\"line\">          stepFunc();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;, stepTime);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    stepFunc();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>getBoundingClientRect</code>函数用于获取元素大小和相对视口的位置。为了让屏幕滚动更加平滑一些，这里借助了<code>outQuart</code>插值算法，如果想要其他效果可以看<a href=\"http://easings.net/zh-cn\" target=\"_blank\" rel=\"noopener\">插值算法对照表</a>,<br>赠送一个<a href=\"https://github.com/component/ease\" target=\"_blank\" rel=\"noopener\">插值算法库</a>。</p>\n"},{"title":"Session-&-Cookie","_content":"### Session\n\n&nbsp;&nbsp;&nbsp;&nbsp;web网站基于`HTTP`协议来做业务交互，`HTTP`协议本身是一个无状态的协议，但实际情况是日常很多业务逻辑都需要记录用户的行为信息。举个例子：\n\n> 一个购物网站，顾客会在商品浏览页面选取需要的各类商品，放置到虚拟的购物车内。下单的时候需要跳转到结算页面，在这一串连续的用户行为中，至关重要的一点是记录当前的购物车信息，而session机制可以恰当的处理此类问题。\n\n&nbsp;&nbsp;&nbsp;&nbsp;网站通常会在用户第一次登录的时候生成一个`Session ID`, `Session ID`不同于用户ID, 用户ID始终唯一，但是同一个用户每次登录获取的`Session ID`可能不一致。`Session ID`由服务器端生成，通过`HTTP`协议头返回给客户端，这样可以极大的降低可能导致的安全问题(其他劫持暂且不说)。因为浏览器拿到的只是一个`token`，而与此相关的数据存储都在服务器端完成。服务端在设置`session ID`的同时会指定改`session id`的过期时间，以及该`session id`试用的请求路径(path)。了解了`session`的大致原理，下面结合代码来了解大致的使用过程。\n\n#### 从cookie说起\n\n上述使用案例得益于`cookie`这一伟大发明，一般来说cookie的处理分为如下几个步骤：\n+ 1. 用户打开网页\n+ 2. 服务端生成cookie数据返回给浏览器\n+ 3. 浏览器将cookie保存\n+ 4. 之后每次加载该页面，浏览器都把cookie数据发送给服务器\n\n\n#### cookies的基本数据格式\n标准的 `HTTP`协议有一个字段`Set-Cookie`用于标示cookie数据。服务器通过该字段告知客户端cookie数据。设置`cookie`数据的同时支持给该数据指定一些配置信息：\n- Path: 表示该cookie数据影响到的路径，当前访问的url不满足该匹配时，不发送该cookie数据。\n- Expires: 该`cookies`数据的过期时间(具体的时间点)，如果不设置该选项，在浏览器关闭时该`cookie`丢失。该字段是一个UTC格式的字符串。\n- Max-Age: 告知浏览器`cookie`多久之后过期，可以解决客户端与服务器时间不一致导致过期时间不准确的问题, 在express里时间单位是毫秒。\n- HttpOnly: 告知浏览器该`cookie`不允许通过浏览器API的形式去修改，比如说通过`document.cookie`修改。在`document.cookie`不可见。\n- Secure: 当设置该值为`true`时，`cookie`数据在`HTTP`协议下无效，只有在`HTTPS`协议下才有效。\n- domain: `domain`属性指定了该`cookie`所属的域名(`Domain`), 比如说设置`domain=example.com`,那么浏览器在给`www.example.com`, `www.abc.example.com`发送`HTTP`请求时都会带上该`cookie`。如果服务器没有设置该属性那么浏览器默认该`cookie`从属于`www.example.com`域名。说到这里，一定会想，要是我把domain设置为其他网站,这样我是不是可以轻易更改其他网站的`cookie`数据了？浏览器有个策略，允许`foo.example.com`的服务器设置`domain`为`example.com`或者`foo.example.com`。但是不允许设置`domain`为`bar.example.com` ETC。同时考虑到安全方面的因素，浏览器拒绝只给`domain`设置公共(public suffixes)，比如说设置为`com`, `co.uk`是不被允许的。\n\n---\n\n**Set-Cookie格式定义**\n>\n*Set-Cookie: name=value; Path:/; Domin=.domin.com;Secure=true*\n\n第一部分表示设置的`cookie`键/值，后面跟着几个配置参数。\n\n\n###Cookie 解析\n`Express/Connect`有一个`cookieParser`中间件专门负责`cookieParser`的解析。其实现原理如下：\n``` javascript\n\n\nfunction parserCookie(cookie, options) {\n   var obj = {};\n   var pairs = cookies.split(/; /);\n   var decode = opt.decode || decodeURIComponent;\n   \n   pairs.forEach(function(pair) {\n      var eq_idx = pair.indexOf('=');\n      var key = pair.substr(0, eq_idx).trim();\n      var val = pair.substr(eq_idx, pair.length).trim();\n       try {\n           obj[key] = decode(val);\n        }\n        catch(err) {\n           obj[key] = val;\n        }\n   });\n   \n   return obj;\n}\n\nfunction parseSignCookie(cookies, secret) {\n  var keys = Object.keys(cookies);\n  var dec = null;\n  var ret = Object.create(null);\n  var val = null\n\n  for(var i = 0; i < keys.length; i++) {\n     var k = keys[i];\n     var v = cookies[k];\n     dec = unsign(v, secret);\n    ret[k] = dec;\n  }\n  return ret;\n}\n\nfunction parseJSONCookie(cookie) {\n   var keys = Object.keys(cookie);\n   var key;\n   var val;\n\n   for(var i = 0; i < cookie.length; i++) {\n      val = cookie[i];\n      key = keys[i];\n      obj[key] = JSON.parse(val);\n   }\n}\n\n\nvar cookieParser = function(secret, opts) {\nfunction(req, res, next) {\n    if(req.cookies) return;\n    \n    var cookies = req.headers.cookies;\n    req.cookies = {};\n    req.signCookies = {};\n\n   //把name=value格式的字符串解析为一个json对象\n    req.cookies = parserCookie(cookies, options);\n\n    if(secret) {\n      //解析加密过的cookie字段\n      req.signCookies = parseSignCookie(req.cookies, secret);\n      //解析stringify过的JSON对象\n      req.signCookies = parseJSONCookie(req.signCookies);\n    }\n    \n    req.cookies = parseJSONCookies(req.cookies);\n}\n}\n```\n\n> Express 给不一样的cookie字段值打上不一样的标签，如`j: `表示该值是一个JSON对象stringify后的值，`s: `表示该字段是经过加密的。默认把加密与未加密的字段分别放在`req.signCookies`, `req.cookies`。\n\n---\n\n### 设置 Cookie \n\n`Express`提供了一个`res.cookie`接口来设置`Cookie`数据。来看看`Express`的处理代码：\n\n``` javascript\n\nres.cookie = function (name, value, options) {\n  var opts = merge({}, options);\n  var secret = this.req.secret;\n  var signed = opts.signed;\n\n  if (signed && !secret) {\n    throw new Error('cookieParser(\"secret\") required for signed cookies');\n  }\n\n  var val = typeof value === 'object'\n    ? 'j:' + JSON.stringify(value)\n    : String(value);\n\n  if (signed) {\n    val = 's:' + sign(val, secret);\n  }\n\n  if ('maxAge' in opts) {\n    opts.expires = new Date(Date.now() + opts.maxAge);\n    opts.maxAge /= 1000;\n  }\n\n  if (opts.path == null) {\n    opts.path = '/';\n  }\n\n  this.append('Set-Cookie', cookie.serialize(name, String(val), opts));\n\n  return this;\n};\n\n//序列化cookie以及配置信息\nfunction serialize(name, val, options) {  \n  var enc = opt.encode || encode;  \n  var pairs = [name + '=' + enc(val)];  \n  if (null != opt.maxAge) {    \n    var maxAge = opt.maxAge - 0;    \n    if (isNaN(maxAge)) \n      throw new Error('maxAge should be a Number');    \n    pairs.push('Max-Age=' + maxAge);  \n  }  \n  if (opt.domain) pairs.push('Domain=' + opt.domain);  \n  if (opt.path) pairs.push('Path=' + opt.path);  \n  if (opt.expires) pairs.push('Expires=' + opt.expires.toUTCString());  \n  if (opt.httpOnly) pairs.push('HttpOnly');  \n  if (opt.secure) pairs.push('Secure');  return pairs.join('; ');\n}\n\n//设置到HTTP应答协议头\nres.append = function append(field, val) {\n  var prev = this.get(field);\n  var value = val;\n\n  if (prev) {\n    // concat the new and prev vals\n    value = Array.isArray(prev) ? prev.concat(val)\n      : Array.isArray(val) ? [prev].concat(val)\n      : [prev, val];\n  }\n\n  return this.set(field, value);\n};\n\n```\n\n---\n","source":"_posts/Session-&-Cookie.md","raw":"---\ntitle: Session-&-Cookie\ncategories: server\n---\n### Session\n\n&nbsp;&nbsp;&nbsp;&nbsp;web网站基于`HTTP`协议来做业务交互，`HTTP`协议本身是一个无状态的协议，但实际情况是日常很多业务逻辑都需要记录用户的行为信息。举个例子：\n\n> 一个购物网站，顾客会在商品浏览页面选取需要的各类商品，放置到虚拟的购物车内。下单的时候需要跳转到结算页面，在这一串连续的用户行为中，至关重要的一点是记录当前的购物车信息，而session机制可以恰当的处理此类问题。\n\n&nbsp;&nbsp;&nbsp;&nbsp;网站通常会在用户第一次登录的时候生成一个`Session ID`, `Session ID`不同于用户ID, 用户ID始终唯一，但是同一个用户每次登录获取的`Session ID`可能不一致。`Session ID`由服务器端生成，通过`HTTP`协议头返回给客户端，这样可以极大的降低可能导致的安全问题(其他劫持暂且不说)。因为浏览器拿到的只是一个`token`，而与此相关的数据存储都在服务器端完成。服务端在设置`session ID`的同时会指定改`session id`的过期时间，以及该`session id`试用的请求路径(path)。了解了`session`的大致原理，下面结合代码来了解大致的使用过程。\n\n#### 从cookie说起\n\n上述使用案例得益于`cookie`这一伟大发明，一般来说cookie的处理分为如下几个步骤：\n+ 1. 用户打开网页\n+ 2. 服务端生成cookie数据返回给浏览器\n+ 3. 浏览器将cookie保存\n+ 4. 之后每次加载该页面，浏览器都把cookie数据发送给服务器\n\n\n#### cookies的基本数据格式\n标准的 `HTTP`协议有一个字段`Set-Cookie`用于标示cookie数据。服务器通过该字段告知客户端cookie数据。设置`cookie`数据的同时支持给该数据指定一些配置信息：\n- Path: 表示该cookie数据影响到的路径，当前访问的url不满足该匹配时，不发送该cookie数据。\n- Expires: 该`cookies`数据的过期时间(具体的时间点)，如果不设置该选项，在浏览器关闭时该`cookie`丢失。该字段是一个UTC格式的字符串。\n- Max-Age: 告知浏览器`cookie`多久之后过期，可以解决客户端与服务器时间不一致导致过期时间不准确的问题, 在express里时间单位是毫秒。\n- HttpOnly: 告知浏览器该`cookie`不允许通过浏览器API的形式去修改，比如说通过`document.cookie`修改。在`document.cookie`不可见。\n- Secure: 当设置该值为`true`时，`cookie`数据在`HTTP`协议下无效，只有在`HTTPS`协议下才有效。\n- domain: `domain`属性指定了该`cookie`所属的域名(`Domain`), 比如说设置`domain=example.com`,那么浏览器在给`www.example.com`, `www.abc.example.com`发送`HTTP`请求时都会带上该`cookie`。如果服务器没有设置该属性那么浏览器默认该`cookie`从属于`www.example.com`域名。说到这里，一定会想，要是我把domain设置为其他网站,这样我是不是可以轻易更改其他网站的`cookie`数据了？浏览器有个策略，允许`foo.example.com`的服务器设置`domain`为`example.com`或者`foo.example.com`。但是不允许设置`domain`为`bar.example.com` ETC。同时考虑到安全方面的因素，浏览器拒绝只给`domain`设置公共(public suffixes)，比如说设置为`com`, `co.uk`是不被允许的。\n\n---\n\n**Set-Cookie格式定义**\n>\n*Set-Cookie: name=value; Path:/; Domin=.domin.com;Secure=true*\n\n第一部分表示设置的`cookie`键/值，后面跟着几个配置参数。\n\n\n###Cookie 解析\n`Express/Connect`有一个`cookieParser`中间件专门负责`cookieParser`的解析。其实现原理如下：\n``` javascript\n\n\nfunction parserCookie(cookie, options) {\n   var obj = {};\n   var pairs = cookies.split(/; /);\n   var decode = opt.decode || decodeURIComponent;\n   \n   pairs.forEach(function(pair) {\n      var eq_idx = pair.indexOf('=');\n      var key = pair.substr(0, eq_idx).trim();\n      var val = pair.substr(eq_idx, pair.length).trim();\n       try {\n           obj[key] = decode(val);\n        }\n        catch(err) {\n           obj[key] = val;\n        }\n   });\n   \n   return obj;\n}\n\nfunction parseSignCookie(cookies, secret) {\n  var keys = Object.keys(cookies);\n  var dec = null;\n  var ret = Object.create(null);\n  var val = null\n\n  for(var i = 0; i < keys.length; i++) {\n     var k = keys[i];\n     var v = cookies[k];\n     dec = unsign(v, secret);\n    ret[k] = dec;\n  }\n  return ret;\n}\n\nfunction parseJSONCookie(cookie) {\n   var keys = Object.keys(cookie);\n   var key;\n   var val;\n\n   for(var i = 0; i < cookie.length; i++) {\n      val = cookie[i];\n      key = keys[i];\n      obj[key] = JSON.parse(val);\n   }\n}\n\n\nvar cookieParser = function(secret, opts) {\nfunction(req, res, next) {\n    if(req.cookies) return;\n    \n    var cookies = req.headers.cookies;\n    req.cookies = {};\n    req.signCookies = {};\n\n   //把name=value格式的字符串解析为一个json对象\n    req.cookies = parserCookie(cookies, options);\n\n    if(secret) {\n      //解析加密过的cookie字段\n      req.signCookies = parseSignCookie(req.cookies, secret);\n      //解析stringify过的JSON对象\n      req.signCookies = parseJSONCookie(req.signCookies);\n    }\n    \n    req.cookies = parseJSONCookies(req.cookies);\n}\n}\n```\n\n> Express 给不一样的cookie字段值打上不一样的标签，如`j: `表示该值是一个JSON对象stringify后的值，`s: `表示该字段是经过加密的。默认把加密与未加密的字段分别放在`req.signCookies`, `req.cookies`。\n\n---\n\n### 设置 Cookie \n\n`Express`提供了一个`res.cookie`接口来设置`Cookie`数据。来看看`Express`的处理代码：\n\n``` javascript\n\nres.cookie = function (name, value, options) {\n  var opts = merge({}, options);\n  var secret = this.req.secret;\n  var signed = opts.signed;\n\n  if (signed && !secret) {\n    throw new Error('cookieParser(\"secret\") required for signed cookies');\n  }\n\n  var val = typeof value === 'object'\n    ? 'j:' + JSON.stringify(value)\n    : String(value);\n\n  if (signed) {\n    val = 's:' + sign(val, secret);\n  }\n\n  if ('maxAge' in opts) {\n    opts.expires = new Date(Date.now() + opts.maxAge);\n    opts.maxAge /= 1000;\n  }\n\n  if (opts.path == null) {\n    opts.path = '/';\n  }\n\n  this.append('Set-Cookie', cookie.serialize(name, String(val), opts));\n\n  return this;\n};\n\n//序列化cookie以及配置信息\nfunction serialize(name, val, options) {  \n  var enc = opt.encode || encode;  \n  var pairs = [name + '=' + enc(val)];  \n  if (null != opt.maxAge) {    \n    var maxAge = opt.maxAge - 0;    \n    if (isNaN(maxAge)) \n      throw new Error('maxAge should be a Number');    \n    pairs.push('Max-Age=' + maxAge);  \n  }  \n  if (opt.domain) pairs.push('Domain=' + opt.domain);  \n  if (opt.path) pairs.push('Path=' + opt.path);  \n  if (opt.expires) pairs.push('Expires=' + opt.expires.toUTCString());  \n  if (opt.httpOnly) pairs.push('HttpOnly');  \n  if (opt.secure) pairs.push('Secure');  return pairs.join('; ');\n}\n\n//设置到HTTP应答协议头\nres.append = function append(field, val) {\n  var prev = this.get(field);\n  var value = val;\n\n  if (prev) {\n    // concat the new and prev vals\n    value = Array.isArray(prev) ? prev.concat(val)\n      : Array.isArray(val) ? [prev].concat(val)\n      : [prev, val];\n  }\n\n  return this.set(field, value);\n};\n\n```\n\n---\n","slug":"Session-&-Cookie","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxd000l9co7eerwidco","content":"<h3 id=\"Session\"><a href=\"#Session\" class=\"headerlink\" title=\"Session\"></a>Session</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;web网站基于<code>HTTP</code>协议来做业务交互，<code>HTTP</code>协议本身是一个无状态的协议，但实际情况是日常很多业务逻辑都需要记录用户的行为信息。举个例子：</p>\n<blockquote>\n<p>一个购物网站，顾客会在商品浏览页面选取需要的各类商品，放置到虚拟的购物车内。下单的时候需要跳转到结算页面，在这一串连续的用户行为中，至关重要的一点是记录当前的购物车信息，而session机制可以恰当的处理此类问题。</p>\n</blockquote>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;网站通常会在用户第一次登录的时候生成一个<code>Session ID</code>, <code>Session ID</code>不同于用户ID, 用户ID始终唯一，但是同一个用户每次登录获取的<code>Session ID</code>可能不一致。<code>Session ID</code>由服务器端生成，通过<code>HTTP</code>协议头返回给客户端，这样可以极大的降低可能导致的安全问题(其他劫持暂且不说)。因为浏览器拿到的只是一个<code>token</code>，而与此相关的数据存储都在服务器端完成。服务端在设置<code>session ID</code>的同时会指定改<code>session id</code>的过期时间，以及该<code>session id</code>试用的请求路径(path)。了解了<code>session</code>的大致原理，下面结合代码来了解大致的使用过程。</p>\n<h4 id=\"从cookie说起\"><a href=\"#从cookie说起\" class=\"headerlink\" title=\"从cookie说起\"></a>从cookie说起</h4><p>上述使用案例得益于<code>cookie</code>这一伟大发明，一般来说cookie的处理分为如下几个步骤：</p>\n<ul>\n<li><ol>\n<li>用户打开网页</li>\n</ol>\n</li>\n<li><ol>\n<li>服务端生成cookie数据返回给浏览器</li>\n</ol>\n</li>\n<li><ol>\n<li>浏览器将cookie保存</li>\n</ol>\n</li>\n<li><ol>\n<li>之后每次加载该页面，浏览器都把cookie数据发送给服务器</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"cookies的基本数据格式\"><a href=\"#cookies的基本数据格式\" class=\"headerlink\" title=\"cookies的基本数据格式\"></a>cookies的基本数据格式</h4><p>标准的 <code>HTTP</code>协议有一个字段<code>Set-Cookie</code>用于标示cookie数据。服务器通过该字段告知客户端cookie数据。设置<code>cookie</code>数据的同时支持给该数据指定一些配置信息：</p>\n<ul>\n<li>Path: 表示该cookie数据影响到的路径，当前访问的url不满足该匹配时，不发送该cookie数据。</li>\n<li>Expires: 该<code>cookies</code>数据的过期时间(具体的时间点)，如果不设置该选项，在浏览器关闭时该<code>cookie</code>丢失。该字段是一个UTC格式的字符串。</li>\n<li>Max-Age: 告知浏览器<code>cookie</code>多久之后过期，可以解决客户端与服务器时间不一致导致过期时间不准确的问题, 在express里时间单位是毫秒。</li>\n<li>HttpOnly: 告知浏览器该<code>cookie</code>不允许通过浏览器API的形式去修改，比如说通过<code>document.cookie</code>修改。在<code>document.cookie</code>不可见。</li>\n<li>Secure: 当设置该值为<code>true</code>时，<code>cookie</code>数据在<code>HTTP</code>协议下无效，只有在<code>HTTPS</code>协议下才有效。</li>\n<li>domain: <code>domain</code>属性指定了该<code>cookie</code>所属的域名(<code>Domain</code>), 比如说设置<code>domain=example.com</code>,那么浏览器在给<code>www.example.com</code>, <code>www.abc.example.com</code>发送<code>HTTP</code>请求时都会带上该<code>cookie</code>。如果服务器没有设置该属性那么浏览器默认该<code>cookie</code>从属于<code>www.example.com</code>域名。说到这里，一定会想，要是我把domain设置为其他网站,这样我是不是可以轻易更改其他网站的<code>cookie</code>数据了？浏览器有个策略，允许<code>foo.example.com</code>的服务器设置<code>domain</code>为<code>example.com</code>或者<code>foo.example.com</code>。但是不允许设置<code>domain</code>为<code>bar.example.com</code> ETC。同时考虑到安全方面的因素，浏览器拒绝只给<code>domain</code>设置公共(public suffixes)，比如说设置为<code>com</code>, <code>co.uk</code>是不被允许的。</li>\n</ul>\n<hr>\n<p><strong>Set-Cookie格式定义</strong><br>&gt;<br><em>Set-Cookie: name=value; Path:/; Domin=.domin.com;Secure=true</em></p>\n<p>第一部分表示设置的<code>cookie</code>键/值，后面跟着几个配置参数。</p>\n<p>###Cookie 解析<br><code>Express/Connect</code>有一个<code>cookieParser</code>中间件专门负责<code>cookieParser</code>的解析。其实现原理如下：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parserCookie</span>(<span class=\"params\">cookie, options</span>) </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> obj = &#123;&#125;;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> pairs = cookies.split(<span class=\"regexp\">/; /</span>);</span><br><span class=\"line\">   <span class=\"keyword\">var</span> decode = opt.decode || <span class=\"built_in\">decodeURIComponent</span>;</span><br><span class=\"line\">   </span><br><span class=\"line\">   pairs.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">pair</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> eq_idx = pair.indexOf(<span class=\"string\">'='</span>);</span><br><span class=\"line\">      <span class=\"keyword\">var</span> key = pair.substr(<span class=\"number\">0</span>, eq_idx).trim();</span><br><span class=\"line\">      <span class=\"keyword\">var</span> val = pair.substr(eq_idx, pair.length).trim();</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           obj[key] = decode(val);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">           obj[key] = val;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">   &#125;);</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseSignCookie</span>(<span class=\"params\">cookies, secret</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> keys = <span class=\"built_in\">Object</span>.keys(cookies);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> dec = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> ret = <span class=\"built_in\">Object</span>.create(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> val = <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class=\"line\">     <span class=\"keyword\">var</span> k = keys[i];</span><br><span class=\"line\">     <span class=\"keyword\">var</span> v = cookies[k];</span><br><span class=\"line\">     dec = unsign(v, secret);</span><br><span class=\"line\">    ret[k] = dec;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseJSONCookie</span>(<span class=\"params\">cookie</span>) </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> keys = <span class=\"built_in\">Object</span>.keys(cookie);</span><br><span class=\"line\">   <span class=\"keyword\">var</span> key;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> val;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; cookie.length; i++) &#123;</span><br><span class=\"line\">      val = cookie[i];</span><br><span class=\"line\">      key = keys[i];</span><br><span class=\"line\">      obj[key] = <span class=\"built_in\">JSON</span>.parse(val);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> cookieParser = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">secret, opts</span>) </span>&#123;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(req.cookies) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> cookies = req.headers.cookies;</span><br><span class=\"line\">    req.cookies = &#123;&#125;;</span><br><span class=\"line\">    req.signCookies = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//把name=value格式的字符串解析为一个json对象</span></span><br><span class=\"line\">    req.cookies = parserCookie(cookies, options);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(secret) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//解析加密过的cookie字段</span></span><br><span class=\"line\">      req.signCookies = parseSignCookie(req.cookies, secret);</span><br><span class=\"line\">      <span class=\"comment\">//解析stringify过的JSON对象</span></span><br><span class=\"line\">      req.signCookies = parseJSONCookie(req.signCookies);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    req.cookies = parseJSONCookies(req.cookies);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>Express 给不一样的cookie字段值打上不一样的标签，如<code>j:</code>表示该值是一个JSON对象stringify后的值，<code>s:</code>表示该字段是经过加密的。默认把加密与未加密的字段分别放在<code>req.signCookies</code>, <code>req.cookies</code>。</p>\n</blockquote>\n<hr>\n<h3 id=\"设置-Cookie\"><a href=\"#设置-Cookie\" class=\"headerlink\" title=\"设置 Cookie\"></a>设置 Cookie</h3><p><code>Express</code>提供了一个<code>res.cookie</code>接口来设置<code>Cookie</code>数据。来看看<code>Express</code>的处理代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">res.cookie = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name, value, options</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> opts = merge(&#123;&#125;, options);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> secret = <span class=\"keyword\">this</span>.req.secret;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> signed = opts.signed;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (signed &amp;&amp; !secret) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'cookieParser(\"secret\") required for signed cookies'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> val = <span class=\"keyword\">typeof</span> value === <span class=\"string\">'object'</span></span><br><span class=\"line\">    ? <span class=\"string\">'j:'</span> + <span class=\"built_in\">JSON</span>.stringify(value)</span><br><span class=\"line\">    : <span class=\"built_in\">String</span>(value);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (signed) &#123;</span><br><span class=\"line\">    val = <span class=\"string\">'s:'</span> + sign(val, secret);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"string\">'maxAge'</span> <span class=\"keyword\">in</span> opts) &#123;</span><br><span class=\"line\">    opts.expires = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"built_in\">Date</span>.now() + opts.maxAge);</span><br><span class=\"line\">    opts.maxAge /= <span class=\"number\">1000</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (opts.path == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    opts.path = <span class=\"string\">'/'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.append(<span class=\"string\">'Set-Cookie'</span>, cookie.serialize(name, <span class=\"built_in\">String</span>(val), opts));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//序列化cookie以及配置信息</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">serialize</span>(<span class=\"params\">name, val, options</span>) </span>&#123;  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> enc = opt.encode || encode;  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> pairs = [name + <span class=\"string\">'='</span> + enc(val)];  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> != opt.maxAge) &#123;    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> maxAge = opt.maxAge - <span class=\"number\">0</span>;    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">isNaN</span>(maxAge)) </span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'maxAge should be a Number'</span>);    </span><br><span class=\"line\">    pairs.push(<span class=\"string\">'Max-Age='</span> + maxAge);  </span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (opt.domain) pairs.push(<span class=\"string\">'Domain='</span> + opt.domain);  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (opt.path) pairs.push(<span class=\"string\">'Path='</span> + opt.path);  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (opt.expires) pairs.push(<span class=\"string\">'Expires='</span> + opt.expires.toUTCString());  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (opt.httpOnly) pairs.push(<span class=\"string\">'HttpOnly'</span>);  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (opt.secure) pairs.push(<span class=\"string\">'Secure'</span>);  <span class=\"keyword\">return</span> pairs.join(<span class=\"string\">'; '</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//设置到HTTP应答协议头</span></span><br><span class=\"line\">res.append = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">append</span>(<span class=\"params\">field, val</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> prev = <span class=\"keyword\">this</span>.get(field);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> value = val;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (prev) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// concat the new and prev vals</span></span><br><span class=\"line\">    value = <span class=\"built_in\">Array</span>.isArray(prev) ? prev.concat(val)</span><br><span class=\"line\">      : <span class=\"built_in\">Array</span>.isArray(val) ? [prev].concat(val)</span><br><span class=\"line\">      : [prev, val];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.set(field, value);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<hr>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"Session\"><a href=\"#Session\" class=\"headerlink\" title=\"Session\"></a>Session</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;web网站基于<code>HTTP</code>协议来做业务交互，<code>HTTP</code>协议本身是一个无状态的协议，但实际情况是日常很多业务逻辑都需要记录用户的行为信息。举个例子：</p>\n<blockquote>\n<p>一个购物网站，顾客会在商品浏览页面选取需要的各类商品，放置到虚拟的购物车内。下单的时候需要跳转到结算页面，在这一串连续的用户行为中，至关重要的一点是记录当前的购物车信息，而session机制可以恰当的处理此类问题。</p>\n</blockquote>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;网站通常会在用户第一次登录的时候生成一个<code>Session ID</code>, <code>Session ID</code>不同于用户ID, 用户ID始终唯一，但是同一个用户每次登录获取的<code>Session ID</code>可能不一致。<code>Session ID</code>由服务器端生成，通过<code>HTTP</code>协议头返回给客户端，这样可以极大的降低可能导致的安全问题(其他劫持暂且不说)。因为浏览器拿到的只是一个<code>token</code>，而与此相关的数据存储都在服务器端完成。服务端在设置<code>session ID</code>的同时会指定改<code>session id</code>的过期时间，以及该<code>session id</code>试用的请求路径(path)。了解了<code>session</code>的大致原理，下面结合代码来了解大致的使用过程。</p>\n<h4 id=\"从cookie说起\"><a href=\"#从cookie说起\" class=\"headerlink\" title=\"从cookie说起\"></a>从cookie说起</h4><p>上述使用案例得益于<code>cookie</code>这一伟大发明，一般来说cookie的处理分为如下几个步骤：</p>\n<ul>\n<li><ol>\n<li>用户打开网页</li>\n</ol>\n</li>\n<li><ol>\n<li>服务端生成cookie数据返回给浏览器</li>\n</ol>\n</li>\n<li><ol>\n<li>浏览器将cookie保存</li>\n</ol>\n</li>\n<li><ol>\n<li>之后每次加载该页面，浏览器都把cookie数据发送给服务器</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"cookies的基本数据格式\"><a href=\"#cookies的基本数据格式\" class=\"headerlink\" title=\"cookies的基本数据格式\"></a>cookies的基本数据格式</h4><p>标准的 <code>HTTP</code>协议有一个字段<code>Set-Cookie</code>用于标示cookie数据。服务器通过该字段告知客户端cookie数据。设置<code>cookie</code>数据的同时支持给该数据指定一些配置信息：</p>\n<ul>\n<li>Path: 表示该cookie数据影响到的路径，当前访问的url不满足该匹配时，不发送该cookie数据。</li>\n<li>Expires: 该<code>cookies</code>数据的过期时间(具体的时间点)，如果不设置该选项，在浏览器关闭时该<code>cookie</code>丢失。该字段是一个UTC格式的字符串。</li>\n<li>Max-Age: 告知浏览器<code>cookie</code>多久之后过期，可以解决客户端与服务器时间不一致导致过期时间不准确的问题, 在express里时间单位是毫秒。</li>\n<li>HttpOnly: 告知浏览器该<code>cookie</code>不允许通过浏览器API的形式去修改，比如说通过<code>document.cookie</code>修改。在<code>document.cookie</code>不可见。</li>\n<li>Secure: 当设置该值为<code>true</code>时，<code>cookie</code>数据在<code>HTTP</code>协议下无效，只有在<code>HTTPS</code>协议下才有效。</li>\n<li>domain: <code>domain</code>属性指定了该<code>cookie</code>所属的域名(<code>Domain</code>), 比如说设置<code>domain=example.com</code>,那么浏览器在给<code>www.example.com</code>, <code>www.abc.example.com</code>发送<code>HTTP</code>请求时都会带上该<code>cookie</code>。如果服务器没有设置该属性那么浏览器默认该<code>cookie</code>从属于<code>www.example.com</code>域名。说到这里，一定会想，要是我把domain设置为其他网站,这样我是不是可以轻易更改其他网站的<code>cookie</code>数据了？浏览器有个策略，允许<code>foo.example.com</code>的服务器设置<code>domain</code>为<code>example.com</code>或者<code>foo.example.com</code>。但是不允许设置<code>domain</code>为<code>bar.example.com</code> ETC。同时考虑到安全方面的因素，浏览器拒绝只给<code>domain</code>设置公共(public suffixes)，比如说设置为<code>com</code>, <code>co.uk</code>是不被允许的。</li>\n</ul>\n<hr>\n<p><strong>Set-Cookie格式定义</strong><br>&gt;<br><em>Set-Cookie: name=value; Path:/; Domin=.domin.com;Secure=true</em></p>\n<p>第一部分表示设置的<code>cookie</code>键/值，后面跟着几个配置参数。</p>\n<p>###Cookie 解析<br><code>Express/Connect</code>有一个<code>cookieParser</code>中间件专门负责<code>cookieParser</code>的解析。其实现原理如下：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parserCookie</span>(<span class=\"params\">cookie, options</span>) </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> obj = &#123;&#125;;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> pairs = cookies.split(<span class=\"regexp\">/; /</span>);</span><br><span class=\"line\">   <span class=\"keyword\">var</span> decode = opt.decode || <span class=\"built_in\">decodeURIComponent</span>;</span><br><span class=\"line\">   </span><br><span class=\"line\">   pairs.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">pair</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> eq_idx = pair.indexOf(<span class=\"string\">'='</span>);</span><br><span class=\"line\">      <span class=\"keyword\">var</span> key = pair.substr(<span class=\"number\">0</span>, eq_idx).trim();</span><br><span class=\"line\">      <span class=\"keyword\">var</span> val = pair.substr(eq_idx, pair.length).trim();</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           obj[key] = decode(val);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">           obj[key] = val;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">   &#125;);</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseSignCookie</span>(<span class=\"params\">cookies, secret</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> keys = <span class=\"built_in\">Object</span>.keys(cookies);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> dec = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> ret = <span class=\"built_in\">Object</span>.create(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> val = <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class=\"line\">     <span class=\"keyword\">var</span> k = keys[i];</span><br><span class=\"line\">     <span class=\"keyword\">var</span> v = cookies[k];</span><br><span class=\"line\">     dec = unsign(v, secret);</span><br><span class=\"line\">    ret[k] = dec;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseJSONCookie</span>(<span class=\"params\">cookie</span>) </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> keys = <span class=\"built_in\">Object</span>.keys(cookie);</span><br><span class=\"line\">   <span class=\"keyword\">var</span> key;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> val;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; cookie.length; i++) &#123;</span><br><span class=\"line\">      val = cookie[i];</span><br><span class=\"line\">      key = keys[i];</span><br><span class=\"line\">      obj[key] = <span class=\"built_in\">JSON</span>.parse(val);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> cookieParser = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">secret, opts</span>) </span>&#123;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(req.cookies) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> cookies = req.headers.cookies;</span><br><span class=\"line\">    req.cookies = &#123;&#125;;</span><br><span class=\"line\">    req.signCookies = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//把name=value格式的字符串解析为一个json对象</span></span><br><span class=\"line\">    req.cookies = parserCookie(cookies, options);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(secret) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//解析加密过的cookie字段</span></span><br><span class=\"line\">      req.signCookies = parseSignCookie(req.cookies, secret);</span><br><span class=\"line\">      <span class=\"comment\">//解析stringify过的JSON对象</span></span><br><span class=\"line\">      req.signCookies = parseJSONCookie(req.signCookies);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    req.cookies = parseJSONCookies(req.cookies);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>Express 给不一样的cookie字段值打上不一样的标签，如<code>j:</code>表示该值是一个JSON对象stringify后的值，<code>s:</code>表示该字段是经过加密的。默认把加密与未加密的字段分别放在<code>req.signCookies</code>, <code>req.cookies</code>。</p>\n</blockquote>\n<hr>\n<h3 id=\"设置-Cookie\"><a href=\"#设置-Cookie\" class=\"headerlink\" title=\"设置 Cookie\"></a>设置 Cookie</h3><p><code>Express</code>提供了一个<code>res.cookie</code>接口来设置<code>Cookie</code>数据。来看看<code>Express</code>的处理代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">res.cookie = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name, value, options</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> opts = merge(&#123;&#125;, options);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> secret = <span class=\"keyword\">this</span>.req.secret;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> signed = opts.signed;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (signed &amp;&amp; !secret) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'cookieParser(\"secret\") required for signed cookies'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> val = <span class=\"keyword\">typeof</span> value === <span class=\"string\">'object'</span></span><br><span class=\"line\">    ? <span class=\"string\">'j:'</span> + <span class=\"built_in\">JSON</span>.stringify(value)</span><br><span class=\"line\">    : <span class=\"built_in\">String</span>(value);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (signed) &#123;</span><br><span class=\"line\">    val = <span class=\"string\">'s:'</span> + sign(val, secret);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"string\">'maxAge'</span> <span class=\"keyword\">in</span> opts) &#123;</span><br><span class=\"line\">    opts.expires = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"built_in\">Date</span>.now() + opts.maxAge);</span><br><span class=\"line\">    opts.maxAge /= <span class=\"number\">1000</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (opts.path == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    opts.path = <span class=\"string\">'/'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.append(<span class=\"string\">'Set-Cookie'</span>, cookie.serialize(name, <span class=\"built_in\">String</span>(val), opts));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//序列化cookie以及配置信息</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">serialize</span>(<span class=\"params\">name, val, options</span>) </span>&#123;  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> enc = opt.encode || encode;  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> pairs = [name + <span class=\"string\">'='</span> + enc(val)];  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> != opt.maxAge) &#123;    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> maxAge = opt.maxAge - <span class=\"number\">0</span>;    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">isNaN</span>(maxAge)) </span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'maxAge should be a Number'</span>);    </span><br><span class=\"line\">    pairs.push(<span class=\"string\">'Max-Age='</span> + maxAge);  </span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (opt.domain) pairs.push(<span class=\"string\">'Domain='</span> + opt.domain);  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (opt.path) pairs.push(<span class=\"string\">'Path='</span> + opt.path);  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (opt.expires) pairs.push(<span class=\"string\">'Expires='</span> + opt.expires.toUTCString());  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (opt.httpOnly) pairs.push(<span class=\"string\">'HttpOnly'</span>);  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (opt.secure) pairs.push(<span class=\"string\">'Secure'</span>);  <span class=\"keyword\">return</span> pairs.join(<span class=\"string\">'; '</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//设置到HTTP应答协议头</span></span><br><span class=\"line\">res.append = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">append</span>(<span class=\"params\">field, val</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> prev = <span class=\"keyword\">this</span>.get(field);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> value = val;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (prev) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// concat the new and prev vals</span></span><br><span class=\"line\">    value = <span class=\"built_in\">Array</span>.isArray(prev) ? prev.concat(val)</span><br><span class=\"line\">      : <span class=\"built_in\">Array</span>.isArray(val) ? [prev].concat(val)</span><br><span class=\"line\">      : [prev, val];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.set(field, value);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<hr>\n"},{"title":"async-tutorial","_content":"`async`是一个强大的异步流程控制库，其语义类似于`js`对数组的操作。它提供了一系列非常强大而便捷的方法，有助于我们在`javascript`单线程模型背景下写出优雅的逻辑控制代码。  \n\n### **牛刀小试**   \n先从文件操作开始初步了解`async`函数库的作用：  \n\n+ 使用`filter`过滤出磁盘中存在的文件  \n\n```javascript\nconst fs = require('fs');  \nconst async = require('async');  \n\nasync.filter(['f1', 'f2', 'f3'], function(it, callback) {\n    fs.access(it, function(err) {\n      callback(null, !err);\n    });\n}, function(err, results) {\n  console.log(results);\n});\n\n```  \n假设当前目录下存在以上三个文件，那么`results`输出为：  \n```javascript\n['f1', 'f2', 'f3']\n```  \n\n+ 使用`map`判断文件是否存在  \n```javascript\nasync.map(['f1', 'f2', 'f3'], function(it, callback) {\n  fs.exists(function(exists) {\n      callback(null, exists);\n  });\n}, function(err, results) {\n    console.log(results);//[true, true, true]\n});\n```  \n\n>以上两个例子分别使用了`access`与`exists`判断文件是否存在，关于两个`API`的详细说明，请查看`nodejs`[官方文档](https://nodejs.org/dist/latest-v6.x/docs/api/fs.html#fs_fs_exists_path_callback)  \n\n\n+ 常用的多任务并行   \n\n```javascript  \nfunction asyncTask(delay, arg) {\n    return function(callback) {\n        setTimeout(function() {\n            console.log(arg + \"done\");\n            callback(null, arg);\n        }, delay);\n    };\n}\n\nasync.parallel([\n    asyncTask(10, \"task1\"),\n    asyncTask(1, \"task2\"),\n    asyncTask(100, \"task3\"),\n], function(err, ret) {\n    console.log(ret);\n});\n\n```  \n`asyncTask`输出的顺序依次为：\n```javascript  \n\n[luncher@localhost async]$ node app.js\ntask2done\ntask1done\ntask3done\n//ret\n[ 'task1', 'task2', 'task3' ]\n\n```  \n可见虽然任务是并行的，但是最终的结果依然按照任务数组的顺序排列。  \n\n+ 顺序执行任务  \n\n```javascript  \n\nfunction asyncTask(delay, arg) {\n    return function(callback) {\n        setTimeout(function() {\n            console.log(arg + \"done\");\n            callback(null, arg);\n        }, delay);\n    };\n}\n\nasync.series([\n    asyncTask(10, \"task1\"),\n    asyncTask(1, \"task2\"),\n    asyncTask(100, \"task3\"),\n], function(err, ret) {\n    console.log(ret);\n});\n\n```  \n\n输出：  \n\n```javascript  \n[luncher@localhost async]$ node app.js\ntask1done\ntask2done\ntask3done\n[ 'task1', 'task2', 'task3' ]  \n```  \n可以看到任务按照传入的顺序依次执行。  \n\n---   \n\n### 集合类型多任务处理  \n- `each`  \n`each`函数依次遍历数组执行回调函数：  \n\n```javascript  \n\nfunction readFile(file, callback) {\n    fs.readFile(file, function(err, ret) {\n        console.log(\"readFile \"+ file + \" done\");\n        callback(err);\n    });\n}\n\nasync.each(['f1', 'f2', 'f3'], readFile, function(err) {\n    console.log(\"all done\");\n});\n\n```  \n**需要注意的是，each不能保证迭代函数完成的顺序，这取决于用户的具体任务**  \n\n- `forEachOf`  \n\n`each`函数可以对数组进行遍历，如果想要遍历的是一个对象，那么需要用到`forEachOf`.  \n\n```javascript  \nfunction readFile(file, k, callback) {\n    fs.readFile(file, function(err, ret) {\n        console.log(\"readFile \"+ k + \" \" + file + \" done\");\n        callback(err);\n    });\n}\n\nasync.forEachOf({k1: \"f1\", k2: \"f2\", k3: \"f3\"}, readFile, function(err) {\n    console.log(\"all done\");\n});\n```  \n\n迭代函数第一个参数是`value`，第二个参数是`key`.  \n\n- 控制`each`和`foEachOf`的顺序  \n` eachSeries`与`forEachOf`都是用来控制迭代函数的顺序执行：  \n\n```javascript  \n\nfunction readFile(file, k, callback) {\n    fs.readFile(file, function(err, ret) {\n        console.log(\"readFile \"+ k + \" \" + file + \" done\");\n        callback(err);\n    });\n}\n\nasync.forEachOfSeries({k1: \"f1\", k2: \"f2\", k3: \"f3\"}, readFile, function(err) {\n    console.log(\"all done\");\n});\n\n```  \n\n这样程序的输出始终是：  \n\n\n```javascript\n[luncher@localhost async]$ node app.js\nreadFile k1 f1 done  \nreadFile k2 f2 done\nreadFile k3 f3 done\nall done\n\n```\n\n+ 使用`apply`包装异步任务  \n\n前面几个异步任务都需要人为的额外写一个函数，如`asyncTask`，`async`提供一个`apply`语法糖用于解决此类问题：  \n\n```javascript  \n\n// 使用 apply\n\nasync.parallel([\n    async.apply(fs.writeFile, 'testfile1', 'test1'),\n    async.apply(fs.writeFile, 'testfile2', 'test2'),\n]);\n\n\n// 等同于\n\nasync.parallel([\n    function(callback){\n        fs.writeFile('testfile1', 'test1', callback);\n    },\n    function(callback){\n        fs.writeFile('testfile2', 'test2', callback);\n    }\n]);\n\n```  \n\n\n+ 使用`Limit`类函数控制并发数量  \n\n`async`为每个接口都提供了一个`Limit`参数，用户限制并发数量，我们利用`filterLimit`做一个简单的测试：  \n\n```javascript\n\nvar count = 0;\nasync.filterLimit([1, 10, 28, 90, 10], 2, function(it, callback) {\n    count++;\n    console.log(it + \"开始\");\n    console.log(\"并发数：\", count);\n    setTimeout(function() {\n        count--;\n        console.log(it + \"结束\");\n        callback(null);\n    }, it);\n}, function(results) {\n    console.log(results);\n});\n\n```  \n输出：  \n\n```javascript  \n[luncher@localhost async]$ node app.js \n1开始\n并发数： 1\n10开始\n并发数： 2\n1结束\n28开始\n并发数： 2\n10结束\n90开始\n并发数： 2\n28结束\n10开始\n并发数： 2\n10结束\n90结束\nnull\n\n```  \n\n可以看到，最大并发数也就是`2`，虽然待执行任务大于`2`.  \n\n`async`几乎提供了全类数组操作类型的接口，例如：`sortBy`、`reduce`、`some`等，这里不再一一展开。  \n\n### 异步控制函数  \n\n前面介绍了两个异步流程控制函数：`series`和`parallel`。下面介绍其他几个流程控制函数：    \n\n+ 使用`whilst`实现`while`操作  \n\n`whilst`用于实现，类似于`while`的效果，直到满足条件，否则持续执行回调函数。  \n\n```javascript  \nvar c = 0;\n\nasync.whilst(function() {\n    console.log(\"judge\");\n    return c < 3;\n}, function(callback) {\n    c++;\n    console.log(\"try \" + c);\n    setTimeout(function() {\n        callback(null, c);\n    }, 1000);\n}, function(err, val) {\n    console.log('err', err);\n    console.log('value: ', val);\n});\n\n```  \n输出：  \n\n```javascript  \n[luncher@localhost async]$ node app.js \njudge\ntry 1\njudge\ntry 2\njudge\ntry 3\njudge\nerr null\nvalue:  3\n```  \n\n+ 使用`waterFall`解决异步任务依赖问题  \n\n```javascript  \nasync.waterfall([\n    function(callback) {\n        callback(null, 'one', 'two');\n    },\n    function(arg1, arg2, callback) {\n      // arg1 now equals 'one' and arg2 now equals 'two'\n        callback(null, 'three');\n    },\n    function(arg1, callback) {\n        // arg1 now equals 'three'\n        callback(null, 'done');\n    }\n], function (err, result) {\n    // result now equals 'done'\n});\n```  \n\n\n","source":"_posts/async-tutorial.md","raw":"---\ntitle: async-tutorial\ncategories: server\n---\n`async`是一个强大的异步流程控制库，其语义类似于`js`对数组的操作。它提供了一系列非常强大而便捷的方法，有助于我们在`javascript`单线程模型背景下写出优雅的逻辑控制代码。  \n\n### **牛刀小试**   \n先从文件操作开始初步了解`async`函数库的作用：  \n\n+ 使用`filter`过滤出磁盘中存在的文件  \n\n```javascript\nconst fs = require('fs');  \nconst async = require('async');  \n\nasync.filter(['f1', 'f2', 'f3'], function(it, callback) {\n    fs.access(it, function(err) {\n      callback(null, !err);\n    });\n}, function(err, results) {\n  console.log(results);\n});\n\n```  \n假设当前目录下存在以上三个文件，那么`results`输出为：  \n```javascript\n['f1', 'f2', 'f3']\n```  \n\n+ 使用`map`判断文件是否存在  \n```javascript\nasync.map(['f1', 'f2', 'f3'], function(it, callback) {\n  fs.exists(function(exists) {\n      callback(null, exists);\n  });\n}, function(err, results) {\n    console.log(results);//[true, true, true]\n});\n```  \n\n>以上两个例子分别使用了`access`与`exists`判断文件是否存在，关于两个`API`的详细说明，请查看`nodejs`[官方文档](https://nodejs.org/dist/latest-v6.x/docs/api/fs.html#fs_fs_exists_path_callback)  \n\n\n+ 常用的多任务并行   \n\n```javascript  \nfunction asyncTask(delay, arg) {\n    return function(callback) {\n        setTimeout(function() {\n            console.log(arg + \"done\");\n            callback(null, arg);\n        }, delay);\n    };\n}\n\nasync.parallel([\n    asyncTask(10, \"task1\"),\n    asyncTask(1, \"task2\"),\n    asyncTask(100, \"task3\"),\n], function(err, ret) {\n    console.log(ret);\n});\n\n```  \n`asyncTask`输出的顺序依次为：\n```javascript  \n\n[luncher@localhost async]$ node app.js\ntask2done\ntask1done\ntask3done\n//ret\n[ 'task1', 'task2', 'task3' ]\n\n```  \n可见虽然任务是并行的，但是最终的结果依然按照任务数组的顺序排列。  \n\n+ 顺序执行任务  \n\n```javascript  \n\nfunction asyncTask(delay, arg) {\n    return function(callback) {\n        setTimeout(function() {\n            console.log(arg + \"done\");\n            callback(null, arg);\n        }, delay);\n    };\n}\n\nasync.series([\n    asyncTask(10, \"task1\"),\n    asyncTask(1, \"task2\"),\n    asyncTask(100, \"task3\"),\n], function(err, ret) {\n    console.log(ret);\n});\n\n```  \n\n输出：  \n\n```javascript  \n[luncher@localhost async]$ node app.js\ntask1done\ntask2done\ntask3done\n[ 'task1', 'task2', 'task3' ]  \n```  \n可以看到任务按照传入的顺序依次执行。  \n\n---   \n\n### 集合类型多任务处理  \n- `each`  \n`each`函数依次遍历数组执行回调函数：  \n\n```javascript  \n\nfunction readFile(file, callback) {\n    fs.readFile(file, function(err, ret) {\n        console.log(\"readFile \"+ file + \" done\");\n        callback(err);\n    });\n}\n\nasync.each(['f1', 'f2', 'f3'], readFile, function(err) {\n    console.log(\"all done\");\n});\n\n```  \n**需要注意的是，each不能保证迭代函数完成的顺序，这取决于用户的具体任务**  \n\n- `forEachOf`  \n\n`each`函数可以对数组进行遍历，如果想要遍历的是一个对象，那么需要用到`forEachOf`.  \n\n```javascript  \nfunction readFile(file, k, callback) {\n    fs.readFile(file, function(err, ret) {\n        console.log(\"readFile \"+ k + \" \" + file + \" done\");\n        callback(err);\n    });\n}\n\nasync.forEachOf({k1: \"f1\", k2: \"f2\", k3: \"f3\"}, readFile, function(err) {\n    console.log(\"all done\");\n});\n```  \n\n迭代函数第一个参数是`value`，第二个参数是`key`.  \n\n- 控制`each`和`foEachOf`的顺序  \n` eachSeries`与`forEachOf`都是用来控制迭代函数的顺序执行：  \n\n```javascript  \n\nfunction readFile(file, k, callback) {\n    fs.readFile(file, function(err, ret) {\n        console.log(\"readFile \"+ k + \" \" + file + \" done\");\n        callback(err);\n    });\n}\n\nasync.forEachOfSeries({k1: \"f1\", k2: \"f2\", k3: \"f3\"}, readFile, function(err) {\n    console.log(\"all done\");\n});\n\n```  \n\n这样程序的输出始终是：  \n\n\n```javascript\n[luncher@localhost async]$ node app.js\nreadFile k1 f1 done  \nreadFile k2 f2 done\nreadFile k3 f3 done\nall done\n\n```\n\n+ 使用`apply`包装异步任务  \n\n前面几个异步任务都需要人为的额外写一个函数，如`asyncTask`，`async`提供一个`apply`语法糖用于解决此类问题：  \n\n```javascript  \n\n// 使用 apply\n\nasync.parallel([\n    async.apply(fs.writeFile, 'testfile1', 'test1'),\n    async.apply(fs.writeFile, 'testfile2', 'test2'),\n]);\n\n\n// 等同于\n\nasync.parallel([\n    function(callback){\n        fs.writeFile('testfile1', 'test1', callback);\n    },\n    function(callback){\n        fs.writeFile('testfile2', 'test2', callback);\n    }\n]);\n\n```  \n\n\n+ 使用`Limit`类函数控制并发数量  \n\n`async`为每个接口都提供了一个`Limit`参数，用户限制并发数量，我们利用`filterLimit`做一个简单的测试：  \n\n```javascript\n\nvar count = 0;\nasync.filterLimit([1, 10, 28, 90, 10], 2, function(it, callback) {\n    count++;\n    console.log(it + \"开始\");\n    console.log(\"并发数：\", count);\n    setTimeout(function() {\n        count--;\n        console.log(it + \"结束\");\n        callback(null);\n    }, it);\n}, function(results) {\n    console.log(results);\n});\n\n```  \n输出：  \n\n```javascript  \n[luncher@localhost async]$ node app.js \n1开始\n并发数： 1\n10开始\n并发数： 2\n1结束\n28开始\n并发数： 2\n10结束\n90开始\n并发数： 2\n28结束\n10开始\n并发数： 2\n10结束\n90结束\nnull\n\n```  \n\n可以看到，最大并发数也就是`2`，虽然待执行任务大于`2`.  \n\n`async`几乎提供了全类数组操作类型的接口，例如：`sortBy`、`reduce`、`some`等，这里不再一一展开。  \n\n### 异步控制函数  \n\n前面介绍了两个异步流程控制函数：`series`和`parallel`。下面介绍其他几个流程控制函数：    \n\n+ 使用`whilst`实现`while`操作  \n\n`whilst`用于实现，类似于`while`的效果，直到满足条件，否则持续执行回调函数。  \n\n```javascript  \nvar c = 0;\n\nasync.whilst(function() {\n    console.log(\"judge\");\n    return c < 3;\n}, function(callback) {\n    c++;\n    console.log(\"try \" + c);\n    setTimeout(function() {\n        callback(null, c);\n    }, 1000);\n}, function(err, val) {\n    console.log('err', err);\n    console.log('value: ', val);\n});\n\n```  \n输出：  \n\n```javascript  \n[luncher@localhost async]$ node app.js \njudge\ntry 1\njudge\ntry 2\njudge\ntry 3\njudge\nerr null\nvalue:  3\n```  \n\n+ 使用`waterFall`解决异步任务依赖问题  \n\n```javascript  \nasync.waterfall([\n    function(callback) {\n        callback(null, 'one', 'two');\n    },\n    function(arg1, arg2, callback) {\n      // arg1 now equals 'one' and arg2 now equals 'two'\n        callback(null, 'three');\n    },\n    function(arg1, callback) {\n        // arg1 now equals 'three'\n        callback(null, 'done');\n    }\n], function (err, result) {\n    // result now equals 'done'\n});\n```  \n\n\n","slug":"async-tutorial","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxd000o9co7x3phb9l2","content":"<p><code>async</code>是一个强大的异步流程控制库，其语义类似于<code>js</code>对数组的操作。它提供了一系列非常强大而便捷的方法，有助于我们在<code>javascript</code>单线程模型背景下写出优雅的逻辑控制代码。  </p>\n<h3 id=\"牛刀小试\"><a href=\"#牛刀小试\" class=\"headerlink\" title=\"牛刀小试\"></a><strong>牛刀小试</strong></h3><p>先从文件操作开始初步了解<code>async</code>函数库的作用：  </p>\n<ul>\n<li>使用<code>filter</code>过滤出磁盘中存在的文件  </li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);  </span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">async</span> = <span class=\"built_in\">require</span>(<span class=\"string\">'async'</span>);  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span>.filter([<span class=\"string\">'f1'</span>, <span class=\"string\">'f2'</span>, <span class=\"string\">'f3'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">it, callback</span>) </span>&#123;</span><br><span class=\"line\">    fs.access(it, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">      callback(<span class=\"literal\">null</span>, !err);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, results</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(results);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">假设当前目录下存在以上三个文件，那么`</span>results<span class=\"string\">`输出为：  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\">[<span class=\"string\">'f1'</span>, <span class=\"string\">'f2'</span>, <span class=\"string\">'f3'</span>]</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">+ 使用`</span>map<span class=\"string\">`判断文件是否存在  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"keyword\">async</span>.map([<span class=\"string\">'f1'</span>, <span class=\"string\">'f2'</span>, <span class=\"string\">'f3'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">it, callback</span>) </span>&#123;</span><br><span class=\"line\">  fs.exists(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">exists</span>) </span>&#123;</span><br><span class=\"line\">      callback(<span class=\"literal\">null</span>, exists);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, results</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(results);<span class=\"comment\">//[true, true, true]</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">&gt;以上两个例子分别使用了`</span>access<span class=\"string\">`与`</span>exists<span class=\"string\">`判断文件是否存在，关于两个`</span>API<span class=\"string\">`的详细说明，请查看`</span>nodejs<span class=\"string\">`[官方文档](https://nodejs.org/dist/latest-v6.x/docs/api/fs.html#fs_fs_exists_path_callback)  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">+ 常用的多任务并行   </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">asyncTask</span>(<span class=\"params\">delay, arg</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(arg + <span class=\"string\">\"done\"</span>);</span><br><span class=\"line\">            callback(<span class=\"literal\">null</span>, arg);</span><br><span class=\"line\">        &#125;, delay);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span>.parallel([</span><br><span class=\"line\">    asyncTask(<span class=\"number\">10</span>, <span class=\"string\">\"task1\"</span>),</span><br><span class=\"line\">    asyncTask(<span class=\"number\">1</span>, <span class=\"string\">\"task2\"</span>),</span><br><span class=\"line\">    asyncTask(<span class=\"number\">100</span>, <span class=\"string\">\"task3\"</span>),</span><br><span class=\"line\">], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, ret</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(ret);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">`</span>asyncTask<span class=\"string\">`输出的顺序依次为：</span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"></span><br><span class=\"line\">[luncher@localhost <span class=\"keyword\">async</span>]$ node app.js</span><br><span class=\"line\">task2done</span><br><span class=\"line\">task1done</span><br><span class=\"line\">task3done</span><br><span class=\"line\"><span class=\"comment\">//ret</span></span><br><span class=\"line\">[ <span class=\"string\">'task1'</span>, <span class=\"string\">'task2'</span>, <span class=\"string\">'task3'</span> ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">可见虽然任务是并行的，但是最终的结果依然按照任务数组的顺序排列。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">+ 顺序执行任务  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">asyncTask</span>(<span class=\"params\">delay, arg</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(arg + <span class=\"string\">\"done\"</span>);</span><br><span class=\"line\">            callback(<span class=\"literal\">null</span>, arg);</span><br><span class=\"line\">        &#125;, delay);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span>.series([</span><br><span class=\"line\">    asyncTask(<span class=\"number\">10</span>, <span class=\"string\">\"task1\"</span>),</span><br><span class=\"line\">    asyncTask(<span class=\"number\">1</span>, <span class=\"string\">\"task2\"</span>),</span><br><span class=\"line\">    asyncTask(<span class=\"number\">100</span>, <span class=\"string\">\"task3\"</span>),</span><br><span class=\"line\">], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, ret</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(ret);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">输出：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\">[luncher@localhost <span class=\"keyword\">async</span>]$ node app.js</span><br><span class=\"line\">task1done</span><br><span class=\"line\">task2done</span><br><span class=\"line\">task3done</span><br><span class=\"line\">[ <span class=\"string\">'task1'</span>, <span class=\"string\">'task2'</span>, <span class=\"string\">'task3'</span> ]  </span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">可以看到任务按照传入的顺序依次执行。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">---   </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 集合类型多任务处理  </span></span><br><span class=\"line\"><span class=\"string\">- `</span>each<span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">`</span>each<span class=\"string\">`函数依次遍历数组执行回调函数：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">readFile</span>(<span class=\"params\">file, callback</span>) </span>&#123;</span><br><span class=\"line\">    fs.readFile(file, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, ret</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"readFile \"</span>+ file + <span class=\"string\">\" done\"</span>);</span><br><span class=\"line\">        callback(err);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span>.each([<span class=\"string\">'f1'</span>, <span class=\"string\">'f2'</span>, <span class=\"string\">'f3'</span>], readFile, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"all done\"</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">**需要注意的是，each不能保证迭代函数完成的顺序，这取决于用户的具体任务**  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">- `</span>forEachOf<span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span>each<span class=\"string\">`函数可以对数组进行遍历，如果想要遍历的是一个对象，那么需要用到`</span>forEachOf<span class=\"string\">`.  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">readFile</span>(<span class=\"params\">file, k, callback</span>) </span>&#123;</span><br><span class=\"line\">    fs.readFile(file, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, ret</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"readFile \"</span>+ k + <span class=\"string\">\" \"</span> + file + <span class=\"string\">\" done\"</span>);</span><br><span class=\"line\">        callback(err);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span>.forEachOf(&#123;<span class=\"attr\">k1</span>: <span class=\"string\">\"f1\"</span>, <span class=\"attr\">k2</span>: <span class=\"string\">\"f2\"</span>, <span class=\"attr\">k3</span>: <span class=\"string\">\"f3\"</span>&#125;, readFile, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"all done\"</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">迭代函数第一个参数是`</span>value<span class=\"string\">`，第二个参数是`</span>key<span class=\"string\">`.  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">- 控制`</span>each<span class=\"string\">`和`</span>foEachOf<span class=\"string\">`的顺序  </span></span><br><span class=\"line\"><span class=\"string\">`</span> eachSeries<span class=\"string\">`与`</span>forEachOf<span class=\"string\">`都是用来控制迭代函数的顺序执行：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">readFile</span>(<span class=\"params\">file, k, callback</span>) </span>&#123;</span><br><span class=\"line\">    fs.readFile(file, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, ret</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"readFile \"</span>+ k + <span class=\"string\">\" \"</span> + file + <span class=\"string\">\" done\"</span>);</span><br><span class=\"line\">        callback(err);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span>.forEachOfSeries(&#123;<span class=\"attr\">k1</span>: <span class=\"string\">\"f1\"</span>, <span class=\"attr\">k2</span>: <span class=\"string\">\"f2\"</span>, <span class=\"attr\">k3</span>: <span class=\"string\">\"f3\"</span>&#125;, readFile, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"all done\"</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">这样程序的输出始终是：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\">[luncher@localhost <span class=\"keyword\">async</span>]$ node app.js</span><br><span class=\"line\">readFile k1 f1 done  </span><br><span class=\"line\">readFile k2 f2 done</span><br><span class=\"line\">readFile k3 f3 done</span><br><span class=\"line\">all done</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用<code>apply</code>包装异步任务  </li>\n</ul>\n<p>前面几个异步任务都需要人为的额外写一个函数，如<code>asyncTask</code>，<code>async</code>提供一个<code>apply</code>语法糖用于解决此类问题：  </p>\n<pre><code class=\"javascript\">\n<span class=\"comment\">// 使用 apply</span>\n\n<span class=\"keyword\">async</span>.parallel([\n    <span class=\"keyword\">async</span>.apply(fs.writeFile, <span class=\"string\">'testfile1'</span>, <span class=\"string\">'test1'</span>),\n    <span class=\"keyword\">async</span>.apply(fs.writeFile, <span class=\"string\">'testfile2'</span>, <span class=\"string\">'test2'</span>),\n]);\n\n\n<span class=\"comment\">// 等同于</span>\n\n<span class=\"keyword\">async</span>.parallel([\n    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>)</span>{\n        fs.writeFile(<span class=\"string\">'testfile1'</span>, <span class=\"string\">'test1'</span>, callback);\n    },\n    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>)</span>{\n        fs.writeFile(<span class=\"string\">'testfile2'</span>, <span class=\"string\">'test2'</span>, callback);\n    }\n]);\n</code></pre>\n<ul>\n<li>使用<code>Limit</code>类函数控制并发数量  </li>\n</ul>\n<p><code>async</code>为每个接口都提供了一个<code>Limit</code>参数，用户限制并发数量，我们利用<code>filterLimit</code>做一个简单的测试：  </p>\n<pre><code class=\"javascript\">\n<span class=\"keyword\">var</span> count = <span class=\"number\">0</span>;\n<span class=\"keyword\">async</span>.filterLimit([<span class=\"number\">1</span>, <span class=\"number\">10</span>, <span class=\"number\">28</span>, <span class=\"number\">90</span>, <span class=\"number\">10</span>], <span class=\"number\">2</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">it, callback</span>) </span>{\n    count++;\n    <span class=\"built_in\">console</span>.log(it + <span class=\"string\">\"开始\"</span>);\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"并发数：\"</span>, count);\n    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n        count--;\n        <span class=\"built_in\">console</span>.log(it + <span class=\"string\">\"结束\"</span>);\n        callback(<span class=\"literal\">null</span>);\n    }, it);\n}, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">results</span>) </span>{\n    <span class=\"built_in\">console</span>.log(results);\n});\n</code></pre>\n<p>输出：  </p>\n<pre><code class=\"javascript\">[luncher@localhost <span class=\"keyword\">async</span>]$ node app.js \n<span class=\"number\">1</span>开始\n并发数： <span class=\"number\">1</span>\n<span class=\"number\">10</span>开始\n并发数： <span class=\"number\">2</span>\n<span class=\"number\">1</span>结束\n<span class=\"number\">28</span>开始\n并发数： <span class=\"number\">2</span>\n<span class=\"number\">10</span>结束\n<span class=\"number\">90</span>开始\n并发数： <span class=\"number\">2</span>\n<span class=\"number\">28</span>结束\n<span class=\"number\">10</span>开始\n并发数： <span class=\"number\">2</span>\n<span class=\"number\">10</span>结束\n<span class=\"number\">90</span>结束\n<span class=\"literal\">null</span>\n</code></pre>\n<p>可以看到，最大并发数也就是<code>2</code>，虽然待执行任务大于<code>2</code>.  </p>\n<p><code>async</code>几乎提供了全类数组操作类型的接口，例如：<code>sortBy</code>、<code>reduce</code>、<code>some</code>等，这里不再一一展开。  </p>\n<h3 id=\"异步控制函数\"><a href=\"#异步控制函数\" class=\"headerlink\" title=\"异步控制函数\"></a>异步控制函数</h3><p>前面介绍了两个异步流程控制函数：<code>series</code>和<code>parallel</code>。下面介绍其他几个流程控制函数：    </p>\n<ul>\n<li>使用<code>whilst</code>实现<code>while</code>操作  </li>\n</ul>\n<p><code>whilst</code>用于实现，类似于<code>while</code>的效果，直到满足条件，否则持续执行回调函数。  </p>\n<pre><code class=\"javascript\"><span class=\"keyword\">var</span> c = <span class=\"number\">0</span>;\n\n<span class=\"keyword\">async</span>.whilst(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"judge\"</span>);\n    <span class=\"keyword\">return</span> c &lt; <span class=\"number\">3</span>;\n}, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>{\n    c++;\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"try \"</span> + c);\n    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n        callback(<span class=\"literal\">null</span>, c);\n    }, <span class=\"number\">1000</span>);\n}, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, val</span>) </span>{\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">'err'</span>, err);\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">'value: '</span>, val);\n});\n</code></pre>\n<p>输出：  </p>\n<pre><code class=\"javascript\">[luncher@localhost <span class=\"keyword\">async</span>]$ node app.js \njudge\n<span class=\"keyword\">try</span> <span class=\"number\">1</span>\njudge\n<span class=\"keyword\">try</span> <span class=\"number\">2</span>\njudge\n<span class=\"keyword\">try</span> <span class=\"number\">3</span>\njudge\nerr <span class=\"literal\">null</span>\nvalue:  <span class=\"number\">3</span>\n</code></pre>\n<ul>\n<li>使用<code>waterFall</code>解决异步任务依赖问题  </li>\n</ul>\n<pre><code class=\"javascript\"><span class=\"keyword\">async</span>.waterfall([\n    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>{\n        callback(<span class=\"literal\">null</span>, <span class=\"string\">'one'</span>, <span class=\"string\">'two'</span>);\n    },\n    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">arg1, arg2, callback</span>) </span>{\n      <span class=\"comment\">// arg1 now equals 'one' and arg2 now equals 'two'</span>\n        callback(<span class=\"literal\">null</span>, <span class=\"string\">'three'</span>);\n    },\n    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">arg1, callback</span>) </span>{\n        <span class=\"comment\">// arg1 now equals 'three'</span>\n        callback(<span class=\"literal\">null</span>, <span class=\"string\">'done'</span>);\n    }\n], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, result</span>) </span>{\n    <span class=\"comment\">// result now equals 'done'</span>\n});\n</code></pre>\n","site":{"data":{}},"excerpt":"","more":"<p><code>async</code>是一个强大的异步流程控制库，其语义类似于<code>js</code>对数组的操作。它提供了一系列非常强大而便捷的方法，有助于我们在<code>javascript</code>单线程模型背景下写出优雅的逻辑控制代码。  </p>\n<h3 id=\"牛刀小试\"><a href=\"#牛刀小试\" class=\"headerlink\" title=\"牛刀小试\"></a><strong>牛刀小试</strong></h3><p>先从文件操作开始初步了解<code>async</code>函数库的作用：  </p>\n<ul>\n<li>使用<code>filter</code>过滤出磁盘中存在的文件  </li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);  </span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">async</span> = <span class=\"built_in\">require</span>(<span class=\"string\">'async'</span>);  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span>.filter([<span class=\"string\">'f1'</span>, <span class=\"string\">'f2'</span>, <span class=\"string\">'f3'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">it, callback</span>) </span>&#123;</span><br><span class=\"line\">    fs.access(it, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">      callback(<span class=\"literal\">null</span>, !err);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, results</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(results);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">假设当前目录下存在以上三个文件，那么`</span>results<span class=\"string\">`输出为：  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\">[<span class=\"string\">'f1'</span>, <span class=\"string\">'f2'</span>, <span class=\"string\">'f3'</span>]</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">+ 使用`</span>map<span class=\"string\">`判断文件是否存在  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"keyword\">async</span>.map([<span class=\"string\">'f1'</span>, <span class=\"string\">'f2'</span>, <span class=\"string\">'f3'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">it, callback</span>) </span>&#123;</span><br><span class=\"line\">  fs.exists(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">exists</span>) </span>&#123;</span><br><span class=\"line\">      callback(<span class=\"literal\">null</span>, exists);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, results</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(results);<span class=\"comment\">//[true, true, true]</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">&gt;以上两个例子分别使用了`</span>access<span class=\"string\">`与`</span>exists<span class=\"string\">`判断文件是否存在，关于两个`</span>API<span class=\"string\">`的详细说明，请查看`</span>nodejs<span class=\"string\">`[官方文档](https://nodejs.org/dist/latest-v6.x/docs/api/fs.html#fs_fs_exists_path_callback)  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">+ 常用的多任务并行   </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">asyncTask</span>(<span class=\"params\">delay, arg</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(arg + <span class=\"string\">\"done\"</span>);</span><br><span class=\"line\">            callback(<span class=\"literal\">null</span>, arg);</span><br><span class=\"line\">        &#125;, delay);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span>.parallel([</span><br><span class=\"line\">    asyncTask(<span class=\"number\">10</span>, <span class=\"string\">\"task1\"</span>),</span><br><span class=\"line\">    asyncTask(<span class=\"number\">1</span>, <span class=\"string\">\"task2\"</span>),</span><br><span class=\"line\">    asyncTask(<span class=\"number\">100</span>, <span class=\"string\">\"task3\"</span>),</span><br><span class=\"line\">], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, ret</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(ret);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">`</span>asyncTask<span class=\"string\">`输出的顺序依次为：</span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"></span><br><span class=\"line\">[luncher@localhost <span class=\"keyword\">async</span>]$ node app.js</span><br><span class=\"line\">task2done</span><br><span class=\"line\">task1done</span><br><span class=\"line\">task3done</span><br><span class=\"line\"><span class=\"comment\">//ret</span></span><br><span class=\"line\">[ <span class=\"string\">'task1'</span>, <span class=\"string\">'task2'</span>, <span class=\"string\">'task3'</span> ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">可见虽然任务是并行的，但是最终的结果依然按照任务数组的顺序排列。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">+ 顺序执行任务  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">asyncTask</span>(<span class=\"params\">delay, arg</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(arg + <span class=\"string\">\"done\"</span>);</span><br><span class=\"line\">            callback(<span class=\"literal\">null</span>, arg);</span><br><span class=\"line\">        &#125;, delay);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span>.series([</span><br><span class=\"line\">    asyncTask(<span class=\"number\">10</span>, <span class=\"string\">\"task1\"</span>),</span><br><span class=\"line\">    asyncTask(<span class=\"number\">1</span>, <span class=\"string\">\"task2\"</span>),</span><br><span class=\"line\">    asyncTask(<span class=\"number\">100</span>, <span class=\"string\">\"task3\"</span>),</span><br><span class=\"line\">], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, ret</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(ret);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">输出：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\">[luncher@localhost <span class=\"keyword\">async</span>]$ node app.js</span><br><span class=\"line\">task1done</span><br><span class=\"line\">task2done</span><br><span class=\"line\">task3done</span><br><span class=\"line\">[ <span class=\"string\">'task1'</span>, <span class=\"string\">'task2'</span>, <span class=\"string\">'task3'</span> ]  </span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">可以看到任务按照传入的顺序依次执行。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">---   </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 集合类型多任务处理  </span></span><br><span class=\"line\"><span class=\"string\">- `</span>each<span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">`</span>each<span class=\"string\">`函数依次遍历数组执行回调函数：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">readFile</span>(<span class=\"params\">file, callback</span>) </span>&#123;</span><br><span class=\"line\">    fs.readFile(file, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, ret</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"readFile \"</span>+ file + <span class=\"string\">\" done\"</span>);</span><br><span class=\"line\">        callback(err);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span>.each([<span class=\"string\">'f1'</span>, <span class=\"string\">'f2'</span>, <span class=\"string\">'f3'</span>], readFile, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"all done\"</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">**需要注意的是，each不能保证迭代函数完成的顺序，这取决于用户的具体任务**  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">- `</span>forEachOf<span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span>each<span class=\"string\">`函数可以对数组进行遍历，如果想要遍历的是一个对象，那么需要用到`</span>forEachOf<span class=\"string\">`.  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">readFile</span>(<span class=\"params\">file, k, callback</span>) </span>&#123;</span><br><span class=\"line\">    fs.readFile(file, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, ret</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"readFile \"</span>+ k + <span class=\"string\">\" \"</span> + file + <span class=\"string\">\" done\"</span>);</span><br><span class=\"line\">        callback(err);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span>.forEachOf(&#123;<span class=\"attr\">k1</span>: <span class=\"string\">\"f1\"</span>, <span class=\"attr\">k2</span>: <span class=\"string\">\"f2\"</span>, <span class=\"attr\">k3</span>: <span class=\"string\">\"f3\"</span>&#125;, readFile, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"all done\"</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">迭代函数第一个参数是`</span>value<span class=\"string\">`，第二个参数是`</span>key<span class=\"string\">`.  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">- 控制`</span>each<span class=\"string\">`和`</span>foEachOf<span class=\"string\">`的顺序  </span></span><br><span class=\"line\"><span class=\"string\">`</span> eachSeries<span class=\"string\">`与`</span>forEachOf<span class=\"string\">`都是用来控制迭代函数的顺序执行：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">readFile</span>(<span class=\"params\">file, k, callback</span>) </span>&#123;</span><br><span class=\"line\">    fs.readFile(file, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, ret</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"readFile \"</span>+ k + <span class=\"string\">\" \"</span> + file + <span class=\"string\">\" done\"</span>);</span><br><span class=\"line\">        callback(err);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span>.forEachOfSeries(&#123;<span class=\"attr\">k1</span>: <span class=\"string\">\"f1\"</span>, <span class=\"attr\">k2</span>: <span class=\"string\">\"f2\"</span>, <span class=\"attr\">k3</span>: <span class=\"string\">\"f3\"</span>&#125;, readFile, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"all done\"</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">这样程序的输出始终是：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\">[luncher@localhost <span class=\"keyword\">async</span>]$ node app.js</span><br><span class=\"line\">readFile k1 f1 done  </span><br><span class=\"line\">readFile k2 f2 done</span><br><span class=\"line\">readFile k3 f3 done</span><br><span class=\"line\">all done</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用<code>apply</code>包装异步任务  </li>\n</ul>\n<p>前面几个异步任务都需要人为的额外写一个函数，如<code>asyncTask</code>，<code>async</code>提供一个<code>apply</code>语法糖用于解决此类问题：  </p>\n<pre><code class=\"javascript\">\n<span class=\"comment\">// 使用 apply</span>\n\n<span class=\"keyword\">async</span>.parallel([\n    <span class=\"keyword\">async</span>.apply(fs.writeFile, <span class=\"string\">'testfile1'</span>, <span class=\"string\">'test1'</span>),\n    <span class=\"keyword\">async</span>.apply(fs.writeFile, <span class=\"string\">'testfile2'</span>, <span class=\"string\">'test2'</span>),\n]);\n\n\n<span class=\"comment\">// 等同于</span>\n\n<span class=\"keyword\">async</span>.parallel([\n    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>)</span>{\n        fs.writeFile(<span class=\"string\">'testfile1'</span>, <span class=\"string\">'test1'</span>, callback);\n    },\n    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>)</span>{\n        fs.writeFile(<span class=\"string\">'testfile2'</span>, <span class=\"string\">'test2'</span>, callback);\n    }\n]);\n</code></pre>\n<ul>\n<li>使用<code>Limit</code>类函数控制并发数量  </li>\n</ul>\n<p><code>async</code>为每个接口都提供了一个<code>Limit</code>参数，用户限制并发数量，我们利用<code>filterLimit</code>做一个简单的测试：  </p>\n<pre><code class=\"javascript\">\n<span class=\"keyword\">var</span> count = <span class=\"number\">0</span>;\n<span class=\"keyword\">async</span>.filterLimit([<span class=\"number\">1</span>, <span class=\"number\">10</span>, <span class=\"number\">28</span>, <span class=\"number\">90</span>, <span class=\"number\">10</span>], <span class=\"number\">2</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">it, callback</span>) </span>{\n    count++;\n    <span class=\"built_in\">console</span>.log(it + <span class=\"string\">\"开始\"</span>);\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"并发数：\"</span>, count);\n    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n        count--;\n        <span class=\"built_in\">console</span>.log(it + <span class=\"string\">\"结束\"</span>);\n        callback(<span class=\"literal\">null</span>);\n    }, it);\n}, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">results</span>) </span>{\n    <span class=\"built_in\">console</span>.log(results);\n});\n</code></pre>\n<p>输出：  </p>\n<pre><code class=\"javascript\">[luncher@localhost <span class=\"keyword\">async</span>]$ node app.js \n<span class=\"number\">1</span>开始\n并发数： <span class=\"number\">1</span>\n<span class=\"number\">10</span>开始\n并发数： <span class=\"number\">2</span>\n<span class=\"number\">1</span>结束\n<span class=\"number\">28</span>开始\n并发数： <span class=\"number\">2</span>\n<span class=\"number\">10</span>结束\n<span class=\"number\">90</span>开始\n并发数： <span class=\"number\">2</span>\n<span class=\"number\">28</span>结束\n<span class=\"number\">10</span>开始\n并发数： <span class=\"number\">2</span>\n<span class=\"number\">10</span>结束\n<span class=\"number\">90</span>结束\n<span class=\"literal\">null</span>\n</code></pre>\n<p>可以看到，最大并发数也就是<code>2</code>，虽然待执行任务大于<code>2</code>.  </p>\n<p><code>async</code>几乎提供了全类数组操作类型的接口，例如：<code>sortBy</code>、<code>reduce</code>、<code>some</code>等，这里不再一一展开。  </p>\n<h3 id=\"异步控制函数\"><a href=\"#异步控制函数\" class=\"headerlink\" title=\"异步控制函数\"></a>异步控制函数</h3><p>前面介绍了两个异步流程控制函数：<code>series</code>和<code>parallel</code>。下面介绍其他几个流程控制函数：    </p>\n<ul>\n<li>使用<code>whilst</code>实现<code>while</code>操作  </li>\n</ul>\n<p><code>whilst</code>用于实现，类似于<code>while</code>的效果，直到满足条件，否则持续执行回调函数。  </p>\n<pre><code class=\"javascript\"><span class=\"keyword\">var</span> c = <span class=\"number\">0</span>;\n\n<span class=\"keyword\">async</span>.whilst(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"judge\"</span>);\n    <span class=\"keyword\">return</span> c &lt; <span class=\"number\">3</span>;\n}, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>{\n    c++;\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"try \"</span> + c);\n    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n        callback(<span class=\"literal\">null</span>, c);\n    }, <span class=\"number\">1000</span>);\n}, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, val</span>) </span>{\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">'err'</span>, err);\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">'value: '</span>, val);\n});\n</code></pre>\n<p>输出：  </p>\n<pre><code class=\"javascript\">[luncher@localhost <span class=\"keyword\">async</span>]$ node app.js \njudge\n<span class=\"keyword\">try</span> <span class=\"number\">1</span>\njudge\n<span class=\"keyword\">try</span> <span class=\"number\">2</span>\njudge\n<span class=\"keyword\">try</span> <span class=\"number\">3</span>\njudge\nerr <span class=\"literal\">null</span>\nvalue:  <span class=\"number\">3</span>\n</code></pre>\n<ul>\n<li>使用<code>waterFall</code>解决异步任务依赖问题  </li>\n</ul>\n<pre><code class=\"javascript\"><span class=\"keyword\">async</span>.waterfall([\n    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>{\n        callback(<span class=\"literal\">null</span>, <span class=\"string\">'one'</span>, <span class=\"string\">'two'</span>);\n    },\n    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">arg1, arg2, callback</span>) </span>{\n      <span class=\"comment\">// arg1 now equals 'one' and arg2 now equals 'two'</span>\n        callback(<span class=\"literal\">null</span>, <span class=\"string\">'three'</span>);\n    },\n    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">arg1, callback</span>) </span>{\n        <span class=\"comment\">// arg1 now equals 'three'</span>\n        callback(<span class=\"literal\">null</span>, <span class=\"string\">'done'</span>);\n    }\n], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, result</span>) </span>{\n    <span class=\"comment\">// result now equals 'done'</span>\n});\n</code></pre>\n"},{"title":"textMate snippet说明","_content":"\ntextMate一直是`mac`下常用的编辑器不过现在好像被`sublime`、`atom`、`vscode`等一系列新生带编辑器取代。为了学习`vscode`的编写，打算系统学学`snippet`语法。\n\n以下译自：\n> https://manual.macromates.com/en/snippets\n\nsnippet是一小段的文本，你可以插入到你的文档里面。它可以包含代码，变量，`tab`键，占位符，以及转换。\n\n# 普通文本\n\n在最简单的情况下，你可以使用 snippet插入一些文本，避免一遍又一遍的重复输入。这样不仅减少输入次数，而且减少出错。  \n\n在你使用 snippet的时候唯一一件事情需要注意的是：`$`和\\`是保留字符，如果你想要使用这两个字符，你需要在字符前面加入一个转译符号：`\\`。\n\n# 变量\n\n你可以通过在变量名称前面加入`$`的形式插入变量。所有的正常变量都被支持，最有用的大概是：`TM_SELECTED_TEXT`变量。例如我们想要创建一个 snippet,用于包装`LaTeX \\textbf`命令的选择，我们可以这样写：\n\n> \\textbf{$TM_SELECTED_TEXT}\n\n如果没有文本被选中，变量不会被设置，也就不会插入任何文本。我们可以通过以下语法插入一个默认值： \n\n>\\textbf{${TM_SELECTED_TEXT:no text was selected}}\n\n默认值也可以包含变量，或者`shell code`。如果默认文本必须包含`}`，则需要转译。\n\n# `Tab`键\n\n在输入完成后，光标会停留在`snippet`最后的位置，又时候这不是我们要的结果。我们可以通过使用`$0`的形式指定光标停留的位置。例如，如果我们给`html`文件定义一个名为`div`的`snippet`，并且希望光标停留在开始和结束标签中间。我们可以这样写：\n\n``` html\n<div>\n    $0\n<div>\n```\n\n我们还可以在$后面指定更多的数字，按下`tab`键的时候控制光标在这些位置移动。例如：\n\n``` html\n<div$1>\n    $0\n<div>\n```\n\n第一次光标出现在$0位置，按下`tab`光标移动到$1位置。\n\n# 占位符\n\n和变量一样，`tab`也可以有占位符，语法类似：\n>${«tab stop»:«default value»}\n\n默认值可以包含文本、`shell code`、以及其他占位符：\n\n``` html\n<div${1: id=\"${2:some_id}\"}>\n    $0\n</div>\n```\n\n插入该`snippet`将会插入一个`div`标签，`id`参数被选中，我们可以直接编辑它或者按下`tab`键切换光标位置。当你编辑占位符文本，内嵌的`tab`停止位会被删除。\n\n# 镜像\n\n有时候我们想要同时修改多个位置，即编辑一个文本的时候能够影响到多个位置。例如，我们新建一个`laTex`的`snippet`：\n\n``` html\n\\begin{${1:enumerate}}\n    $0\n\\end{$1}\n```\n\n在插入完成该`snippet`，`enumerate`会被选中，修改它会影响到`\\end`位置部分。\n\n*vscode*没有支持的格式没有做翻译，有兴趣的自己研究：）","source":"_posts/TextMate snippet.md","raw":"---\ntitle: textMate snippet说明\ncategories: vscode\n---\n\ntextMate一直是`mac`下常用的编辑器不过现在好像被`sublime`、`atom`、`vscode`等一系列新生带编辑器取代。为了学习`vscode`的编写，打算系统学学`snippet`语法。\n\n以下译自：\n> https://manual.macromates.com/en/snippets\n\nsnippet是一小段的文本，你可以插入到你的文档里面。它可以包含代码，变量，`tab`键，占位符，以及转换。\n\n# 普通文本\n\n在最简单的情况下，你可以使用 snippet插入一些文本，避免一遍又一遍的重复输入。这样不仅减少输入次数，而且减少出错。  \n\n在你使用 snippet的时候唯一一件事情需要注意的是：`$`和\\`是保留字符，如果你想要使用这两个字符，你需要在字符前面加入一个转译符号：`\\`。\n\n# 变量\n\n你可以通过在变量名称前面加入`$`的形式插入变量。所有的正常变量都被支持，最有用的大概是：`TM_SELECTED_TEXT`变量。例如我们想要创建一个 snippet,用于包装`LaTeX \\textbf`命令的选择，我们可以这样写：\n\n> \\textbf{$TM_SELECTED_TEXT}\n\n如果没有文本被选中，变量不会被设置，也就不会插入任何文本。我们可以通过以下语法插入一个默认值： \n\n>\\textbf{${TM_SELECTED_TEXT:no text was selected}}\n\n默认值也可以包含变量，或者`shell code`。如果默认文本必须包含`}`，则需要转译。\n\n# `Tab`键\n\n在输入完成后，光标会停留在`snippet`最后的位置，又时候这不是我们要的结果。我们可以通过使用`$0`的形式指定光标停留的位置。例如，如果我们给`html`文件定义一个名为`div`的`snippet`，并且希望光标停留在开始和结束标签中间。我们可以这样写：\n\n``` html\n<div>\n    $0\n<div>\n```\n\n我们还可以在$后面指定更多的数字，按下`tab`键的时候控制光标在这些位置移动。例如：\n\n``` html\n<div$1>\n    $0\n<div>\n```\n\n第一次光标出现在$0位置，按下`tab`光标移动到$1位置。\n\n# 占位符\n\n和变量一样，`tab`也可以有占位符，语法类似：\n>${«tab stop»:«default value»}\n\n默认值可以包含文本、`shell code`、以及其他占位符：\n\n``` html\n<div${1: id=\"${2:some_id}\"}>\n    $0\n</div>\n```\n\n插入该`snippet`将会插入一个`div`标签，`id`参数被选中，我们可以直接编辑它或者按下`tab`键切换光标位置。当你编辑占位符文本，内嵌的`tab`停止位会被删除。\n\n# 镜像\n\n有时候我们想要同时修改多个位置，即编辑一个文本的时候能够影响到多个位置。例如，我们新建一个`laTex`的`snippet`：\n\n``` html\n\\begin{${1:enumerate}}\n    $0\n\\end{$1}\n```\n\n在插入完成该`snippet`，`enumerate`会被选中，修改它会影响到`\\end`位置部分。\n\n*vscode*没有支持的格式没有做翻译，有兴趣的自己研究：）","slug":"TextMate snippet","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxf000s9co7fwe9r84p","content":"<p>textMate一直是<code>mac</code>下常用的编辑器不过现在好像被<code>sublime</code>、<code>atom</code>、<code>vscode</code>等一系列新生带编辑器取代。为了学习<code>vscode</code>的编写，打算系统学学<code>snippet</code>语法。</p>\n<p>以下译自：</p>\n<blockquote>\n<p><a href=\"https://manual.macromates.com/en/snippets\" target=\"_blank\" rel=\"noopener\">https://manual.macromates.com/en/snippets</a></p>\n</blockquote>\n<p>snippet是一小段的文本，你可以插入到你的文档里面。它可以包含代码，变量，<code>tab</code>键，占位符，以及转换。</p>\n<h1 id=\"普通文本\"><a href=\"#普通文本\" class=\"headerlink\" title=\"普通文本\"></a>普通文本</h1><p>在最简单的情况下，你可以使用 snippet插入一些文本，避免一遍又一遍的重复输入。这样不仅减少输入次数，而且减少出错。  </p>\n<p>在你使用 snippet的时候唯一一件事情需要注意的是：<code>$</code>和`是保留字符，如果你想要使用这两个字符，你需要在字符前面加入一个转译符号：<code>\\</code>。</p>\n<h1 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h1><p>你可以通过在变量名称前面加入<code>$</code>的形式插入变量。所有的正常变量都被支持，最有用的大概是：<code>TM_SELECTED_TEXT</code>变量。例如我们想要创建一个 snippet,用于包装<code>LaTeX \\textbf</code>命令的选择，我们可以这样写：</p>\n<blockquote>\n<p>\\textbf{$TM_SELECTED_TEXT}</p>\n</blockquote>\n<p>如果没有文本被选中，变量不会被设置，也就不会插入任何文本。我们可以通过以下语法插入一个默认值： </p>\n<blockquote>\n<p>\\textbf{${TM_SELECTED_TEXT:no text was selected}}</p>\n</blockquote>\n<p>默认值也可以包含变量，或者<code>shell code</code>。如果默认文本必须包含<code>}</code>，则需要转译。</p>\n<h1 id=\"Tab键\"><a href=\"#Tab键\" class=\"headerlink\" title=\"Tab键\"></a><code>Tab</code>键</h1><p>在输入完成后，光标会停留在<code>snippet</code>最后的位置，又时候这不是我们要的结果。我们可以通过使用<code>$0</code>的形式指定光标停留的位置。例如，如果我们给<code>html</code>文件定义一个名为<code>div</code>的<code>snippet</code>，并且希望光标停留在开始和结束标签中间。我们可以这样写：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    $0</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>我们还可以在$后面指定更多的数字，按下<code>tab</code>键的时候控制光标在这些位置移动。例如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div$1</span>&gt;</span></span><br><span class=\"line\">    $0</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>第一次光标出现在$0位置，按下<code>tab</code>光标移动到$1位置。</p>\n<h1 id=\"占位符\"><a href=\"#占位符\" class=\"headerlink\" title=\"占位符\"></a>占位符</h1><p>和变量一样，<code>tab</code>也可以有占位符，语法类似：</p>\n<blockquote>\n<p>${«tab stop»:«default value»}</p>\n</blockquote>\n<p>默认值可以包含文本、<code>shell code</code>、以及其他占位符：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div$&#123;1:</span> <span class=\"attr\">id</span>=<span class=\"string\">\"$&#123;2:some_id&#125;\"</span>&#125;&gt;</span></span><br><span class=\"line\">    $0</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>插入该<code>snippet</code>将会插入一个<code>div</code>标签，<code>id</code>参数被选中，我们可以直接编辑它或者按下<code>tab</code>键切换光标位置。当你编辑占位符文本，内嵌的<code>tab</code>停止位会被删除。</p>\n<h1 id=\"镜像\"><a href=\"#镜像\" class=\"headerlink\" title=\"镜像\"></a>镜像</h1><p>有时候我们想要同时修改多个位置，即编辑一个文本的时候能够影响到多个位置。例如，我们新建一个<code>laTex</code>的<code>snippet</code>：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\begin&#123;$&#123;1:enumerate&#125;&#125;</span><br><span class=\"line\">    $0</span><br><span class=\"line\">\\end&#123;$1&#125;</span><br></pre></td></tr></table></figure>\n<p>在插入完成该<code>snippet</code>，<code>enumerate</code>会被选中，修改它会影响到<code>\\end</code>位置部分。</p>\n<p><em>vscode</em>没有支持的格式没有做翻译，有兴趣的自己研究：）</p>\n","site":{"data":{}},"excerpt":"","more":"<p>textMate一直是<code>mac</code>下常用的编辑器不过现在好像被<code>sublime</code>、<code>atom</code>、<code>vscode</code>等一系列新生带编辑器取代。为了学习<code>vscode</code>的编写，打算系统学学<code>snippet</code>语法。</p>\n<p>以下译自：</p>\n<blockquote>\n<p><a href=\"https://manual.macromates.com/en/snippets\" target=\"_blank\" rel=\"noopener\">https://manual.macromates.com/en/snippets</a></p>\n</blockquote>\n<p>snippet是一小段的文本，你可以插入到你的文档里面。它可以包含代码，变量，<code>tab</code>键，占位符，以及转换。</p>\n<h1 id=\"普通文本\"><a href=\"#普通文本\" class=\"headerlink\" title=\"普通文本\"></a>普通文本</h1><p>在最简单的情况下，你可以使用 snippet插入一些文本，避免一遍又一遍的重复输入。这样不仅减少输入次数，而且减少出错。  </p>\n<p>在你使用 snippet的时候唯一一件事情需要注意的是：<code>$</code>和`是保留字符，如果你想要使用这两个字符，你需要在字符前面加入一个转译符号：<code>\\</code>。</p>\n<h1 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h1><p>你可以通过在变量名称前面加入<code>$</code>的形式插入变量。所有的正常变量都被支持，最有用的大概是：<code>TM_SELECTED_TEXT</code>变量。例如我们想要创建一个 snippet,用于包装<code>LaTeX \\textbf</code>命令的选择，我们可以这样写：</p>\n<blockquote>\n<p>\\textbf{$TM_SELECTED_TEXT}</p>\n</blockquote>\n<p>如果没有文本被选中，变量不会被设置，也就不会插入任何文本。我们可以通过以下语法插入一个默认值： </p>\n<blockquote>\n<p>\\textbf{${TM_SELECTED_TEXT:no text was selected}}</p>\n</blockquote>\n<p>默认值也可以包含变量，或者<code>shell code</code>。如果默认文本必须包含<code>}</code>，则需要转译。</p>\n<h1 id=\"Tab键\"><a href=\"#Tab键\" class=\"headerlink\" title=\"Tab键\"></a><code>Tab</code>键</h1><p>在输入完成后，光标会停留在<code>snippet</code>最后的位置，又时候这不是我们要的结果。我们可以通过使用<code>$0</code>的形式指定光标停留的位置。例如，如果我们给<code>html</code>文件定义一个名为<code>div</code>的<code>snippet</code>，并且希望光标停留在开始和结束标签中间。我们可以这样写：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    $0</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>我们还可以在$后面指定更多的数字，按下<code>tab</code>键的时候控制光标在这些位置移动。例如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div$1</span>&gt;</span></span><br><span class=\"line\">    $0</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>第一次光标出现在$0位置，按下<code>tab</code>光标移动到$1位置。</p>\n<h1 id=\"占位符\"><a href=\"#占位符\" class=\"headerlink\" title=\"占位符\"></a>占位符</h1><p>和变量一样，<code>tab</code>也可以有占位符，语法类似：</p>\n<blockquote>\n<p>${«tab stop»:«default value»}</p>\n</blockquote>\n<p>默认值可以包含文本、<code>shell code</code>、以及其他占位符：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div$&#123;1:</span> <span class=\"attr\">id</span>=<span class=\"string\">\"$&#123;2:some_id&#125;\"</span>&#125;&gt;</span></span><br><span class=\"line\">    $0</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>插入该<code>snippet</code>将会插入一个<code>div</code>标签，<code>id</code>参数被选中，我们可以直接编辑它或者按下<code>tab</code>键切换光标位置。当你编辑占位符文本，内嵌的<code>tab</code>停止位会被删除。</p>\n<h1 id=\"镜像\"><a href=\"#镜像\" class=\"headerlink\" title=\"镜像\"></a>镜像</h1><p>有时候我们想要同时修改多个位置，即编辑一个文本的时候能够影响到多个位置。例如，我们新建一个<code>laTex</code>的<code>snippet</code>：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\begin&#123;$&#123;1:enumerate&#125;&#125;</span><br><span class=\"line\">    $0</span><br><span class=\"line\">\\end&#123;$1&#125;</span><br></pre></td></tr></table></figure>\n<p>在插入完成该<code>snippet</code>，<code>enumerate</code>会被选中，修改它会影响到<code>\\end</code>位置部分。</p>\n<p><em>vscode</em>没有支持的格式没有做翻译，有兴趣的自己研究：）</p>\n"},{"title":"URL编解码","_content":"&nbsp;&nbsp;&nbsp;&nbsp;URI(统一资源定为标志)，用于指定想要访问的资源，URI可以有各种形式，如：日常在用的URL、每本书背面的ISBN码都是URI的一种形式, 日常过程中，如果不加区分，一般说的`URI`都指的是`URL`。拿我们熟悉的URL来说：\n\n一个普通的URL：\n>https://www.baidu.com/fuck.php?action=run#hash=1\n\nURL一般包括以下几个部分：\n\n+ 1. Scheme\n指定URL协议：http/https\n+ 2. hostname\n指定域名，如上面的`www.baidu.com`\n+ 3. port\n指定目标主机端口号，`http`协议默认为80端口，`https`默认为433端口。\n+ 4. path\n指定要访问的资源路径，以上为`fuck.php`\n+ 5. query\n以`?`开头，传递给目标主机的参数，`key/value`的形式来表示参数，参数之间通过`&`符号间隔开来。在`Nodejs`服务器，上面的`URL`最终解析得到`query`对象:\n> req.query = {action: run}\n+ 6. hash\n`hash`参数用于给浏览器渲染出来的`HTML`界面指定锚点，服务器在解析`URL`的时候会把`#`后面的字符丢弃。\n\n如果在实际运用过程中我们仅仅只需要知道这些概念就好了，可惜事情的复杂度往往比现象的要大。\n\n- 如果要给`URL`放其他字符怎么处理，如果我想放一些二进制数据呢？\n- 数据量一大，URL会不会出现过长的问题？\n\n####URL编解码\n&nbsp;&nbsp;&nbsp;&nbsp;在编写`js`代码过程中有几个常用的`URL`编码函数：`encodeURI`, `encodeURIComponent`, `atob`。以及对应的解码函数：`decodeURI`, `decodeURIComponent`, `btoa`。关于编解码，官方也有明确的规定(RFC 3986文档)，以下字符为保留字符，如果开发者需要使用它，就需要对其编码：\n> ; , / ? : @ & = + $\n\n同时也规定了一些非保留字符：\n>字母/数字/- _ . ! ~ * ' ( )\t\n\n**对URL特殊字符的编码称之为`百分号编码`**。即：\n> 对于特殊字符序，需要转换为`UTF-8`编码方式，然后取每个字节的16进制值，在其前面加上`%`号，完成编码。由于`UTF-8`编码兼容`ASCII`码，所以对于**特殊字符**只需要取其`ASCII`码的16进制值，在前面加上`%`即可。由于`%`号(ASCII HEX = 25)在`URL`编码有特殊的含义，所以也需要对它编码：`%25`。最终得到的`url`仅仅由定义`URL schema`需要的字符，加上非保留字符组成。\n\n\n来看看几个编解码函数的具体功能：\n+ encodeURI/decodeURI\n用于对整个`URL`编解码，但是其不会对**保留字符与上面定义的非保留字符**进行编码。举个例子：\n普通的编码：\n```javascript\n\n> var url1 = 'http://www.baidu.com/fuck.php?action=run';\nundefined\n\n> encodeURI(url1)\n'http://www.baidu.com/fuck.php?action=run'\n> \n\n```\n\n加上几个保留字符试一试：\n``` javascript\n\n> var url1 = 'http:/$/@;www.baidu.com/fuck.php?action=run';\n\n> encodeURI(url1)\n'http:/$/@;www.baidu.com/fuck.php?action=run'\n> \n\n```\n**可以看到并没有对保留字符编码。**\n\n再加入几个其他字符，如中文，试一试：\n```javascript\n> var url1 = 'http:/$/@;www.baidu.com/你好fuck.php?action=run';\n\n> encodeURI(url1)\n'http:/$/@;www.baidu.com/%E4%BD%A0%E5%A5%BDfuck.php?action=run'\n\n```\n`你好`对应的`Unicode`码为：`4F60`、`597D`。`UTF-8`编码之后分别为：`E4BDA0`与`E5A5BD`正好匹配`encodeURI`的输出。\n**可以看到对encodeURI除保留字符与特殊字符外的字符进行了编码。**\n\n>由于`encodeURI`不会对一些特殊字符编码，但是`URL`规范使用中必须对一些特殊字符譬如说：`&`, `=`,`+`进行编码。所以我们要用到的另一个函数是`encodeURIComponent`。\n\n**encodeURIComponent会把除非保留字符外的字符，通过百分号编码，转化为非保留字符的形式，这其中就包括了特殊字符。**\n看几个例子：\n``` javascript\n> var component = 'http://www.baidu.com'; \n\n> encodeURIComponent(component);\n'http%3A%2F%2Fwww.baidu.com'\n> \n\n```\n`:`, `/`都是保留字符，而`.`以及字母是非保留字符，验证了我们的想法。\n\n如果我们要在`URL`传入一些二进制数据怎么办呢？首先想到的是：**`Base64`编码的出现主要就是为了解决二进制数据的传输问题**。`btoa`就是我们想要的接口。\n举个例子：\n```javascript\nvar atob = require('atob');\nvar btoa = require('btoa');\n\nvar u1 = 'http://www.baidu.com';\n\nconsole.log(btoa(u1));\n\n```\n输出：\n> aHR0cDovL3d3dy5iYWlkdS5jb20=\n\n由于`Base64`在被编码字符长度不为`3`的倍数情况下会出现`=`号，**而`=`是保留字符**，由于它在这里有特殊的含义(表示传输数据的一部分)，所以需要调用`encodeURIComponent`对其进行编码。\n\n\n####URL的一些数据长度限制规定\n`web 浏览器`对整个 URI 长度有一定的限制。传统的IE浏览器是2048个字节，而现代各种浏览器和 web 服务器的设定均不一样，这依赖于各个浏览器厂家的规定或者可以根据 web 服务器的处理能力来设定。\n\n\n\n","source":"_posts/URL编解码.md","raw":"---\ntitle: URL编解码\ncategories: web\n---\n&nbsp;&nbsp;&nbsp;&nbsp;URI(统一资源定为标志)，用于指定想要访问的资源，URI可以有各种形式，如：日常在用的URL、每本书背面的ISBN码都是URI的一种形式, 日常过程中，如果不加区分，一般说的`URI`都指的是`URL`。拿我们熟悉的URL来说：\n\n一个普通的URL：\n>https://www.baidu.com/fuck.php?action=run#hash=1\n\nURL一般包括以下几个部分：\n\n+ 1. Scheme\n指定URL协议：http/https\n+ 2. hostname\n指定域名，如上面的`www.baidu.com`\n+ 3. port\n指定目标主机端口号，`http`协议默认为80端口，`https`默认为433端口。\n+ 4. path\n指定要访问的资源路径，以上为`fuck.php`\n+ 5. query\n以`?`开头，传递给目标主机的参数，`key/value`的形式来表示参数，参数之间通过`&`符号间隔开来。在`Nodejs`服务器，上面的`URL`最终解析得到`query`对象:\n> req.query = {action: run}\n+ 6. hash\n`hash`参数用于给浏览器渲染出来的`HTML`界面指定锚点，服务器在解析`URL`的时候会把`#`后面的字符丢弃。\n\n如果在实际运用过程中我们仅仅只需要知道这些概念就好了，可惜事情的复杂度往往比现象的要大。\n\n- 如果要给`URL`放其他字符怎么处理，如果我想放一些二进制数据呢？\n- 数据量一大，URL会不会出现过长的问题？\n\n####URL编解码\n&nbsp;&nbsp;&nbsp;&nbsp;在编写`js`代码过程中有几个常用的`URL`编码函数：`encodeURI`, `encodeURIComponent`, `atob`。以及对应的解码函数：`decodeURI`, `decodeURIComponent`, `btoa`。关于编解码，官方也有明确的规定(RFC 3986文档)，以下字符为保留字符，如果开发者需要使用它，就需要对其编码：\n> ; , / ? : @ & = + $\n\n同时也规定了一些非保留字符：\n>字母/数字/- _ . ! ~ * ' ( )\t\n\n**对URL特殊字符的编码称之为`百分号编码`**。即：\n> 对于特殊字符序，需要转换为`UTF-8`编码方式，然后取每个字节的16进制值，在其前面加上`%`号，完成编码。由于`UTF-8`编码兼容`ASCII`码，所以对于**特殊字符**只需要取其`ASCII`码的16进制值，在前面加上`%`即可。由于`%`号(ASCII HEX = 25)在`URL`编码有特殊的含义，所以也需要对它编码：`%25`。最终得到的`url`仅仅由定义`URL schema`需要的字符，加上非保留字符组成。\n\n\n来看看几个编解码函数的具体功能：\n+ encodeURI/decodeURI\n用于对整个`URL`编解码，但是其不会对**保留字符与上面定义的非保留字符**进行编码。举个例子：\n普通的编码：\n```javascript\n\n> var url1 = 'http://www.baidu.com/fuck.php?action=run';\nundefined\n\n> encodeURI(url1)\n'http://www.baidu.com/fuck.php?action=run'\n> \n\n```\n\n加上几个保留字符试一试：\n``` javascript\n\n> var url1 = 'http:/$/@;www.baidu.com/fuck.php?action=run';\n\n> encodeURI(url1)\n'http:/$/@;www.baidu.com/fuck.php?action=run'\n> \n\n```\n**可以看到并没有对保留字符编码。**\n\n再加入几个其他字符，如中文，试一试：\n```javascript\n> var url1 = 'http:/$/@;www.baidu.com/你好fuck.php?action=run';\n\n> encodeURI(url1)\n'http:/$/@;www.baidu.com/%E4%BD%A0%E5%A5%BDfuck.php?action=run'\n\n```\n`你好`对应的`Unicode`码为：`4F60`、`597D`。`UTF-8`编码之后分别为：`E4BDA0`与`E5A5BD`正好匹配`encodeURI`的输出。\n**可以看到对encodeURI除保留字符与特殊字符外的字符进行了编码。**\n\n>由于`encodeURI`不会对一些特殊字符编码，但是`URL`规范使用中必须对一些特殊字符譬如说：`&`, `=`,`+`进行编码。所以我们要用到的另一个函数是`encodeURIComponent`。\n\n**encodeURIComponent会把除非保留字符外的字符，通过百分号编码，转化为非保留字符的形式，这其中就包括了特殊字符。**\n看几个例子：\n``` javascript\n> var component = 'http://www.baidu.com'; \n\n> encodeURIComponent(component);\n'http%3A%2F%2Fwww.baidu.com'\n> \n\n```\n`:`, `/`都是保留字符，而`.`以及字母是非保留字符，验证了我们的想法。\n\n如果我们要在`URL`传入一些二进制数据怎么办呢？首先想到的是：**`Base64`编码的出现主要就是为了解决二进制数据的传输问题**。`btoa`就是我们想要的接口。\n举个例子：\n```javascript\nvar atob = require('atob');\nvar btoa = require('btoa');\n\nvar u1 = 'http://www.baidu.com';\n\nconsole.log(btoa(u1));\n\n```\n输出：\n> aHR0cDovL3d3dy5iYWlkdS5jb20=\n\n由于`Base64`在被编码字符长度不为`3`的倍数情况下会出现`=`号，**而`=`是保留字符**，由于它在这里有特殊的含义(表示传输数据的一部分)，所以需要调用`encodeURIComponent`对其进行编码。\n\n\n####URL的一些数据长度限制规定\n`web 浏览器`对整个 URI 长度有一定的限制。传统的IE浏览器是2048个字节，而现代各种浏览器和 web 服务器的设定均不一样，这依赖于各个浏览器厂家的规定或者可以根据 web 服务器的处理能力来设定。\n\n\n\n","slug":"URL编解码","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxh000v9co74v6ti8b0","content":"<p>&nbsp;&nbsp;&nbsp;&nbsp;URI(统一资源定为标志)，用于指定想要访问的资源，URI可以有各种形式，如：日常在用的URL、每本书背面的ISBN码都是URI的一种形式, 日常过程中，如果不加区分，一般说的<code>URI</code>都指的是<code>URL</code>。拿我们熟悉的URL来说：</p>\n<p>一个普通的URL：</p>\n<blockquote>\n<p><a href=\"https://www.baidu.com/fuck.php?action=run#hash=1\" target=\"_blank\" rel=\"noopener\">https://www.baidu.com/fuck.php?action=run#hash=1</a></p>\n</blockquote>\n<p>URL一般包括以下几个部分：</p>\n<ul>\n<li><ol>\n<li>Scheme<br>指定URL协议：http/https</li>\n</ol>\n</li>\n<li><ol>\n<li>hostname<br>指定域名，如上面的<code>www.baidu.com</code></li>\n</ol>\n</li>\n<li><ol>\n<li>port<br>指定目标主机端口号，<code>http</code>协议默认为80端口，<code>https</code>默认为433端口。</li>\n</ol>\n</li>\n<li><ol>\n<li>path<br>指定要访问的资源路径，以上为<code>fuck.php</code></li>\n</ol>\n</li>\n<li><ol>\n<li>query<br>以<code>?</code>开头，传递给目标主机的参数，<code>key/value</code>的形式来表示参数，参数之间通过<code>&amp;</code>符号间隔开来。在<code>Nodejs</code>服务器，上面的<code>URL</code>最终解析得到<code>query</code>对象:<blockquote>\n<p>req.query = {action: run}</p>\n</blockquote>\n</li>\n</ol>\n</li>\n<li><ol>\n<li>hash<br><code>hash</code>参数用于给浏览器渲染出来的<code>HTML</code>界面指定锚点，服务器在解析<code>URL</code>的时候会把<code>#</code>后面的字符丢弃。</li>\n</ol>\n</li>\n</ul>\n<p>如果在实际运用过程中我们仅仅只需要知道这些概念就好了，可惜事情的复杂度往往比现象的要大。</p>\n<ul>\n<li>如果要给<code>URL</code>放其他字符怎么处理，如果我想放一些二进制数据呢？</li>\n<li>数据量一大，URL会不会出现过长的问题？</li>\n</ul>\n<p>####URL编解码<br>&nbsp;&nbsp;&nbsp;&nbsp;在编写<code>js</code>代码过程中有几个常用的<code>URL</code>编码函数：<code>encodeURI</code>, <code>encodeURIComponent</code>, <code>atob</code>。以及对应的解码函数：<code>decodeURI</code>, <code>decodeURIComponent</code>, <code>btoa</code>。关于编解码，官方也有明确的规定(RFC 3986文档)，以下字符为保留字符，如果开发者需要使用它，就需要对其编码：</p>\n<blockquote>\n<p>; , / ? : @ &amp; = + $</p>\n</blockquote>\n<p>同时也规定了一些非保留字符：</p>\n<blockquote>\n<p>字母/数字/- _ . ! ~ * ‘ ( )    </p>\n</blockquote>\n<p><strong>对URL特殊字符的编码称之为<code>百分号编码</code></strong>。即：</p>\n<blockquote>\n<p>对于特殊字符序，需要转换为<code>UTF-8</code>编码方式，然后取每个字节的16进制值，在其前面加上<code>%</code>号，完成编码。由于<code>UTF-8</code>编码兼容<code>ASCII</code>码，所以对于<strong>特殊字符</strong>只需要取其<code>ASCII</code>码的16进制值，在前面加上<code>%</code>即可。由于<code>%</code>号(ASCII HEX = 25)在<code>URL</code>编码有特殊的含义，所以也需要对它编码：<code>%25</code>。最终得到的<code>url</code>仅仅由定义<code>URL schema</code>需要的字符，加上非保留字符组成。</p>\n</blockquote>\n<p>来看看几个编解码函数的具体功能：</p>\n<ul>\n<li>encodeURI/decodeURI<br>用于对整个<code>URL</code>编解码，但是其不会对<strong>保留字符与上面定义的非保留字符</strong>进行编码。举个例子：<br>普通的编码：<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"keyword\">var</span> url1 = <span class=\"string\">'http://www.baidu.com/fuck.php?action=run'</span>;</span><br><span class=\"line\"><span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"built_in\">encodeURI</span>(url1)</span><br><span class=\"line\"><span class=\"string\">'http://www.baidu.com/fuck.php?action=run'</span></span><br><span class=\"line\">&gt;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>加上几个保留字符试一试：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"keyword\">var</span> url1 = <span class=\"string\">'http:/$/@;www.baidu.com/fuck.php?action=run'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"built_in\">encodeURI</span>(url1)</span><br><span class=\"line\"><span class=\"string\">'http:/$/@;www.baidu.com/fuck.php?action=run'</span></span><br><span class=\"line\">&gt;</span><br></pre></td></tr></table></figure></p>\n<p><strong>可以看到并没有对保留字符编码。</strong></p>\n<p>再加入几个其他字符，如中文，试一试：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; <span class=\"keyword\">var</span> url1 = <span class=\"string\">'http:/$/@;www.baidu.com/你好fuck.php?action=run'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"built_in\">encodeURI</span>(url1)</span><br><span class=\"line\"><span class=\"string\">'http:/$/@;www.baidu.com/%E4%BD%A0%E5%A5%BDfuck.php?action=run'</span></span><br></pre></td></tr></table></figure></p>\n<p><code>你好</code>对应的<code>Unicode</code>码为：<code>4F60</code>、<code>597D</code>。<code>UTF-8</code>编码之后分别为：<code>E4BDA0</code>与<code>E5A5BD</code>正好匹配<code>encodeURI</code>的输出。<br><strong>可以看到对encodeURI除保留字符与特殊字符外的字符进行了编码。</strong></p>\n<blockquote>\n<p>由于<code>encodeURI</code>不会对一些特殊字符编码，但是<code>URL</code>规范使用中必须对一些特殊字符譬如说：<code>&amp;</code>, <code>=</code>,<code>+</code>进行编码。所以我们要用到的另一个函数是<code>encodeURIComponent</code>。</p>\n</blockquote>\n<p><strong>encodeURIComponent会把除非保留字符外的字符，通过百分号编码，转化为非保留字符的形式，这其中就包括了特殊字符。</strong><br>看几个例子：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; <span class=\"keyword\">var</span> component = <span class=\"string\">'http://www.baidu.com'</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"built_in\">encodeURIComponent</span>(component);</span><br><span class=\"line\"><span class=\"string\">'http%3A%2F%2Fwww.baidu.com'</span></span><br><span class=\"line\">&gt;</span><br></pre></td></tr></table></figure></p>\n<p><code>:</code>, <code>/</code>都是保留字符，而<code>.</code>以及字母是非保留字符，验证了我们的想法。</p>\n<p>如果我们要在<code>URL</code>传入一些二进制数据怎么办呢？首先想到的是：<strong><code>Base64</code>编码的出现主要就是为了解决二进制数据的传输问题</strong>。<code>btoa</code>就是我们想要的接口。<br>举个例子：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> atob = <span class=\"built_in\">require</span>(<span class=\"string\">'atob'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> btoa = <span class=\"built_in\">require</span>(<span class=\"string\">'btoa'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> u1 = <span class=\"string\">'http://www.baidu.com'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(btoa(u1));</span><br></pre></td></tr></table></figure></p>\n<p>输出：</p>\n<blockquote>\n<p>aHR0cDovL3d3dy5iYWlkdS5jb20=</p>\n</blockquote>\n<p>由于<code>Base64</code>在被编码字符长度不为<code>3</code>的倍数情况下会出现<code>=</code>号，<strong>而<code>=</code>是保留字符</strong>，由于它在这里有特殊的含义(表示传输数据的一部分)，所以需要调用<code>encodeURIComponent</code>对其进行编码。</p>\n<p>####URL的一些数据长度限制规定<br><code>web 浏览器</code>对整个 URI 长度有一定的限制。传统的IE浏览器是2048个字节，而现代各种浏览器和 web 服务器的设定均不一样，这依赖于各个浏览器厂家的规定或者可以根据 web 服务器的处理能力来设定。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>&nbsp;&nbsp;&nbsp;&nbsp;URI(统一资源定为标志)，用于指定想要访问的资源，URI可以有各种形式，如：日常在用的URL、每本书背面的ISBN码都是URI的一种形式, 日常过程中，如果不加区分，一般说的<code>URI</code>都指的是<code>URL</code>。拿我们熟悉的URL来说：</p>\n<p>一个普通的URL：</p>\n<blockquote>\n<p><a href=\"https://www.baidu.com/fuck.php?action=run#hash=1\" target=\"_blank\" rel=\"noopener\">https://www.baidu.com/fuck.php?action=run#hash=1</a></p>\n</blockquote>\n<p>URL一般包括以下几个部分：</p>\n<ul>\n<li><ol>\n<li>Scheme<br>指定URL协议：http/https</li>\n</ol>\n</li>\n<li><ol>\n<li>hostname<br>指定域名，如上面的<code>www.baidu.com</code></li>\n</ol>\n</li>\n<li><ol>\n<li>port<br>指定目标主机端口号，<code>http</code>协议默认为80端口，<code>https</code>默认为433端口。</li>\n</ol>\n</li>\n<li><ol>\n<li>path<br>指定要访问的资源路径，以上为<code>fuck.php</code></li>\n</ol>\n</li>\n<li><ol>\n<li>query<br>以<code>?</code>开头，传递给目标主机的参数，<code>key/value</code>的形式来表示参数，参数之间通过<code>&amp;</code>符号间隔开来。在<code>Nodejs</code>服务器，上面的<code>URL</code>最终解析得到<code>query</code>对象:<blockquote>\n<p>req.query = {action: run}</p>\n</blockquote>\n</li>\n</ol>\n</li>\n<li><ol>\n<li>hash<br><code>hash</code>参数用于给浏览器渲染出来的<code>HTML</code>界面指定锚点，服务器在解析<code>URL</code>的时候会把<code>#</code>后面的字符丢弃。</li>\n</ol>\n</li>\n</ul>\n<p>如果在实际运用过程中我们仅仅只需要知道这些概念就好了，可惜事情的复杂度往往比现象的要大。</p>\n<ul>\n<li>如果要给<code>URL</code>放其他字符怎么处理，如果我想放一些二进制数据呢？</li>\n<li>数据量一大，URL会不会出现过长的问题？</li>\n</ul>\n<p>####URL编解码<br>&nbsp;&nbsp;&nbsp;&nbsp;在编写<code>js</code>代码过程中有几个常用的<code>URL</code>编码函数：<code>encodeURI</code>, <code>encodeURIComponent</code>, <code>atob</code>。以及对应的解码函数：<code>decodeURI</code>, <code>decodeURIComponent</code>, <code>btoa</code>。关于编解码，官方也有明确的规定(RFC 3986文档)，以下字符为保留字符，如果开发者需要使用它，就需要对其编码：</p>\n<blockquote>\n<p>; , / ? : @ &amp; = + $</p>\n</blockquote>\n<p>同时也规定了一些非保留字符：</p>\n<blockquote>\n<p>字母/数字/- _ . ! ~ * ‘ ( )    </p>\n</blockquote>\n<p><strong>对URL特殊字符的编码称之为<code>百分号编码</code></strong>。即：</p>\n<blockquote>\n<p>对于特殊字符序，需要转换为<code>UTF-8</code>编码方式，然后取每个字节的16进制值，在其前面加上<code>%</code>号，完成编码。由于<code>UTF-8</code>编码兼容<code>ASCII</code>码，所以对于<strong>特殊字符</strong>只需要取其<code>ASCII</code>码的16进制值，在前面加上<code>%</code>即可。由于<code>%</code>号(ASCII HEX = 25)在<code>URL</code>编码有特殊的含义，所以也需要对它编码：<code>%25</code>。最终得到的<code>url</code>仅仅由定义<code>URL schema</code>需要的字符，加上非保留字符组成。</p>\n</blockquote>\n<p>来看看几个编解码函数的具体功能：</p>\n<ul>\n<li>encodeURI/decodeURI<br>用于对整个<code>URL</code>编解码，但是其不会对<strong>保留字符与上面定义的非保留字符</strong>进行编码。举个例子：<br>普通的编码：<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"keyword\">var</span> url1 = <span class=\"string\">'http://www.baidu.com/fuck.php?action=run'</span>;</span><br><span class=\"line\"><span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"built_in\">encodeURI</span>(url1)</span><br><span class=\"line\"><span class=\"string\">'http://www.baidu.com/fuck.php?action=run'</span></span><br><span class=\"line\">&gt;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>加上几个保留字符试一试：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"keyword\">var</span> url1 = <span class=\"string\">'http:/$/@;www.baidu.com/fuck.php?action=run'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"built_in\">encodeURI</span>(url1)</span><br><span class=\"line\"><span class=\"string\">'http:/$/@;www.baidu.com/fuck.php?action=run'</span></span><br><span class=\"line\">&gt;</span><br></pre></td></tr></table></figure></p>\n<p><strong>可以看到并没有对保留字符编码。</strong></p>\n<p>再加入几个其他字符，如中文，试一试：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; <span class=\"keyword\">var</span> url1 = <span class=\"string\">'http:/$/@;www.baidu.com/你好fuck.php?action=run'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"built_in\">encodeURI</span>(url1)</span><br><span class=\"line\"><span class=\"string\">'http:/$/@;www.baidu.com/%E4%BD%A0%E5%A5%BDfuck.php?action=run'</span></span><br></pre></td></tr></table></figure></p>\n<p><code>你好</code>对应的<code>Unicode</code>码为：<code>4F60</code>、<code>597D</code>。<code>UTF-8</code>编码之后分别为：<code>E4BDA0</code>与<code>E5A5BD</code>正好匹配<code>encodeURI</code>的输出。<br><strong>可以看到对encodeURI除保留字符与特殊字符外的字符进行了编码。</strong></p>\n<blockquote>\n<p>由于<code>encodeURI</code>不会对一些特殊字符编码，但是<code>URL</code>规范使用中必须对一些特殊字符譬如说：<code>&amp;</code>, <code>=</code>,<code>+</code>进行编码。所以我们要用到的另一个函数是<code>encodeURIComponent</code>。</p>\n</blockquote>\n<p><strong>encodeURIComponent会把除非保留字符外的字符，通过百分号编码，转化为非保留字符的形式，这其中就包括了特殊字符。</strong><br>看几个例子：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; <span class=\"keyword\">var</span> component = <span class=\"string\">'http://www.baidu.com'</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"built_in\">encodeURIComponent</span>(component);</span><br><span class=\"line\"><span class=\"string\">'http%3A%2F%2Fwww.baidu.com'</span></span><br><span class=\"line\">&gt;</span><br></pre></td></tr></table></figure></p>\n<p><code>:</code>, <code>/</code>都是保留字符，而<code>.</code>以及字母是非保留字符，验证了我们的想法。</p>\n<p>如果我们要在<code>URL</code>传入一些二进制数据怎么办呢？首先想到的是：<strong><code>Base64</code>编码的出现主要就是为了解决二进制数据的传输问题</strong>。<code>btoa</code>就是我们想要的接口。<br>举个例子：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> atob = <span class=\"built_in\">require</span>(<span class=\"string\">'atob'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> btoa = <span class=\"built_in\">require</span>(<span class=\"string\">'btoa'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> u1 = <span class=\"string\">'http://www.baidu.com'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(btoa(u1));</span><br></pre></td></tr></table></figure></p>\n<p>输出：</p>\n<blockquote>\n<p>aHR0cDovL3d3dy5iYWlkdS5jb20=</p>\n</blockquote>\n<p>由于<code>Base64</code>在被编码字符长度不为<code>3</code>的倍数情况下会出现<code>=</code>号，<strong>而<code>=</code>是保留字符</strong>，由于它在这里有特殊的含义(表示传输数据的一部分)，所以需要调用<code>encodeURIComponent</code>对其进行编码。</p>\n<p>####URL的一些数据长度限制规定<br><code>web 浏览器</code>对整个 URI 长度有一定的限制。传统的IE浏览器是2048个字节，而现代各种浏览器和 web 服务器的设定均不一样，这依赖于各个浏览器厂家的规定或者可以根据 web 服务器的处理能力来设定。</p>\n"},{"title":"css视觉格式化1","date":"2016-08-18T02:43:12.000Z","_content":"\n# 视觉格式化基本概念总结\n\n## 块级元素水平格式化\n\n- 1、水平格式化七个属性，只有宽度、左右外边距可以设置为`auto`，其他必须为特定值，或者默认为0.\n- 2、外边距可以为负、其他不能。`width`默认为`auto`、其他默认为0.\n- 3、七个水平布局属性之和等于父元素的`width`，只要所有所有属性都是大于或者等于0，元素就不会超过父元素的内容区域。\n- 4、如果外边距离与`width`都设置为特定值且之和大于父元素的`width`，右边距会重置为`auto`。\n- 5、如果只有一个设置为`auto`，其会根据公式计算。\n- 6、如果参数之和大于父元素的`width`且`margin-right`设置为`auto`，则会重置`margin-right`以适配公式(如果没有设置`margin-right`为`auto`则会保持设置值)\n\n---\n\n## 块级元素的垂直格式化\n\n- 1、高度默认由其内容决定、受到内容宽度影响\n- 2、七个属性的值必须等于元素包含的`height`\n- 3、七个属性只有三个可以设置为`auto`\n- 4、如果把上下外边距设置为`auto`，那么它会自动计算为0\n- 5、如果块级正常流元素的高度设置为`auto`,而且只有块级子元素，其默认高度是最高元素外边框(border)边界到最低子元素外边框边界的距离。\n- 6、如果给包含块设置`边框`或者内边距时，包含块的高度会把子元素的外边距(margin)包含在内\n- 7、垂直负外边距合并规则：\n    + 如果两个外边距都是负，浏览器取绝对值比较大的那个数\n    + 如果一正一负，浏览器会用正外边距减去负外边距的绝对值\n    + 行内框、浮动定位、和绝对定位元素之间的外边距不会叠加(外边距合并只发生在正常流元素)\n\n---\n\n## 行内元素布局的基本概念\n\n- 1、`em`框： `font-size`大小确定\n- 2、内容区\n    + 行内非替换元素：等于`em`框\n    + 行内替换元素：元素固有宽高、加上边距、边框\n\n- 3、行间距\n    + 行内非替换元素：等于`font-size`与`line-height`的差\n    + 行内替换元素：没有行间距的概念\n\n- 4、行内框\n\n    + 行内非替换元素：等于`line-height`\n    + 行内替换元素：等于内容区\n\n---\n\n## 行内元素布局一些有用的概念\n\n- 1、内容区类似于块级元素的内容框\n- 2、行内元素背景作用于内容区以及内边距\n- 3、行内元素的边框包围内容区、内边距\n- 4、非替换元素的边框、边距不会影响行内框高度\n- 5、替换元素的边距、边框会影响行内框高度\n- 6、可以为除了行内非替换元素外的任意元素设置垂直外边距\n\n---\n\n# 关于百分数参数\n\n- 1、对`margin/padding`使用百分比将会相对于包含块的内容区宽度计算\n- 2、对于`height`属性使用百分比将会相对于包含块内容区的高度计算\n- 3、对于定位元素(`position`属性非`static`)的`top`、`bottom`属性使用百分比将会相对于包含块高度计算\n- 4、不允许对`border`属性使用百分比","source":"_posts/css视觉格式化1.md","raw":"---\ntitle: css视觉格式化1\ndate: 2016-08-18 10:43:12\ntags: line box inline block\ncategories: web\n---\n\n# 视觉格式化基本概念总结\n\n## 块级元素水平格式化\n\n- 1、水平格式化七个属性，只有宽度、左右外边距可以设置为`auto`，其他必须为特定值，或者默认为0.\n- 2、外边距可以为负、其他不能。`width`默认为`auto`、其他默认为0.\n- 3、七个水平布局属性之和等于父元素的`width`，只要所有所有属性都是大于或者等于0，元素就不会超过父元素的内容区域。\n- 4、如果外边距离与`width`都设置为特定值且之和大于父元素的`width`，右边距会重置为`auto`。\n- 5、如果只有一个设置为`auto`，其会根据公式计算。\n- 6、如果参数之和大于父元素的`width`且`margin-right`设置为`auto`，则会重置`margin-right`以适配公式(如果没有设置`margin-right`为`auto`则会保持设置值)\n\n---\n\n## 块级元素的垂直格式化\n\n- 1、高度默认由其内容决定、受到内容宽度影响\n- 2、七个属性的值必须等于元素包含的`height`\n- 3、七个属性只有三个可以设置为`auto`\n- 4、如果把上下外边距设置为`auto`，那么它会自动计算为0\n- 5、如果块级正常流元素的高度设置为`auto`,而且只有块级子元素，其默认高度是最高元素外边框(border)边界到最低子元素外边框边界的距离。\n- 6、如果给包含块设置`边框`或者内边距时，包含块的高度会把子元素的外边距(margin)包含在内\n- 7、垂直负外边距合并规则：\n    + 如果两个外边距都是负，浏览器取绝对值比较大的那个数\n    + 如果一正一负，浏览器会用正外边距减去负外边距的绝对值\n    + 行内框、浮动定位、和绝对定位元素之间的外边距不会叠加(外边距合并只发生在正常流元素)\n\n---\n\n## 行内元素布局的基本概念\n\n- 1、`em`框： `font-size`大小确定\n- 2、内容区\n    + 行内非替换元素：等于`em`框\n    + 行内替换元素：元素固有宽高、加上边距、边框\n\n- 3、行间距\n    + 行内非替换元素：等于`font-size`与`line-height`的差\n    + 行内替换元素：没有行间距的概念\n\n- 4、行内框\n\n    + 行内非替换元素：等于`line-height`\n    + 行内替换元素：等于内容区\n\n---\n\n## 行内元素布局一些有用的概念\n\n- 1、内容区类似于块级元素的内容框\n- 2、行内元素背景作用于内容区以及内边距\n- 3、行内元素的边框包围内容区、内边距\n- 4、非替换元素的边框、边距不会影响行内框高度\n- 5、替换元素的边距、边框会影响行内框高度\n- 6、可以为除了行内非替换元素外的任意元素设置垂直外边距\n\n---\n\n# 关于百分数参数\n\n- 1、对`margin/padding`使用百分比将会相对于包含块的内容区宽度计算\n- 2、对于`height`属性使用百分比将会相对于包含块内容区的高度计算\n- 3、对于定位元素(`position`属性非`static`)的`top`、`bottom`属性使用百分比将会相对于包含块高度计算\n- 4、不允许对`border`属性使用百分比","slug":"css视觉格式化1","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxj000y9co73bq3jr5g","content":"<h1 id=\"视觉格式化基本概念总结\"><a href=\"#视觉格式化基本概念总结\" class=\"headerlink\" title=\"视觉格式化基本概念总结\"></a>视觉格式化基本概念总结</h1><h2 id=\"块级元素水平格式化\"><a href=\"#块级元素水平格式化\" class=\"headerlink\" title=\"块级元素水平格式化\"></a>块级元素水平格式化</h2><ul>\n<li>1、水平格式化七个属性，只有宽度、左右外边距可以设置为<code>auto</code>，其他必须为特定值，或者默认为0.</li>\n<li>2、外边距可以为负、其他不能。<code>width</code>默认为<code>auto</code>、其他默认为0.</li>\n<li>3、七个水平布局属性之和等于父元素的<code>width</code>，只要所有所有属性都是大于或者等于0，元素就不会超过父元素的内容区域。</li>\n<li>4、如果外边距离与<code>width</code>都设置为特定值且之和大于父元素的<code>width</code>，右边距会重置为<code>auto</code>。</li>\n<li>5、如果只有一个设置为<code>auto</code>，其会根据公式计算。</li>\n<li>6、如果参数之和大于父元素的<code>width</code>且<code>margin-right</code>设置为<code>auto</code>，则会重置<code>margin-right</code>以适配公式(如果没有设置<code>margin-right</code>为<code>auto</code>则会保持设置值)</li>\n</ul>\n<hr>\n<h2 id=\"块级元素的垂直格式化\"><a href=\"#块级元素的垂直格式化\" class=\"headerlink\" title=\"块级元素的垂直格式化\"></a>块级元素的垂直格式化</h2><ul>\n<li>1、高度默认由其内容决定、受到内容宽度影响</li>\n<li>2、七个属性的值必须等于元素包含的<code>height</code></li>\n<li>3、七个属性只有三个可以设置为<code>auto</code></li>\n<li>4、如果把上下外边距设置为<code>auto</code>，那么它会自动计算为0</li>\n<li>5、如果块级正常流元素的高度设置为<code>auto</code>,而且只有块级子元素，其默认高度是最高元素外边框(border)边界到最低子元素外边框边界的距离。</li>\n<li>6、如果给包含块设置<code>边框</code>或者内边距时，包含块的高度会把子元素的外边距(margin)包含在内</li>\n<li>7、垂直负外边距合并规则：<ul>\n<li>如果两个外边距都是负，浏览器取绝对值比较大的那个数</li>\n<li>如果一正一负，浏览器会用正外边距减去负外边距的绝对值</li>\n<li>行内框、浮动定位、和绝对定位元素之间的外边距不会叠加(外边距合并只发生在正常流元素)</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"行内元素布局的基本概念\"><a href=\"#行内元素布局的基本概念\" class=\"headerlink\" title=\"行内元素布局的基本概念\"></a>行内元素布局的基本概念</h2><ul>\n<li>1、<code>em</code>框： <code>font-size</code>大小确定</li>\n<li><p>2、内容区</p>\n<ul>\n<li>行内非替换元素：等于<code>em</code>框</li>\n<li>行内替换元素：元素固有宽高、加上边距、边框</li>\n</ul>\n</li>\n<li><p>3、行间距</p>\n<ul>\n<li>行内非替换元素：等于<code>font-size</code>与<code>line-height</code>的差</li>\n<li>行内替换元素：没有行间距的概念</li>\n</ul>\n</li>\n<li><p>4、行内框</p>\n<ul>\n<li>行内非替换元素：等于<code>line-height</code></li>\n<li>行内替换元素：等于内容区</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"行内元素布局一些有用的概念\"><a href=\"#行内元素布局一些有用的概念\" class=\"headerlink\" title=\"行内元素布局一些有用的概念\"></a>行内元素布局一些有用的概念</h2><ul>\n<li>1、内容区类似于块级元素的内容框</li>\n<li>2、行内元素背景作用于内容区以及内边距</li>\n<li>3、行内元素的边框包围内容区、内边距</li>\n<li>4、非替换元素的边框、边距不会影响行内框高度</li>\n<li>5、替换元素的边距、边框会影响行内框高度</li>\n<li>6、可以为除了行内非替换元素外的任意元素设置垂直外边距</li>\n</ul>\n<hr>\n<h1 id=\"关于百分数参数\"><a href=\"#关于百分数参数\" class=\"headerlink\" title=\"关于百分数参数\"></a>关于百分数参数</h1><ul>\n<li>1、对<code>margin/padding</code>使用百分比将会相对于包含块的内容区宽度计算</li>\n<li>2、对于<code>height</code>属性使用百分比将会相对于包含块内容区的高度计算</li>\n<li>3、对于定位元素(<code>position</code>属性非<code>static</code>)的<code>top</code>、<code>bottom</code>属性使用百分比将会相对于包含块高度计算</li>\n<li>4、不允许对<code>border</code>属性使用百分比</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"视觉格式化基本概念总结\"><a href=\"#视觉格式化基本概念总结\" class=\"headerlink\" title=\"视觉格式化基本概念总结\"></a>视觉格式化基本概念总结</h1><h2 id=\"块级元素水平格式化\"><a href=\"#块级元素水平格式化\" class=\"headerlink\" title=\"块级元素水平格式化\"></a>块级元素水平格式化</h2><ul>\n<li>1、水平格式化七个属性，只有宽度、左右外边距可以设置为<code>auto</code>，其他必须为特定值，或者默认为0.</li>\n<li>2、外边距可以为负、其他不能。<code>width</code>默认为<code>auto</code>、其他默认为0.</li>\n<li>3、七个水平布局属性之和等于父元素的<code>width</code>，只要所有所有属性都是大于或者等于0，元素就不会超过父元素的内容区域。</li>\n<li>4、如果外边距离与<code>width</code>都设置为特定值且之和大于父元素的<code>width</code>，右边距会重置为<code>auto</code>。</li>\n<li>5、如果只有一个设置为<code>auto</code>，其会根据公式计算。</li>\n<li>6、如果参数之和大于父元素的<code>width</code>且<code>margin-right</code>设置为<code>auto</code>，则会重置<code>margin-right</code>以适配公式(如果没有设置<code>margin-right</code>为<code>auto</code>则会保持设置值)</li>\n</ul>\n<hr>\n<h2 id=\"块级元素的垂直格式化\"><a href=\"#块级元素的垂直格式化\" class=\"headerlink\" title=\"块级元素的垂直格式化\"></a>块级元素的垂直格式化</h2><ul>\n<li>1、高度默认由其内容决定、受到内容宽度影响</li>\n<li>2、七个属性的值必须等于元素包含的<code>height</code></li>\n<li>3、七个属性只有三个可以设置为<code>auto</code></li>\n<li>4、如果把上下外边距设置为<code>auto</code>，那么它会自动计算为0</li>\n<li>5、如果块级正常流元素的高度设置为<code>auto</code>,而且只有块级子元素，其默认高度是最高元素外边框(border)边界到最低子元素外边框边界的距离。</li>\n<li>6、如果给包含块设置<code>边框</code>或者内边距时，包含块的高度会把子元素的外边距(margin)包含在内</li>\n<li>7、垂直负外边距合并规则：<ul>\n<li>如果两个外边距都是负，浏览器取绝对值比较大的那个数</li>\n<li>如果一正一负，浏览器会用正外边距减去负外边距的绝对值</li>\n<li>行内框、浮动定位、和绝对定位元素之间的外边距不会叠加(外边距合并只发生在正常流元素)</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"行内元素布局的基本概念\"><a href=\"#行内元素布局的基本概念\" class=\"headerlink\" title=\"行内元素布局的基本概念\"></a>行内元素布局的基本概念</h2><ul>\n<li>1、<code>em</code>框： <code>font-size</code>大小确定</li>\n<li><p>2、内容区</p>\n<ul>\n<li>行内非替换元素：等于<code>em</code>框</li>\n<li>行内替换元素：元素固有宽高、加上边距、边框</li>\n</ul>\n</li>\n<li><p>3、行间距</p>\n<ul>\n<li>行内非替换元素：等于<code>font-size</code>与<code>line-height</code>的差</li>\n<li>行内替换元素：没有行间距的概念</li>\n</ul>\n</li>\n<li><p>4、行内框</p>\n<ul>\n<li>行内非替换元素：等于<code>line-height</code></li>\n<li>行内替换元素：等于内容区</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"行内元素布局一些有用的概念\"><a href=\"#行内元素布局一些有用的概念\" class=\"headerlink\" title=\"行内元素布局一些有用的概念\"></a>行内元素布局一些有用的概念</h2><ul>\n<li>1、内容区类似于块级元素的内容框</li>\n<li>2、行内元素背景作用于内容区以及内边距</li>\n<li>3、行内元素的边框包围内容区、内边距</li>\n<li>4、非替换元素的边框、边距不会影响行内框高度</li>\n<li>5、替换元素的边距、边框会影响行内框高度</li>\n<li>6、可以为除了行内非替换元素外的任意元素设置垂直外边距</li>\n</ul>\n<hr>\n<h1 id=\"关于百分数参数\"><a href=\"#关于百分数参数\" class=\"headerlink\" title=\"关于百分数参数\"></a>关于百分数参数</h1><ul>\n<li>1、对<code>margin/padding</code>使用百分比将会相对于包含块的内容区宽度计算</li>\n<li>2、对于<code>height</code>属性使用百分比将会相对于包含块内容区的高度计算</li>\n<li>3、对于定位元素(<code>position</code>属性非<code>static</code>)的<code>top</code>、<code>bottom</code>属性使用百分比将会相对于包含块高度计算</li>\n<li>4、不允许对<code>border</code>属性使用百分比</li>\n</ul>\n"},{"title":"darling","date":"2016-06-22T09:59:21.000Z","_content":"\n---  \n\n### I will always be you side, You will never alone!\n\n---  \n","source":"_posts/darling-md.md","raw":"---\ntitle: darling\ndate: 2016-06-22 17:59:21\ntags: love\ncategories: life\n---\n\n---  \n\n### I will always be you side, You will never alone!\n\n---  \n","slug":"darling-md","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxm00129co70j1yoyy4","content":"<hr>\n<h3 id=\"I-will-always-be-you-side-You-will-never-alone\"><a href=\"#I-will-always-be-you-side-You-will-never-alone\" class=\"headerlink\" title=\"I will always be you side, You will never alone!\"></a>I will always be you side, You will never alone!</h3><hr>\n","site":{"data":{}},"excerpt":"","more":"<hr>\n<h3 id=\"I-will-always-be-you-side-You-will-never-alone\"><a href=\"#I-will-always-be-you-side-You-will-never-alone\" class=\"headerlink\" title=\"I will always be you side, You will never alone!\"></a>I will always be you side, You will never alone!</h3><hr>\n"},{"title":"electron-研究笔记","_content":"使用`electron`有一阵子了，随着项目推进，需要研究的东西也逐渐多起来。总结了以下，问题主要出现在：  \n- 跨平台兼容性  \n- 新的功能需求  \n\n=================\n\n#### `electron` 渲染进程模拟浏览器环境  \n\n`electron`渲染进程默认为`nodejs`环境，在里面你可以调用`require`引入第三方模块，但有时候我们想要的是一个真实的浏览器环境。`electron`需要做的配置如下：  \n\n```javascript  \n\n    var mainWindow = new BrowserWindow({\n        resizable: true,\n        width: size.width,\n        height: size.height,\n        title: 'HolaStudio',\n        webPreferences:\n        {\n            nodeIntegration: false,\n            preload: path.join(__dirname, 'tangide', 'expose-window-apis.js')\n        }\n    });\n\n```  \n\n创建`BrowserWindow`的时候指定`nodeIntegration`为`false`。  这样在`electron`内置浏览器里面不会有`module`和`require`全局变量。  \n\n====================\n\n#### 渲染进程与主进程之间的通信  \n`electron`下主进程与渲染进程之间的通信主要有如下几种方式：  \n- 使用`remote`模块  \n- 使用`ipc`做进程间通信  \n\n这里我选择了第二种方式：  \n```javascript  \n\n// In main process.\nconst ipcMain = require('electron').ipcMain;\nipcMain.on('asynchronous-message', function(event, arg) {\n  console.log(arg);  // prints \"ping\"\n  event.sender.send('asynchronous-reply', 'pong');\n});\n\nipcMain.on('synchronous-message', function(event, arg) {\n  console.log(arg);  // prints \"ping\"\n  event.returnValue = 'pong';\n});\n\n// In renderer process (web page).\nconst ipcRenderer = require('electron').ipcRenderer;\nconsole.log(ipcRenderer.sendSync('synchronous-message', 'ping')); // prints \"pong\"\n\nipcRenderer.on('asynchronous-reply', function(event, arg) {\n  console.log(arg); // prints \"pong\"\n});\nipcRenderer.send('asynchronous-message', 'ping');\n\n```  \n在渲染进程引入模块，都需要用`require`的方式，但是按照要求，渲染进程必须是一个真实的浏览器环境，所以需要通过其他方式来引入模块包。  \n\n```javascript  \n    preload: path.join(__dirname, 'tangide', 'expose-window-apis.js')\n```  \n\n该配置的作用在于：  \n>界面的其它脚本运行之前预先加载一个指定脚本. 这个脚本将一直可以使用 node APIs 无论 node integration 是否开启. 脚本路径为绝对路径。  \n\n`expose-window-apis.js`实现如下：  \n```javascript  \n//inner process communication\nwindow.ipc = require('electron').ipcRenderer;  \n```  \n\n通过这种方式，渲染进程`window`对应引入了`ipc`模块，解决了渲染进程引入模块包的问题：）  \n\n============================\n\n#### mac系统下快捷键问题  \n\n`Mac`系统下，默认的快捷键`Redo`、`Undo`、复制粘贴等不能使用，阅读了`electron`发现需要通过创建应用菜单的方式做一个映射。  \n```  javascript\n\nconst Menu = require(\"menu\");\n     // Create the Application's main menu\n    let template = [{\n        label: \"Application\",\n        submenu: [\n            { label: \"About Application\", selector: \"orderFrontStandardAboutPanel:\" },\n            { type: \"separator\" },\n            { label: \"Quit\", accelerator: \"Command+Q\", click: function() { app.quit(); }}\n        ]}, {\n        label: keysBinding[\"Edit\"],\n        submenu: [\n            { label: keysBinding[\"Undo\"], accelerator: \"CmdOrCtrl+Z\", selector: \"undo:\" },\n            { label: keysBinding[\"Redo\"], accelerator: \"Shift+CmdOrCtrl+Z\", selector: \"redo:\" },\n            { type: \"separator\" },\n            { label: keysBinding[\"Cut\"], accelerator: \"CmdOrCtrl+X\", selector: \"cut:\" },\n            { label: keysBinding[\"Copy\"], accelerator: \"CmdOrCtrl+C\", selector: \"copy:\" },\n            { label: keysBinding[\"Paste\"], accelerator: \"CmdOrCtrl+V\", selector: \"paste:\" },\n            { label: keysBinding[\"Select All\"], accelerator: \"CmdOrCtrl+A\", selector: \"selectAll:\" }\n        ]}\n    ];\n\n//注册菜单  \nMenu.setApplicationMenu(Menu.buildFromTemplate(template));\n\n```  \n\n=======================\n\n#### 系统快捷键冲突问题  \n\n开发者最常用到的快捷键一个是`F12`,打开开发者工具。 `F5`刷新当前网页：  \n```javascript  \nconst globalShortcut = require('global-shortcut');   \nregisterShortcut();  \nfunction registerShortcut() {\n    function doRegister(cmd, callback) {\n        globalShortcut.register(cmd, callback);\n    }\n\n    let registed = globalShortcut.isRegistered('F12');\n    if(registed) return;\n\n    doRegister('F12', function() {\n        let win = BrowserWindow.getFocusedWindow();\n        if(!win) return;\n        win.webContents.toggleDevTools();\n        console.log(\"toggleDevTools F12\");\n    });\n\n    doRegister('F6', function() {\n        let win = BrowserWindow.getFocusedWindow();\n        if(!win) return;\n        win.webContents.toggleDevTools();\n        console.log(\"toggleDevTools F6\");\n    });\n\n    doRegister('F5', function() {\n        let win = BrowserWindow.getFocusedWindow();\n        if(!win) return;\n        win.reload();\n        console.log(\"refresh\");\n    });\n\n    return;\n}\n\n```   \n\n正常情况下通过注册全局快捷键的方式能够满足绝大多数情况下的应用场景，但是使用过程中还是有如下问题：  \n- `electron`注册了快捷键后，系统默认浏览器无法通过快捷键触发调式工具。  \n- `windows`系统`electron`应用的`F12`按键无效。  \n\n对于`windows`系统`F12`无效问题，`electron`官方貌似也没有一个好的解决方案。一个讨论的[帖子](https://github.com/electron/electron/issues/5066)。  \n\n快捷键覆盖的问题，目前的解决办法如下：  \n监听`blur`和`focus`事件，在`blur`事件下注消快捷键，在`focus`下重新注册监听快捷键。  \n\n```javascript  \n    mainWindow.on('blur', function() {\n        let win = BrowserWindow.getFocusedWindow();\n        if(win) return;\n        globalShortcut.unregisterAll();\n        console.log('blur');\n    });\n\n    mainWindow.on('focus', function() {\n        registerShortcut();\n        console.log('focus');\n    });\n```  \n\n一个`electron`应用可能存在多个窗口，所以在主窗口触发`blur`事件的时候需要判断是不是所有`electron`都失去了焦点。  在这种情况下注消快捷键，以便系统浏览器能正常调式。  \n","source":"_posts/electron-研究笔记.md","raw":"---\ntitle: electron-研究笔记\ncategories: web\n---\n使用`electron`有一阵子了，随着项目推进，需要研究的东西也逐渐多起来。总结了以下，问题主要出现在：  \n- 跨平台兼容性  \n- 新的功能需求  \n\n=================\n\n#### `electron` 渲染进程模拟浏览器环境  \n\n`electron`渲染进程默认为`nodejs`环境，在里面你可以调用`require`引入第三方模块，但有时候我们想要的是一个真实的浏览器环境。`electron`需要做的配置如下：  \n\n```javascript  \n\n    var mainWindow = new BrowserWindow({\n        resizable: true,\n        width: size.width,\n        height: size.height,\n        title: 'HolaStudio',\n        webPreferences:\n        {\n            nodeIntegration: false,\n            preload: path.join(__dirname, 'tangide', 'expose-window-apis.js')\n        }\n    });\n\n```  \n\n创建`BrowserWindow`的时候指定`nodeIntegration`为`false`。  这样在`electron`内置浏览器里面不会有`module`和`require`全局变量。  \n\n====================\n\n#### 渲染进程与主进程之间的通信  \n`electron`下主进程与渲染进程之间的通信主要有如下几种方式：  \n- 使用`remote`模块  \n- 使用`ipc`做进程间通信  \n\n这里我选择了第二种方式：  \n```javascript  \n\n// In main process.\nconst ipcMain = require('electron').ipcMain;\nipcMain.on('asynchronous-message', function(event, arg) {\n  console.log(arg);  // prints \"ping\"\n  event.sender.send('asynchronous-reply', 'pong');\n});\n\nipcMain.on('synchronous-message', function(event, arg) {\n  console.log(arg);  // prints \"ping\"\n  event.returnValue = 'pong';\n});\n\n// In renderer process (web page).\nconst ipcRenderer = require('electron').ipcRenderer;\nconsole.log(ipcRenderer.sendSync('synchronous-message', 'ping')); // prints \"pong\"\n\nipcRenderer.on('asynchronous-reply', function(event, arg) {\n  console.log(arg); // prints \"pong\"\n});\nipcRenderer.send('asynchronous-message', 'ping');\n\n```  \n在渲染进程引入模块，都需要用`require`的方式，但是按照要求，渲染进程必须是一个真实的浏览器环境，所以需要通过其他方式来引入模块包。  \n\n```javascript  \n    preload: path.join(__dirname, 'tangide', 'expose-window-apis.js')\n```  \n\n该配置的作用在于：  \n>界面的其它脚本运行之前预先加载一个指定脚本. 这个脚本将一直可以使用 node APIs 无论 node integration 是否开启. 脚本路径为绝对路径。  \n\n`expose-window-apis.js`实现如下：  \n```javascript  \n//inner process communication\nwindow.ipc = require('electron').ipcRenderer;  \n```  \n\n通过这种方式，渲染进程`window`对应引入了`ipc`模块，解决了渲染进程引入模块包的问题：）  \n\n============================\n\n#### mac系统下快捷键问题  \n\n`Mac`系统下，默认的快捷键`Redo`、`Undo`、复制粘贴等不能使用，阅读了`electron`发现需要通过创建应用菜单的方式做一个映射。  \n```  javascript\n\nconst Menu = require(\"menu\");\n     // Create the Application's main menu\n    let template = [{\n        label: \"Application\",\n        submenu: [\n            { label: \"About Application\", selector: \"orderFrontStandardAboutPanel:\" },\n            { type: \"separator\" },\n            { label: \"Quit\", accelerator: \"Command+Q\", click: function() { app.quit(); }}\n        ]}, {\n        label: keysBinding[\"Edit\"],\n        submenu: [\n            { label: keysBinding[\"Undo\"], accelerator: \"CmdOrCtrl+Z\", selector: \"undo:\" },\n            { label: keysBinding[\"Redo\"], accelerator: \"Shift+CmdOrCtrl+Z\", selector: \"redo:\" },\n            { type: \"separator\" },\n            { label: keysBinding[\"Cut\"], accelerator: \"CmdOrCtrl+X\", selector: \"cut:\" },\n            { label: keysBinding[\"Copy\"], accelerator: \"CmdOrCtrl+C\", selector: \"copy:\" },\n            { label: keysBinding[\"Paste\"], accelerator: \"CmdOrCtrl+V\", selector: \"paste:\" },\n            { label: keysBinding[\"Select All\"], accelerator: \"CmdOrCtrl+A\", selector: \"selectAll:\" }\n        ]}\n    ];\n\n//注册菜单  \nMenu.setApplicationMenu(Menu.buildFromTemplate(template));\n\n```  \n\n=======================\n\n#### 系统快捷键冲突问题  \n\n开发者最常用到的快捷键一个是`F12`,打开开发者工具。 `F5`刷新当前网页：  \n```javascript  \nconst globalShortcut = require('global-shortcut');   \nregisterShortcut();  \nfunction registerShortcut() {\n    function doRegister(cmd, callback) {\n        globalShortcut.register(cmd, callback);\n    }\n\n    let registed = globalShortcut.isRegistered('F12');\n    if(registed) return;\n\n    doRegister('F12', function() {\n        let win = BrowserWindow.getFocusedWindow();\n        if(!win) return;\n        win.webContents.toggleDevTools();\n        console.log(\"toggleDevTools F12\");\n    });\n\n    doRegister('F6', function() {\n        let win = BrowserWindow.getFocusedWindow();\n        if(!win) return;\n        win.webContents.toggleDevTools();\n        console.log(\"toggleDevTools F6\");\n    });\n\n    doRegister('F5', function() {\n        let win = BrowserWindow.getFocusedWindow();\n        if(!win) return;\n        win.reload();\n        console.log(\"refresh\");\n    });\n\n    return;\n}\n\n```   \n\n正常情况下通过注册全局快捷键的方式能够满足绝大多数情况下的应用场景，但是使用过程中还是有如下问题：  \n- `electron`注册了快捷键后，系统默认浏览器无法通过快捷键触发调式工具。  \n- `windows`系统`electron`应用的`F12`按键无效。  \n\n对于`windows`系统`F12`无效问题，`electron`官方貌似也没有一个好的解决方案。一个讨论的[帖子](https://github.com/electron/electron/issues/5066)。  \n\n快捷键覆盖的问题，目前的解决办法如下：  \n监听`blur`和`focus`事件，在`blur`事件下注消快捷键，在`focus`下重新注册监听快捷键。  \n\n```javascript  \n    mainWindow.on('blur', function() {\n        let win = BrowserWindow.getFocusedWindow();\n        if(win) return;\n        globalShortcut.unregisterAll();\n        console.log('blur');\n    });\n\n    mainWindow.on('focus', function() {\n        registerShortcut();\n        console.log('focus');\n    });\n```  \n\n一个`electron`应用可能存在多个窗口，所以在主窗口触发`blur`事件的时候需要判断是不是所有`electron`都失去了焦点。  在这种情况下注消快捷键，以便系统浏览器能正常调式。  \n","slug":"electron-研究笔记","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxo00159co7yyq1hkpi","content":"<p>使用<code>electron</code>有一阵子了，随着项目推进，需要研究的东西也逐渐多起来。总结了以下，问题主要出现在：  </p>\n<ul>\n<li>跨平台兼容性  </li>\n<li>新的功能需求  </li>\n</ul>\n<p>=================</p>\n<h4 id=\"electron-渲染进程模拟浏览器环境\"><a href=\"#electron-渲染进程模拟浏览器环境\" class=\"headerlink\" title=\"electron 渲染进程模拟浏览器环境\"></a><code>electron</code> 渲染进程模拟浏览器环境</h4><p><code>electron</code>渲染进程默认为<code>nodejs</code>环境，在里面你可以调用<code>require</code>引入第三方模块，但有时候我们想要的是一个真实的浏览器环境。<code>electron</code>需要做的配置如下：  </p>\n<pre><code class=\"javascript\">\n<span class=\"keyword\">var</span> mainWindow = <span class=\"keyword\">new</span> BrowserWindow({\n    resizable: <span class=\"literal\">true</span>,\n    width: size.width,\n    height: size.height,\n    title: <span class=\"string\">'HolaStudio'</span>,\n    webPreferences:\n    {\n        nodeIntegration: <span class=\"literal\">false</span>,\n        preload: path.join(__dirname, <span class=\"string\">'tangide'</span>, <span class=\"string\">'expose-window-apis.js'</span>)\n    }\n});\n</code></pre>\n<p>创建<code>BrowserWindow</code>的时候指定<code>nodeIntegration</code>为<code>false</code>。  这样在<code>electron</code>内置浏览器里面不会有<code>module</code>和<code>require</code>全局变量。  </p>\n<p>====================</p>\n<h4 id=\"渲染进程与主进程之间的通信\"><a href=\"#渲染进程与主进程之间的通信\" class=\"headerlink\" title=\"渲染进程与主进程之间的通信\"></a>渲染进程与主进程之间的通信</h4><p><code>electron</code>下主进程与渲染进程之间的通信主要有如下几种方式：  </p>\n<ul>\n<li>使用<code>remote</code>模块  </li>\n<li>使用<code>ipc</code>做进程间通信  </li>\n</ul>\n<p>这里我选择了第二种方式：  </p>\n<pre><code class=\"javascript\">\n<span class=\"comment\">// In main process.</span>\n<span class=\"keyword\">const</span> ipcMain = <span class=\"built_in\">require</span>(<span class=\"string\">'electron'</span>).ipcMain;\nipcMain.on(<span class=\"string\">'asynchronous-message'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event, arg</span>) </span>{\n  <span class=\"built_in\">console</span>.log(arg);  <span class=\"comment\">// prints \"ping\"</span>\n  event.sender.send(<span class=\"string\">'asynchronous-reply'</span>, <span class=\"string\">'pong'</span>);\n});\n\nipcMain.on(<span class=\"string\">'synchronous-message'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event, arg</span>) </span>{\n  <span class=\"built_in\">console</span>.log(arg);  <span class=\"comment\">// prints \"ping\"</span>\n  event.returnValue = <span class=\"string\">'pong'</span>;\n});\n\n<span class=\"comment\">// In renderer process (web page).</span>\n<span class=\"keyword\">const</span> ipcRenderer = <span class=\"built_in\">require</span>(<span class=\"string\">'electron'</span>).ipcRenderer;\n<span class=\"built_in\">console</span>.log(ipcRenderer.sendSync(<span class=\"string\">'synchronous-message'</span>, <span class=\"string\">'ping'</span>)); <span class=\"comment\">// prints \"pong\"</span>\n\nipcRenderer.on(<span class=\"string\">'asynchronous-reply'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event, arg</span>) </span>{\n  <span class=\"built_in\">console</span>.log(arg); <span class=\"comment\">// prints \"pong\"</span>\n});\nipcRenderer.send(<span class=\"string\">'asynchronous-message'</span>, <span class=\"string\">'ping'</span>);\n</code></pre>\n<p>在渲染进程引入模块，都需要用<code>require</code>的方式，但是按照要求，渲染进程必须是一个真实的浏览器环境，所以需要通过其他方式来引入模块包。  </p>\n<pre><code class=\"javascript\">preload: path.join(__dirname, <span class=\"string\">'tangide'</span>, <span class=\"string\">'expose-window-apis.js'</span>)\n</code></pre>\n<p>该配置的作用在于：  </p>\n<blockquote>\n<p>界面的其它脚本运行之前预先加载一个指定脚本. 这个脚本将一直可以使用 node APIs 无论 node integration 是否开启. 脚本路径为绝对路径。  </p>\n</blockquote>\n<p><code>expose-window-apis.js</code>实现如下：  </p>\n<pre><code class=\"javascript\"><span class=\"comment\">//inner process communication</span>\n<span class=\"built_in\">window</span>.ipc = <span class=\"built_in\">require</span>(<span class=\"string\">'electron'</span>).ipcRenderer;\n</code></pre>\n<p>通过这种方式，渲染进程<code>window</code>对应引入了<code>ipc</code>模块，解决了渲染进程引入模块包的问题：）  </p>\n<p>============================</p>\n<h4 id=\"mac系统下快捷键问题\"><a href=\"#mac系统下快捷键问题\" class=\"headerlink\" title=\"mac系统下快捷键问题\"></a>mac系统下快捷键问题</h4><p><code>Mac</code>系统下，默认的快捷键<code>Redo</code>、<code>Undo</code>、复制粘贴等不能使用，阅读了<code>electron</code>发现需要通过创建应用菜单的方式做一个映射。  </p>\n<pre><code class=\"javascript\">\n<span class=\"keyword\">const</span> Menu = <span class=\"built_in\">require</span>(<span class=\"string\">\"menu\"</span>);\n     <span class=\"comment\">// Create the Application's main menu</span>\n    <span class=\"keyword\">let</span> template = [{\n        label: <span class=\"string\">\"Application\"</span>,\n        submenu: [\n            { <span class=\"attr\">label</span>: <span class=\"string\">\"About Application\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"orderFrontStandardAboutPanel:\"</span> },\n            { <span class=\"attr\">type</span>: <span class=\"string\">\"separator\"</span> },\n            { <span class=\"attr\">label</span>: <span class=\"string\">\"Quit\"</span>, <span class=\"attr\">accelerator</span>: <span class=\"string\">\"Command+Q\"</span>, <span class=\"attr\">click</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{ app.quit(); }}\n        ]}, {\n        label: keysBinding[<span class=\"string\">\"Edit\"</span>],\n        submenu: [\n            { <span class=\"attr\">label</span>: keysBinding[<span class=\"string\">\"Undo\"</span>], <span class=\"attr\">accelerator</span>: <span class=\"string\">\"CmdOrCtrl+Z\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"undo:\"</span> },\n            { <span class=\"attr\">label</span>: keysBinding[<span class=\"string\">\"Redo\"</span>], <span class=\"attr\">accelerator</span>: <span class=\"string\">\"Shift+CmdOrCtrl+Z\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"redo:\"</span> },\n            { <span class=\"attr\">type</span>: <span class=\"string\">\"separator\"</span> },\n            { <span class=\"attr\">label</span>: keysBinding[<span class=\"string\">\"Cut\"</span>], <span class=\"attr\">accelerator</span>: <span class=\"string\">\"CmdOrCtrl+X\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"cut:\"</span> },\n            { <span class=\"attr\">label</span>: keysBinding[<span class=\"string\">\"Copy\"</span>], <span class=\"attr\">accelerator</span>: <span class=\"string\">\"CmdOrCtrl+C\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"copy:\"</span> },\n            { <span class=\"attr\">label</span>: keysBinding[<span class=\"string\">\"Paste\"</span>], <span class=\"attr\">accelerator</span>: <span class=\"string\">\"CmdOrCtrl+V\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"paste:\"</span> },\n            { <span class=\"attr\">label</span>: keysBinding[<span class=\"string\">\"Select All\"</span>], <span class=\"attr\">accelerator</span>: <span class=\"string\">\"CmdOrCtrl+A\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"selectAll:\"</span> }\n        ]}\n    ];\n\n<span class=\"comment\">//注册菜单  </span>\nMenu.setApplicationMenu(Menu.buildFromTemplate(template));\n</code></pre>\n<p>=======================</p>\n<h4 id=\"系统快捷键冲突问题\"><a href=\"#系统快捷键冲突问题\" class=\"headerlink\" title=\"系统快捷键冲突问题\"></a>系统快捷键冲突问题</h4><p>开发者最常用到的快捷键一个是<code>F12</code>,打开开发者工具。 <code>F5</code>刷新当前网页：  </p>\n<pre><code class=\"javascript\"><span class=\"keyword\">const</span> globalShortcut = <span class=\"built_in\">require</span>(<span class=\"string\">'global-shortcut'</span>);   \nregisterShortcut();  \n<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">registerShortcut</span>(<span class=\"params\"></span>) </span>{\n    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doRegister</span>(<span class=\"params\">cmd, callback</span>) </span>{\n        globalShortcut.register(cmd, callback);\n    }\n\n    <span class=\"keyword\">let</span> registed = globalShortcut.isRegistered(<span class=\"string\">'F12'</span>);\n    <span class=\"keyword\">if</span>(registed) <span class=\"keyword\">return</span>;\n\n    doRegister(<span class=\"string\">'F12'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n        <span class=\"keyword\">let</span> win = BrowserWindow.getFocusedWindow();\n        <span class=\"keyword\">if</span>(!win) <span class=\"keyword\">return</span>;\n        win.webContents.toggleDevTools();\n        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"toggleDevTools F12\"</span>);\n    });\n\n    doRegister(<span class=\"string\">'F6'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n        <span class=\"keyword\">let</span> win = BrowserWindow.getFocusedWindow();\n        <span class=\"keyword\">if</span>(!win) <span class=\"keyword\">return</span>;\n        win.webContents.toggleDevTools();\n        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"toggleDevTools F6\"</span>);\n    });\n\n    doRegister(<span class=\"string\">'F5'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n        <span class=\"keyword\">let</span> win = BrowserWindow.getFocusedWindow();\n        <span class=\"keyword\">if</span>(!win) <span class=\"keyword\">return</span>;\n        win.reload();\n        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"refresh\"</span>);\n    });\n\n    <span class=\"keyword\">return</span>;\n}\n</code></pre>\n<p>正常情况下通过注册全局快捷键的方式能够满足绝大多数情况下的应用场景，但是使用过程中还是有如下问题：  </p>\n<ul>\n<li><code>electron</code>注册了快捷键后，系统默认浏览器无法通过快捷键触发调式工具。  </li>\n<li><code>windows</code>系统<code>electron</code>应用的<code>F12</code>按键无效。  </li>\n</ul>\n<p>对于<code>windows</code>系统<code>F12</code>无效问题，<code>electron</code>官方貌似也没有一个好的解决方案。一个讨论的<a href=\"https://github.com/electron/electron/issues/5066\" target=\"_blank\" rel=\"noopener\">帖子</a>。  </p>\n<p>快捷键覆盖的问题，目前的解决办法如下：<br>监听<code>blur</code>和<code>focus</code>事件，在<code>blur</code>事件下注消快捷键，在<code>focus</code>下重新注册监听快捷键。  </p>\n<pre><code class=\"javascript\">mainWindow.on(<span class=\"string\">'blur'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n    <span class=\"keyword\">let</span> win = BrowserWindow.getFocusedWindow();\n    <span class=\"keyword\">if</span>(win) <span class=\"keyword\">return</span>;\n    globalShortcut.unregisterAll();\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">'blur'</span>);\n});\n\nmainWindow.on(<span class=\"string\">'focus'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n    registerShortcut();\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">'focus'</span>);\n});\n</code></pre>\n<p>一个<code>electron</code>应用可能存在多个窗口，所以在主窗口触发<code>blur</code>事件的时候需要判断是不是所有<code>electron</code>都失去了焦点。  在这种情况下注消快捷键，以便系统浏览器能正常调式。  </p>\n","site":{"data":{}},"excerpt":"","more":"<p>使用<code>electron</code>有一阵子了，随着项目推进，需要研究的东西也逐渐多起来。总结了以下，问题主要出现在：  </p>\n<ul>\n<li>跨平台兼容性  </li>\n<li>新的功能需求  </li>\n</ul>\n<p>=================</p>\n<h4 id=\"electron-渲染进程模拟浏览器环境\"><a href=\"#electron-渲染进程模拟浏览器环境\" class=\"headerlink\" title=\"electron 渲染进程模拟浏览器环境\"></a><code>electron</code> 渲染进程模拟浏览器环境</h4><p><code>electron</code>渲染进程默认为<code>nodejs</code>环境，在里面你可以调用<code>require</code>引入第三方模块，但有时候我们想要的是一个真实的浏览器环境。<code>electron</code>需要做的配置如下：  </p>\n<pre><code class=\"javascript\">\n<span class=\"keyword\">var</span> mainWindow = <span class=\"keyword\">new</span> BrowserWindow({\n    resizable: <span class=\"literal\">true</span>,\n    width: size.width,\n    height: size.height,\n    title: <span class=\"string\">'HolaStudio'</span>,\n    webPreferences:\n    {\n        nodeIntegration: <span class=\"literal\">false</span>,\n        preload: path.join(__dirname, <span class=\"string\">'tangide'</span>, <span class=\"string\">'expose-window-apis.js'</span>)\n    }\n});\n</code></pre>\n<p>创建<code>BrowserWindow</code>的时候指定<code>nodeIntegration</code>为<code>false</code>。  这样在<code>electron</code>内置浏览器里面不会有<code>module</code>和<code>require</code>全局变量。  </p>\n<p>====================</p>\n<h4 id=\"渲染进程与主进程之间的通信\"><a href=\"#渲染进程与主进程之间的通信\" class=\"headerlink\" title=\"渲染进程与主进程之间的通信\"></a>渲染进程与主进程之间的通信</h4><p><code>electron</code>下主进程与渲染进程之间的通信主要有如下几种方式：  </p>\n<ul>\n<li>使用<code>remote</code>模块  </li>\n<li>使用<code>ipc</code>做进程间通信  </li>\n</ul>\n<p>这里我选择了第二种方式：  </p>\n<pre><code class=\"javascript\">\n<span class=\"comment\">// In main process.</span>\n<span class=\"keyword\">const</span> ipcMain = <span class=\"built_in\">require</span>(<span class=\"string\">'electron'</span>).ipcMain;\nipcMain.on(<span class=\"string\">'asynchronous-message'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event, arg</span>) </span>{\n  <span class=\"built_in\">console</span>.log(arg);  <span class=\"comment\">// prints \"ping\"</span>\n  event.sender.send(<span class=\"string\">'asynchronous-reply'</span>, <span class=\"string\">'pong'</span>);\n});\n\nipcMain.on(<span class=\"string\">'synchronous-message'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event, arg</span>) </span>{\n  <span class=\"built_in\">console</span>.log(arg);  <span class=\"comment\">// prints \"ping\"</span>\n  event.returnValue = <span class=\"string\">'pong'</span>;\n});\n\n<span class=\"comment\">// In renderer process (web page).</span>\n<span class=\"keyword\">const</span> ipcRenderer = <span class=\"built_in\">require</span>(<span class=\"string\">'electron'</span>).ipcRenderer;\n<span class=\"built_in\">console</span>.log(ipcRenderer.sendSync(<span class=\"string\">'synchronous-message'</span>, <span class=\"string\">'ping'</span>)); <span class=\"comment\">// prints \"pong\"</span>\n\nipcRenderer.on(<span class=\"string\">'asynchronous-reply'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event, arg</span>) </span>{\n  <span class=\"built_in\">console</span>.log(arg); <span class=\"comment\">// prints \"pong\"</span>\n});\nipcRenderer.send(<span class=\"string\">'asynchronous-message'</span>, <span class=\"string\">'ping'</span>);\n</code></pre>\n<p>在渲染进程引入模块，都需要用<code>require</code>的方式，但是按照要求，渲染进程必须是一个真实的浏览器环境，所以需要通过其他方式来引入模块包。  </p>\n<pre><code class=\"javascript\">preload: path.join(__dirname, <span class=\"string\">'tangide'</span>, <span class=\"string\">'expose-window-apis.js'</span>)\n</code></pre>\n<p>该配置的作用在于：  </p>\n<blockquote>\n<p>界面的其它脚本运行之前预先加载一个指定脚本. 这个脚本将一直可以使用 node APIs 无论 node integration 是否开启. 脚本路径为绝对路径。  </p>\n</blockquote>\n<p><code>expose-window-apis.js</code>实现如下：  </p>\n<pre><code class=\"javascript\"><span class=\"comment\">//inner process communication</span>\n<span class=\"built_in\">window</span>.ipc = <span class=\"built_in\">require</span>(<span class=\"string\">'electron'</span>).ipcRenderer;\n</code></pre>\n<p>通过这种方式，渲染进程<code>window</code>对应引入了<code>ipc</code>模块，解决了渲染进程引入模块包的问题：）  </p>\n<p>============================</p>\n<h4 id=\"mac系统下快捷键问题\"><a href=\"#mac系统下快捷键问题\" class=\"headerlink\" title=\"mac系统下快捷键问题\"></a>mac系统下快捷键问题</h4><p><code>Mac</code>系统下，默认的快捷键<code>Redo</code>、<code>Undo</code>、复制粘贴等不能使用，阅读了<code>electron</code>发现需要通过创建应用菜单的方式做一个映射。  </p>\n<pre><code class=\"javascript\">\n<span class=\"keyword\">const</span> Menu = <span class=\"built_in\">require</span>(<span class=\"string\">\"menu\"</span>);\n     <span class=\"comment\">// Create the Application's main menu</span>\n    <span class=\"keyword\">let</span> template = [{\n        label: <span class=\"string\">\"Application\"</span>,\n        submenu: [\n            { <span class=\"attr\">label</span>: <span class=\"string\">\"About Application\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"orderFrontStandardAboutPanel:\"</span> },\n            { <span class=\"attr\">type</span>: <span class=\"string\">\"separator\"</span> },\n            { <span class=\"attr\">label</span>: <span class=\"string\">\"Quit\"</span>, <span class=\"attr\">accelerator</span>: <span class=\"string\">\"Command+Q\"</span>, <span class=\"attr\">click</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{ app.quit(); }}\n        ]}, {\n        label: keysBinding[<span class=\"string\">\"Edit\"</span>],\n        submenu: [\n            { <span class=\"attr\">label</span>: keysBinding[<span class=\"string\">\"Undo\"</span>], <span class=\"attr\">accelerator</span>: <span class=\"string\">\"CmdOrCtrl+Z\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"undo:\"</span> },\n            { <span class=\"attr\">label</span>: keysBinding[<span class=\"string\">\"Redo\"</span>], <span class=\"attr\">accelerator</span>: <span class=\"string\">\"Shift+CmdOrCtrl+Z\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"redo:\"</span> },\n            { <span class=\"attr\">type</span>: <span class=\"string\">\"separator\"</span> },\n            { <span class=\"attr\">label</span>: keysBinding[<span class=\"string\">\"Cut\"</span>], <span class=\"attr\">accelerator</span>: <span class=\"string\">\"CmdOrCtrl+X\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"cut:\"</span> },\n            { <span class=\"attr\">label</span>: keysBinding[<span class=\"string\">\"Copy\"</span>], <span class=\"attr\">accelerator</span>: <span class=\"string\">\"CmdOrCtrl+C\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"copy:\"</span> },\n            { <span class=\"attr\">label</span>: keysBinding[<span class=\"string\">\"Paste\"</span>], <span class=\"attr\">accelerator</span>: <span class=\"string\">\"CmdOrCtrl+V\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"paste:\"</span> },\n            { <span class=\"attr\">label</span>: keysBinding[<span class=\"string\">\"Select All\"</span>], <span class=\"attr\">accelerator</span>: <span class=\"string\">\"CmdOrCtrl+A\"</span>, <span class=\"attr\">selector</span>: <span class=\"string\">\"selectAll:\"</span> }\n        ]}\n    ];\n\n<span class=\"comment\">//注册菜单  </span>\nMenu.setApplicationMenu(Menu.buildFromTemplate(template));\n</code></pre>\n<p>=======================</p>\n<h4 id=\"系统快捷键冲突问题\"><a href=\"#系统快捷键冲突问题\" class=\"headerlink\" title=\"系统快捷键冲突问题\"></a>系统快捷键冲突问题</h4><p>开发者最常用到的快捷键一个是<code>F12</code>,打开开发者工具。 <code>F5</code>刷新当前网页：  </p>\n<pre><code class=\"javascript\"><span class=\"keyword\">const</span> globalShortcut = <span class=\"built_in\">require</span>(<span class=\"string\">'global-shortcut'</span>);   \nregisterShortcut();  \n<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">registerShortcut</span>(<span class=\"params\"></span>) </span>{\n    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doRegister</span>(<span class=\"params\">cmd, callback</span>) </span>{\n        globalShortcut.register(cmd, callback);\n    }\n\n    <span class=\"keyword\">let</span> registed = globalShortcut.isRegistered(<span class=\"string\">'F12'</span>);\n    <span class=\"keyword\">if</span>(registed) <span class=\"keyword\">return</span>;\n\n    doRegister(<span class=\"string\">'F12'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n        <span class=\"keyword\">let</span> win = BrowserWindow.getFocusedWindow();\n        <span class=\"keyword\">if</span>(!win) <span class=\"keyword\">return</span>;\n        win.webContents.toggleDevTools();\n        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"toggleDevTools F12\"</span>);\n    });\n\n    doRegister(<span class=\"string\">'F6'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n        <span class=\"keyword\">let</span> win = BrowserWindow.getFocusedWindow();\n        <span class=\"keyword\">if</span>(!win) <span class=\"keyword\">return</span>;\n        win.webContents.toggleDevTools();\n        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"toggleDevTools F6\"</span>);\n    });\n\n    doRegister(<span class=\"string\">'F5'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n        <span class=\"keyword\">let</span> win = BrowserWindow.getFocusedWindow();\n        <span class=\"keyword\">if</span>(!win) <span class=\"keyword\">return</span>;\n        win.reload();\n        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"refresh\"</span>);\n    });\n\n    <span class=\"keyword\">return</span>;\n}\n</code></pre>\n<p>正常情况下通过注册全局快捷键的方式能够满足绝大多数情况下的应用场景，但是使用过程中还是有如下问题：  </p>\n<ul>\n<li><code>electron</code>注册了快捷键后，系统默认浏览器无法通过快捷键触发调式工具。  </li>\n<li><code>windows</code>系统<code>electron</code>应用的<code>F12</code>按键无效。  </li>\n</ul>\n<p>对于<code>windows</code>系统<code>F12</code>无效问题，<code>electron</code>官方貌似也没有一个好的解决方案。一个讨论的<a href=\"https://github.com/electron/electron/issues/5066\" target=\"_blank\" rel=\"noopener\">帖子</a>。  </p>\n<p>快捷键覆盖的问题，目前的解决办法如下：<br>监听<code>blur</code>和<code>focus</code>事件，在<code>blur</code>事件下注消快捷键，在<code>focus</code>下重新注册监听快捷键。  </p>\n<pre><code class=\"javascript\">mainWindow.on(<span class=\"string\">'blur'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n    <span class=\"keyword\">let</span> win = BrowserWindow.getFocusedWindow();\n    <span class=\"keyword\">if</span>(win) <span class=\"keyword\">return</span>;\n    globalShortcut.unregisterAll();\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">'blur'</span>);\n});\n\nmainWindow.on(<span class=\"string\">'focus'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n    registerShortcut();\n    <span class=\"built_in\">console</span>.log(<span class=\"string\">'focus'</span>);\n});\n</code></pre>\n<p>一个<code>electron</code>应用可能存在多个窗口，所以在主窗口触发<code>blur</code>事件的时候需要判断是不是所有<code>electron</code>都失去了焦点。  在这种情况下注消快捷键，以便系统浏览器能正常调式。  </p>\n"},{"title":"electron-打包web应用","_content":"时下流行的web app打包工具主要有两个，一个是国内开发者主导的`nw.js`，另一个是国外大厂支撑的`electron`。对比了`nw.js`以及`electron`之后还是选择了`electron`，原因主要有以下几点：\n\n+ 1、基于该工具已有广泛被使用的产品，如：`atom`、`vs code`等。\n+ 2、在开发者中口碑比较好，有大公司参与进来，遇到问题，提个`issue`能很快得到响应。\n\n下载基于`electron`打包的[HolaStudio](http://cdn.studio.holaverse.cn/dist/)。   \n\n---  \n\n### 使用`webpack`编译项目   \n\n`HolaStudio`离线版本打包的时候需要把服务器、客户端打包到一个安装包内。所以第一步首先要把服务器代码混淆，为接下来打包做准备。  \n\n构建工具选择了`webpack`, 关于构建工具没有做很细致的筛选，因为我都不熟悉：）。所以就听从朋友建议，选择了入了`webpack`的坑。  \n\n关于`webpack`的使用，官方有详细的文档说明,`github`自行搜索。\n\n`webpack`需要一个配置文件(`webpack.config.js`)，用来描述项目的环境，以及第三方插件的集成等信息：\n\n```javascript\n\nvar webpack = require('webpack');\nvar path = require('path');\nvar fs = require('fs-extra');\nvar packageJSON = fs.readJsonSync('./package.json');\n\nvar nodeModules = {};\nfs.readdirSync('./node_modules')\n  .filter(function(x) {\n    return ['.bin', '.npminstall'].indexOf(x) === -1;\n  })\n  .filter(function(y) {\n    return !(y in packageJSON.devDependencies);\n  })\n  .forEach(function(mod) {\n\tnodeModules[mod] = 'commonjs ' + mod;\n});\n\nmodule.exports = {\n    entry: './app.js',\n    target: 'node',\n    context: __dirname,\n    node: {\n        __dirname: false,\n        __filename: false\n    },  \n    output: {\n        path: path.join(__dirname, 'output'),\n        filename: 'output.js',\n        externals: nodeModules,\n    },\n    externals: nodeModules,\n    plugins: [\n        new webpack.optimize.UglifyJsPlugin({compress: {warnings: false}}),\n        new webpack.IgnorePlugin(/\\.(css|less)$/)\n    ]\n}\n\n```  \n简要的说明：  \n- entry: 指定项目的入口文件，即启动`node`服务指定的文件  \n- target: 指定当前的编译环境为`node`, 其他选择有`web`、`webworker`等    \n- context: 指定一个路径找到`entry`文件  \n- node: 用于指定一些`nodejs`环境配置  __dirname=false 表示启用__dirname 变量(默认为'/'), __filename=false 表示启用__filename 变量(默认为'/index.js')。  \n- output: 指定编译输出文件及目录  \n- externals: 指定外部依赖库文件  \n- plugins: `webpack`插件集成，这里主要用到了一个混淆插件  \n\n运行 `webpack .` 会在当前目录下的`output` 文件夹得到编译输出文件。\n\n---   \n### 安装`electron`以及相关工具  \n\n- 运行命令`npm i -g electron-prebuilt` 安装`electron`。\n\n简要说说关于`electron`的设计理念：\n\n`electron`打包的应用分为主进程和渲染进程，渲染进程使用`Chromium`来展示页面，主进程以类似创建窗口的方式创建网页。主进程具备调用系统相关服务的功能，主进程和渲染进程之间以`进程间通信`的方式交互。  更详细的`electron`[说明文档](https://github.com/electron/electron/blob/master/docs-translations/zh-CN/).  \n\n*在打包`HolaStudio`的过程中，选择把`node`服务端代码放在主进程，编辑器放在一个渲染进程。*    \n\n`electron`项目的构建目录结构：  \n![图1](http://7xsec6.com1.z0.glb.clouddn.com/electron-release.png)  \n\n在该目录下运行`electron .`即可调式`electron`应用。  \n\n所以在启动`electron`应用的过程中，需要启动`node`后台的同时创建一个渲染窗口显示编辑器。  \n\n```javascript\n\n//处理windows 应用安装以及更新时刻的默认事件  \nif(require('electron-squirrel-startup')) return;\n\nvar app = require('app');\nvar path = require('path');\nvar electron = require('electron');\nvar BrowserWindow = require('browser-window');\nvar globalShortcut = require('global-shortcut');\n\nvar mainWindow = null;\nvar webContents = null;\n\n//所有窗口被关闭\napp.on('window-all-closed', function() {\n  // 在 OS X 上，通常用户在明确地按下 Cmd + Q 之前\n  // 应用会保持活动状态\n    if(process.platform != 'darwin') {\n        app.quit();\n    }\n});\n\n//当前应用准备退出\napp.on('will-quit', function() {\n    globalShortcut.unregisterAll();\n});\n\n// 当 Electron 完成了初始化并且准备创建浏览器窗口的时候\napp.on('ready', function() {\n    global.mainProcess = app;\n    require('./hola_studio.js');\n    registerShortcut();\n});\n\n//hola_studio 服务器发出`done`事件后，准备渲染编辑器界面\napp.on('done', function(url) {\n    var electronScreen = electron.screen;\n    var size = electronScreen.getPrimaryDisplay().workAreaSize;\n    mainWindow = new BrowserWindow({resizable: true, width: size.width, height: size.height,\n        title: 'HolaStudio'});\n    mainWindow.loadURL(url);\n    webContents = mainWindow.webContents;\n    mainWindow.on('closed', function() {\n        mainWindow = null;\n        webContents = null;\n    });\n});\n\n//注册快捷键用于打开开发者工具以及刷新当前页面\nfunction registerShortcut() {\n    function doRegister(cmd, callback) {\n        globalShortcut.register(cmd, callback);\n    }\n\n    doRegister('F12', function() {\n        var win = BrowserWindow.getFocusedWindow();\n        win.webContents.toggleDevTools();\n        console.log(\"toggleDevTools F12\");\n    });\n\n    //windows 平台下`F12`按键按下收不到消息(貌似还没有解决方案)，所以写了一个替代按键\n    doRegister('F6', function() {\n        var win = BrowserWindow.getFocusedWindow();\n        win.webContents.toggleDevTools();\n        console.log(\"toggleDevTools F6\");\n    });\n\n    doRegister('F5', function() {\n        var win = BrowserWindow.getFocusedWindow();\n        win.reload();\n        console.log(\"refresh\");\n    });\n\n    return;\n}\n\n```\n如果之前有做过`MFC`、`QT`类GUI的开发，对`electron`这样的工作流程一定非常熟悉。  \n\n---  \n\n### 安装`electron-builder`工具来编译安装包   \n\n`electron-builder`把几个不同平台的安装包编译工具集成到一起，得到一个统一的接口，方便使用。  \n\n`electron-builder` 建议把构建目录分为两层，上面一层主要管理编译工具、构建所需的资源以及构建的输出，称之为dev 目录。下面一层则为以`electron`为入口的工程目录，称之为app 目录。  \n\n`dev`目录预览：\n\n![图3](http://7xsec6.com1.z0.glb.clouddn.com/electron-builder.png)\n\n`app`目录预览：  \n![图4](http://7xsec6.com1.z0.glb.clouddn.com/electron-release.png)\n\n需要做的工作很简单：\n- 安装构建工具(electron、electron-prebuilder)  \n- 修改dev目录下`package.json`指定编译脚本  \n- 修改app目录下`package.json`指定编译选项  \n- 运行脚本编译安装包  \n\ndev 目录下`package.json`预览:  \n\n``` javascript  \n{\n  \"name\": \"HolaStudio\",\n  \"version\": \"0.0.1\",\n  \"homepage\": \"http://studio.holaverse.cn\",\n  \"description\": \"HolaStudio Release Version.\",\n  \"scripts\": {\n    \"dist\": \"npm run dist:linux && npm run dist:win\",\n    \"dist:osx\": \"build --platform darwin --arch all -d\",\n    \"dist:win\": \"build --platform win32 --arch all -d\",\n    \"dist:linux\": \"build --platform linux --arch all -d\"\n  },\n  \"keywords\": [\n    \"HolaStudio\"\n  ],\n  \"author\": \"holaverse Tech Inc.\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"electron-builder\": \"^2.11.0\",\n    \"electron-prebuilt\": \"^0.37.2\"\n  },\n  \"build\": {\n    \"osx\": {\n      \"title\": \"HolaStudio\",\n      \"background\": \"build/background.png\",\n      \"icon\": \"build/icon.icns\",\n      \"icon-size\": 128,\n      \"contents\": [\n        {\n          \"x\": 355,\n          \"y\": 125,\n          \"type\": \"link\",\n          \"path\": \"/Applications\"\n        },\n        {\n          \"x\": 155,\n          \"y\": 125,\n          \"type\": \"file\"\n        }\n      ]\n    }\n  }\n}\n\n```  \n\n- `scripts`字段指定`npm`编译不同平台的运行脚本。  \n- `build`指定编译时载入的资源配置  \n\napp 目录下`package.json`增加编译时配置选项(最新版本`electron-builder`已经把它提出到`dev`目录下的`package.json`)  \n  ```javascript  \n\"build\": {\n    \"asar\": false,\n    \"iconUrl\": \"http://7xsec6.com1.z0.glb.clouddn.com/icon.ico\",\n    \"app-bundle-id\": \"holaverse.studio\",\n    \"app-category-type\": \"public.app-category.productivity\"\n  },\n```  \n- asar告诉打包工具，不要压缩资源文件，因为在`HolaStudio`运行过程中，需要频繁改动项目路径下文件。  \n- iconUrl指定windows安装包`icon url`  \n- app-bundle-id/public.app-category.productivity,mac平台下编译选项  \n\n更详细的配置文档[请看这里](https://github.com/electron-userland/electron-builder/blob/master/docs/options.md)。  \n\n\n成功打包了各种平台的安装包后，后续需要做的是阅读`electron`文档，在有新需求的时候能够很快的处理掉。  \n","source":"_posts/electron-打包web应用.md","raw":"---\ntitle: electron-打包web应用\ncategories: web\n---\n时下流行的web app打包工具主要有两个，一个是国内开发者主导的`nw.js`，另一个是国外大厂支撑的`electron`。对比了`nw.js`以及`electron`之后还是选择了`electron`，原因主要有以下几点：\n\n+ 1、基于该工具已有广泛被使用的产品，如：`atom`、`vs code`等。\n+ 2、在开发者中口碑比较好，有大公司参与进来，遇到问题，提个`issue`能很快得到响应。\n\n下载基于`electron`打包的[HolaStudio](http://cdn.studio.holaverse.cn/dist/)。   \n\n---  \n\n### 使用`webpack`编译项目   \n\n`HolaStudio`离线版本打包的时候需要把服务器、客户端打包到一个安装包内。所以第一步首先要把服务器代码混淆，为接下来打包做准备。  \n\n构建工具选择了`webpack`, 关于构建工具没有做很细致的筛选，因为我都不熟悉：）。所以就听从朋友建议，选择了入了`webpack`的坑。  \n\n关于`webpack`的使用，官方有详细的文档说明,`github`自行搜索。\n\n`webpack`需要一个配置文件(`webpack.config.js`)，用来描述项目的环境，以及第三方插件的集成等信息：\n\n```javascript\n\nvar webpack = require('webpack');\nvar path = require('path');\nvar fs = require('fs-extra');\nvar packageJSON = fs.readJsonSync('./package.json');\n\nvar nodeModules = {};\nfs.readdirSync('./node_modules')\n  .filter(function(x) {\n    return ['.bin', '.npminstall'].indexOf(x) === -1;\n  })\n  .filter(function(y) {\n    return !(y in packageJSON.devDependencies);\n  })\n  .forEach(function(mod) {\n\tnodeModules[mod] = 'commonjs ' + mod;\n});\n\nmodule.exports = {\n    entry: './app.js',\n    target: 'node',\n    context: __dirname,\n    node: {\n        __dirname: false,\n        __filename: false\n    },  \n    output: {\n        path: path.join(__dirname, 'output'),\n        filename: 'output.js',\n        externals: nodeModules,\n    },\n    externals: nodeModules,\n    plugins: [\n        new webpack.optimize.UglifyJsPlugin({compress: {warnings: false}}),\n        new webpack.IgnorePlugin(/\\.(css|less)$/)\n    ]\n}\n\n```  \n简要的说明：  \n- entry: 指定项目的入口文件，即启动`node`服务指定的文件  \n- target: 指定当前的编译环境为`node`, 其他选择有`web`、`webworker`等    \n- context: 指定一个路径找到`entry`文件  \n- node: 用于指定一些`nodejs`环境配置  __dirname=false 表示启用__dirname 变量(默认为'/'), __filename=false 表示启用__filename 变量(默认为'/index.js')。  \n- output: 指定编译输出文件及目录  \n- externals: 指定外部依赖库文件  \n- plugins: `webpack`插件集成，这里主要用到了一个混淆插件  \n\n运行 `webpack .` 会在当前目录下的`output` 文件夹得到编译输出文件。\n\n---   \n### 安装`electron`以及相关工具  \n\n- 运行命令`npm i -g electron-prebuilt` 安装`electron`。\n\n简要说说关于`electron`的设计理念：\n\n`electron`打包的应用分为主进程和渲染进程，渲染进程使用`Chromium`来展示页面，主进程以类似创建窗口的方式创建网页。主进程具备调用系统相关服务的功能，主进程和渲染进程之间以`进程间通信`的方式交互。  更详细的`electron`[说明文档](https://github.com/electron/electron/blob/master/docs-translations/zh-CN/).  \n\n*在打包`HolaStudio`的过程中，选择把`node`服务端代码放在主进程，编辑器放在一个渲染进程。*    \n\n`electron`项目的构建目录结构：  \n![图1](http://7xsec6.com1.z0.glb.clouddn.com/electron-release.png)  \n\n在该目录下运行`electron .`即可调式`electron`应用。  \n\n所以在启动`electron`应用的过程中，需要启动`node`后台的同时创建一个渲染窗口显示编辑器。  \n\n```javascript\n\n//处理windows 应用安装以及更新时刻的默认事件  \nif(require('electron-squirrel-startup')) return;\n\nvar app = require('app');\nvar path = require('path');\nvar electron = require('electron');\nvar BrowserWindow = require('browser-window');\nvar globalShortcut = require('global-shortcut');\n\nvar mainWindow = null;\nvar webContents = null;\n\n//所有窗口被关闭\napp.on('window-all-closed', function() {\n  // 在 OS X 上，通常用户在明确地按下 Cmd + Q 之前\n  // 应用会保持活动状态\n    if(process.platform != 'darwin') {\n        app.quit();\n    }\n});\n\n//当前应用准备退出\napp.on('will-quit', function() {\n    globalShortcut.unregisterAll();\n});\n\n// 当 Electron 完成了初始化并且准备创建浏览器窗口的时候\napp.on('ready', function() {\n    global.mainProcess = app;\n    require('./hola_studio.js');\n    registerShortcut();\n});\n\n//hola_studio 服务器发出`done`事件后，准备渲染编辑器界面\napp.on('done', function(url) {\n    var electronScreen = electron.screen;\n    var size = electronScreen.getPrimaryDisplay().workAreaSize;\n    mainWindow = new BrowserWindow({resizable: true, width: size.width, height: size.height,\n        title: 'HolaStudio'});\n    mainWindow.loadURL(url);\n    webContents = mainWindow.webContents;\n    mainWindow.on('closed', function() {\n        mainWindow = null;\n        webContents = null;\n    });\n});\n\n//注册快捷键用于打开开发者工具以及刷新当前页面\nfunction registerShortcut() {\n    function doRegister(cmd, callback) {\n        globalShortcut.register(cmd, callback);\n    }\n\n    doRegister('F12', function() {\n        var win = BrowserWindow.getFocusedWindow();\n        win.webContents.toggleDevTools();\n        console.log(\"toggleDevTools F12\");\n    });\n\n    //windows 平台下`F12`按键按下收不到消息(貌似还没有解决方案)，所以写了一个替代按键\n    doRegister('F6', function() {\n        var win = BrowserWindow.getFocusedWindow();\n        win.webContents.toggleDevTools();\n        console.log(\"toggleDevTools F6\");\n    });\n\n    doRegister('F5', function() {\n        var win = BrowserWindow.getFocusedWindow();\n        win.reload();\n        console.log(\"refresh\");\n    });\n\n    return;\n}\n\n```\n如果之前有做过`MFC`、`QT`类GUI的开发，对`electron`这样的工作流程一定非常熟悉。  \n\n---  \n\n### 安装`electron-builder`工具来编译安装包   \n\n`electron-builder`把几个不同平台的安装包编译工具集成到一起，得到一个统一的接口，方便使用。  \n\n`electron-builder` 建议把构建目录分为两层，上面一层主要管理编译工具、构建所需的资源以及构建的输出，称之为dev 目录。下面一层则为以`electron`为入口的工程目录，称之为app 目录。  \n\n`dev`目录预览：\n\n![图3](http://7xsec6.com1.z0.glb.clouddn.com/electron-builder.png)\n\n`app`目录预览：  \n![图4](http://7xsec6.com1.z0.glb.clouddn.com/electron-release.png)\n\n需要做的工作很简单：\n- 安装构建工具(electron、electron-prebuilder)  \n- 修改dev目录下`package.json`指定编译脚本  \n- 修改app目录下`package.json`指定编译选项  \n- 运行脚本编译安装包  \n\ndev 目录下`package.json`预览:  \n\n``` javascript  \n{\n  \"name\": \"HolaStudio\",\n  \"version\": \"0.0.1\",\n  \"homepage\": \"http://studio.holaverse.cn\",\n  \"description\": \"HolaStudio Release Version.\",\n  \"scripts\": {\n    \"dist\": \"npm run dist:linux && npm run dist:win\",\n    \"dist:osx\": \"build --platform darwin --arch all -d\",\n    \"dist:win\": \"build --platform win32 --arch all -d\",\n    \"dist:linux\": \"build --platform linux --arch all -d\"\n  },\n  \"keywords\": [\n    \"HolaStudio\"\n  ],\n  \"author\": \"holaverse Tech Inc.\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"electron-builder\": \"^2.11.0\",\n    \"electron-prebuilt\": \"^0.37.2\"\n  },\n  \"build\": {\n    \"osx\": {\n      \"title\": \"HolaStudio\",\n      \"background\": \"build/background.png\",\n      \"icon\": \"build/icon.icns\",\n      \"icon-size\": 128,\n      \"contents\": [\n        {\n          \"x\": 355,\n          \"y\": 125,\n          \"type\": \"link\",\n          \"path\": \"/Applications\"\n        },\n        {\n          \"x\": 155,\n          \"y\": 125,\n          \"type\": \"file\"\n        }\n      ]\n    }\n  }\n}\n\n```  \n\n- `scripts`字段指定`npm`编译不同平台的运行脚本。  \n- `build`指定编译时载入的资源配置  \n\napp 目录下`package.json`增加编译时配置选项(最新版本`electron-builder`已经把它提出到`dev`目录下的`package.json`)  \n  ```javascript  \n\"build\": {\n    \"asar\": false,\n    \"iconUrl\": \"http://7xsec6.com1.z0.glb.clouddn.com/icon.ico\",\n    \"app-bundle-id\": \"holaverse.studio\",\n    \"app-category-type\": \"public.app-category.productivity\"\n  },\n```  \n- asar告诉打包工具，不要压缩资源文件，因为在`HolaStudio`运行过程中，需要频繁改动项目路径下文件。  \n- iconUrl指定windows安装包`icon url`  \n- app-bundle-id/public.app-category.productivity,mac平台下编译选项  \n\n更详细的配置文档[请看这里](https://github.com/electron-userland/electron-builder/blob/master/docs/options.md)。  \n\n\n成功打包了各种平台的安装包后，后续需要做的是阅读`electron`文档，在有新需求的时候能够很快的处理掉。  \n","slug":"electron-打包web应用","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxq00199co7pcs5kjeo","content":"<p>时下流行的web app打包工具主要有两个，一个是国内开发者主导的<code>nw.js</code>，另一个是国外大厂支撑的<code>electron</code>。对比了<code>nw.js</code>以及<code>electron</code>之后还是选择了<code>electron</code>，原因主要有以下几点：</p>\n<ul>\n<li>1、基于该工具已有广泛被使用的产品，如：<code>atom</code>、<code>vs code</code>等。</li>\n<li>2、在开发者中口碑比较好，有大公司参与进来，遇到问题，提个<code>issue</code>能很快得到响应。</li>\n</ul>\n<p>下载基于<code>electron</code>打包的<a href=\"http://cdn.studio.holaverse.cn/dist/\" target=\"_blank\" rel=\"noopener\">HolaStudio</a>。   </p>\n<hr>\n<h3 id=\"使用webpack编译项目\"><a href=\"#使用webpack编译项目\" class=\"headerlink\" title=\"使用webpack编译项目\"></a>使用<code>webpack</code>编译项目</h3><p><code>HolaStudio</code>离线版本打包的时候需要把服务器、客户端打包到一个安装包内。所以第一步首先要把服务器代码混淆，为接下来打包做准备。  </p>\n<p>构建工具选择了<code>webpack</code>, 关于构建工具没有做很细致的筛选，因为我都不熟悉：）。所以就听从朋友建议，选择了入了<code>webpack</code>的坑。  </p>\n<p>关于<code>webpack</code>的使用，官方有详细的文档说明,<code>github</code>自行搜索。</p>\n<p><code>webpack</code>需要一个配置文件(<code>webpack.config.js</code>)，用来描述项目的环境，以及第三方插件的集成等信息：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs-extra'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> packageJSON = fs.readJsonSync(<span class=\"string\">'./package.json'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> nodeModules = &#123;&#125;;</span><br><span class=\"line\">fs.readdirSync(<span class=\"string\">'./node_modules'</span>)</span><br><span class=\"line\">  .filter(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"string\">'.bin'</span>, <span class=\"string\">'.npminstall'</span>].indexOf(x) === <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .filter(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> !(y <span class=\"keyword\">in</span> packageJSON.devDependencies);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">mod</span>) </span>&#123;</span><br><span class=\"line\">\tnodeModules[mod] = <span class=\"string\">'commonjs '</span> + mod;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    entry: <span class=\"string\">'./app.js'</span>,</span><br><span class=\"line\">    target: <span class=\"string\">'node'</span>,</span><br><span class=\"line\">    context: __dirname,</span><br><span class=\"line\">    node: &#123;</span><br><span class=\"line\">        __dirname: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        __filename: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;,  </span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        path: path.join(__dirname, <span class=\"string\">'output'</span>),</span><br><span class=\"line\">        filename: <span class=\"string\">'output.js'</span>,</span><br><span class=\"line\">        externals: nodeModules,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    externals: nodeModules,</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        <span class=\"keyword\">new</span> webpack.optimize.UglifyJsPlugin(&#123;<span class=\"attr\">compress</span>: &#123;<span class=\"attr\">warnings</span>: <span class=\"literal\">false</span>&#125;&#125;),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> webpack.IgnorePlugin(<span class=\"regexp\">/\\.(css|less)$/</span>)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">简要的说明：  </span></span><br><span class=\"line\"><span class=\"string\">- entry: 指定项目的入口文件，即启动`</span>node<span class=\"string\">`服务指定的文件  </span></span><br><span class=\"line\"><span class=\"string\">- target: 指定当前的编译环境为`</span>node<span class=\"string\">`, 其他选择有`</span>web<span class=\"string\">`、`</span>webworker<span class=\"string\">`等    </span></span><br><span class=\"line\"><span class=\"string\">- context: 指定一个路径找到`</span>entry<span class=\"string\">`文件  </span></span><br><span class=\"line\"><span class=\"string\">- node: 用于指定一些`</span>nodejs<span class=\"string\">`环境配置  __dirname=false 表示启用__dirname 变量(默认为'/'), __filename=false 表示启用__filename 变量(默认为'/index.js')。  </span></span><br><span class=\"line\"><span class=\"string\">- output: 指定编译输出文件及目录  </span></span><br><span class=\"line\"><span class=\"string\">- externals: 指定外部依赖库文件  </span></span><br><span class=\"line\"><span class=\"string\">- plugins: `</span>webpack<span class=\"string\">`插件集成，这里主要用到了一个混淆插件  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">运行 `</span>webpack .<span class=\"string\">` 会在当前目录下的`</span>output<span class=\"string\">` 文件夹得到编译输出文件。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">---   </span></span><br><span class=\"line\"><span class=\"string\">### 安装`</span>electron<span class=\"string\">`以及相关工具  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">- 运行命令`</span>npm i -g electron-prebuilt<span class=\"string\">` 安装`</span>electron<span class=\"string\">`。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">简要说说关于`</span>electron<span class=\"string\">`的设计理念：</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span>electron<span class=\"string\">`打包的应用分为主进程和渲染进程，渲染进程使用`</span>Chromium<span class=\"string\">`来展示页面，主进程以类似创建窗口的方式创建网页。主进程具备调用系统相关服务的功能，主进程和渲染进程之间以`</span>进程间通信<span class=\"string\">`的方式交互。  更详细的`</span>electron<span class=\"string\">`[说明文档](https://github.com/electron/electron/blob/master/docs-translations/zh-CN/).  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">*在打包`</span>HolaStudio<span class=\"string\">`的过程中，选择把`</span>node<span class=\"string\">`服务端代码放在主进程，编辑器放在一个渲染进程。*    </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span>electron<span class=\"string\">`项目的构建目录结构：  </span></span><br><span class=\"line\"><span class=\"string\">![图1](http://7xsec6.com1.z0.glb.clouddn.com/electron-release.png)  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">在该目录下运行`</span>electron .<span class=\"string\">`即可调式`</span>electron<span class=\"string\">`应用。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">所以在启动`</span>electron<span class=\"string\">`应用的过程中，需要启动`</span>node<span class=\"string\">`后台的同时创建一个渲染窗口显示编辑器。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//处理windows 应用安装以及更新时刻的默认事件  </span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>(<span class=\"string\">'electron-squirrel-startup'</span>)) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"built_in\">require</span>(<span class=\"string\">'app'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> electron = <span class=\"built_in\">require</span>(<span class=\"string\">'electron'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> BrowserWindow = <span class=\"built_in\">require</span>(<span class=\"string\">'browser-window'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> globalShortcut = <span class=\"built_in\">require</span>(<span class=\"string\">'global-shortcut'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> mainWindow = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> webContents = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//所有窗口被关闭</span></span><br><span class=\"line\">app.on(<span class=\"string\">'window-all-closed'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 在 OS X 上，通常用户在明确地按下 Cmd + Q 之前</span></span><br><span class=\"line\">  <span class=\"comment\">// 应用会保持活动状态</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(process.platform != <span class=\"string\">'darwin'</span>) &#123;</span><br><span class=\"line\">        app.quit();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//当前应用准备退出</span></span><br><span class=\"line\">app.on(<span class=\"string\">'will-quit'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    globalShortcut.unregisterAll();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 当 Electron 完成了初始化并且准备创建浏览器窗口的时候</span></span><br><span class=\"line\">app.on(<span class=\"string\">'ready'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    global.mainProcess = app;</span><br><span class=\"line\">    <span class=\"built_in\">require</span>(<span class=\"string\">'./hola_studio.js'</span>);</span><br><span class=\"line\">    registerShortcut();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//hola_studio 服务器发出`done`事件后，准备渲染编辑器界面</span></span><br><span class=\"line\">app.on(<span class=\"string\">'done'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> electronScreen = electron.screen;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> size = electronScreen.getPrimaryDisplay().workAreaSize;</span><br><span class=\"line\">    mainWindow = <span class=\"keyword\">new</span> BrowserWindow(&#123;<span class=\"attr\">resizable</span>: <span class=\"literal\">true</span>, <span class=\"attr\">width</span>: size.width, <span class=\"attr\">height</span>: size.height,</span><br><span class=\"line\">        title: <span class=\"string\">'HolaStudio'</span>&#125;);</span><br><span class=\"line\">    mainWindow.loadURL(url);</span><br><span class=\"line\">    webContents = mainWindow.webContents;</span><br><span class=\"line\">    mainWindow.on(<span class=\"string\">'closed'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        mainWindow = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        webContents = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//注册快捷键用于打开开发者工具以及刷新当前页面</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">registerShortcut</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doRegister</span>(<span class=\"params\">cmd, callback</span>) </span>&#123;</span><br><span class=\"line\">        globalShortcut.register(cmd, callback);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    doRegister(<span class=\"string\">'F12'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> win = BrowserWindow.getFocusedWindow();</span><br><span class=\"line\">        win.webContents.toggleDevTools();</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"toggleDevTools F12\"</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//windows 平台下`F12`按键按下收不到消息(貌似还没有解决方案)，所以写了一个替代按键</span></span><br><span class=\"line\">    doRegister(<span class=\"string\">'F6'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> win = BrowserWindow.getFocusedWindow();</span><br><span class=\"line\">        win.webContents.toggleDevTools();</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"toggleDevTools F6\"</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    doRegister(<span class=\"string\">'F5'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> win = BrowserWindow.getFocusedWindow();</span><br><span class=\"line\">        win.reload();</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"refresh\"</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如果之前有做过<code>MFC</code>、<code>QT</code>类GUI的开发，对<code>electron</code>这样的工作流程一定非常熟悉。  </p>\n<hr>\n<h3 id=\"安装electron-builder工具来编译安装包\"><a href=\"#安装electron-builder工具来编译安装包\" class=\"headerlink\" title=\"安装electron-builder工具来编译安装包\"></a>安装<code>electron-builder</code>工具来编译安装包</h3><p><code>electron-builder</code>把几个不同平台的安装包编译工具集成到一起，得到一个统一的接口，方便使用。  </p>\n<p><code>electron-builder</code> 建议把构建目录分为两层，上面一层主要管理编译工具、构建所需的资源以及构建的输出，称之为dev 目录。下面一层则为以<code>electron</code>为入口的工程目录，称之为app 目录。  </p>\n<p><code>dev</code>目录预览：</p>\n<p><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/electron-builder.png\" alt=\"图3\"></p>\n<p><code>app</code>目录预览：<br><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/electron-release.png\" alt=\"图4\"></p>\n<p>需要做的工作很简单：</p>\n<ul>\n<li>安装构建工具(electron、electron-prebuilder)  </li>\n<li>修改dev目录下<code>package.json</code>指定编译脚本  </li>\n<li>修改app目录下<code>package.json</code>指定编译选项  </li>\n<li>运行脚本编译安装包  </li>\n</ul>\n<p>dev 目录下<code>package.json</code>预览:  </p>\n<pre><code class=\"javascript\">{\n  <span class=\"string\">\"name\"</span>: <span class=\"string\">\"HolaStudio\"</span>,\n  <span class=\"string\">\"version\"</span>: <span class=\"string\">\"0.0.1\"</span>,\n  <span class=\"string\">\"homepage\"</span>: <span class=\"string\">\"http://studio.holaverse.cn\"</span>,\n  <span class=\"string\">\"description\"</span>: <span class=\"string\">\"HolaStudio Release Version.\"</span>,\n  <span class=\"string\">\"scripts\"</span>: {\n    <span class=\"string\">\"dist\"</span>: <span class=\"string\">\"npm run dist:linux &amp;&amp; npm run dist:win\"</span>,\n    <span class=\"string\">\"dist:osx\"</span>: <span class=\"string\">\"build --platform darwin --arch all -d\"</span>,\n    <span class=\"string\">\"dist:win\"</span>: <span class=\"string\">\"build --platform win32 --arch all -d\"</span>,\n    <span class=\"string\">\"dist:linux\"</span>: <span class=\"string\">\"build --platform linux --arch all -d\"</span>\n  },\n  <span class=\"string\">\"keywords\"</span>: [\n    <span class=\"string\">\"HolaStudio\"</span>\n  ],\n  <span class=\"string\">\"author\"</span>: <span class=\"string\">\"holaverse Tech Inc.\"</span>,\n  <span class=\"string\">\"license\"</span>: <span class=\"string\">\"ISC\"</span>,\n  <span class=\"string\">\"devDependencies\"</span>: {\n    <span class=\"string\">\"electron-builder\"</span>: <span class=\"string\">\"^2.11.0\"</span>,\n    <span class=\"string\">\"electron-prebuilt\"</span>: <span class=\"string\">\"^0.37.2\"</span>\n  },\n  <span class=\"string\">\"build\"</span>: {\n    <span class=\"string\">\"osx\"</span>: {\n      <span class=\"string\">\"title\"</span>: <span class=\"string\">\"HolaStudio\"</span>,\n      <span class=\"string\">\"background\"</span>: <span class=\"string\">\"build/background.png\"</span>,\n      <span class=\"string\">\"icon\"</span>: <span class=\"string\">\"build/icon.icns\"</span>,\n      <span class=\"string\">\"icon-size\"</span>: <span class=\"number\">128</span>,\n      <span class=\"string\">\"contents\"</span>: [\n        {\n          <span class=\"string\">\"x\"</span>: <span class=\"number\">355</span>,\n          <span class=\"string\">\"y\"</span>: <span class=\"number\">125</span>,\n          <span class=\"string\">\"type\"</span>: <span class=\"string\">\"link\"</span>,\n          <span class=\"string\">\"path\"</span>: <span class=\"string\">\"/Applications\"</span>\n        },\n        {\n          <span class=\"string\">\"x\"</span>: <span class=\"number\">155</span>,\n          <span class=\"string\">\"y\"</span>: <span class=\"number\">125</span>,\n          <span class=\"string\">\"type\"</span>: <span class=\"string\">\"file\"</span>\n        }\n      ]\n    }\n  }\n}\n</code></pre>\n<ul>\n<li><code>scripts</code>字段指定<code>npm</code>编译不同平台的运行脚本。  </li>\n<li><code>build</code>指定编译时载入的资源配置  </li>\n</ul>\n<p>app 目录下<code>package.json</code>增加编译时配置选项(最新版本<code>electron-builder</code>已经把它提出到<code>dev</code>目录下的<code>package.json</code>)  </p>\n<pre><code class=\"javascript\"><span class=\"string\">\"build\"</span>: {\n    <span class=\"string\">\"asar\"</span>: <span class=\"literal\">false</span>,\n    <span class=\"string\">\"iconUrl\"</span>: <span class=\"string\">\"http://7xsec6.com1.z0.glb.clouddn.com/icon.ico\"</span>,\n    <span class=\"string\">\"app-bundle-id\"</span>: <span class=\"string\">\"holaverse.studio\"</span>,\n    <span class=\"string\">\"app-category-type\"</span>: <span class=\"string\">\"public.app-category.productivity\"</span>\n  },\n</code></pre>\n<ul>\n<li>asar告诉打包工具，不要压缩资源文件，因为在<code>HolaStudio</code>运行过程中，需要频繁改动项目路径下文件。  </li>\n<li>iconUrl指定windows安装包<code>icon url</code>  </li>\n<li>app-bundle-id/public.app-category.productivity,mac平台下编译选项  </li>\n</ul>\n<p>更详细的配置文档<a href=\"https://github.com/electron-userland/electron-builder/blob/master/docs/options.md\" target=\"_blank\" rel=\"noopener\">请看这里</a>。  </p>\n<p>成功打包了各种平台的安装包后，后续需要做的是阅读<code>electron</code>文档，在有新需求的时候能够很快的处理掉。  </p>\n","site":{"data":{}},"excerpt":"","more":"<p>时下流行的web app打包工具主要有两个，一个是国内开发者主导的<code>nw.js</code>，另一个是国外大厂支撑的<code>electron</code>。对比了<code>nw.js</code>以及<code>electron</code>之后还是选择了<code>electron</code>，原因主要有以下几点：</p>\n<ul>\n<li>1、基于该工具已有广泛被使用的产品，如：<code>atom</code>、<code>vs code</code>等。</li>\n<li>2、在开发者中口碑比较好，有大公司参与进来，遇到问题，提个<code>issue</code>能很快得到响应。</li>\n</ul>\n<p>下载基于<code>electron</code>打包的<a href=\"http://cdn.studio.holaverse.cn/dist/\" target=\"_blank\" rel=\"noopener\">HolaStudio</a>。   </p>\n<hr>\n<h3 id=\"使用webpack编译项目\"><a href=\"#使用webpack编译项目\" class=\"headerlink\" title=\"使用webpack编译项目\"></a>使用<code>webpack</code>编译项目</h3><p><code>HolaStudio</code>离线版本打包的时候需要把服务器、客户端打包到一个安装包内。所以第一步首先要把服务器代码混淆，为接下来打包做准备。  </p>\n<p>构建工具选择了<code>webpack</code>, 关于构建工具没有做很细致的筛选，因为我都不熟悉：）。所以就听从朋友建议，选择了入了<code>webpack</code>的坑。  </p>\n<p>关于<code>webpack</code>的使用，官方有详细的文档说明,<code>github</code>自行搜索。</p>\n<p><code>webpack</code>需要一个配置文件(<code>webpack.config.js</code>)，用来描述项目的环境，以及第三方插件的集成等信息：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs-extra'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> packageJSON = fs.readJsonSync(<span class=\"string\">'./package.json'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> nodeModules = &#123;&#125;;</span><br><span class=\"line\">fs.readdirSync(<span class=\"string\">'./node_modules'</span>)</span><br><span class=\"line\">  .filter(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"string\">'.bin'</span>, <span class=\"string\">'.npminstall'</span>].indexOf(x) === <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .filter(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> !(y <span class=\"keyword\">in</span> packageJSON.devDependencies);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">mod</span>) </span>&#123;</span><br><span class=\"line\">\tnodeModules[mod] = <span class=\"string\">'commonjs '</span> + mod;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    entry: <span class=\"string\">'./app.js'</span>,</span><br><span class=\"line\">    target: <span class=\"string\">'node'</span>,</span><br><span class=\"line\">    context: __dirname,</span><br><span class=\"line\">    node: &#123;</span><br><span class=\"line\">        __dirname: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        __filename: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;,  </span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        path: path.join(__dirname, <span class=\"string\">'output'</span>),</span><br><span class=\"line\">        filename: <span class=\"string\">'output.js'</span>,</span><br><span class=\"line\">        externals: nodeModules,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    externals: nodeModules,</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        <span class=\"keyword\">new</span> webpack.optimize.UglifyJsPlugin(&#123;<span class=\"attr\">compress</span>: &#123;<span class=\"attr\">warnings</span>: <span class=\"literal\">false</span>&#125;&#125;),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> webpack.IgnorePlugin(<span class=\"regexp\">/\\.(css|less)$/</span>)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">简要的说明：  </span></span><br><span class=\"line\"><span class=\"string\">- entry: 指定项目的入口文件，即启动`</span>node<span class=\"string\">`服务指定的文件  </span></span><br><span class=\"line\"><span class=\"string\">- target: 指定当前的编译环境为`</span>node<span class=\"string\">`, 其他选择有`</span>web<span class=\"string\">`、`</span>webworker<span class=\"string\">`等    </span></span><br><span class=\"line\"><span class=\"string\">- context: 指定一个路径找到`</span>entry<span class=\"string\">`文件  </span></span><br><span class=\"line\"><span class=\"string\">- node: 用于指定一些`</span>nodejs<span class=\"string\">`环境配置  __dirname=false 表示启用__dirname 变量(默认为'/'), __filename=false 表示启用__filename 变量(默认为'/index.js')。  </span></span><br><span class=\"line\"><span class=\"string\">- output: 指定编译输出文件及目录  </span></span><br><span class=\"line\"><span class=\"string\">- externals: 指定外部依赖库文件  </span></span><br><span class=\"line\"><span class=\"string\">- plugins: `</span>webpack<span class=\"string\">`插件集成，这里主要用到了一个混淆插件  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">运行 `</span>webpack .<span class=\"string\">` 会在当前目录下的`</span>output<span class=\"string\">` 文件夹得到编译输出文件。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">---   </span></span><br><span class=\"line\"><span class=\"string\">### 安装`</span>electron<span class=\"string\">`以及相关工具  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">- 运行命令`</span>npm i -g electron-prebuilt<span class=\"string\">` 安装`</span>electron<span class=\"string\">`。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">简要说说关于`</span>electron<span class=\"string\">`的设计理念：</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span>electron<span class=\"string\">`打包的应用分为主进程和渲染进程，渲染进程使用`</span>Chromium<span class=\"string\">`来展示页面，主进程以类似创建窗口的方式创建网页。主进程具备调用系统相关服务的功能，主进程和渲染进程之间以`</span>进程间通信<span class=\"string\">`的方式交互。  更详细的`</span>electron<span class=\"string\">`[说明文档](https://github.com/electron/electron/blob/master/docs-translations/zh-CN/).  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">*在打包`</span>HolaStudio<span class=\"string\">`的过程中，选择把`</span>node<span class=\"string\">`服务端代码放在主进程，编辑器放在一个渲染进程。*    </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span>electron<span class=\"string\">`项目的构建目录结构：  </span></span><br><span class=\"line\"><span class=\"string\">![图1](http://7xsec6.com1.z0.glb.clouddn.com/electron-release.png)  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">在该目录下运行`</span>electron .<span class=\"string\">`即可调式`</span>electron<span class=\"string\">`应用。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">所以在启动`</span>electron<span class=\"string\">`应用的过程中，需要启动`</span>node<span class=\"string\">`后台的同时创建一个渲染窗口显示编辑器。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//处理windows 应用安装以及更新时刻的默认事件  </span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>(<span class=\"string\">'electron-squirrel-startup'</span>)) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"built_in\">require</span>(<span class=\"string\">'app'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> electron = <span class=\"built_in\">require</span>(<span class=\"string\">'electron'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> BrowserWindow = <span class=\"built_in\">require</span>(<span class=\"string\">'browser-window'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> globalShortcut = <span class=\"built_in\">require</span>(<span class=\"string\">'global-shortcut'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> mainWindow = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> webContents = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//所有窗口被关闭</span></span><br><span class=\"line\">app.on(<span class=\"string\">'window-all-closed'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 在 OS X 上，通常用户在明确地按下 Cmd + Q 之前</span></span><br><span class=\"line\">  <span class=\"comment\">// 应用会保持活动状态</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(process.platform != <span class=\"string\">'darwin'</span>) &#123;</span><br><span class=\"line\">        app.quit();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//当前应用准备退出</span></span><br><span class=\"line\">app.on(<span class=\"string\">'will-quit'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    globalShortcut.unregisterAll();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 当 Electron 完成了初始化并且准备创建浏览器窗口的时候</span></span><br><span class=\"line\">app.on(<span class=\"string\">'ready'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    global.mainProcess = app;</span><br><span class=\"line\">    <span class=\"built_in\">require</span>(<span class=\"string\">'./hola_studio.js'</span>);</span><br><span class=\"line\">    registerShortcut();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//hola_studio 服务器发出`done`事件后，准备渲染编辑器界面</span></span><br><span class=\"line\">app.on(<span class=\"string\">'done'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> electronScreen = electron.screen;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> size = electronScreen.getPrimaryDisplay().workAreaSize;</span><br><span class=\"line\">    mainWindow = <span class=\"keyword\">new</span> BrowserWindow(&#123;<span class=\"attr\">resizable</span>: <span class=\"literal\">true</span>, <span class=\"attr\">width</span>: size.width, <span class=\"attr\">height</span>: size.height,</span><br><span class=\"line\">        title: <span class=\"string\">'HolaStudio'</span>&#125;);</span><br><span class=\"line\">    mainWindow.loadURL(url);</span><br><span class=\"line\">    webContents = mainWindow.webContents;</span><br><span class=\"line\">    mainWindow.on(<span class=\"string\">'closed'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        mainWindow = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        webContents = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//注册快捷键用于打开开发者工具以及刷新当前页面</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">registerShortcut</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doRegister</span>(<span class=\"params\">cmd, callback</span>) </span>&#123;</span><br><span class=\"line\">        globalShortcut.register(cmd, callback);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    doRegister(<span class=\"string\">'F12'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> win = BrowserWindow.getFocusedWindow();</span><br><span class=\"line\">        win.webContents.toggleDevTools();</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"toggleDevTools F12\"</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//windows 平台下`F12`按键按下收不到消息(貌似还没有解决方案)，所以写了一个替代按键</span></span><br><span class=\"line\">    doRegister(<span class=\"string\">'F6'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> win = BrowserWindow.getFocusedWindow();</span><br><span class=\"line\">        win.webContents.toggleDevTools();</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"toggleDevTools F6\"</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    doRegister(<span class=\"string\">'F5'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> win = BrowserWindow.getFocusedWindow();</span><br><span class=\"line\">        win.reload();</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"refresh\"</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如果之前有做过<code>MFC</code>、<code>QT</code>类GUI的开发，对<code>electron</code>这样的工作流程一定非常熟悉。  </p>\n<hr>\n<h3 id=\"安装electron-builder工具来编译安装包\"><a href=\"#安装electron-builder工具来编译安装包\" class=\"headerlink\" title=\"安装electron-builder工具来编译安装包\"></a>安装<code>electron-builder</code>工具来编译安装包</h3><p><code>electron-builder</code>把几个不同平台的安装包编译工具集成到一起，得到一个统一的接口，方便使用。  </p>\n<p><code>electron-builder</code> 建议把构建目录分为两层，上面一层主要管理编译工具、构建所需的资源以及构建的输出，称之为dev 目录。下面一层则为以<code>electron</code>为入口的工程目录，称之为app 目录。  </p>\n<p><code>dev</code>目录预览：</p>\n<p><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/electron-builder.png\" alt=\"图3\"></p>\n<p><code>app</code>目录预览：<br><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/electron-release.png\" alt=\"图4\"></p>\n<p>需要做的工作很简单：</p>\n<ul>\n<li>安装构建工具(electron、electron-prebuilder)  </li>\n<li>修改dev目录下<code>package.json</code>指定编译脚本  </li>\n<li>修改app目录下<code>package.json</code>指定编译选项  </li>\n<li>运行脚本编译安装包  </li>\n</ul>\n<p>dev 目录下<code>package.json</code>预览:  </p>\n<pre><code class=\"javascript\">{\n  <span class=\"string\">\"name\"</span>: <span class=\"string\">\"HolaStudio\"</span>,\n  <span class=\"string\">\"version\"</span>: <span class=\"string\">\"0.0.1\"</span>,\n  <span class=\"string\">\"homepage\"</span>: <span class=\"string\">\"http://studio.holaverse.cn\"</span>,\n  <span class=\"string\">\"description\"</span>: <span class=\"string\">\"HolaStudio Release Version.\"</span>,\n  <span class=\"string\">\"scripts\"</span>: {\n    <span class=\"string\">\"dist\"</span>: <span class=\"string\">\"npm run dist:linux &amp;&amp; npm run dist:win\"</span>,\n    <span class=\"string\">\"dist:osx\"</span>: <span class=\"string\">\"build --platform darwin --arch all -d\"</span>,\n    <span class=\"string\">\"dist:win\"</span>: <span class=\"string\">\"build --platform win32 --arch all -d\"</span>,\n    <span class=\"string\">\"dist:linux\"</span>: <span class=\"string\">\"build --platform linux --arch all -d\"</span>\n  },\n  <span class=\"string\">\"keywords\"</span>: [\n    <span class=\"string\">\"HolaStudio\"</span>\n  ],\n  <span class=\"string\">\"author\"</span>: <span class=\"string\">\"holaverse Tech Inc.\"</span>,\n  <span class=\"string\">\"license\"</span>: <span class=\"string\">\"ISC\"</span>,\n  <span class=\"string\">\"devDependencies\"</span>: {\n    <span class=\"string\">\"electron-builder\"</span>: <span class=\"string\">\"^2.11.0\"</span>,\n    <span class=\"string\">\"electron-prebuilt\"</span>: <span class=\"string\">\"^0.37.2\"</span>\n  },\n  <span class=\"string\">\"build\"</span>: {\n    <span class=\"string\">\"osx\"</span>: {\n      <span class=\"string\">\"title\"</span>: <span class=\"string\">\"HolaStudio\"</span>,\n      <span class=\"string\">\"background\"</span>: <span class=\"string\">\"build/background.png\"</span>,\n      <span class=\"string\">\"icon\"</span>: <span class=\"string\">\"build/icon.icns\"</span>,\n      <span class=\"string\">\"icon-size\"</span>: <span class=\"number\">128</span>,\n      <span class=\"string\">\"contents\"</span>: [\n        {\n          <span class=\"string\">\"x\"</span>: <span class=\"number\">355</span>,\n          <span class=\"string\">\"y\"</span>: <span class=\"number\">125</span>,\n          <span class=\"string\">\"type\"</span>: <span class=\"string\">\"link\"</span>,\n          <span class=\"string\">\"path\"</span>: <span class=\"string\">\"/Applications\"</span>\n        },\n        {\n          <span class=\"string\">\"x\"</span>: <span class=\"number\">155</span>,\n          <span class=\"string\">\"y\"</span>: <span class=\"number\">125</span>,\n          <span class=\"string\">\"type\"</span>: <span class=\"string\">\"file\"</span>\n        }\n      ]\n    }\n  }\n}\n</code></pre>\n<ul>\n<li><code>scripts</code>字段指定<code>npm</code>编译不同平台的运行脚本。  </li>\n<li><code>build</code>指定编译时载入的资源配置  </li>\n</ul>\n<p>app 目录下<code>package.json</code>增加编译时配置选项(最新版本<code>electron-builder</code>已经把它提出到<code>dev</code>目录下的<code>package.json</code>)  </p>\n<pre><code class=\"javascript\"><span class=\"string\">\"build\"</span>: {\n    <span class=\"string\">\"asar\"</span>: <span class=\"literal\">false</span>,\n    <span class=\"string\">\"iconUrl\"</span>: <span class=\"string\">\"http://7xsec6.com1.z0.glb.clouddn.com/icon.ico\"</span>,\n    <span class=\"string\">\"app-bundle-id\"</span>: <span class=\"string\">\"holaverse.studio\"</span>,\n    <span class=\"string\">\"app-category-type\"</span>: <span class=\"string\">\"public.app-category.productivity\"</span>\n  },\n</code></pre>\n<ul>\n<li>asar告诉打包工具，不要压缩资源文件，因为在<code>HolaStudio</code>运行过程中，需要频繁改动项目路径下文件。  </li>\n<li>iconUrl指定windows安装包<code>icon url</code>  </li>\n<li>app-bundle-id/public.app-category.productivity,mac平台下编译选项  </li>\n</ul>\n<p>更详细的配置文档<a href=\"https://github.com/electron-userland/electron-builder/blob/master/docs/options.md\" target=\"_blank\" rel=\"noopener\">请看这里</a>。  </p>\n<p>成功打包了各种平台的安装包后，后续需要做的是阅读<code>electron</code>文档，在有新需求的时候能够很快的处理掉。  </p>\n"},{"title":"flex-box-xmind","date":"2016-07-31T14:10:36.000Z","_content":"\nCSS3引入了强大的弹性布局(flex-box)，解决了传统CSS布局效率低下的问题。说句实话，学了一个礼拜多的CSS知识，我到现在都还没搞清楚，float\\display\\clear。\n三个布局参数之间的联系。查资料的过程中发现了`flex-box`这一神器，仿佛抓住了救命稻草。\n\n---  \n\n兼容性探测：\n![](https://luncher.github.io/images/caniuse-flexbox.png)\n\n\n推荐一个主流浏览器的特性支持情况检测网站: [caniuse-flexbox](http://caniuse.com/#search=flex)\n\nflex-box所有属性思维导图：\n\n![](https://luncher.github.io/images/flexbox.png)\n\n","source":"_posts/flex-box-xmind.md","raw":"---\ntitle: flex-box-xmind\ndate: 2016-07-31 22:10:36\ntags: flexbox xmind\ncategories: web\n---\n\nCSS3引入了强大的弹性布局(flex-box)，解决了传统CSS布局效率低下的问题。说句实话，学了一个礼拜多的CSS知识，我到现在都还没搞清楚，float\\display\\clear。\n三个布局参数之间的联系。查资料的过程中发现了`flex-box`这一神器，仿佛抓住了救命稻草。\n\n---  \n\n兼容性探测：\n![](https://luncher.github.io/images/caniuse-flexbox.png)\n\n\n推荐一个主流浏览器的特性支持情况检测网站: [caniuse-flexbox](http://caniuse.com/#search=flex)\n\nflex-box所有属性思维导图：\n\n![](https://luncher.github.io/images/flexbox.png)\n\n","slug":"flex-box-xmind","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxr001b9co7hfdzlhvw","content":"<p>CSS3引入了强大的弹性布局(flex-box)，解决了传统CSS布局效率低下的问题。说句实话，学了一个礼拜多的CSS知识，我到现在都还没搞清楚，float\\display\\clear。<br>三个布局参数之间的联系。查资料的过程中发现了<code>flex-box</code>这一神器，仿佛抓住了救命稻草。</p>\n<hr>\n<p>兼容性探测：<br><img src=\"https://luncher.github.io/images/caniuse-flexbox.png\" alt=\"\"></p>\n<p>推荐一个主流浏览器的特性支持情况检测网站: <a href=\"http://caniuse.com/#search=flex\" target=\"_blank\" rel=\"noopener\">caniuse-flexbox</a></p>\n<p>flex-box所有属性思维导图：</p>\n<p><img src=\"https://luncher.github.io/images/flexbox.png\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>CSS3引入了强大的弹性布局(flex-box)，解决了传统CSS布局效率低下的问题。说句实话，学了一个礼拜多的CSS知识，我到现在都还没搞清楚，float\\display\\clear。<br>三个布局参数之间的联系。查资料的过程中发现了<code>flex-box</code>这一神器，仿佛抓住了救命稻草。</p>\n<hr>\n<p>兼容性探测：<br><img src=\"https://luncher.github.io/images/caniuse-flexbox.png\" alt=\"\"></p>\n<p>推荐一个主流浏览器的特性支持情况检测网站: <a href=\"http://caniuse.com/#search=flex\" target=\"_blank\" rel=\"noopener\">caniuse-flexbox</a></p>\n<p>flex-box所有属性思维导图：</p>\n<p><img src=\"https://luncher.github.io/images/flexbox.png\" alt=\"\"></p>\n"},{"title":"iptables配置","_content":"### 1、Iptables介绍\n\nCentos系统内建了一个强大的防火墙，通常又被称为`iptables`。准确的说应该叫iptables/netfilter。iptables工作于用户层，用户通过命令行给防火墙预定规则表。netfilter是一个内核模块，完成实际的过滤工作。有许多GUI软件方便用户来设置防火墙规则，但都缺乏一定的灵活性，并且限制用户了解其中真正发生了什么。\n\n在开始配置Iptables之前，我们需要知道知道一些它是如何工作的。Iptables利用到了 IP 地址、协议(tcp,udp,icmp)和端口。我们不需要成为这方面的专家，但多少知道一些有助于理解iptables是如何工作的。\n\nIptables给预定义的链路(INPUT、OUTPUT、FORWARD)设置规则。链路校验IP包并根据定义的规则对其做相应的处理，如：接受、丢弃等。对包的处理又被称为：`targets`。两个通常用到的`target`一个是`DROP`用于丢弃一个包、一个是`ACCEPT`用于接受一个包。\n\n#### 链路  \n有三个预定义的链路定义在`filter`表内，我们可以给它添加规则来处理通过链路的IP包。三个链路分别是：  \n- INPUT -所有发往本机的数据包\n- OUTPUT -所有从本机输出的数据包  \n- FORWARD -所有的即不是发往本机也不是从本机发出的数据包，但是需要通过本机的数据包。通常用在本机当作一个路由器的情况下。\n\n所有的规则最终被添加到链路的一张表内。一个数据包在链路的规则表内轮流被校验，从顶部开始，一旦匹配到规则，规则定义的行为被执行，例如接受(ACCEPT)、丢弃(DROP)数据包。一旦数据包被处理、后续的规则将不会被执行。如果一个数据包没有匹配到任何一条规则，那么链路的默认行为会被使用，这被称为链路的默认策略。通常有两种默认的链路配置策略：  \n\n+ 1、 设置默认策略丢弃所有的数据包、添加规则指定我们需要允许的IP地址或者指定端口的服务，如FTP、web服务器、Samba文件服务等。  \n+ 2、 设置默认策略接受所有的数据包、添加规则指定我们需要拒绝的IP地址或者指定端口等。\n\n### 2、起步\n\n确认iptables已经安装：  \n```\n[luncher@localhost ide-server]$ rpm -qa iptables\niptables-1.4.21-13.fc21.x86_64\n[luncher@localhost ide-server]$\n```\n\n查看当前配置信息：  \n```\n[luncher@localhost ide-server]$ sudo iptables -L\n[sudo] password for luncher: \nChain INPUT (policy DROP)\ntarget     prot opt source               destination         \nACCEPT     all  --  anywhere             anywhere            \nACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED\nACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh\n\n```\n\n我们可以看到ssh服务默认被centos服务允许了。\n\niptables 还有一些基本的命令如：start/restart/off/on等，和其他系统服务器基本类似。\n\n\n### 3、写一个简单的规则设置\n\n一组简单的配置规则：  \n```  \n# iptables -P INPUT ACCEPT\n# iptables -F\n# iptables -A INPUT -i lo -j ACCEPT\n# iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n# iptables -A INPUT -p tcp --dport 22 -j ACCEPT\n# iptables -P INPUT DROP\n# iptables -P FORWARD DROP\n# iptables -P OUTPUT ACCEPT\n# iptables -L -v\n```\n\n看看最终的结果：\n```\n[luncher@localhost ide-server]$ sudo iptables -L -v\nChain INPUT (policy DROP 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination         \n   34  6368 ACCEPT     all  --  any    any     anywhere             anywhere             state RELATED,ESTABLISHED\n    0     0 ACCEPT     tcp  --  any    any     anywhere             anywhere             tcp dpt:ssh\n\n```\n\n下面来详细解释一下以上八个命令的具体作用：  \n+ 1、 iptables -P INPUT ACCEPT  \n如果我们远程登录到服务器修改配置，那么我们必须临时给INPUT设置默认的策略ACCEPT，否则一旦我们把规则表清空，我们将无法登录服务器。  \n\n+ 2、 iptables -F  \n用户清空`filter`表当前的配置规则。以便添加新规则。  \n\n+ 3、iptables -A INPUT -i lo -j ACCEPT  \n给INPUT链的末尾添加规则，当数据包进入本地网络使用的接口为`localhost`时，那么跳转(-j)到行为接受(ACCEPT)。多数软件都回和本地主机(localhost)适配器通信，所以必须开启该通道。  \n\n+ 4、iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT  \n接下来我们要保障已经建立的链路通信，这里我们使用`state`判断数据包的状态，辨别这是一个新的链接、还是一个已经建立的链接。允许接受已经建立链接的数据包。\n\n+ 5、iptables -A INPUT -p tcp --dport 22 -j ACCEPT  \n`SSH`链接基于22端口，我们必须开启ssh服务。`--dport`选项基于tcp包的目的端口来匹配包，`--sport`类似。  \n\n+ 6、iptables -P INPUT DROP  \n为`INPUT`链设置默认的行为(`target`)。`-P`用于指定链路(`--policy`)。  \n\n+ 7、iptables -P FORWARD DROP  \n为`FORWARD`链设置默认行为(`target`)。  \n\n+ 8、iptables -P OUTPUT ACCEPT  \n最后，我们设置`OUTPUT`允许默认输出，表明我们信任我们的用户。  \n\n+ 9、iptables -L -v  \n列出当前的配置规则  \n\n\n### 4、接口  \n\n在上面例子，我们可以给以指定网络接口的数据包设置规则，例如：\n\n```\niptables -A INPUT -i lo -j ACCEPT  \n```  \n\n常用的网口还有:`eth0`、`eth1`等等。  \n\n\n### 5、IP地址\n\n有时候对整个网口做限制还是不够精确，我们需要更加细致的规则来达到我们说要的效果。例如，添加一个可信的IP地址：\n```\niptables -A INPUT -s 192.168.0.51 -j ACCEPT  \n```  \n有时候一个IP还是不够用，我们需要对一个地址范围的IP定制规则：\n```\niptables -A INPUT -s 192.168.0.0/51 -j ACCEPT \n```  \n为了防止`IP`地址伪造，我们也可以根据`mac`地址来过滤：  \n```\niptables -A INPUT -s 192.168.0.51 -m mac --mac-source 0a:d0:62:de -j ACCEPT\n```  \n\n### 6、端口和协议\n\n上面我们看到了一些基于IP地址的过滤规则配置，接下来我们来学习根据协议以及端口号来设置过滤规则。在我们开始之前，必须知道一些特定服务的协议以及端口号，例如：bittorrent 服务，使用的是`tcp`协议，端口号默认`6881`：  \n```\niptables -A INPUT -p tcp --dport 6881 -j ACCEPT\n```  \n如果我们要对一系列连续的端口做相同的操作可以这样：  \n```\niptables -A INPUT -p tcp --dport 6881:6991 -j ACCEPT  \n```  \n注意：在限制端口之前必须指定协议类型，常用的有：tcp、udp、icmp。  \n\n### 7、总结  \n来看一个生产机器上的防火墙配置：\n\n```\n*filter\n:INPUT ACCEPT [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\n-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n-A INPUT -p icmp -j ACCEPT\n-A INPUT -i lo -j ACCEPT\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT\n-A INPUT -m state --state NEW -s 117.135.137.133 -m tcp -p tcp --dport 10050 -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 10240 -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT\n-A INPUT -j REJECT --reject-with icmp-host-prohibited\n-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT\n-A FORWARD -j REJECT --reject-with icmp-host-prohibited\n-A OUTPUT -p tcp -m tcp --sport 10240 -j ACCEPT\nCOMMIT\n\n```  \n解释几个选项  \n- 1、*filter表示当前的表名为`filter`，一般不可以修改  \n- 2、:INPUT ACCEPT [0:0]表示链的详细说明，`:<chain-name> <chain-policy> [<packet-counter>:<byte-counter>]`。 \n- 3、COMMIT：每个表的描述都以`COMMIT`关键字结束  \n- 4、--reject-with icmp-host-prohibited：设置REJECT(target)的返回信息，也就是给发送者返回拒绝信息。可以参看常用的`icmp`类型。\n\n---  \n*到这里，我们学习了`iptables`的基础配置。相信经过不断的刻意练习，iptables配置一定烂熟于心。*\n\n\n\n\n\n","source":"_posts/iptables配置.md","raw":"---\ntitle: iptables配置\ncategories: server\n---\n### 1、Iptables介绍\n\nCentos系统内建了一个强大的防火墙，通常又被称为`iptables`。准确的说应该叫iptables/netfilter。iptables工作于用户层，用户通过命令行给防火墙预定规则表。netfilter是一个内核模块，完成实际的过滤工作。有许多GUI软件方便用户来设置防火墙规则，但都缺乏一定的灵活性，并且限制用户了解其中真正发生了什么。\n\n在开始配置Iptables之前，我们需要知道知道一些它是如何工作的。Iptables利用到了 IP 地址、协议(tcp,udp,icmp)和端口。我们不需要成为这方面的专家，但多少知道一些有助于理解iptables是如何工作的。\n\nIptables给预定义的链路(INPUT、OUTPUT、FORWARD)设置规则。链路校验IP包并根据定义的规则对其做相应的处理，如：接受、丢弃等。对包的处理又被称为：`targets`。两个通常用到的`target`一个是`DROP`用于丢弃一个包、一个是`ACCEPT`用于接受一个包。\n\n#### 链路  \n有三个预定义的链路定义在`filter`表内，我们可以给它添加规则来处理通过链路的IP包。三个链路分别是：  \n- INPUT -所有发往本机的数据包\n- OUTPUT -所有从本机输出的数据包  \n- FORWARD -所有的即不是发往本机也不是从本机发出的数据包，但是需要通过本机的数据包。通常用在本机当作一个路由器的情况下。\n\n所有的规则最终被添加到链路的一张表内。一个数据包在链路的规则表内轮流被校验，从顶部开始，一旦匹配到规则，规则定义的行为被执行，例如接受(ACCEPT)、丢弃(DROP)数据包。一旦数据包被处理、后续的规则将不会被执行。如果一个数据包没有匹配到任何一条规则，那么链路的默认行为会被使用，这被称为链路的默认策略。通常有两种默认的链路配置策略：  \n\n+ 1、 设置默认策略丢弃所有的数据包、添加规则指定我们需要允许的IP地址或者指定端口的服务，如FTP、web服务器、Samba文件服务等。  \n+ 2、 设置默认策略接受所有的数据包、添加规则指定我们需要拒绝的IP地址或者指定端口等。\n\n### 2、起步\n\n确认iptables已经安装：  \n```\n[luncher@localhost ide-server]$ rpm -qa iptables\niptables-1.4.21-13.fc21.x86_64\n[luncher@localhost ide-server]$\n```\n\n查看当前配置信息：  \n```\n[luncher@localhost ide-server]$ sudo iptables -L\n[sudo] password for luncher: \nChain INPUT (policy DROP)\ntarget     prot opt source               destination         \nACCEPT     all  --  anywhere             anywhere            \nACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED\nACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh\n\n```\n\n我们可以看到ssh服务默认被centos服务允许了。\n\niptables 还有一些基本的命令如：start/restart/off/on等，和其他系统服务器基本类似。\n\n\n### 3、写一个简单的规则设置\n\n一组简单的配置规则：  \n```  \n# iptables -P INPUT ACCEPT\n# iptables -F\n# iptables -A INPUT -i lo -j ACCEPT\n# iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n# iptables -A INPUT -p tcp --dport 22 -j ACCEPT\n# iptables -P INPUT DROP\n# iptables -P FORWARD DROP\n# iptables -P OUTPUT ACCEPT\n# iptables -L -v\n```\n\n看看最终的结果：\n```\n[luncher@localhost ide-server]$ sudo iptables -L -v\nChain INPUT (policy DROP 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination         \n   34  6368 ACCEPT     all  --  any    any     anywhere             anywhere             state RELATED,ESTABLISHED\n    0     0 ACCEPT     tcp  --  any    any     anywhere             anywhere             tcp dpt:ssh\n\n```\n\n下面来详细解释一下以上八个命令的具体作用：  \n+ 1、 iptables -P INPUT ACCEPT  \n如果我们远程登录到服务器修改配置，那么我们必须临时给INPUT设置默认的策略ACCEPT，否则一旦我们把规则表清空，我们将无法登录服务器。  \n\n+ 2、 iptables -F  \n用户清空`filter`表当前的配置规则。以便添加新规则。  \n\n+ 3、iptables -A INPUT -i lo -j ACCEPT  \n给INPUT链的末尾添加规则，当数据包进入本地网络使用的接口为`localhost`时，那么跳转(-j)到行为接受(ACCEPT)。多数软件都回和本地主机(localhost)适配器通信，所以必须开启该通道。  \n\n+ 4、iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT  \n接下来我们要保障已经建立的链路通信，这里我们使用`state`判断数据包的状态，辨别这是一个新的链接、还是一个已经建立的链接。允许接受已经建立链接的数据包。\n\n+ 5、iptables -A INPUT -p tcp --dport 22 -j ACCEPT  \n`SSH`链接基于22端口，我们必须开启ssh服务。`--dport`选项基于tcp包的目的端口来匹配包，`--sport`类似。  \n\n+ 6、iptables -P INPUT DROP  \n为`INPUT`链设置默认的行为(`target`)。`-P`用于指定链路(`--policy`)。  \n\n+ 7、iptables -P FORWARD DROP  \n为`FORWARD`链设置默认行为(`target`)。  \n\n+ 8、iptables -P OUTPUT ACCEPT  \n最后，我们设置`OUTPUT`允许默认输出，表明我们信任我们的用户。  \n\n+ 9、iptables -L -v  \n列出当前的配置规则  \n\n\n### 4、接口  \n\n在上面例子，我们可以给以指定网络接口的数据包设置规则，例如：\n\n```\niptables -A INPUT -i lo -j ACCEPT  \n```  \n\n常用的网口还有:`eth0`、`eth1`等等。  \n\n\n### 5、IP地址\n\n有时候对整个网口做限制还是不够精确，我们需要更加细致的规则来达到我们说要的效果。例如，添加一个可信的IP地址：\n```\niptables -A INPUT -s 192.168.0.51 -j ACCEPT  \n```  \n有时候一个IP还是不够用，我们需要对一个地址范围的IP定制规则：\n```\niptables -A INPUT -s 192.168.0.0/51 -j ACCEPT \n```  \n为了防止`IP`地址伪造，我们也可以根据`mac`地址来过滤：  \n```\niptables -A INPUT -s 192.168.0.51 -m mac --mac-source 0a:d0:62:de -j ACCEPT\n```  \n\n### 6、端口和协议\n\n上面我们看到了一些基于IP地址的过滤规则配置，接下来我们来学习根据协议以及端口号来设置过滤规则。在我们开始之前，必须知道一些特定服务的协议以及端口号，例如：bittorrent 服务，使用的是`tcp`协议，端口号默认`6881`：  \n```\niptables -A INPUT -p tcp --dport 6881 -j ACCEPT\n```  \n如果我们要对一系列连续的端口做相同的操作可以这样：  \n```\niptables -A INPUT -p tcp --dport 6881:6991 -j ACCEPT  \n```  \n注意：在限制端口之前必须指定协议类型，常用的有：tcp、udp、icmp。  \n\n### 7、总结  \n来看一个生产机器上的防火墙配置：\n\n```\n*filter\n:INPUT ACCEPT [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\n-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n-A INPUT -p icmp -j ACCEPT\n-A INPUT -i lo -j ACCEPT\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT\n-A INPUT -m state --state NEW -s 117.135.137.133 -m tcp -p tcp --dport 10050 -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 10240 -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT\n-A INPUT -j REJECT --reject-with icmp-host-prohibited\n-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT\n-A FORWARD -j REJECT --reject-with icmp-host-prohibited\n-A OUTPUT -p tcp -m tcp --sport 10240 -j ACCEPT\nCOMMIT\n\n```  \n解释几个选项  \n- 1、*filter表示当前的表名为`filter`，一般不可以修改  \n- 2、:INPUT ACCEPT [0:0]表示链的详细说明，`:<chain-name> <chain-policy> [<packet-counter>:<byte-counter>]`。 \n- 3、COMMIT：每个表的描述都以`COMMIT`关键字结束  \n- 4、--reject-with icmp-host-prohibited：设置REJECT(target)的返回信息，也就是给发送者返回拒绝信息。可以参看常用的`icmp`类型。\n\n---  \n*到这里，我们学习了`iptables`的基础配置。相信经过不断的刻意练习，iptables配置一定烂熟于心。*\n\n\n\n\n\n","slug":"iptables配置","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxt001g9co78m4t09l3","content":"<h3 id=\"1、Iptables介绍\"><a href=\"#1、Iptables介绍\" class=\"headerlink\" title=\"1、Iptables介绍\"></a>1、Iptables介绍</h3><p>Centos系统内建了一个强大的防火墙，通常又被称为<code>iptables</code>。准确的说应该叫iptables/netfilter。iptables工作于用户层，用户通过命令行给防火墙预定规则表。netfilter是一个内核模块，完成实际的过滤工作。有许多GUI软件方便用户来设置防火墙规则，但都缺乏一定的灵活性，并且限制用户了解其中真正发生了什么。</p>\n<p>在开始配置Iptables之前，我们需要知道知道一些它是如何工作的。Iptables利用到了 IP 地址、协议(tcp,udp,icmp)和端口。我们不需要成为这方面的专家，但多少知道一些有助于理解iptables是如何工作的。</p>\n<p>Iptables给预定义的链路(INPUT、OUTPUT、FORWARD)设置规则。链路校验IP包并根据定义的规则对其做相应的处理，如：接受、丢弃等。对包的处理又被称为：<code>targets</code>。两个通常用到的<code>target</code>一个是<code>DROP</code>用于丢弃一个包、一个是<code>ACCEPT</code>用于接受一个包。</p>\n<h4 id=\"链路\"><a href=\"#链路\" class=\"headerlink\" title=\"链路\"></a>链路</h4><p>有三个预定义的链路定义在<code>filter</code>表内，我们可以给它添加规则来处理通过链路的IP包。三个链路分别是：  </p>\n<ul>\n<li>INPUT -所有发往本机的数据包</li>\n<li>OUTPUT -所有从本机输出的数据包  </li>\n<li>FORWARD -所有的即不是发往本机也不是从本机发出的数据包，但是需要通过本机的数据包。通常用在本机当作一个路由器的情况下。</li>\n</ul>\n<p>所有的规则最终被添加到链路的一张表内。一个数据包在链路的规则表内轮流被校验，从顶部开始，一旦匹配到规则，规则定义的行为被执行，例如接受(ACCEPT)、丢弃(DROP)数据包。一旦数据包被处理、后续的规则将不会被执行。如果一个数据包没有匹配到任何一条规则，那么链路的默认行为会被使用，这被称为链路的默认策略。通常有两种默认的链路配置策略：  </p>\n<ul>\n<li>1、 设置默认策略丢弃所有的数据包、添加规则指定我们需要允许的IP地址或者指定端口的服务，如FTP、web服务器、Samba文件服务等。  </li>\n<li>2、 设置默认策略接受所有的数据包、添加规则指定我们需要拒绝的IP地址或者指定端口等。</li>\n</ul>\n<h3 id=\"2、起步\"><a href=\"#2、起步\" class=\"headerlink\" title=\"2、起步\"></a>2、起步</h3><p>确认iptables已经安装：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[luncher@localhost ide-server]$ rpm -qa iptables</span><br><span class=\"line\">iptables-1.4.21-13.fc21.x86_64</span><br><span class=\"line\">[luncher@localhost ide-server]$</span><br></pre></td></tr></table></figure></p>\n<p>查看当前配置信息：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[luncher@localhost ide-server]$ sudo iptables -L</span><br><span class=\"line\">[sudo] password for luncher: </span><br><span class=\"line\">Chain INPUT (policy DROP)</span><br><span class=\"line\">target     prot opt source               destination         </span><br><span class=\"line\">ACCEPT     all  --  anywhere             anywhere            </span><br><span class=\"line\">ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED</span><br><span class=\"line\">ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh</span><br></pre></td></tr></table></figure></p>\n<p>我们可以看到ssh服务默认被centos服务允许了。</p>\n<p>iptables 还有一些基本的命令如：start/restart/off/on等，和其他系统服务器基本类似。</p>\n<h3 id=\"3、写一个简单的规则设置\"><a href=\"#3、写一个简单的规则设置\" class=\"headerlink\" title=\"3、写一个简单的规则设置\"></a>3、写一个简单的规则设置</h3><p>一组简单的配置规则：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># iptables -P INPUT ACCEPT</span><br><span class=\"line\"># iptables -F</span><br><span class=\"line\"># iptables -A INPUT -i lo -j ACCEPT</span><br><span class=\"line\"># iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class=\"line\"># iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class=\"line\"># iptables -P INPUT DROP</span><br><span class=\"line\"># iptables -P FORWARD DROP</span><br><span class=\"line\"># iptables -P OUTPUT ACCEPT</span><br><span class=\"line\"># iptables -L -v</span><br></pre></td></tr></table></figure></p>\n<p>看看最终的结果：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[luncher@localhost ide-server]$ sudo iptables -L -v</span><br><span class=\"line\">Chain INPUT (policy DROP 0 packets, 0 bytes)</span><br><span class=\"line\"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class=\"line\">   34  6368 ACCEPT     all  --  any    any     anywhere             anywhere             state RELATED,ESTABLISHED</span><br><span class=\"line\">    0     0 ACCEPT     tcp  --  any    any     anywhere             anywhere             tcp dpt:ssh</span><br></pre></td></tr></table></figure></p>\n<p>下面来详细解释一下以上八个命令的具体作用：  </p>\n<ul>\n<li><p>1、 iptables -P INPUT ACCEPT<br>如果我们远程登录到服务器修改配置，那么我们必须临时给INPUT设置默认的策略ACCEPT，否则一旦我们把规则表清空，我们将无法登录服务器。  </p>\n</li>\n<li><p>2、 iptables -F<br>用户清空<code>filter</code>表当前的配置规则。以便添加新规则。  </p>\n</li>\n<li><p>3、iptables -A INPUT -i lo -j ACCEPT<br>给INPUT链的末尾添加规则，当数据包进入本地网络使用的接口为<code>localhost</code>时，那么跳转(-j)到行为接受(ACCEPT)。多数软件都回和本地主机(localhost)适配器通信，所以必须开启该通道。  </p>\n</li>\n<li><p>4、iptables -A INPUT -m state –state ESTABLISHED,RELATED -j ACCEPT<br>接下来我们要保障已经建立的链路通信，这里我们使用<code>state</code>判断数据包的状态，辨别这是一个新的链接、还是一个已经建立的链接。允许接受已经建立链接的数据包。</p>\n</li>\n<li><p>5、iptables -A INPUT -p tcp –dport 22 -j ACCEPT<br><code>SSH</code>链接基于22端口，我们必须开启ssh服务。<code>--dport</code>选项基于tcp包的目的端口来匹配包，<code>--sport</code>类似。  </p>\n</li>\n<li><p>6、iptables -P INPUT DROP<br>为<code>INPUT</code>链设置默认的行为(<code>target</code>)。<code>-P</code>用于指定链路(<code>--policy</code>)。  </p>\n</li>\n<li><p>7、iptables -P FORWARD DROP<br>为<code>FORWARD</code>链设置默认行为(<code>target</code>)。  </p>\n</li>\n<li><p>8、iptables -P OUTPUT ACCEPT<br>最后，我们设置<code>OUTPUT</code>允许默认输出，表明我们信任我们的用户。  </p>\n</li>\n<li><p>9、iptables -L -v<br>列出当前的配置规则  </p>\n</li>\n</ul>\n<h3 id=\"4、接口\"><a href=\"#4、接口\" class=\"headerlink\" title=\"4、接口\"></a>4、接口</h3><p>在上面例子，我们可以给以指定网络接口的数据包设置规则，例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -A INPUT -i lo -j ACCEPT  </span><br><span class=\"line\">```  </span><br><span class=\"line\"></span><br><span class=\"line\">常用的网口还有:`eth0`、`eth1`等等。  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">### 5、IP地址</span><br><span class=\"line\"></span><br><span class=\"line\">有时候对整个网口做限制还是不够精确，我们需要更加细致的规则来达到我们说要的效果。例如，添加一个可信的IP地址：</span><br></pre></td></tr></table></figure>\n<p>iptables -A INPUT -s 192.168.0.51 -j ACCEPT<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">有时候一个IP还是不够用，我们需要对一个地址范围的IP定制规则：</span><br></pre></td></tr></table></figure></p>\n<p>iptables -A INPUT -s 192.168.0.0/51 -j ACCEPT<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">为了防止`IP`地址伪造，我们也可以根据`mac`地址来过滤：</span><br></pre></td></tr></table></figure></p>\n<p>iptables -A INPUT -s 192.168.0.51 -m mac –mac-source 0a:d0:62:de -j ACCEPT<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">### 6、端口和协议</span><br><span class=\"line\"></span><br><span class=\"line\">上面我们看到了一些基于IP地址的过滤规则配置，接下来我们来学习根据协议以及端口号来设置过滤规则。在我们开始之前，必须知道一些特定服务的协议以及端口号，例如：bittorrent 服务，使用的是`tcp`协议，端口号默认`6881`：</span><br></pre></td></tr></table></figure></p>\n<p>iptables -A INPUT -p tcp –dport 6881 -j ACCEPT<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">如果我们要对一系列连续的端口做相同的操作可以这样：</span><br></pre></td></tr></table></figure></p>\n<p>iptables -A INPUT -p tcp –dport 6881:6991 -j ACCEPT<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">注意：在限制端口之前必须指定协议类型，常用的有：tcp、udp、icmp。  </span><br><span class=\"line\"></span><br><span class=\"line\">### 7、总结  </span><br><span class=\"line\">来看一个生产机器上的防火墙配置：</span><br></pre></td></tr></table></figure></p>\n<p>*filter<br>:INPUT ACCEPT [0:0]<br>:FORWARD ACCEPT [0:0]<br>:OUTPUT ACCEPT [0:0]<br>-A INPUT -m state –state ESTABLISHED,RELATED -j ACCEPT<br>-A INPUT -p icmp -j ACCEPT<br>-A INPUT -i lo -j ACCEPT<br>-A INPUT -m state –state NEW -m tcp -p tcp –dport 22 -j ACCEPT<br>-A INPUT -m state –state NEW -s 117.135.137.133 -m tcp -p tcp –dport 10050 -j ACCEPT<br>-A INPUT -p tcp -m state –state NEW -m tcp –dport 10240 -j ACCEPT<br>-A INPUT -p tcp -m state –state NEW -m tcp –dport 80 -j ACCEPT<br>-A INPUT -j REJECT –reject-with icmp-host-prohibited<br>-A INPUT -p tcp -m tcp –dport 80 -j ACCEPT<br>-A FORWARD -j REJECT –reject-with icmp-host-prohibited<br>-A OUTPUT -p tcp -m tcp –sport 10240 -j ACCEPT<br>COMMIT</p>\n<p>```<br>解释几个选项  </p>\n<ul>\n<li>1、*filter表示当前的表名为<code>filter</code>，一般不可以修改  </li>\n<li>2、:INPUT ACCEPT [0:0]表示链的详细说明，<code>:&lt;chain-name&gt; &lt;chain-policy&gt; [&lt;packet-counter&gt;:&lt;byte-counter&gt;]</code>。 </li>\n<li>3、COMMIT：每个表的描述都以<code>COMMIT</code>关键字结束  </li>\n<li>4、–reject-with icmp-host-prohibited：设置REJECT(target)的返回信息，也就是给发送者返回拒绝信息。可以参看常用的<code>icmp</code>类型。</li>\n</ul>\n<hr>\n<p><em>到这里，我们学习了<code>iptables</code>的基础配置。相信经过不断的刻意练习，iptables配置一定烂熟于心。</em></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"1、Iptables介绍\"><a href=\"#1、Iptables介绍\" class=\"headerlink\" title=\"1、Iptables介绍\"></a>1、Iptables介绍</h3><p>Centos系统内建了一个强大的防火墙，通常又被称为<code>iptables</code>。准确的说应该叫iptables/netfilter。iptables工作于用户层，用户通过命令行给防火墙预定规则表。netfilter是一个内核模块，完成实际的过滤工作。有许多GUI软件方便用户来设置防火墙规则，但都缺乏一定的灵活性，并且限制用户了解其中真正发生了什么。</p>\n<p>在开始配置Iptables之前，我们需要知道知道一些它是如何工作的。Iptables利用到了 IP 地址、协议(tcp,udp,icmp)和端口。我们不需要成为这方面的专家，但多少知道一些有助于理解iptables是如何工作的。</p>\n<p>Iptables给预定义的链路(INPUT、OUTPUT、FORWARD)设置规则。链路校验IP包并根据定义的规则对其做相应的处理，如：接受、丢弃等。对包的处理又被称为：<code>targets</code>。两个通常用到的<code>target</code>一个是<code>DROP</code>用于丢弃一个包、一个是<code>ACCEPT</code>用于接受一个包。</p>\n<h4 id=\"链路\"><a href=\"#链路\" class=\"headerlink\" title=\"链路\"></a>链路</h4><p>有三个预定义的链路定义在<code>filter</code>表内，我们可以给它添加规则来处理通过链路的IP包。三个链路分别是：  </p>\n<ul>\n<li>INPUT -所有发往本机的数据包</li>\n<li>OUTPUT -所有从本机输出的数据包  </li>\n<li>FORWARD -所有的即不是发往本机也不是从本机发出的数据包，但是需要通过本机的数据包。通常用在本机当作一个路由器的情况下。</li>\n</ul>\n<p>所有的规则最终被添加到链路的一张表内。一个数据包在链路的规则表内轮流被校验，从顶部开始，一旦匹配到规则，规则定义的行为被执行，例如接受(ACCEPT)、丢弃(DROP)数据包。一旦数据包被处理、后续的规则将不会被执行。如果一个数据包没有匹配到任何一条规则，那么链路的默认行为会被使用，这被称为链路的默认策略。通常有两种默认的链路配置策略：  </p>\n<ul>\n<li>1、 设置默认策略丢弃所有的数据包、添加规则指定我们需要允许的IP地址或者指定端口的服务，如FTP、web服务器、Samba文件服务等。  </li>\n<li>2、 设置默认策略接受所有的数据包、添加规则指定我们需要拒绝的IP地址或者指定端口等。</li>\n</ul>\n<h3 id=\"2、起步\"><a href=\"#2、起步\" class=\"headerlink\" title=\"2、起步\"></a>2、起步</h3><p>确认iptables已经安装：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[luncher@localhost ide-server]$ rpm -qa iptables</span><br><span class=\"line\">iptables-1.4.21-13.fc21.x86_64</span><br><span class=\"line\">[luncher@localhost ide-server]$</span><br></pre></td></tr></table></figure></p>\n<p>查看当前配置信息：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[luncher@localhost ide-server]$ sudo iptables -L</span><br><span class=\"line\">[sudo] password for luncher: </span><br><span class=\"line\">Chain INPUT (policy DROP)</span><br><span class=\"line\">target     prot opt source               destination         </span><br><span class=\"line\">ACCEPT     all  --  anywhere             anywhere            </span><br><span class=\"line\">ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED</span><br><span class=\"line\">ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh</span><br></pre></td></tr></table></figure></p>\n<p>我们可以看到ssh服务默认被centos服务允许了。</p>\n<p>iptables 还有一些基本的命令如：start/restart/off/on等，和其他系统服务器基本类似。</p>\n<h3 id=\"3、写一个简单的规则设置\"><a href=\"#3、写一个简单的规则设置\" class=\"headerlink\" title=\"3、写一个简单的规则设置\"></a>3、写一个简单的规则设置</h3><p>一组简单的配置规则：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># iptables -P INPUT ACCEPT</span><br><span class=\"line\"># iptables -F</span><br><span class=\"line\"># iptables -A INPUT -i lo -j ACCEPT</span><br><span class=\"line\"># iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class=\"line\"># iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class=\"line\"># iptables -P INPUT DROP</span><br><span class=\"line\"># iptables -P FORWARD DROP</span><br><span class=\"line\"># iptables -P OUTPUT ACCEPT</span><br><span class=\"line\"># iptables -L -v</span><br></pre></td></tr></table></figure></p>\n<p>看看最终的结果：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[luncher@localhost ide-server]$ sudo iptables -L -v</span><br><span class=\"line\">Chain INPUT (policy DROP 0 packets, 0 bytes)</span><br><span class=\"line\"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class=\"line\">   34  6368 ACCEPT     all  --  any    any     anywhere             anywhere             state RELATED,ESTABLISHED</span><br><span class=\"line\">    0     0 ACCEPT     tcp  --  any    any     anywhere             anywhere             tcp dpt:ssh</span><br></pre></td></tr></table></figure></p>\n<p>下面来详细解释一下以上八个命令的具体作用：  </p>\n<ul>\n<li><p>1、 iptables -P INPUT ACCEPT<br>如果我们远程登录到服务器修改配置，那么我们必须临时给INPUT设置默认的策略ACCEPT，否则一旦我们把规则表清空，我们将无法登录服务器。  </p>\n</li>\n<li><p>2、 iptables -F<br>用户清空<code>filter</code>表当前的配置规则。以便添加新规则。  </p>\n</li>\n<li><p>3、iptables -A INPUT -i lo -j ACCEPT<br>给INPUT链的末尾添加规则，当数据包进入本地网络使用的接口为<code>localhost</code>时，那么跳转(-j)到行为接受(ACCEPT)。多数软件都回和本地主机(localhost)适配器通信，所以必须开启该通道。  </p>\n</li>\n<li><p>4、iptables -A INPUT -m state –state ESTABLISHED,RELATED -j ACCEPT<br>接下来我们要保障已经建立的链路通信，这里我们使用<code>state</code>判断数据包的状态，辨别这是一个新的链接、还是一个已经建立的链接。允许接受已经建立链接的数据包。</p>\n</li>\n<li><p>5、iptables -A INPUT -p tcp –dport 22 -j ACCEPT<br><code>SSH</code>链接基于22端口，我们必须开启ssh服务。<code>--dport</code>选项基于tcp包的目的端口来匹配包，<code>--sport</code>类似。  </p>\n</li>\n<li><p>6、iptables -P INPUT DROP<br>为<code>INPUT</code>链设置默认的行为(<code>target</code>)。<code>-P</code>用于指定链路(<code>--policy</code>)。  </p>\n</li>\n<li><p>7、iptables -P FORWARD DROP<br>为<code>FORWARD</code>链设置默认行为(<code>target</code>)。  </p>\n</li>\n<li><p>8、iptables -P OUTPUT ACCEPT<br>最后，我们设置<code>OUTPUT</code>允许默认输出，表明我们信任我们的用户。  </p>\n</li>\n<li><p>9、iptables -L -v<br>列出当前的配置规则  </p>\n</li>\n</ul>\n<h3 id=\"4、接口\"><a href=\"#4、接口\" class=\"headerlink\" title=\"4、接口\"></a>4、接口</h3><p>在上面例子，我们可以给以指定网络接口的数据包设置规则，例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -A INPUT -i lo -j ACCEPT  </span><br><span class=\"line\">```  </span><br><span class=\"line\"></span><br><span class=\"line\">常用的网口还有:`eth0`、`eth1`等等。  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">### 5、IP地址</span><br><span class=\"line\"></span><br><span class=\"line\">有时候对整个网口做限制还是不够精确，我们需要更加细致的规则来达到我们说要的效果。例如，添加一个可信的IP地址：</span><br></pre></td></tr></table></figure>\n<p>iptables -A INPUT -s 192.168.0.51 -j ACCEPT<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">有时候一个IP还是不够用，我们需要对一个地址范围的IP定制规则：</span><br></pre></td></tr></table></figure></p>\n<p>iptables -A INPUT -s 192.168.0.0/51 -j ACCEPT<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">为了防止`IP`地址伪造，我们也可以根据`mac`地址来过滤：</span><br></pre></td></tr></table></figure></p>\n<p>iptables -A INPUT -s 192.168.0.51 -m mac –mac-source 0a:d0:62:de -j ACCEPT<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">### 6、端口和协议</span><br><span class=\"line\"></span><br><span class=\"line\">上面我们看到了一些基于IP地址的过滤规则配置，接下来我们来学习根据协议以及端口号来设置过滤规则。在我们开始之前，必须知道一些特定服务的协议以及端口号，例如：bittorrent 服务，使用的是`tcp`协议，端口号默认`6881`：</span><br></pre></td></tr></table></figure></p>\n<p>iptables -A INPUT -p tcp –dport 6881 -j ACCEPT<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">如果我们要对一系列连续的端口做相同的操作可以这样：</span><br></pre></td></tr></table></figure></p>\n<p>iptables -A INPUT -p tcp –dport 6881:6991 -j ACCEPT<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">注意：在限制端口之前必须指定协议类型，常用的有：tcp、udp、icmp。  </span><br><span class=\"line\"></span><br><span class=\"line\">### 7、总结  </span><br><span class=\"line\">来看一个生产机器上的防火墙配置：</span><br></pre></td></tr></table></figure></p>\n<p>*filter<br>:INPUT ACCEPT [0:0]<br>:FORWARD ACCEPT [0:0]<br>:OUTPUT ACCEPT [0:0]<br>-A INPUT -m state –state ESTABLISHED,RELATED -j ACCEPT<br>-A INPUT -p icmp -j ACCEPT<br>-A INPUT -i lo -j ACCEPT<br>-A INPUT -m state –state NEW -m tcp -p tcp –dport 22 -j ACCEPT<br>-A INPUT -m state –state NEW -s 117.135.137.133 -m tcp -p tcp –dport 10050 -j ACCEPT<br>-A INPUT -p tcp -m state –state NEW -m tcp –dport 10240 -j ACCEPT<br>-A INPUT -p tcp -m state –state NEW -m tcp –dport 80 -j ACCEPT<br>-A INPUT -j REJECT –reject-with icmp-host-prohibited<br>-A INPUT -p tcp -m tcp –dport 80 -j ACCEPT<br>-A FORWARD -j REJECT –reject-with icmp-host-prohibited<br>-A OUTPUT -p tcp -m tcp –sport 10240 -j ACCEPT<br>COMMIT</p>\n<p>```<br>解释几个选项  </p>\n<ul>\n<li>1、*filter表示当前的表名为<code>filter</code>，一般不可以修改  </li>\n<li>2、:INPUT ACCEPT [0:0]表示链的详细说明，<code>:&lt;chain-name&gt; &lt;chain-policy&gt; [&lt;packet-counter&gt;:&lt;byte-counter&gt;]</code>。 </li>\n<li>3、COMMIT：每个表的描述都以<code>COMMIT</code>关键字结束  </li>\n<li>4、–reject-with icmp-host-prohibited：设置REJECT(target)的返回信息，也就是给发送者返回拒绝信息。可以参看常用的<code>icmp</code>类型。</li>\n</ul>\n<hr>\n<p><em>到这里，我们学习了<code>iptables</code>的基础配置。相信经过不断的刻意练习，iptables配置一定烂熟于心。</em></p>\n"},{"title":"nodejs-Modules-(一)","_content":"  Nodejs拥有一套简单的模块加载系统，在Nodejs里面文件和模块是一一对应的关系。例如：`foo.js`加载了同一个目录下的`circle.js`文件。  \n\n\n`circle.js`文件内容：  \n``` javascript  \nconst PI = Math.PI;  \nexports.area = (r) => PI*r*r;  \nexports.circumference = (r) => 2*PI*r;  \n```  \n\n`foo.js`文件内容：  \n```javascript  \nconst circle = require('./circle.js');  \nconsole.log(`the area of radius 4 is ${circle.area(4)}`);\n\n```    \n\n`circle`模块导出了`area`和`circumference`函数，为了根模块能够引用到它，你可以把它们添加到`exports`对象上。  \n\n**模块内部的局部变量都是私有的,  因为每个模块都被封装在一个函数内部。**上面的例中`PI`就是属于`circle`模块的局部变量。  \n\n**如果你希望导出一个函数或者一个对象，你应该把该函数或者对象赋值给`module.exports`而不是`exports`**。  \n\n---  \n\n### 访问主模块  \n如果一个模块直接通过`Node.js`启动运行，`require.main`将会设置为该模块。你可以通过如下方式测试当前模块是否为主模块：  \n```javascript  \nconsole.log(require.main === module);\n```  \n举个例子，对于`foo.js`文件，如果通过`nodejs foo.js`运行，那么该测试将会输出`true`, 如果通过`require('foo.js')`，测试将输出`false`。  \n由于每个`module`对象都有一个`filename`属性，也可以通过`require.main.filename`查看主模块文件名。  \n\n---  \n\n### 模块加载  \n\n当我们调用`require`加载外部文件的时候，将会调用`require.resolve`函数。具体的解析规则如下：  \n\n```  \n在Y目录下的模块调用require(X)  \n- 1. 如果X是一个内建核心模块，  \n   a. 返回该模块  \n   b. 停止执行  \n\n- 2. 如果X使用`./`或者`/`或者`../`开头  \n   a. 把(Y+X)作为文件路径来加载(LOAD_AS_FILE)      \n   b. 把(Y+X)作为目录路径来加载(LOAD_AS_DIRECTORY)    \n\n- 3. 加载`node_modules(X, dirname(Y))`(LOAD_NODE_MODULES)    \n\n- 4. 抛出`not found`异常  \n\n```  \n\n**LOAD_AS_FILE(x)**  \n- A. 如果`x`是一个文件则把`x`作为`javascript`文本文件加载。  停止  \n- B. 如果`x.js`是一个文件则把`x.js`作为`javascript`文本文件加载。 停止  \n- C. 如果`x.json`是一个文件则把`x.json`作为一个`javascript`对象来解析。 停止  \n- D. 如果`x.node`是一个文件则把`x.node`作为一个二进制插件。停止  \n\n**LOAD_AS_DIRECTORY(x)**  \n- A. 如果`x/package.json`是一个文件  \n   a. 解析`package.json`读取`main`字段.  \n   b. let m = x + `main`字段值  \n   c. LOAD_AS_FILE(m)   \n- B. 如果`x/index.js`是一个文件，则把`x/index.js`作为`javascript`文本文件加载。 停止  \n- C. 如果`x/index.json`是一个文件，则把`x/index.json`作为`js`对象来解析。停止  \n- D. 如果`x/index.node`是一个文件， 则把`x/index.node`作为二进制插件加载。停止  \n\n**NODE_MODULES_PATHS(START)**  \n- 1. let PARTS = path split(START)  \n- 2. let I = count of PARTS - 1  \n- 3. let DIRS = []  \n- 4. while I >= 0,  \n   a. if PARTS[I] = \"node_modules\" CONTINUE  \n   c. DIR = path join(PARTS[0 .. I] + \"node_modules\")  \n   b. DIRS = DIRS + DIR    \n   c. let I = I - 1  \n- 5. return DIRS  \n\n---  \n\n### 模块缓存  \n模块在首次加载完毕之后会被缓存， 这意味着`require('foo.js')`不会导致`foo.js`被执行两次。 如果希望多次执行模块代码，可以导出`export`一个函数，该函数负责执行代码。  \n\n#### 模块缓存警告  \n+ 1、模块基于被解析的名字来缓存，由于同一个模块在不同目录被加载可能会得到不同的文件名，所以`require('foo')`，不能保证总是得到相同的对象。  \n\n+ 2、在一些大小写不敏感的系统，不同的文件名被系统指向同一个文件，但是缓存模块依旧认为它们是两个不同的模块，也就是说，`require('foo')`和`require('FOO')`将会得到两个不同的对象，而不考虑，`foo`和`FOO`是否是同一个文件。  \n\n---  \n\n### 核心模块  \n`Nodejs`内置几个被打成二进制形式的包。内置模块将会被优先加载，例如`require('http')`将会加载内置的`http`模块，即使有一个文件名也为`http`。  \n\n**需要注意的是：核心模块在安装的时候已经和`node`可执行程序打包到一起了。**  \n\n--- \n\n### 循环加载  \n\n考虑有这样几个模块：  \n`a.js`  \n```javascript  \nconsole.log('a starting');\nexports.done = false;\nconst b = require('./b.js');\nconsole.log('in a, b.done = %j', b.done);\nexports.done = true;\nconsole.log('a done');  \n```  \n\n`b.js`  \n```javascript\nconsole.log('b starting');\nexports.done = false;\nconst a = require('./a.js');\nconsole.log('in b, a.done = %j', a.done);\nexports.done = true;\nconsole.log('b done');\n```\n\n`main.js`\n```javascript  \nconsole.log('main starting');\nconst a = require('./a.js');\nconst b = require('./b.js');\nconsole.log('in main, a.done=%j, b.done=%j', a.done, b.done);\n```\n\n但`main.js`开始加载`a.js`而，`a.js`开始加载`b.js`，而`b.js`又开始加载`a.js`。为了阻止无限循环模块加载，一个**未加载完成的a模块**将会返回给`b.js`，接着`b.js`模块加载完毕，把`exports`对象返回给`a.js`。  \n\n于此同时`main.js`两个模块都加载完毕了，运行`main.js`输出如下： \n\n```javascript  \n$ node main.js\nmain starting\na starting\nb starting\nin b, a.done = false\nb done\nin a, b.done = true\na done\nin main, a.done=true, b.done=true\n```\n\n---  \n\n### 文件模块   \n如果指定的文件名文件不存在，那么`Node.js`将会尝试加载不同后缀名的文件主要有：(`.js`, `.json`, `.node`)。  \n`.js`后缀被解析为`js`文本文件，`.json`文件被解析文`js`对象，`.node`文件被解析为`node`插件，通过`dlopen`加载。  \n\n---  \n\n### 文件夹作为模块    \n使用文件夹是一个非常便捷的代码管理方式，提供一个统一的外部入口，供外部调用该文件夹。主要有三种方式可以达到该目的：  \n\n- 在文件夹的根目录建立一个`package.json`，使用`main`字段指定入口脚本文件，例如：  \n```javascript  \n{ \"name\" : \"some-library\",\n  \"main\" : \"./lib/some-library.js\" }\n```  \n\n在当前目录下有一个`some-library`文件夹，此时调用`require('./some-library')`将会尝试加载`./some-library/lib/some-library.js`文件。如果`main`字段指定的文件找不到，`Node.js`将会报错：  \n```\nError: Cannot find module 'some-library'\n```  \n\n如果在该文件夹下没有`package.json`,`Node.js`将会尝试加载：  \n- ./some-library/index.js  \n- ./some-library/index.json  \n- ./some-library/index.node  \n\n---  \n\n### 从`node_modules`文件夹加载  \n\n如果传递给`require`的参数既不是内置模块，模块名称也不是以`./`、`/`、`../`开头，那么`Node.js`将会尝试寻找父目录下的`node_modules`文件夹。如果没有找到就再往上面一层查找，直到退回系统根目录。  \n\n举个例子：文件`/home/ry/project/foo.js`，调用`require('bar.js')`，将会查找以下`node_modules`文件夹：  \n- `/home/ry/project/node_modules/bar.js`  \n- `/home/ry/node_modules/bar.js`     \n- `/home/node_modules/bar.js`    \n- `/node_modules/bar.js`  \n\n---  \n\n### 从全局文件夹加载模块  \n\n`NODE_PATH`环境变量被配置为用一系列冒号分隔的绝对路径，`Nodejs`将会去这些目录下寻找模块。`NODE_PATH`最初在前面的一些模块加载方法都没有出现的时候使用，现在慢慢变得没那么必要了。  \n除此之外`Node.js`还会查找以下目录：  \n- $HOME/.node_modules  \n- $HOME/.node_libraries  \n- $PREFIX/lib/node_modules  \n\n`$HOME`为当前用户的根目录，`$PREFIX`通过`node_prefix`来配置。  \n\n**基于一些历史方面的原因，建议把模块安装在本地的`node_modules`文件夹下，这一加载速度最快也最可靠。**  \n\n---  \n\n### 模块包装  \n\n在模块执行之前，`Node.js`把它包装成一个函数的形式，看起来像这样：  \n```javascript  \n(function (exports, require, module, __filename, __dirname) {\n// Your module code actually lives in here\n});  \n```  \n\n通过这种做法带来以下好处：  \n- 保证被`let`,`var`,`const`定义的变量作用域局限于模块内部，而不是全局变量。  \n- 包装了几个看起来类似于全局变量来指定该模块，例如：  \n  + `module`和`exports`变量，用于从该模块导出数据到其他模块。  \n  + `__filename`,`__dirname`,指向该模块的文件绝对路径以及文件夹路径。  \n\n---  \n\n### `module`对象  \n\n- module.children   \n一个数组指定了当前模块引用的其他模块。  \n\n- module.exports  \n一个对象，用于导出数据，如果希望导出的是一个函数，则应该给`module.exports`赋值，而不是给`exports`。否则会造成意想不到的后果。\n\n- exports\n一个对象，最初指向`module.exports`，如果你给它赋值，它将会指向对象，而不是最初的`module.exports`。  \n类似于：  \n\n```javascript  \nfunction require(...) {\n  // ...\n  ((module, exports) => {\n    // Your module code here\n    exports = some_func;        // re-assigns exports, exports is no longer\n                                // a shortcut, and nothing is exported.\n    module.exports = some_func; // makes your module export 0\n  })(module, module.exports);\n  return module;\n}\n```  \n\n- module.filename  \n模块的绝对路径名称  \n\n- module.id  \n模块`id`通常等于`module.filename`  \n\n- module.loaded  \n用于判断模块是否加载完毕，或者正在加载中。  \n\n- module.parent  \n指向首次加载本模块的模块。  \n\n- module.require(id)  \n + id: String  \n + 返回一个module.exports导出的对象。  \n\n\n  \n","source":"_posts/nodejs-Modules-(一).md","raw":"---\ntitle: nodejs-Modules-(一)\ncategories: server\n---\n  Nodejs拥有一套简单的模块加载系统，在Nodejs里面文件和模块是一一对应的关系。例如：`foo.js`加载了同一个目录下的`circle.js`文件。  \n\n\n`circle.js`文件内容：  \n``` javascript  \nconst PI = Math.PI;  \nexports.area = (r) => PI*r*r;  \nexports.circumference = (r) => 2*PI*r;  \n```  \n\n`foo.js`文件内容：  \n```javascript  \nconst circle = require('./circle.js');  \nconsole.log(`the area of radius 4 is ${circle.area(4)}`);\n\n```    \n\n`circle`模块导出了`area`和`circumference`函数，为了根模块能够引用到它，你可以把它们添加到`exports`对象上。  \n\n**模块内部的局部变量都是私有的,  因为每个模块都被封装在一个函数内部。**上面的例中`PI`就是属于`circle`模块的局部变量。  \n\n**如果你希望导出一个函数或者一个对象，你应该把该函数或者对象赋值给`module.exports`而不是`exports`**。  \n\n---  \n\n### 访问主模块  \n如果一个模块直接通过`Node.js`启动运行，`require.main`将会设置为该模块。你可以通过如下方式测试当前模块是否为主模块：  \n```javascript  \nconsole.log(require.main === module);\n```  \n举个例子，对于`foo.js`文件，如果通过`nodejs foo.js`运行，那么该测试将会输出`true`, 如果通过`require('foo.js')`，测试将输出`false`。  \n由于每个`module`对象都有一个`filename`属性，也可以通过`require.main.filename`查看主模块文件名。  \n\n---  \n\n### 模块加载  \n\n当我们调用`require`加载外部文件的时候，将会调用`require.resolve`函数。具体的解析规则如下：  \n\n```  \n在Y目录下的模块调用require(X)  \n- 1. 如果X是一个内建核心模块，  \n   a. 返回该模块  \n   b. 停止执行  \n\n- 2. 如果X使用`./`或者`/`或者`../`开头  \n   a. 把(Y+X)作为文件路径来加载(LOAD_AS_FILE)      \n   b. 把(Y+X)作为目录路径来加载(LOAD_AS_DIRECTORY)    \n\n- 3. 加载`node_modules(X, dirname(Y))`(LOAD_NODE_MODULES)    \n\n- 4. 抛出`not found`异常  \n\n```  \n\n**LOAD_AS_FILE(x)**  \n- A. 如果`x`是一个文件则把`x`作为`javascript`文本文件加载。  停止  \n- B. 如果`x.js`是一个文件则把`x.js`作为`javascript`文本文件加载。 停止  \n- C. 如果`x.json`是一个文件则把`x.json`作为一个`javascript`对象来解析。 停止  \n- D. 如果`x.node`是一个文件则把`x.node`作为一个二进制插件。停止  \n\n**LOAD_AS_DIRECTORY(x)**  \n- A. 如果`x/package.json`是一个文件  \n   a. 解析`package.json`读取`main`字段.  \n   b. let m = x + `main`字段值  \n   c. LOAD_AS_FILE(m)   \n- B. 如果`x/index.js`是一个文件，则把`x/index.js`作为`javascript`文本文件加载。 停止  \n- C. 如果`x/index.json`是一个文件，则把`x/index.json`作为`js`对象来解析。停止  \n- D. 如果`x/index.node`是一个文件， 则把`x/index.node`作为二进制插件加载。停止  \n\n**NODE_MODULES_PATHS(START)**  \n- 1. let PARTS = path split(START)  \n- 2. let I = count of PARTS - 1  \n- 3. let DIRS = []  \n- 4. while I >= 0,  \n   a. if PARTS[I] = \"node_modules\" CONTINUE  \n   c. DIR = path join(PARTS[0 .. I] + \"node_modules\")  \n   b. DIRS = DIRS + DIR    \n   c. let I = I - 1  \n- 5. return DIRS  \n\n---  \n\n### 模块缓存  \n模块在首次加载完毕之后会被缓存， 这意味着`require('foo.js')`不会导致`foo.js`被执行两次。 如果希望多次执行模块代码，可以导出`export`一个函数，该函数负责执行代码。  \n\n#### 模块缓存警告  \n+ 1、模块基于被解析的名字来缓存，由于同一个模块在不同目录被加载可能会得到不同的文件名，所以`require('foo')`，不能保证总是得到相同的对象。  \n\n+ 2、在一些大小写不敏感的系统，不同的文件名被系统指向同一个文件，但是缓存模块依旧认为它们是两个不同的模块，也就是说，`require('foo')`和`require('FOO')`将会得到两个不同的对象，而不考虑，`foo`和`FOO`是否是同一个文件。  \n\n---  \n\n### 核心模块  \n`Nodejs`内置几个被打成二进制形式的包。内置模块将会被优先加载，例如`require('http')`将会加载内置的`http`模块，即使有一个文件名也为`http`。  \n\n**需要注意的是：核心模块在安装的时候已经和`node`可执行程序打包到一起了。**  \n\n--- \n\n### 循环加载  \n\n考虑有这样几个模块：  \n`a.js`  \n```javascript  \nconsole.log('a starting');\nexports.done = false;\nconst b = require('./b.js');\nconsole.log('in a, b.done = %j', b.done);\nexports.done = true;\nconsole.log('a done');  \n```  \n\n`b.js`  \n```javascript\nconsole.log('b starting');\nexports.done = false;\nconst a = require('./a.js');\nconsole.log('in b, a.done = %j', a.done);\nexports.done = true;\nconsole.log('b done');\n```\n\n`main.js`\n```javascript  \nconsole.log('main starting');\nconst a = require('./a.js');\nconst b = require('./b.js');\nconsole.log('in main, a.done=%j, b.done=%j', a.done, b.done);\n```\n\n但`main.js`开始加载`a.js`而，`a.js`开始加载`b.js`，而`b.js`又开始加载`a.js`。为了阻止无限循环模块加载，一个**未加载完成的a模块**将会返回给`b.js`，接着`b.js`模块加载完毕，把`exports`对象返回给`a.js`。  \n\n于此同时`main.js`两个模块都加载完毕了，运行`main.js`输出如下： \n\n```javascript  \n$ node main.js\nmain starting\na starting\nb starting\nin b, a.done = false\nb done\nin a, b.done = true\na done\nin main, a.done=true, b.done=true\n```\n\n---  \n\n### 文件模块   \n如果指定的文件名文件不存在，那么`Node.js`将会尝试加载不同后缀名的文件主要有：(`.js`, `.json`, `.node`)。  \n`.js`后缀被解析为`js`文本文件，`.json`文件被解析文`js`对象，`.node`文件被解析为`node`插件，通过`dlopen`加载。  \n\n---  \n\n### 文件夹作为模块    \n使用文件夹是一个非常便捷的代码管理方式，提供一个统一的外部入口，供外部调用该文件夹。主要有三种方式可以达到该目的：  \n\n- 在文件夹的根目录建立一个`package.json`，使用`main`字段指定入口脚本文件，例如：  \n```javascript  \n{ \"name\" : \"some-library\",\n  \"main\" : \"./lib/some-library.js\" }\n```  \n\n在当前目录下有一个`some-library`文件夹，此时调用`require('./some-library')`将会尝试加载`./some-library/lib/some-library.js`文件。如果`main`字段指定的文件找不到，`Node.js`将会报错：  \n```\nError: Cannot find module 'some-library'\n```  \n\n如果在该文件夹下没有`package.json`,`Node.js`将会尝试加载：  \n- ./some-library/index.js  \n- ./some-library/index.json  \n- ./some-library/index.node  \n\n---  \n\n### 从`node_modules`文件夹加载  \n\n如果传递给`require`的参数既不是内置模块，模块名称也不是以`./`、`/`、`../`开头，那么`Node.js`将会尝试寻找父目录下的`node_modules`文件夹。如果没有找到就再往上面一层查找，直到退回系统根目录。  \n\n举个例子：文件`/home/ry/project/foo.js`，调用`require('bar.js')`，将会查找以下`node_modules`文件夹：  \n- `/home/ry/project/node_modules/bar.js`  \n- `/home/ry/node_modules/bar.js`     \n- `/home/node_modules/bar.js`    \n- `/node_modules/bar.js`  \n\n---  \n\n### 从全局文件夹加载模块  \n\n`NODE_PATH`环境变量被配置为用一系列冒号分隔的绝对路径，`Nodejs`将会去这些目录下寻找模块。`NODE_PATH`最初在前面的一些模块加载方法都没有出现的时候使用，现在慢慢变得没那么必要了。  \n除此之外`Node.js`还会查找以下目录：  \n- $HOME/.node_modules  \n- $HOME/.node_libraries  \n- $PREFIX/lib/node_modules  \n\n`$HOME`为当前用户的根目录，`$PREFIX`通过`node_prefix`来配置。  \n\n**基于一些历史方面的原因，建议把模块安装在本地的`node_modules`文件夹下，这一加载速度最快也最可靠。**  \n\n---  \n\n### 模块包装  \n\n在模块执行之前，`Node.js`把它包装成一个函数的形式，看起来像这样：  \n```javascript  \n(function (exports, require, module, __filename, __dirname) {\n// Your module code actually lives in here\n});  \n```  \n\n通过这种做法带来以下好处：  \n- 保证被`let`,`var`,`const`定义的变量作用域局限于模块内部，而不是全局变量。  \n- 包装了几个看起来类似于全局变量来指定该模块，例如：  \n  + `module`和`exports`变量，用于从该模块导出数据到其他模块。  \n  + `__filename`,`__dirname`,指向该模块的文件绝对路径以及文件夹路径。  \n\n---  \n\n### `module`对象  \n\n- module.children   \n一个数组指定了当前模块引用的其他模块。  \n\n- module.exports  \n一个对象，用于导出数据，如果希望导出的是一个函数，则应该给`module.exports`赋值，而不是给`exports`。否则会造成意想不到的后果。\n\n- exports\n一个对象，最初指向`module.exports`，如果你给它赋值，它将会指向对象，而不是最初的`module.exports`。  \n类似于：  \n\n```javascript  \nfunction require(...) {\n  // ...\n  ((module, exports) => {\n    // Your module code here\n    exports = some_func;        // re-assigns exports, exports is no longer\n                                // a shortcut, and nothing is exported.\n    module.exports = some_func; // makes your module export 0\n  })(module, module.exports);\n  return module;\n}\n```  \n\n- module.filename  \n模块的绝对路径名称  \n\n- module.id  \n模块`id`通常等于`module.filename`  \n\n- module.loaded  \n用于判断模块是否加载完毕，或者正在加载中。  \n\n- module.parent  \n指向首次加载本模块的模块。  \n\n- module.require(id)  \n + id: String  \n + 返回一个module.exports导出的对象。  \n\n\n  \n","slug":"nodejs-Modules-(一)","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxv001i9co7ppknpkxz","content":"<p>  Nodejs拥有一套简单的模块加载系统，在Nodejs里面文件和模块是一一对应的关系。例如：<code>foo.js</code>加载了同一个目录下的<code>circle.js</code>文件。  </p>\n<p><code>circle.js</code>文件内容：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> PI = <span class=\"built_in\">Math</span>.PI;  </span><br><span class=\"line\">exports.area = <span class=\"function\">(<span class=\"params\">r</span>) =&gt;</span> PI*r*r;  </span><br><span class=\"line\">exports.circumference = <span class=\"function\">(<span class=\"params\">r</span>) =&gt;</span> <span class=\"number\">2</span>*PI*r;  </span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span>foo.js<span class=\"string\">`文件内容：  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"keyword\">const</span> circle = <span class=\"built_in\">require</span>(<span class=\"string\">'./circle.js'</span>);  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">`the area of radius 4 is <span class=\"subst\">$&#123;circle.area(<span class=\"number\">4</span>)&#125;</span>`</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`    </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span>circle<span class=\"string\">`模块导出了`</span>area<span class=\"string\">`和`</span>circumference<span class=\"string\">`函数，为了根模块能够引用到它，你可以把它们添加到`</span>exports<span class=\"string\">`对象上。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">**模块内部的局部变量都是私有的,  因为每个模块都被封装在一个函数内部。**上面的例中`</span>PI<span class=\"string\">`就是属于`</span>circle<span class=\"string\">`模块的局部变量。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">**如果你希望导出一个函数或者一个对象，你应该把该函数或者对象赋值给`</span><span class=\"built_in\">module</span>.exports<span class=\"string\">`而不是`</span>exports<span class=\"string\">`**。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">---  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 访问主模块  </span></span><br><span class=\"line\"><span class=\"string\">如果一个模块直接通过`</span>Node.js<span class=\"string\">`启动运行，`</span><span class=\"built_in\">require</span>.main<span class=\"string\">`将会设置为该模块。你可以通过如下方式测试当前模块是否为主模块：  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">require</span>.main === <span class=\"built_in\">module</span>);</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">举个例子，对于`</span>foo.js<span class=\"string\">`文件，如果通过`</span>nodejs foo.js<span class=\"string\">`运行，那么该测试将会输出`</span><span class=\"literal\">true</span><span class=\"string\">`, 如果通过`</span><span class=\"built_in\">require</span>(<span class=\"string\">'foo.js'</span>)<span class=\"string\">`，测试将输出`</span><span class=\"literal\">false</span><span class=\"string\">`。  </span></span><br><span class=\"line\"><span class=\"string\">由于每个`</span><span class=\"built_in\">module</span><span class=\"string\">`对象都有一个`</span>filename<span class=\"string\">`属性，也可以通过`</span><span class=\"built_in\">require</span>.main.filename<span class=\"string\">`查看主模块文件名。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">---  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 模块加载  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">当我们调用`</span><span class=\"built_in\">require</span><span class=\"string\">`加载外部文件的时候，将会调用`</span><span class=\"built_in\">require</span>.resolve<span class=\"string\">`函数。具体的解析规则如下：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>  </span><br><span class=\"line\">在Y目录下的模块调用<span class=\"built_in\">require</span>(X)  </span><br><span class=\"line\">- <span class=\"number\">1.</span> 如果X是一个内建核心模块，  </span><br><span class=\"line\">   a. 返回该模块  </span><br><span class=\"line\">   b. 停止执行  </span><br><span class=\"line\"></span><br><span class=\"line\">- <span class=\"number\">2.</span> 如果X使用<span class=\"string\">`./`</span>或者<span class=\"string\">`/`</span>或者<span class=\"string\">`../`</span>开头  </span><br><span class=\"line\">   a. 把(Y+X)作为文件路径来加载(LOAD_AS_FILE)      </span><br><span class=\"line\">   b. 把(Y+X)作为目录路径来加载(LOAD_AS_DIRECTORY)    </span><br><span class=\"line\"></span><br><span class=\"line\">- <span class=\"number\">3.</span> 加载<span class=\"string\">`node_modules(X, dirname(Y))`</span>(LOAD_NODE_MODULES)    </span><br><span class=\"line\"></span><br><span class=\"line\">- <span class=\"number\">4.</span> 抛出<span class=\"string\">`not found`</span>异常  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">**LOAD_AS_FILE(x)**  </span></span><br><span class=\"line\"><span class=\"string\">- A. 如果`</span>x<span class=\"string\">`是一个文件则把`</span>x<span class=\"string\">`作为`</span>javascript<span class=\"string\">`文本文件加载。  停止  </span></span><br><span class=\"line\"><span class=\"string\">- B. 如果`</span>x.js<span class=\"string\">`是一个文件则把`</span>x.js<span class=\"string\">`作为`</span>javascript<span class=\"string\">`文本文件加载。 停止  </span></span><br><span class=\"line\"><span class=\"string\">- C. 如果`</span>x.json<span class=\"string\">`是一个文件则把`</span>x.json<span class=\"string\">`作为一个`</span>javascript<span class=\"string\">`对象来解析。 停止  </span></span><br><span class=\"line\"><span class=\"string\">- D. 如果`</span>x.node<span class=\"string\">`是一个文件则把`</span>x.node<span class=\"string\">`作为一个二进制插件。停止  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">**LOAD_AS_DIRECTORY(x)**  </span></span><br><span class=\"line\"><span class=\"string\">- A. 如果`</span>x/package.json<span class=\"string\">`是一个文件  </span></span><br><span class=\"line\"><span class=\"string\">   a. 解析`</span>package.json<span class=\"string\">`读取`</span>main<span class=\"string\">`字段.  </span></span><br><span class=\"line\"><span class=\"string\">   b. let m = x + `</span>main<span class=\"string\">`字段值  </span></span><br><span class=\"line\"><span class=\"string\">   c. LOAD_AS_FILE(m)   </span></span><br><span class=\"line\"><span class=\"string\">- B. 如果`</span>x/index.js<span class=\"string\">`是一个文件，则把`</span>x/index.js<span class=\"string\">`作为`</span>javascript<span class=\"string\">`文本文件加载。 停止  </span></span><br><span class=\"line\"><span class=\"string\">- C. 如果`</span>x/index.json<span class=\"string\">`是一个文件，则把`</span>x/index.json<span class=\"string\">`作为`</span>js<span class=\"string\">`对象来解析。停止  </span></span><br><span class=\"line\"><span class=\"string\">- D. 如果`</span>x/index.node<span class=\"string\">`是一个文件， 则把`</span>x/index.node<span class=\"string\">`作为二进制插件加载。停止  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">**NODE_MODULES_PATHS(START)**  </span></span><br><span class=\"line\"><span class=\"string\">- 1. let PARTS = path split(START)  </span></span><br><span class=\"line\"><span class=\"string\">- 2. let I = count of PARTS - 1  </span></span><br><span class=\"line\"><span class=\"string\">- 3. let DIRS = []  </span></span><br><span class=\"line\"><span class=\"string\">- 4. while I &gt;= 0,  </span></span><br><span class=\"line\"><span class=\"string\">   a. if PARTS[I] = \"node_modules\" CONTINUE  </span></span><br><span class=\"line\"><span class=\"string\">   c. DIR = path join(PARTS[0 .. I] + \"node_modules\")  </span></span><br><span class=\"line\"><span class=\"string\">   b. DIRS = DIRS + DIR    </span></span><br><span class=\"line\"><span class=\"string\">   c. let I = I - 1  </span></span><br><span class=\"line\"><span class=\"string\">- 5. return DIRS  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">---  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 模块缓存  </span></span><br><span class=\"line\"><span class=\"string\">模块在首次加载完毕之后会被缓存， 这意味着`</span><span class=\"built_in\">require</span>(<span class=\"string\">'foo.js'</span>)<span class=\"string\">`不会导致`</span>foo.js<span class=\"string\">`被执行两次。 如果希望多次执行模块代码，可以导出`</span><span class=\"keyword\">export</span><span class=\"string\">`一个函数，该函数负责执行代码。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">#### 模块缓存警告  </span></span><br><span class=\"line\"><span class=\"string\">+ 1、模块基于被解析的名字来缓存，由于同一个模块在不同目录被加载可能会得到不同的文件名，所以`</span><span class=\"built_in\">require</span>(<span class=\"string\">'foo'</span>)<span class=\"string\">`，不能保证总是得到相同的对象。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">+ 2、在一些大小写不敏感的系统，不同的文件名被系统指向同一个文件，但是缓存模块依旧认为它们是两个不同的模块，也就是说，`</span><span class=\"built_in\">require</span>(<span class=\"string\">'foo'</span>)<span class=\"string\">`和`</span><span class=\"built_in\">require</span>(<span class=\"string\">'FOO'</span>)<span class=\"string\">`将会得到两个不同的对象，而不考虑，`</span>foo<span class=\"string\">`和`</span>FOO<span class=\"string\">`是否是同一个文件。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">---  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 核心模块  </span></span><br><span class=\"line\"><span class=\"string\">`</span>Nodejs<span class=\"string\">`内置几个被打成二进制形式的包。内置模块将会被优先加载，例如`</span><span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>)<span class=\"string\">`将会加载内置的`</span>http<span class=\"string\">`模块，即使有一个文件名也为`</span>http<span class=\"string\">`。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">**需要注意的是：核心模块在安装的时候已经和`</span>node<span class=\"string\">`可执行程序打包到一起了。**  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">--- </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 循环加载  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">考虑有这样几个模块：  </span></span><br><span class=\"line\"><span class=\"string\">`</span>a.js<span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'a starting'</span>);</span><br><span class=\"line\">exports.done = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> b = <span class=\"built_in\">require</span>(<span class=\"string\">'./b.js'</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'in a, b.done = %j'</span>, b.done);</span><br><span class=\"line\">exports.done = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'a done'</span>);  </span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span>b.js<span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'b starting'</span>);</span><br><span class=\"line\">exports.done = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> a = <span class=\"built_in\">require</span>(<span class=\"string\">'./a.js'</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'in b, a.done = %j'</span>, a.done);</span><br><span class=\"line\">exports.done = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'b done'</span>);</span><br></pre></td></tr></table></figure></p>\n<p><code>main.js</code><br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'main starting'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> a = <span class=\"built_in\">require</span>(<span class=\"string\">'./a.js'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> b = <span class=\"built_in\">require</span>(<span class=\"string\">'./b.js'</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'in main, a.done=%j, b.done=%j'</span>, a.done, b.done);</span><br></pre></td></tr></table></figure></p>\n<p>但<code>main.js</code>开始加载<code>a.js</code>而，<code>a.js</code>开始加载<code>b.js</code>，而<code>b.js</code>又开始加载<code>a.js</code>。为了阻止无限循环模块加载，一个<strong>未加载完成的a模块</strong>将会返回给<code>b.js</code>，接着<code>b.js</code>模块加载完毕，把<code>exports</code>对象返回给<code>a.js</code>。  </p>\n<p>于此同时<code>main.js</code>两个模块都加载完毕了，运行<code>main.js</code>输出如下： </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ node main.js</span><br><span class=\"line\">main starting</span><br><span class=\"line\">a starting</span><br><span class=\"line\">b starting</span><br><span class=\"line\"><span class=\"keyword\">in</span> b, a.done = <span class=\"literal\">false</span></span><br><span class=\"line\">b done</span><br><span class=\"line\"><span class=\"keyword\">in</span> a, b.done = <span class=\"literal\">true</span></span><br><span class=\"line\">a done</span><br><span class=\"line\"><span class=\"keyword\">in</span> main, a.done=<span class=\"literal\">true</span>, b.done=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"文件模块\"><a href=\"#文件模块\" class=\"headerlink\" title=\"文件模块\"></a>文件模块</h3><p>如果指定的文件名文件不存在，那么<code>Node.js</code>将会尝试加载不同后缀名的文件主要有：(<code>.js</code>, <code>.json</code>, <code>.node</code>)。<br><code>.js</code>后缀被解析为<code>js</code>文本文件，<code>.json</code>文件被解析文<code>js</code>对象，<code>.node</code>文件被解析为<code>node</code>插件，通过<code>dlopen</code>加载。  </p>\n<hr>\n<h3 id=\"文件夹作为模块\"><a href=\"#文件夹作为模块\" class=\"headerlink\" title=\"文件夹作为模块\"></a>文件夹作为模块</h3><p>使用文件夹是一个非常便捷的代码管理方式，提供一个统一的外部入口，供外部调用该文件夹。主要有三种方式可以达到该目的：  </p>\n<ul>\n<li>在文件夹的根目录建立一个<code>package.json</code>，使用<code>main</code>字段指定入口脚本文件，例如：  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; <span class=\"string\">\"name\"</span> : <span class=\"string\">\"some-library\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"main\"</span> : <span class=\"string\">\"./lib/some-library.js\"</span> &#125;</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">在当前目录下有一个`</span>some-library<span class=\"string\">`文件夹，此时调用`</span><span class=\"built_in\">require</span>(<span class=\"string\">'./some-library'</span>)<span class=\"string\">`将会尝试加载`</span>./some-library/lib/some-library.js<span class=\"string\">`文件。如果`</span>main<span class=\"string\">`字段指定的文件找不到，`</span>Node.js<span class=\"string\">`将会报错：</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>Error: Cannot find module ‘some-library’</p>\n<pre><code>\n如果在该文件夹下没有`package.json`,`Node.js`将会尝试加载：  \n- ./some-library/index.js  \n- ./some-library/index.json  \n- ./some-library/index.node  \n\n---  \n\n### 从`node_modules`文件夹加载  \n\n如果传递给`require`的参数既不是内置模块，模块名称也不是以`./`、`/`、`../`开头，那么`Node.js`将会尝试寻找父目录下的`node_modules`文件夹。如果没有找到就再往上面一层查找，直到退回系统根目录。  \n\n举个例子：文件`/home/ry/project/foo.js`，调用`require(&apos;bar.js&apos;)`，将会查找以下`node_modules`文件夹：  \n- `/home/ry/project/node_modules/bar.js`  \n- `/home/ry/node_modules/bar.js`     \n- `/home/node_modules/bar.js`    \n- `/node_modules/bar.js`  \n\n---  \n\n### 从全局文件夹加载模块  \n\n`NODE_PATH`环境变量被配置为用一系列冒号分隔的绝对路径，`Nodejs`将会去这些目录下寻找模块。`NODE_PATH`最初在前面的一些模块加载方法都没有出现的时候使用，现在慢慢变得没那么必要了。  \n除此之外`Node.js`还会查找以下目录：  \n- $HOME/.node_modules  \n- $HOME/.node_libraries  \n- $PREFIX/lib/node_modules  \n\n`$HOME`为当前用户的根目录，`$PREFIX`通过`node_prefix`来配置。  \n\n**基于一些历史方面的原因，建议把模块安装在本地的`node_modules`文件夹下，这一加载速度最快也最可靠。**  \n\n---  \n\n### 模块包装  \n\n在模块执行之前，`Node.js`把它包装成一个函数的形式，看起来像这样：  \n```javascript  \n(function (exports, require, module, __filename, __dirname) {\n// Your module code actually lives in here\n});\n</code></pre><p>通过这种做法带来以下好处：  </p>\n<ul>\n<li>保证被<code>let</code>,<code>var</code>,<code>const</code>定义的变量作用域局限于模块内部，而不是全局变量。  </li>\n<li>包装了几个看起来类似于全局变量来指定该模块，例如：  <ul>\n<li><code>module</code>和<code>exports</code>变量，用于从该模块导出数据到其他模块。  </li>\n<li><code>__filename</code>,<code>__dirname</code>,指向该模块的文件绝对路径以及文件夹路径。  </li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3 id=\"module对象\"><a href=\"#module对象\" class=\"headerlink\" title=\"module对象\"></a><code>module</code>对象</h3><ul>\n<li><p>module.children<br>一个数组指定了当前模块引用的其他模块。  </p>\n</li>\n<li><p>module.exports<br>一个对象，用于导出数据，如果希望导出的是一个函数，则应该给<code>module.exports</code>赋值，而不是给<code>exports</code>。否则会造成意想不到的后果。</p>\n</li>\n<li><p>exports<br>一个对象，最初指向<code>module.exports</code>，如果你给它赋值，它将会指向对象，而不是最初的<code>module.exports</code>。<br>类似于：  </p>\n</li>\n</ul>\n<pre><code class=\"javascript\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">require</span>(<span class=\"params\">...</span>) </span>{\n  <span class=\"comment\">// ...</span>\n  (<span class=\"function\">(<span class=\"params\"><span class=\"built_in\">module</span>, exports</span>) =&gt;</span> {\n    <span class=\"comment\">// Your module code here</span>\n    exports = some_func;        <span class=\"comment\">// re-assigns exports, exports is no longer</span>\n                                <span class=\"comment\">// a shortcut, and nothing is exported.</span>\n    <span class=\"built_in\">module</span>.exports = some_func; <span class=\"comment\">// makes your module export 0</span>\n  })(<span class=\"built_in\">module</span>, <span class=\"built_in\">module</span>.exports);\n  <span class=\"keyword\">return</span> <span class=\"built_in\">module</span>;\n}\n</code></pre>\n<ul>\n<li><p>module.filename<br>模块的绝对路径名称  </p>\n</li>\n<li><p>module.id<br>模块<code>id</code>通常等于<code>module.filename</code>  </p>\n</li>\n<li><p>module.loaded<br>用于判断模块是否加载完毕，或者正在加载中。  </p>\n</li>\n<li><p>module.parent<br>指向首次加载本模块的模块。  </p>\n</li>\n<li><p>module.require(id)  </p>\n<ul>\n<li>id: String  </li>\n<li>返回一个module.exports导出的对象。  </li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>  Nodejs拥有一套简单的模块加载系统，在Nodejs里面文件和模块是一一对应的关系。例如：<code>foo.js</code>加载了同一个目录下的<code>circle.js</code>文件。  </p>\n<p><code>circle.js</code>文件内容：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> PI = <span class=\"built_in\">Math</span>.PI;  </span><br><span class=\"line\">exports.area = <span class=\"function\">(<span class=\"params\">r</span>) =&gt;</span> PI*r*r;  </span><br><span class=\"line\">exports.circumference = <span class=\"function\">(<span class=\"params\">r</span>) =&gt;</span> <span class=\"number\">2</span>*PI*r;  </span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span>foo.js<span class=\"string\">`文件内容：  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"keyword\">const</span> circle = <span class=\"built_in\">require</span>(<span class=\"string\">'./circle.js'</span>);  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">`the area of radius 4 is <span class=\"subst\">$&#123;circle.area(<span class=\"number\">4</span>)&#125;</span>`</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`    </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span>circle<span class=\"string\">`模块导出了`</span>area<span class=\"string\">`和`</span>circumference<span class=\"string\">`函数，为了根模块能够引用到它，你可以把它们添加到`</span>exports<span class=\"string\">`对象上。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">**模块内部的局部变量都是私有的,  因为每个模块都被封装在一个函数内部。**上面的例中`</span>PI<span class=\"string\">`就是属于`</span>circle<span class=\"string\">`模块的局部变量。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">**如果你希望导出一个函数或者一个对象，你应该把该函数或者对象赋值给`</span><span class=\"built_in\">module</span>.exports<span class=\"string\">`而不是`</span>exports<span class=\"string\">`**。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">---  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 访问主模块  </span></span><br><span class=\"line\"><span class=\"string\">如果一个模块直接通过`</span>Node.js<span class=\"string\">`启动运行，`</span><span class=\"built_in\">require</span>.main<span class=\"string\">`将会设置为该模块。你可以通过如下方式测试当前模块是否为主模块：  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">require</span>.main === <span class=\"built_in\">module</span>);</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">举个例子，对于`</span>foo.js<span class=\"string\">`文件，如果通过`</span>nodejs foo.js<span class=\"string\">`运行，那么该测试将会输出`</span><span class=\"literal\">true</span><span class=\"string\">`, 如果通过`</span><span class=\"built_in\">require</span>(<span class=\"string\">'foo.js'</span>)<span class=\"string\">`，测试将输出`</span><span class=\"literal\">false</span><span class=\"string\">`。  </span></span><br><span class=\"line\"><span class=\"string\">由于每个`</span><span class=\"built_in\">module</span><span class=\"string\">`对象都有一个`</span>filename<span class=\"string\">`属性，也可以通过`</span><span class=\"built_in\">require</span>.main.filename<span class=\"string\">`查看主模块文件名。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">---  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 模块加载  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">当我们调用`</span><span class=\"built_in\">require</span><span class=\"string\">`加载外部文件的时候，将会调用`</span><span class=\"built_in\">require</span>.resolve<span class=\"string\">`函数。具体的解析规则如下：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>  </span><br><span class=\"line\">在Y目录下的模块调用<span class=\"built_in\">require</span>(X)  </span><br><span class=\"line\">- <span class=\"number\">1.</span> 如果X是一个内建核心模块，  </span><br><span class=\"line\">   a. 返回该模块  </span><br><span class=\"line\">   b. 停止执行  </span><br><span class=\"line\"></span><br><span class=\"line\">- <span class=\"number\">2.</span> 如果X使用<span class=\"string\">`./`</span>或者<span class=\"string\">`/`</span>或者<span class=\"string\">`../`</span>开头  </span><br><span class=\"line\">   a. 把(Y+X)作为文件路径来加载(LOAD_AS_FILE)      </span><br><span class=\"line\">   b. 把(Y+X)作为目录路径来加载(LOAD_AS_DIRECTORY)    </span><br><span class=\"line\"></span><br><span class=\"line\">- <span class=\"number\">3.</span> 加载<span class=\"string\">`node_modules(X, dirname(Y))`</span>(LOAD_NODE_MODULES)    </span><br><span class=\"line\"></span><br><span class=\"line\">- <span class=\"number\">4.</span> 抛出<span class=\"string\">`not found`</span>异常  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">**LOAD_AS_FILE(x)**  </span></span><br><span class=\"line\"><span class=\"string\">- A. 如果`</span>x<span class=\"string\">`是一个文件则把`</span>x<span class=\"string\">`作为`</span>javascript<span class=\"string\">`文本文件加载。  停止  </span></span><br><span class=\"line\"><span class=\"string\">- B. 如果`</span>x.js<span class=\"string\">`是一个文件则把`</span>x.js<span class=\"string\">`作为`</span>javascript<span class=\"string\">`文本文件加载。 停止  </span></span><br><span class=\"line\"><span class=\"string\">- C. 如果`</span>x.json<span class=\"string\">`是一个文件则把`</span>x.json<span class=\"string\">`作为一个`</span>javascript<span class=\"string\">`对象来解析。 停止  </span></span><br><span class=\"line\"><span class=\"string\">- D. 如果`</span>x.node<span class=\"string\">`是一个文件则把`</span>x.node<span class=\"string\">`作为一个二进制插件。停止  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">**LOAD_AS_DIRECTORY(x)**  </span></span><br><span class=\"line\"><span class=\"string\">- A. 如果`</span>x/package.json<span class=\"string\">`是一个文件  </span></span><br><span class=\"line\"><span class=\"string\">   a. 解析`</span>package.json<span class=\"string\">`读取`</span>main<span class=\"string\">`字段.  </span></span><br><span class=\"line\"><span class=\"string\">   b. let m = x + `</span>main<span class=\"string\">`字段值  </span></span><br><span class=\"line\"><span class=\"string\">   c. LOAD_AS_FILE(m)   </span></span><br><span class=\"line\"><span class=\"string\">- B. 如果`</span>x/index.js<span class=\"string\">`是一个文件，则把`</span>x/index.js<span class=\"string\">`作为`</span>javascript<span class=\"string\">`文本文件加载。 停止  </span></span><br><span class=\"line\"><span class=\"string\">- C. 如果`</span>x/index.json<span class=\"string\">`是一个文件，则把`</span>x/index.json<span class=\"string\">`作为`</span>js<span class=\"string\">`对象来解析。停止  </span></span><br><span class=\"line\"><span class=\"string\">- D. 如果`</span>x/index.node<span class=\"string\">`是一个文件， 则把`</span>x/index.node<span class=\"string\">`作为二进制插件加载。停止  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">**NODE_MODULES_PATHS(START)**  </span></span><br><span class=\"line\"><span class=\"string\">- 1. let PARTS = path split(START)  </span></span><br><span class=\"line\"><span class=\"string\">- 2. let I = count of PARTS - 1  </span></span><br><span class=\"line\"><span class=\"string\">- 3. let DIRS = []  </span></span><br><span class=\"line\"><span class=\"string\">- 4. while I &gt;= 0,  </span></span><br><span class=\"line\"><span class=\"string\">   a. if PARTS[I] = \"node_modules\" CONTINUE  </span></span><br><span class=\"line\"><span class=\"string\">   c. DIR = path join(PARTS[0 .. I] + \"node_modules\")  </span></span><br><span class=\"line\"><span class=\"string\">   b. DIRS = DIRS + DIR    </span></span><br><span class=\"line\"><span class=\"string\">   c. let I = I - 1  </span></span><br><span class=\"line\"><span class=\"string\">- 5. return DIRS  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">---  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 模块缓存  </span></span><br><span class=\"line\"><span class=\"string\">模块在首次加载完毕之后会被缓存， 这意味着`</span><span class=\"built_in\">require</span>(<span class=\"string\">'foo.js'</span>)<span class=\"string\">`不会导致`</span>foo.js<span class=\"string\">`被执行两次。 如果希望多次执行模块代码，可以导出`</span><span class=\"keyword\">export</span><span class=\"string\">`一个函数，该函数负责执行代码。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">#### 模块缓存警告  </span></span><br><span class=\"line\"><span class=\"string\">+ 1、模块基于被解析的名字来缓存，由于同一个模块在不同目录被加载可能会得到不同的文件名，所以`</span><span class=\"built_in\">require</span>(<span class=\"string\">'foo'</span>)<span class=\"string\">`，不能保证总是得到相同的对象。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">+ 2、在一些大小写不敏感的系统，不同的文件名被系统指向同一个文件，但是缓存模块依旧认为它们是两个不同的模块，也就是说，`</span><span class=\"built_in\">require</span>(<span class=\"string\">'foo'</span>)<span class=\"string\">`和`</span><span class=\"built_in\">require</span>(<span class=\"string\">'FOO'</span>)<span class=\"string\">`将会得到两个不同的对象，而不考虑，`</span>foo<span class=\"string\">`和`</span>FOO<span class=\"string\">`是否是同一个文件。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">---  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 核心模块  </span></span><br><span class=\"line\"><span class=\"string\">`</span>Nodejs<span class=\"string\">`内置几个被打成二进制形式的包。内置模块将会被优先加载，例如`</span><span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>)<span class=\"string\">`将会加载内置的`</span>http<span class=\"string\">`模块，即使有一个文件名也为`</span>http<span class=\"string\">`。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">**需要注意的是：核心模块在安装的时候已经和`</span>node<span class=\"string\">`可执行程序打包到一起了。**  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">--- </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 循环加载  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">考虑有这样几个模块：  </span></span><br><span class=\"line\"><span class=\"string\">`</span>a.js<span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'a starting'</span>);</span><br><span class=\"line\">exports.done = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> b = <span class=\"built_in\">require</span>(<span class=\"string\">'./b.js'</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'in a, b.done = %j'</span>, b.done);</span><br><span class=\"line\">exports.done = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'a done'</span>);  </span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span>b.js<span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'b starting'</span>);</span><br><span class=\"line\">exports.done = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> a = <span class=\"built_in\">require</span>(<span class=\"string\">'./a.js'</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'in b, a.done = %j'</span>, a.done);</span><br><span class=\"line\">exports.done = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'b done'</span>);</span><br></pre></td></tr></table></figure></p>\n<p><code>main.js</code><br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'main starting'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> a = <span class=\"built_in\">require</span>(<span class=\"string\">'./a.js'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> b = <span class=\"built_in\">require</span>(<span class=\"string\">'./b.js'</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'in main, a.done=%j, b.done=%j'</span>, a.done, b.done);</span><br></pre></td></tr></table></figure></p>\n<p>但<code>main.js</code>开始加载<code>a.js</code>而，<code>a.js</code>开始加载<code>b.js</code>，而<code>b.js</code>又开始加载<code>a.js</code>。为了阻止无限循环模块加载，一个<strong>未加载完成的a模块</strong>将会返回给<code>b.js</code>，接着<code>b.js</code>模块加载完毕，把<code>exports</code>对象返回给<code>a.js</code>。  </p>\n<p>于此同时<code>main.js</code>两个模块都加载完毕了，运行<code>main.js</code>输出如下： </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ node main.js</span><br><span class=\"line\">main starting</span><br><span class=\"line\">a starting</span><br><span class=\"line\">b starting</span><br><span class=\"line\"><span class=\"keyword\">in</span> b, a.done = <span class=\"literal\">false</span></span><br><span class=\"line\">b done</span><br><span class=\"line\"><span class=\"keyword\">in</span> a, b.done = <span class=\"literal\">true</span></span><br><span class=\"line\">a done</span><br><span class=\"line\"><span class=\"keyword\">in</span> main, a.done=<span class=\"literal\">true</span>, b.done=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"文件模块\"><a href=\"#文件模块\" class=\"headerlink\" title=\"文件模块\"></a>文件模块</h3><p>如果指定的文件名文件不存在，那么<code>Node.js</code>将会尝试加载不同后缀名的文件主要有：(<code>.js</code>, <code>.json</code>, <code>.node</code>)。<br><code>.js</code>后缀被解析为<code>js</code>文本文件，<code>.json</code>文件被解析文<code>js</code>对象，<code>.node</code>文件被解析为<code>node</code>插件，通过<code>dlopen</code>加载。  </p>\n<hr>\n<h3 id=\"文件夹作为模块\"><a href=\"#文件夹作为模块\" class=\"headerlink\" title=\"文件夹作为模块\"></a>文件夹作为模块</h3><p>使用文件夹是一个非常便捷的代码管理方式，提供一个统一的外部入口，供外部调用该文件夹。主要有三种方式可以达到该目的：  </p>\n<ul>\n<li>在文件夹的根目录建立一个<code>package.json</code>，使用<code>main</code>字段指定入口脚本文件，例如：  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; <span class=\"string\">\"name\"</span> : <span class=\"string\">\"some-library\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"main\"</span> : <span class=\"string\">\"./lib/some-library.js\"</span> &#125;</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">在当前目录下有一个`</span>some-library<span class=\"string\">`文件夹，此时调用`</span><span class=\"built_in\">require</span>(<span class=\"string\">'./some-library'</span>)<span class=\"string\">`将会尝试加载`</span>./some-library/lib/some-library.js<span class=\"string\">`文件。如果`</span>main<span class=\"string\">`字段指定的文件找不到，`</span>Node.js<span class=\"string\">`将会报错：</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>Error: Cannot find module ‘some-library’</p>\n<pre><code>\n如果在该文件夹下没有`package.json`,`Node.js`将会尝试加载：  \n- ./some-library/index.js  \n- ./some-library/index.json  \n- ./some-library/index.node  \n\n---  \n\n### 从`node_modules`文件夹加载  \n\n如果传递给`require`的参数既不是内置模块，模块名称也不是以`./`、`/`、`../`开头，那么`Node.js`将会尝试寻找父目录下的`node_modules`文件夹。如果没有找到就再往上面一层查找，直到退回系统根目录。  \n\n举个例子：文件`/home/ry/project/foo.js`，调用`require(&apos;bar.js&apos;)`，将会查找以下`node_modules`文件夹：  \n- `/home/ry/project/node_modules/bar.js`  \n- `/home/ry/node_modules/bar.js`     \n- `/home/node_modules/bar.js`    \n- `/node_modules/bar.js`  \n\n---  \n\n### 从全局文件夹加载模块  \n\n`NODE_PATH`环境变量被配置为用一系列冒号分隔的绝对路径，`Nodejs`将会去这些目录下寻找模块。`NODE_PATH`最初在前面的一些模块加载方法都没有出现的时候使用，现在慢慢变得没那么必要了。  \n除此之外`Node.js`还会查找以下目录：  \n- $HOME/.node_modules  \n- $HOME/.node_libraries  \n- $PREFIX/lib/node_modules  \n\n`$HOME`为当前用户的根目录，`$PREFIX`通过`node_prefix`来配置。  \n\n**基于一些历史方面的原因，建议把模块安装在本地的`node_modules`文件夹下，这一加载速度最快也最可靠。**  \n\n---  \n\n### 模块包装  \n\n在模块执行之前，`Node.js`把它包装成一个函数的形式，看起来像这样：  \n```javascript  \n(function (exports, require, module, __filename, __dirname) {\n// Your module code actually lives in here\n});\n</code></pre><p>通过这种做法带来以下好处：  </p>\n<ul>\n<li>保证被<code>let</code>,<code>var</code>,<code>const</code>定义的变量作用域局限于模块内部，而不是全局变量。  </li>\n<li>包装了几个看起来类似于全局变量来指定该模块，例如：  <ul>\n<li><code>module</code>和<code>exports</code>变量，用于从该模块导出数据到其他模块。  </li>\n<li><code>__filename</code>,<code>__dirname</code>,指向该模块的文件绝对路径以及文件夹路径。  </li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3 id=\"module对象\"><a href=\"#module对象\" class=\"headerlink\" title=\"module对象\"></a><code>module</code>对象</h3><ul>\n<li><p>module.children<br>一个数组指定了当前模块引用的其他模块。  </p>\n</li>\n<li><p>module.exports<br>一个对象，用于导出数据，如果希望导出的是一个函数，则应该给<code>module.exports</code>赋值，而不是给<code>exports</code>。否则会造成意想不到的后果。</p>\n</li>\n<li><p>exports<br>一个对象，最初指向<code>module.exports</code>，如果你给它赋值，它将会指向对象，而不是最初的<code>module.exports</code>。<br>类似于：  </p>\n</li>\n</ul>\n<pre><code class=\"javascript\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">require</span>(<span class=\"params\">...</span>) </span>{\n  <span class=\"comment\">// ...</span>\n  (<span class=\"function\">(<span class=\"params\"><span class=\"built_in\">module</span>, exports</span>) =&gt;</span> {\n    <span class=\"comment\">// Your module code here</span>\n    exports = some_func;        <span class=\"comment\">// re-assigns exports, exports is no longer</span>\n                                <span class=\"comment\">// a shortcut, and nothing is exported.</span>\n    <span class=\"built_in\">module</span>.exports = some_func; <span class=\"comment\">// makes your module export 0</span>\n  })(<span class=\"built_in\">module</span>, <span class=\"built_in\">module</span>.exports);\n  <span class=\"keyword\">return</span> <span class=\"built_in\">module</span>;\n}\n</code></pre>\n<ul>\n<li><p>module.filename<br>模块的绝对路径名称  </p>\n</li>\n<li><p>module.id<br>模块<code>id</code>通常等于<code>module.filename</code>  </p>\n</li>\n<li><p>module.loaded<br>用于判断模块是否加载完毕，或者正在加载中。  </p>\n</li>\n<li><p>module.parent<br>指向首次加载本模块的模块。  </p>\n</li>\n<li><p>module.require(id)  </p>\n<ul>\n<li>id: String  </li>\n<li>返回一个module.exports导出的对象。  </li>\n</ul>\n</li>\n</ul>\n"},{"title":"jvascript模块管理","date":"2016-08-15T08:26:23.000Z","_content":"\n代码模块化目的：\n\n- 1、封装\n- 2、代码复用\n\n---\n\n# 常见模块化解决反案\n\n## 1、AMD(`Asynchronous Module Definition`)\n\n  >`RequireJS`实现了AMD规范。\n\n---\n\n## 2、CMD(`Common Module Definition`)\n\n  >`SeaJS`实现了`CMD`规范。\n\n---\n\n## 3、CommonJS Modules\n\n  >`NodeJS`环境的模块加载实现了`CommonJS`规范。每个文件都是一个单独的模块，\n有单独的作用域。模块之间通过global设置共享变量。`Browserify`可以让服务器代码跑在客户端。\n\n  特点：\n\n- 1、所有代码都运行在模块作用域，不会污染全局作用域。\n- 2、模块可以多次加载，但是只会在第一次加载时运行一次，\n    然后运行结果就被缓存了，以后再加载，就直接读取缓存结果。要想让模块再次运行，必须清除缓存。\n- 3、模块加载的顺序，按照其在代码中出现的顺序。\n\n常见问题：\n\n- 清除缓存：\n  delete require.cache[require.resolve('./b.js')]\n模块按照绝对路径缓存，require.resolve返回模块的绝对路径。\n\n- 解决互相依赖包含问题：\n  CommonJS的做法是，一旦出现某个模块被\"循环加载\"，就只输出已经执行的部分，还未执行的部分不会输出。\n\n总结：\n> AMD、CMD主要用在浏览器端异步加载、COMMONJS主要用在服务器端的同步加载。\n","source":"_posts/javascript模块管理.md","raw":"---\ntitle: jvascript模块管理\ndate: 2016-08-15 16:26:23\ntags: AMD、CMD、commonjs\ncategories: web\n---\n\n代码模块化目的：\n\n- 1、封装\n- 2、代码复用\n\n---\n\n# 常见模块化解决反案\n\n## 1、AMD(`Asynchronous Module Definition`)\n\n  >`RequireJS`实现了AMD规范。\n\n---\n\n## 2、CMD(`Common Module Definition`)\n\n  >`SeaJS`实现了`CMD`规范。\n\n---\n\n## 3、CommonJS Modules\n\n  >`NodeJS`环境的模块加载实现了`CommonJS`规范。每个文件都是一个单独的模块，\n有单独的作用域。模块之间通过global设置共享变量。`Browserify`可以让服务器代码跑在客户端。\n\n  特点：\n\n- 1、所有代码都运行在模块作用域，不会污染全局作用域。\n- 2、模块可以多次加载，但是只会在第一次加载时运行一次，\n    然后运行结果就被缓存了，以后再加载，就直接读取缓存结果。要想让模块再次运行，必须清除缓存。\n- 3、模块加载的顺序，按照其在代码中出现的顺序。\n\n常见问题：\n\n- 清除缓存：\n  delete require.cache[require.resolve('./b.js')]\n模块按照绝对路径缓存，require.resolve返回模块的绝对路径。\n\n- 解决互相依赖包含问题：\n  CommonJS的做法是，一旦出现某个模块被\"循环加载\"，就只输出已经执行的部分，还未执行的部分不会输出。\n\n总结：\n> AMD、CMD主要用在浏览器端异步加载、COMMONJS主要用在服务器端的同步加载。\n","slug":"javascript模块管理","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxw001l9co7bg6dk69i","content":"<p>代码模块化目的：</p>\n<ul>\n<li>1、封装</li>\n<li>2、代码复用</li>\n</ul>\n<hr>\n<h1 id=\"常见模块化解决反案\"><a href=\"#常见模块化解决反案\" class=\"headerlink\" title=\"常见模块化解决反案\"></a>常见模块化解决反案</h1><h2 id=\"1、AMD-Asynchronous-Module-Definition\"><a href=\"#1、AMD-Asynchronous-Module-Definition\" class=\"headerlink\" title=\"1、AMD(Asynchronous Module Definition)\"></a>1、AMD(<code>Asynchronous Module Definition</code>)</h2><blockquote>\n<p><code>RequireJS</code>实现了AMD规范。</p>\n</blockquote>\n<hr>\n<h2 id=\"2、CMD-Common-Module-Definition\"><a href=\"#2、CMD-Common-Module-Definition\" class=\"headerlink\" title=\"2、CMD(Common Module Definition)\"></a>2、CMD(<code>Common Module Definition</code>)</h2><blockquote>\n<p><code>SeaJS</code>实现了<code>CMD</code>规范。</p>\n</blockquote>\n<hr>\n<h2 id=\"3、CommonJS-Modules\"><a href=\"#3、CommonJS-Modules\" class=\"headerlink\" title=\"3、CommonJS Modules\"></a>3、CommonJS Modules</h2><blockquote>\n<p><code>NodeJS</code>环境的模块加载实现了<code>CommonJS</code>规范。每个文件都是一个单独的模块，<br>有单独的作用域。模块之间通过global设置共享变量。<code>Browserify</code>可以让服务器代码跑在客户端。</p>\n</blockquote>\n<p>  特点：</p>\n<ul>\n<li>1、所有代码都运行在模块作用域，不会污染全局作用域。</li>\n<li>2、模块可以多次加载，但是只会在第一次加载时运行一次，<br>  然后运行结果就被缓存了，以后再加载，就直接读取缓存结果。要想让模块再次运行，必须清除缓存。</li>\n<li>3、模块加载的顺序，按照其在代码中出现的顺序。</li>\n</ul>\n<p>常见问题：</p>\n<ul>\n<li><p>清除缓存：<br>delete require.cache[require.resolve(‘./b.js’)]<br>模块按照绝对路径缓存，require.resolve返回模块的绝对路径。</p>\n</li>\n<li><p>解决互相依赖包含问题：<br>CommonJS的做法是，一旦出现某个模块被”循环加载”，就只输出已经执行的部分，还未执行的部分不会输出。</p>\n</li>\n</ul>\n<p>总结：</p>\n<blockquote>\n<p>AMD、CMD主要用在浏览器端异步加载、COMMONJS主要用在服务器端的同步加载。</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p>代码模块化目的：</p>\n<ul>\n<li>1、封装</li>\n<li>2、代码复用</li>\n</ul>\n<hr>\n<h1 id=\"常见模块化解决反案\"><a href=\"#常见模块化解决反案\" class=\"headerlink\" title=\"常见模块化解决反案\"></a>常见模块化解决反案</h1><h2 id=\"1、AMD-Asynchronous-Module-Definition\"><a href=\"#1、AMD-Asynchronous-Module-Definition\" class=\"headerlink\" title=\"1、AMD(Asynchronous Module Definition)\"></a>1、AMD(<code>Asynchronous Module Definition</code>)</h2><blockquote>\n<p><code>RequireJS</code>实现了AMD规范。</p>\n</blockquote>\n<hr>\n<h2 id=\"2、CMD-Common-Module-Definition\"><a href=\"#2、CMD-Common-Module-Definition\" class=\"headerlink\" title=\"2、CMD(Common Module Definition)\"></a>2、CMD(<code>Common Module Definition</code>)</h2><blockquote>\n<p><code>SeaJS</code>实现了<code>CMD</code>规范。</p>\n</blockquote>\n<hr>\n<h2 id=\"3、CommonJS-Modules\"><a href=\"#3、CommonJS-Modules\" class=\"headerlink\" title=\"3、CommonJS Modules\"></a>3、CommonJS Modules</h2><blockquote>\n<p><code>NodeJS</code>环境的模块加载实现了<code>CommonJS</code>规范。每个文件都是一个单独的模块，<br>有单独的作用域。模块之间通过global设置共享变量。<code>Browserify</code>可以让服务器代码跑在客户端。</p>\n</blockquote>\n<p>  特点：</p>\n<ul>\n<li>1、所有代码都运行在模块作用域，不会污染全局作用域。</li>\n<li>2、模块可以多次加载，但是只会在第一次加载时运行一次，<br>  然后运行结果就被缓存了，以后再加载，就直接读取缓存结果。要想让模块再次运行，必须清除缓存。</li>\n<li>3、模块加载的顺序，按照其在代码中出现的顺序。</li>\n</ul>\n<p>常见问题：</p>\n<ul>\n<li><p>清除缓存：<br>delete require.cache[require.resolve(‘./b.js’)]<br>模块按照绝对路径缓存，require.resolve返回模块的绝对路径。</p>\n</li>\n<li><p>解决互相依赖包含问题：<br>CommonJS的做法是，一旦出现某个模块被”循环加载”，就只输出已经执行的部分，还未执行的部分不会输出。</p>\n</li>\n</ul>\n<p>总结：</p>\n<blockquote>\n<p>AMD、CMD主要用在浏览器端异步加载、COMMONJS主要用在服务器端的同步加载。</p>\n</blockquote>\n"},{"title":"table","date":"2016-08-07T11:09:38.000Z","_content":"\n表格大概是`html`里面最常用的元素之一。看书上介绍说，在`css`出现之前，前端工程师一直采用`table`来布局页面，\n不过我没有尝试过，相比于那些早些年的前端工程师，现在的前端工程师应该算比较幸运吧！`IE`系列老旧浏览器逐渐`死去`，\n`HTML5`标准颁布，一切都在往好的方向走～\n\n# 表格的基本属性以及实践\n\n## 表格相关的基本元素\n\n- table\n  定义表格的根元素\n- thead\n  定义表头(页眉)\n- tbody\n  定义表体\n- tfoot\n  定义表脚(页脚)\n- tr\n  定义一行\n- th\n  定义表头内单元格\n- td\n  定义普通数据单元格\n- caption\n  定义表格标题\n- col\n  定义表格列\n- colgroup\n  定义表格列组\n---\n\n**注意事项**：\n\n- `thead`、`tbody`、`tfoot`主要方便对表格不同区域进行分组，以及在打印表格的时候提供不同信息。\n- `td`、`th`单元格必须包含在`tr`属性里面\n- `col`、`colgroup`元素主要方便对表格不同列进行样式设置,需要注意的是列元素可以控制的属性[比较有限](http://www.w3.org/TR/CSS21/tables.html#columns).基本的`color`、`text-align`都不被支持\n\n比较合理的解释看这里：\n>The colour of text is dependent on the 'color' property of its element. Unless specified, the 'color' property (basically) defaults to 'inherit', which means \"take the value of the parent element\".\n\nSo for some text in a cell, the colour is determined by the 'color' property of the cell, which is taken from the row, which is taken from the table, which is taken from the table's parent, and so on.\n\nWhat about the column? Well, the column isn't one of the cell's ancestors, so it never gets a look-in! And therein lies the problem.\n\n\n\n## 表格样式布局\n\n- caption-side\n  控制表格标题位置\n- border-collapse\n  控制表格边框模型\n- table-layout\n  控制表格布局，是否根据单元格内容缩放\n- border-spacing\n  控制相邻单元格边框之间的距离，仅用于边框模型为分离模式\n- empty-cells\n  控制隐藏表格中空单元格的背景与边框\n- rowspan\n  控制单元格所跨行数\n- colspan\n  控制单元格所跨列数\n\n---\n\n## 实践问题\n\n### 奇偶行设置不同背景色\n\n1、css 奇偶行伪类选择器\n\n`nth-child(n)`选择器匹配其父元素的第`n`个子元素，odd 和 even 是可用于匹配下标是奇数或偶数的子元素的关键词。\n\n``` css\ntable tr:nth-child(even) {\n  background-color: red;\n}\n```\n\n> 为`tr`相对父元素为偶数索引(从1开始)的行设置背景为红色\n\n\n### 设置第一列为不同背景\n\n1、使用`first-child`伪类选择器\n\n``` css\ntable td:first-child {\n  background-color: red;\n}\n```\n\n\n2、使用`col`元素控制样式\n\n``` html\n\n<table>\n  <caption>hahah</caption>\n  <col class=\"col1\"\\>\n  <tr>\n    <th>th1</th>\n    <th>th2</th>\n    /...\n\n```\n\n``` css\n\ntable .col1 {\n  background-color: gray;\n}\n\n```\n\n### 设置单元格边框并合并单元格\n\n控制单元格的显示除了`盒模型`基本属性外还有`rowspan` `colspan` `empty-cells`三个属性。\n\n需要注意的是`rowspan`与`colspan`只能通过`html`属性设置，而不能通过`css`样式引用。\n\n","source":"_posts/table.md","raw":"---\ntitle: table\ndate: 2016-08-07 19:09:38\ntags: css html table\ncategories: web\n---\n\n表格大概是`html`里面最常用的元素之一。看书上介绍说，在`css`出现之前，前端工程师一直采用`table`来布局页面，\n不过我没有尝试过，相比于那些早些年的前端工程师，现在的前端工程师应该算比较幸运吧！`IE`系列老旧浏览器逐渐`死去`，\n`HTML5`标准颁布，一切都在往好的方向走～\n\n# 表格的基本属性以及实践\n\n## 表格相关的基本元素\n\n- table\n  定义表格的根元素\n- thead\n  定义表头(页眉)\n- tbody\n  定义表体\n- tfoot\n  定义表脚(页脚)\n- tr\n  定义一行\n- th\n  定义表头内单元格\n- td\n  定义普通数据单元格\n- caption\n  定义表格标题\n- col\n  定义表格列\n- colgroup\n  定义表格列组\n---\n\n**注意事项**：\n\n- `thead`、`tbody`、`tfoot`主要方便对表格不同区域进行分组，以及在打印表格的时候提供不同信息。\n- `td`、`th`单元格必须包含在`tr`属性里面\n- `col`、`colgroup`元素主要方便对表格不同列进行样式设置,需要注意的是列元素可以控制的属性[比较有限](http://www.w3.org/TR/CSS21/tables.html#columns).基本的`color`、`text-align`都不被支持\n\n比较合理的解释看这里：\n>The colour of text is dependent on the 'color' property of its element. Unless specified, the 'color' property (basically) defaults to 'inherit', which means \"take the value of the parent element\".\n\nSo for some text in a cell, the colour is determined by the 'color' property of the cell, which is taken from the row, which is taken from the table, which is taken from the table's parent, and so on.\n\nWhat about the column? Well, the column isn't one of the cell's ancestors, so it never gets a look-in! And therein lies the problem.\n\n\n\n## 表格样式布局\n\n- caption-side\n  控制表格标题位置\n- border-collapse\n  控制表格边框模型\n- table-layout\n  控制表格布局，是否根据单元格内容缩放\n- border-spacing\n  控制相邻单元格边框之间的距离，仅用于边框模型为分离模式\n- empty-cells\n  控制隐藏表格中空单元格的背景与边框\n- rowspan\n  控制单元格所跨行数\n- colspan\n  控制单元格所跨列数\n\n---\n\n## 实践问题\n\n### 奇偶行设置不同背景色\n\n1、css 奇偶行伪类选择器\n\n`nth-child(n)`选择器匹配其父元素的第`n`个子元素，odd 和 even 是可用于匹配下标是奇数或偶数的子元素的关键词。\n\n``` css\ntable tr:nth-child(even) {\n  background-color: red;\n}\n```\n\n> 为`tr`相对父元素为偶数索引(从1开始)的行设置背景为红色\n\n\n### 设置第一列为不同背景\n\n1、使用`first-child`伪类选择器\n\n``` css\ntable td:first-child {\n  background-color: red;\n}\n```\n\n\n2、使用`col`元素控制样式\n\n``` html\n\n<table>\n  <caption>hahah</caption>\n  <col class=\"col1\"\\>\n  <tr>\n    <th>th1</th>\n    <th>th2</th>\n    /...\n\n```\n\n``` css\n\ntable .col1 {\n  background-color: gray;\n}\n\n```\n\n### 设置单元格边框并合并单元格\n\n控制单元格的显示除了`盒模型`基本属性外还有`rowspan` `colspan` `empty-cells`三个属性。\n\n需要注意的是`rowspan`与`colspan`只能通过`html`属性设置，而不能通过`css`样式引用。\n\n","slug":"table","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxx001o9co7nn692are","content":"<p>表格大概是<code>html</code>里面最常用的元素之一。看书上介绍说，在<code>css</code>出现之前，前端工程师一直采用<code>table</code>来布局页面，<br>不过我没有尝试过，相比于那些早些年的前端工程师，现在的前端工程师应该算比较幸运吧！<code>IE</code>系列老旧浏览器逐渐<code>死去</code>，<br><code>HTML5</code>标准颁布，一切都在往好的方向走～</p>\n<h1 id=\"表格的基本属性以及实践\"><a href=\"#表格的基本属性以及实践\" class=\"headerlink\" title=\"表格的基本属性以及实践\"></a>表格的基本属性以及实践</h1><h2 id=\"表格相关的基本元素\"><a href=\"#表格相关的基本元素\" class=\"headerlink\" title=\"表格相关的基本元素\"></a>表格相关的基本元素</h2><ul>\n<li>table<br>定义表格的根元素</li>\n<li>thead<br>定义表头(页眉)</li>\n<li>tbody<br>定义表体</li>\n<li>tfoot<br>定义表脚(页脚)</li>\n<li>tr<br>定义一行</li>\n<li>th<br>定义表头内单元格</li>\n<li>td<br>定义普通数据单元格</li>\n<li>caption<br>定义表格标题</li>\n<li>col<br>定义表格列</li>\n<li>colgroup<br>定义表格列组</li>\n</ul>\n<hr>\n<p><strong>注意事项</strong>：</p>\n<ul>\n<li><code>thead</code>、<code>tbody</code>、<code>tfoot</code>主要方便对表格不同区域进行分组，以及在打印表格的时候提供不同信息。</li>\n<li><code>td</code>、<code>th</code>单元格必须包含在<code>tr</code>属性里面</li>\n<li><code>col</code>、<code>colgroup</code>元素主要方便对表格不同列进行样式设置,需要注意的是列元素可以控制的属性<a href=\"http://www.w3.org/TR/CSS21/tables.html#columns\" target=\"_blank\" rel=\"noopener\">比较有限</a>.基本的<code>color</code>、<code>text-align</code>都不被支持</li>\n</ul>\n<p>比较合理的解释看这里：</p>\n<blockquote>\n<p>The colour of text is dependent on the ‘color’ property of its element. Unless specified, the ‘color’ property (basically) defaults to ‘inherit’, which means “take the value of the parent element”.</p>\n</blockquote>\n<p>So for some text in a cell, the colour is determined by the ‘color’ property of the cell, which is taken from the row, which is taken from the table, which is taken from the table’s parent, and so on.</p>\n<p>What about the column? Well, the column isn’t one of the cell’s ancestors, so it never gets a look-in! And therein lies the problem.</p>\n<h2 id=\"表格样式布局\"><a href=\"#表格样式布局\" class=\"headerlink\" title=\"表格样式布局\"></a>表格样式布局</h2><ul>\n<li>caption-side<br>控制表格标题位置</li>\n<li>border-collapse<br>控制表格边框模型</li>\n<li>table-layout<br>控制表格布局，是否根据单元格内容缩放</li>\n<li>border-spacing<br>控制相邻单元格边框之间的距离，仅用于边框模型为分离模式</li>\n<li>empty-cells<br>控制隐藏表格中空单元格的背景与边框</li>\n<li>rowspan<br>控制单元格所跨行数</li>\n<li>colspan<br>控制单元格所跨列数</li>\n</ul>\n<hr>\n<h2 id=\"实践问题\"><a href=\"#实践问题\" class=\"headerlink\" title=\"实践问题\"></a>实践问题</h2><h3 id=\"奇偶行设置不同背景色\"><a href=\"#奇偶行设置不同背景色\" class=\"headerlink\" title=\"奇偶行设置不同背景色\"></a>奇偶行设置不同背景色</h3><p>1、css 奇偶行伪类选择器</p>\n<p><code>nth-child(n)</code>选择器匹配其父元素的第<code>n</code>个子元素，odd 和 even 是可用于匹配下标是奇数或偶数的子元素的关键词。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">table</span> <span class=\"selector-tag\">tr</span><span class=\"selector-pseudo\">:nth-child(even)</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>为<code>tr</code>相对父元素为偶数索引(从1开始)的行设置背景为红色</p>\n</blockquote>\n<h3 id=\"设置第一列为不同背景\"><a href=\"#设置第一列为不同背景\" class=\"headerlink\" title=\"设置第一列为不同背景\"></a>设置第一列为不同背景</h3><p>1、使用<code>first-child</code>伪类选择器</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">table</span> <span class=\"selector-tag\">td</span><span class=\"selector-pseudo\">:first-child</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2、使用<code>col</code>元素控制样式</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">caption</span>&gt;</span>hahah<span class=\"tag\">&lt;/<span class=\"name\">caption</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">col</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col1\"</span>\\&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>th1<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>th2<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">    /...</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">table</span> <span class=\"selector-class\">.col1</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: gray;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"设置单元格边框并合并单元格\"><a href=\"#设置单元格边框并合并单元格\" class=\"headerlink\" title=\"设置单元格边框并合并单元格\"></a>设置单元格边框并合并单元格</h3><p>控制单元格的显示除了<code>盒模型</code>基本属性外还有<code>rowspan</code> <code>colspan</code> <code>empty-cells</code>三个属性。</p>\n<p>需要注意的是<code>rowspan</code>与<code>colspan</code>只能通过<code>html</code>属性设置，而不能通过<code>css</code>样式引用。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>表格大概是<code>html</code>里面最常用的元素之一。看书上介绍说，在<code>css</code>出现之前，前端工程师一直采用<code>table</code>来布局页面，<br>不过我没有尝试过，相比于那些早些年的前端工程师，现在的前端工程师应该算比较幸运吧！<code>IE</code>系列老旧浏览器逐渐<code>死去</code>，<br><code>HTML5</code>标准颁布，一切都在往好的方向走～</p>\n<h1 id=\"表格的基本属性以及实践\"><a href=\"#表格的基本属性以及实践\" class=\"headerlink\" title=\"表格的基本属性以及实践\"></a>表格的基本属性以及实践</h1><h2 id=\"表格相关的基本元素\"><a href=\"#表格相关的基本元素\" class=\"headerlink\" title=\"表格相关的基本元素\"></a>表格相关的基本元素</h2><ul>\n<li>table<br>定义表格的根元素</li>\n<li>thead<br>定义表头(页眉)</li>\n<li>tbody<br>定义表体</li>\n<li>tfoot<br>定义表脚(页脚)</li>\n<li>tr<br>定义一行</li>\n<li>th<br>定义表头内单元格</li>\n<li>td<br>定义普通数据单元格</li>\n<li>caption<br>定义表格标题</li>\n<li>col<br>定义表格列</li>\n<li>colgroup<br>定义表格列组</li>\n</ul>\n<hr>\n<p><strong>注意事项</strong>：</p>\n<ul>\n<li><code>thead</code>、<code>tbody</code>、<code>tfoot</code>主要方便对表格不同区域进行分组，以及在打印表格的时候提供不同信息。</li>\n<li><code>td</code>、<code>th</code>单元格必须包含在<code>tr</code>属性里面</li>\n<li><code>col</code>、<code>colgroup</code>元素主要方便对表格不同列进行样式设置,需要注意的是列元素可以控制的属性<a href=\"http://www.w3.org/TR/CSS21/tables.html#columns\" target=\"_blank\" rel=\"noopener\">比较有限</a>.基本的<code>color</code>、<code>text-align</code>都不被支持</li>\n</ul>\n<p>比较合理的解释看这里：</p>\n<blockquote>\n<p>The colour of text is dependent on the ‘color’ property of its element. Unless specified, the ‘color’ property (basically) defaults to ‘inherit’, which means “take the value of the parent element”.</p>\n</blockquote>\n<p>So for some text in a cell, the colour is determined by the ‘color’ property of the cell, which is taken from the row, which is taken from the table, which is taken from the table’s parent, and so on.</p>\n<p>What about the column? Well, the column isn’t one of the cell’s ancestors, so it never gets a look-in! And therein lies the problem.</p>\n<h2 id=\"表格样式布局\"><a href=\"#表格样式布局\" class=\"headerlink\" title=\"表格样式布局\"></a>表格样式布局</h2><ul>\n<li>caption-side<br>控制表格标题位置</li>\n<li>border-collapse<br>控制表格边框模型</li>\n<li>table-layout<br>控制表格布局，是否根据单元格内容缩放</li>\n<li>border-spacing<br>控制相邻单元格边框之间的距离，仅用于边框模型为分离模式</li>\n<li>empty-cells<br>控制隐藏表格中空单元格的背景与边框</li>\n<li>rowspan<br>控制单元格所跨行数</li>\n<li>colspan<br>控制单元格所跨列数</li>\n</ul>\n<hr>\n<h2 id=\"实践问题\"><a href=\"#实践问题\" class=\"headerlink\" title=\"实践问题\"></a>实践问题</h2><h3 id=\"奇偶行设置不同背景色\"><a href=\"#奇偶行设置不同背景色\" class=\"headerlink\" title=\"奇偶行设置不同背景色\"></a>奇偶行设置不同背景色</h3><p>1、css 奇偶行伪类选择器</p>\n<p><code>nth-child(n)</code>选择器匹配其父元素的第<code>n</code>个子元素，odd 和 even 是可用于匹配下标是奇数或偶数的子元素的关键词。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">table</span> <span class=\"selector-tag\">tr</span><span class=\"selector-pseudo\">:nth-child(even)</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>为<code>tr</code>相对父元素为偶数索引(从1开始)的行设置背景为红色</p>\n</blockquote>\n<h3 id=\"设置第一列为不同背景\"><a href=\"#设置第一列为不同背景\" class=\"headerlink\" title=\"设置第一列为不同背景\"></a>设置第一列为不同背景</h3><p>1、使用<code>first-child</code>伪类选择器</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">table</span> <span class=\"selector-tag\">td</span><span class=\"selector-pseudo\">:first-child</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2、使用<code>col</code>元素控制样式</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">caption</span>&gt;</span>hahah<span class=\"tag\">&lt;/<span class=\"name\">caption</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">col</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col1\"</span>\\&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>th1<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>th2<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">    /...</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">table</span> <span class=\"selector-class\">.col1</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: gray;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"设置单元格边框并合并单元格\"><a href=\"#设置单元格边框并合并单元格\" class=\"headerlink\" title=\"设置单元格边框并合并单元格\"></a>设置单元格边框并合并单元格</h3><p>控制单元格的显示除了<code>盒模型</code>基本属性外还有<code>rowspan</code> <code>colspan</code> <code>empty-cells</code>三个属性。</p>\n<p>需要注意的是<code>rowspan</code>与<code>colspan</code>只能通过<code>html</code>属性设置，而不能通过<code>css</code>样式引用。</p>\n"},{"title":"npm-的工作原理","_content":"### 包(Package)和模块(Module)  \n\n#### 如何定义一个`Package`  \n\n满足如下条件都可以称为一个包：  \n- 一个文件夹包含应用程序，使用`package.json`来描述它(a)    \n- 一个用gzip压缩的文件夹，满足(a)定义(b)    \n- 一个url可以获取(b)描述的压缩包(c)  \n- 一个<name>@<version>描述的一个包已经被发布到`npm`仓库 (d)  \n- 一个<name>@<tag>描述的包同(e)  \n- 一个<name>描述的包，并且具有`latest`标签，满足(e) (f)    \n- 一个`git url` 可以被克隆，满足(a) 定义  \n\n---  \n\n**即使没有把包推送到公共的`npm`仓库，依然可以从`npm`获得很多好处：**  \n+ 如果你只是想写一个基于`nodejs`的应用程序，或者  \n+ 如果你想安装一个压缩的包  \n\n`git URL`可以是以下几种格式：  \n- git://github.com/user/project.git#commit-ish  \n- git+ssh://user@hostname:project.git#commit-ish  \n- git+http://user@hostname/project/blah.git#commit-ish  \n- git+https://user@hostname/project/blah.git#commit-ish  \n\n`commit-ish` 是一个可以`git checkout`的参数。默认为`master`。  \n\n---  \n\n#### 如何定义一个`Module`  \n\n**`Module`是任何的能被`nodejs`程序使用`require`加载的模块。**满足以下条件均可以称为`Module`：  \n+ 一个文件夹包含`package.json`文件并指定了`main`字段  \n+ 一个文件夹包含`index.js`文件  \n+ 一个`javascript`文件  \n\n\n#### 大多数`Package`都是一个`Module`  \n\n譬如说一些`cli`程序的`package`只包含一些可执行的命令行程序，并没有提供`main`字段来指定程序供外部使用。 这些`package`不是`module`。  \n\n---  \n\n### npm v2解析包的依赖关系  \n\n想像一下现在有三个模块`module A`、`module B`、`module C`。A依赖B的`V1`版本，C依赖于B的`V2`版本。  \n![deps2](http://7xsec6.com1.z0.glb.clouddn.com/deps2.png)  \n\n\n现在创建一个应用程序依赖`A`和`C`。   \n![deps4](http://7xsec6.com1.z0.glb.clouddn.com/deps4.png)  \n\n---  \n#### 模块依赖地狱(Dependency Hell)  \n包管理器必须必须提供一个`module B`的版本。在`nodejs`之前的`runtime`，都会尝试通过提供一个折中的版本来解决它。\n![deps3](http://7xsec6.com1.z0.glb.clouddn.com/deps3.png)  \n\n\n`npm`采取了另外一种方式，**把依赖的模块包嵌入子目录：**    \n![deps](http://7xsec6.com1.z0.glb.clouddn.com/deps.png)  \n\n\n---  \n\n### npm V3 解析包的依赖关系  \n\nnpm3和npm2的不同之处在于：  \n> npm2使用嵌套的方式来管理依赖包，`npm3`尝试缓和过长的包依赖路径问题。 把二级依赖的包安装在同一级目录下。  \n\n想像一下我们有一个模块`A`依赖模块`B`。我们在安装模块`A`的时候，在项目的`node_modules`文件夹下： 可以看到 `npm v2`与`npm v3`的差异：  \n\n![deps2deps3](http://7xsec6.com1.z0.glb.clouddn.com/npm3deps2.png)  \n\n\n现在我们需要安装一个模块`C`，模块`C`依赖模块`B`但是版本与模块`A`依赖的不同：  \n\n![deps3deps3](http://7xsec6.com1.z0.glb.clouddn.com/npm3deps3.png)  \n\n\n由于`B v1.0`已经安装在`node_modules`目录的根目录下了，不能把`B v2.0`也安装在根目录下。这个时候`npm v3`的处理方式和`npm v2`类似：  \n\n![deps3deps4](http://7xsec6.com1.z0.glb.clouddn.com/npm3deps4.png)  \n\n\n通过 `npm ls`查看当前项目所有包的依赖关系。如果只是想看顶级包的依赖关系可以执行`npm ls --depth=0`。  \n\n---  \n### `npm v3`去重  \n\n**npm dedupe**\n\n该命令会删除`node_modules`顶级目录下没有被使用的模块，并且把被重复依赖的模块移动到顶级目录下。  \n\n\n","source":"_posts/npm-的工作原理.md","raw":"---\ntitle: npm-的工作原理\ncategories: server\n---\n### 包(Package)和模块(Module)  \n\n#### 如何定义一个`Package`  \n\n满足如下条件都可以称为一个包：  \n- 一个文件夹包含应用程序，使用`package.json`来描述它(a)    \n- 一个用gzip压缩的文件夹，满足(a)定义(b)    \n- 一个url可以获取(b)描述的压缩包(c)  \n- 一个<name>@<version>描述的一个包已经被发布到`npm`仓库 (d)  \n- 一个<name>@<tag>描述的包同(e)  \n- 一个<name>描述的包，并且具有`latest`标签，满足(e) (f)    \n- 一个`git url` 可以被克隆，满足(a) 定义  \n\n---  \n\n**即使没有把包推送到公共的`npm`仓库，依然可以从`npm`获得很多好处：**  \n+ 如果你只是想写一个基于`nodejs`的应用程序，或者  \n+ 如果你想安装一个压缩的包  \n\n`git URL`可以是以下几种格式：  \n- git://github.com/user/project.git#commit-ish  \n- git+ssh://user@hostname:project.git#commit-ish  \n- git+http://user@hostname/project/blah.git#commit-ish  \n- git+https://user@hostname/project/blah.git#commit-ish  \n\n`commit-ish` 是一个可以`git checkout`的参数。默认为`master`。  \n\n---  \n\n#### 如何定义一个`Module`  \n\n**`Module`是任何的能被`nodejs`程序使用`require`加载的模块。**满足以下条件均可以称为`Module`：  \n+ 一个文件夹包含`package.json`文件并指定了`main`字段  \n+ 一个文件夹包含`index.js`文件  \n+ 一个`javascript`文件  \n\n\n#### 大多数`Package`都是一个`Module`  \n\n譬如说一些`cli`程序的`package`只包含一些可执行的命令行程序，并没有提供`main`字段来指定程序供外部使用。 这些`package`不是`module`。  \n\n---  \n\n### npm v2解析包的依赖关系  \n\n想像一下现在有三个模块`module A`、`module B`、`module C`。A依赖B的`V1`版本，C依赖于B的`V2`版本。  \n![deps2](http://7xsec6.com1.z0.glb.clouddn.com/deps2.png)  \n\n\n现在创建一个应用程序依赖`A`和`C`。   \n![deps4](http://7xsec6.com1.z0.glb.clouddn.com/deps4.png)  \n\n---  \n#### 模块依赖地狱(Dependency Hell)  \n包管理器必须必须提供一个`module B`的版本。在`nodejs`之前的`runtime`，都会尝试通过提供一个折中的版本来解决它。\n![deps3](http://7xsec6.com1.z0.glb.clouddn.com/deps3.png)  \n\n\n`npm`采取了另外一种方式，**把依赖的模块包嵌入子目录：**    \n![deps](http://7xsec6.com1.z0.glb.clouddn.com/deps.png)  \n\n\n---  \n\n### npm V3 解析包的依赖关系  \n\nnpm3和npm2的不同之处在于：  \n> npm2使用嵌套的方式来管理依赖包，`npm3`尝试缓和过长的包依赖路径问题。 把二级依赖的包安装在同一级目录下。  \n\n想像一下我们有一个模块`A`依赖模块`B`。我们在安装模块`A`的时候，在项目的`node_modules`文件夹下： 可以看到 `npm v2`与`npm v3`的差异：  \n\n![deps2deps3](http://7xsec6.com1.z0.glb.clouddn.com/npm3deps2.png)  \n\n\n现在我们需要安装一个模块`C`，模块`C`依赖模块`B`但是版本与模块`A`依赖的不同：  \n\n![deps3deps3](http://7xsec6.com1.z0.glb.clouddn.com/npm3deps3.png)  \n\n\n由于`B v1.0`已经安装在`node_modules`目录的根目录下了，不能把`B v2.0`也安装在根目录下。这个时候`npm v3`的处理方式和`npm v2`类似：  \n\n![deps3deps4](http://7xsec6.com1.z0.glb.clouddn.com/npm3deps4.png)  \n\n\n通过 `npm ls`查看当前项目所有包的依赖关系。如果只是想看顶级包的依赖关系可以执行`npm ls --depth=0`。  \n\n---  \n### `npm v3`去重  \n\n**npm dedupe**\n\n该命令会删除`node_modules`顶级目录下没有被使用的模块，并且把被重复依赖的模块移动到顶级目录下。  \n\n\n","slug":"npm-的工作原理","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlxy001r9co7vmutj2tf","content":"<h3 id=\"包-Package-和模块-Module\"><a href=\"#包-Package-和模块-Module\" class=\"headerlink\" title=\"包(Package)和模块(Module)\"></a>包(Package)和模块(Module)</h3><h4 id=\"如何定义一个Package\"><a href=\"#如何定义一个Package\" class=\"headerlink\" title=\"如何定义一个Package\"></a>如何定义一个<code>Package</code></h4><p>满足如下条件都可以称为一个包：  </p>\n<ul>\n<li>一个文件夹包含应用程序，使用<code>package.json</code>来描述它(a)    </li>\n<li>一个用gzip压缩的文件夹，满足(a)定义(b)    </li>\n<li>一个url可以获取(b)描述的压缩包(c)  </li>\n<li>一个<name>@<version>描述的一个包已经被发布到<code>npm</code>仓库 (d)  </version></name></li>\n<li>一个<name>@<tag>描述的包同(e)  </tag></name></li>\n<li>一个<name>描述的包，并且具有<code>latest</code>标签，满足(e) (f)    </name></li>\n<li>一个<code>git url</code> 可以被克隆，满足(a) 定义  </li>\n</ul>\n<hr>\n<p><strong>即使没有把包推送到公共的<code>npm</code>仓库，依然可以从<code>npm</code>获得很多好处：</strong>  </p>\n<ul>\n<li>如果你只是想写一个基于<code>nodejs</code>的应用程序，或者  </li>\n<li>如果你想安装一个压缩的包  </li>\n</ul>\n<p><code>git URL</code>可以是以下几种格式：  </p>\n<ul>\n<li>git://github.com/user/project.git#commit-ish  </li>\n<li>git+ssh://user@hostname:project.git#commit-ish  </li>\n<li>git+<a href=\"http://user@hostname/project/blah.git#commit-ish\" target=\"_blank\" rel=\"noopener\">http://user@hostname/project/blah.git#commit-ish</a>  </li>\n<li>git+<a href=\"https://user@hostname/project/blah.git#commit-ish\" target=\"_blank\" rel=\"noopener\">https://user@hostname/project/blah.git#commit-ish</a>  </li>\n</ul>\n<p><code>commit-ish</code> 是一个可以<code>git checkout</code>的参数。默认为<code>master</code>。  </p>\n<hr>\n<h4 id=\"如何定义一个Module\"><a href=\"#如何定义一个Module\" class=\"headerlink\" title=\"如何定义一个Module\"></a>如何定义一个<code>Module</code></h4><p><strong><code>Module</code>是任何的能被<code>nodejs</code>程序使用<code>require</code>加载的模块。</strong>满足以下条件均可以称为<code>Module</code>：  </p>\n<ul>\n<li>一个文件夹包含<code>package.json</code>文件并指定了<code>main</code>字段  </li>\n<li>一个文件夹包含<code>index.js</code>文件  </li>\n<li>一个<code>javascript</code>文件  </li>\n</ul>\n<h4 id=\"大多数Package都是一个Module\"><a href=\"#大多数Package都是一个Module\" class=\"headerlink\" title=\"大多数Package都是一个Module\"></a>大多数<code>Package</code>都是一个<code>Module</code></h4><p>譬如说一些<code>cli</code>程序的<code>package</code>只包含一些可执行的命令行程序，并没有提供<code>main</code>字段来指定程序供外部使用。 这些<code>package</code>不是<code>module</code>。  </p>\n<hr>\n<h3 id=\"npm-v2解析包的依赖关系\"><a href=\"#npm-v2解析包的依赖关系\" class=\"headerlink\" title=\"npm v2解析包的依赖关系\"></a>npm v2解析包的依赖关系</h3><p>想像一下现在有三个模块<code>module A</code>、<code>module B</code>、<code>module C</code>。A依赖B的<code>V1</code>版本，C依赖于B的<code>V2</code>版本。<br><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/deps2.png\" alt=\"deps2\">  </p>\n<p>现在创建一个应用程序依赖<code>A</code>和<code>C</code>。<br><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/deps4.png\" alt=\"deps4\">  </p>\n<hr>\n<h4 id=\"模块依赖地狱-Dependency-Hell\"><a href=\"#模块依赖地狱-Dependency-Hell\" class=\"headerlink\" title=\"模块依赖地狱(Dependency Hell)\"></a>模块依赖地狱(Dependency Hell)</h4><p>包管理器必须必须提供一个<code>module B</code>的版本。在<code>nodejs</code>之前的<code>runtime</code>，都会尝试通过提供一个折中的版本来解决它。<br><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/deps3.png\" alt=\"deps3\">  </p>\n<p><code>npm</code>采取了另外一种方式，<strong>把依赖的模块包嵌入子目录：</strong><br><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/deps.png\" alt=\"deps\">  </p>\n<hr>\n<h3 id=\"npm-V3-解析包的依赖关系\"><a href=\"#npm-V3-解析包的依赖关系\" class=\"headerlink\" title=\"npm V3 解析包的依赖关系\"></a>npm V3 解析包的依赖关系</h3><p>npm3和npm2的不同之处在于：  </p>\n<blockquote>\n<p>npm2使用嵌套的方式来管理依赖包，<code>npm3</code>尝试缓和过长的包依赖路径问题。 把二级依赖的包安装在同一级目录下。  </p>\n</blockquote>\n<p>想像一下我们有一个模块<code>A</code>依赖模块<code>B</code>。我们在安装模块<code>A</code>的时候，在项目的<code>node_modules</code>文件夹下： 可以看到 <code>npm v2</code>与<code>npm v3</code>的差异：  </p>\n<p><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/npm3deps2.png\" alt=\"deps2deps3\">  </p>\n<p>现在我们需要安装一个模块<code>C</code>，模块<code>C</code>依赖模块<code>B</code>但是版本与模块<code>A</code>依赖的不同：  </p>\n<p><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/npm3deps3.png\" alt=\"deps3deps3\">  </p>\n<p>由于<code>B v1.0</code>已经安装在<code>node_modules</code>目录的根目录下了，不能把<code>B v2.0</code>也安装在根目录下。这个时候<code>npm v3</code>的处理方式和<code>npm v2</code>类似：  </p>\n<p><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/npm3deps4.png\" alt=\"deps3deps4\">  </p>\n<p>通过 <code>npm ls</code>查看当前项目所有包的依赖关系。如果只是想看顶级包的依赖关系可以执行<code>npm ls --depth=0</code>。  </p>\n<hr>\n<h3 id=\"npm-v3去重\"><a href=\"#npm-v3去重\" class=\"headerlink\" title=\"npm v3去重\"></a><code>npm v3</code>去重</h3><p><strong>npm dedupe</strong></p>\n<p>该命令会删除<code>node_modules</code>顶级目录下没有被使用的模块，并且把被重复依赖的模块移动到顶级目录下。  </p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"包-Package-和模块-Module\"><a href=\"#包-Package-和模块-Module\" class=\"headerlink\" title=\"包(Package)和模块(Module)\"></a>包(Package)和模块(Module)</h3><h4 id=\"如何定义一个Package\"><a href=\"#如何定义一个Package\" class=\"headerlink\" title=\"如何定义一个Package\"></a>如何定义一个<code>Package</code></h4><p>满足如下条件都可以称为一个包：  </p>\n<ul>\n<li>一个文件夹包含应用程序，使用<code>package.json</code>来描述它(a)    </li>\n<li>一个用gzip压缩的文件夹，满足(a)定义(b)    </li>\n<li>一个url可以获取(b)描述的压缩包(c)  </li>\n<li>一个<name>@<version>描述的一个包已经被发布到<code>npm</code>仓库 (d)  </version></name></li>\n<li>一个<name>@<tag>描述的包同(e)  </tag></name></li>\n<li>一个<name>描述的包，并且具有<code>latest</code>标签，满足(e) (f)    </name></li>\n<li>一个<code>git url</code> 可以被克隆，满足(a) 定义  </li>\n</ul>\n<hr>\n<p><strong>即使没有把包推送到公共的<code>npm</code>仓库，依然可以从<code>npm</code>获得很多好处：</strong>  </p>\n<ul>\n<li>如果你只是想写一个基于<code>nodejs</code>的应用程序，或者  </li>\n<li>如果你想安装一个压缩的包  </li>\n</ul>\n<p><code>git URL</code>可以是以下几种格式：  </p>\n<ul>\n<li>git://github.com/user/project.git#commit-ish  </li>\n<li>git+ssh://user@hostname:project.git#commit-ish  </li>\n<li>git+<a href=\"http://user@hostname/project/blah.git#commit-ish\" target=\"_blank\" rel=\"noopener\">http://user@hostname/project/blah.git#commit-ish</a>  </li>\n<li>git+<a href=\"https://user@hostname/project/blah.git#commit-ish\" target=\"_blank\" rel=\"noopener\">https://user@hostname/project/blah.git#commit-ish</a>  </li>\n</ul>\n<p><code>commit-ish</code> 是一个可以<code>git checkout</code>的参数。默认为<code>master</code>。  </p>\n<hr>\n<h4 id=\"如何定义一个Module\"><a href=\"#如何定义一个Module\" class=\"headerlink\" title=\"如何定义一个Module\"></a>如何定义一个<code>Module</code></h4><p><strong><code>Module</code>是任何的能被<code>nodejs</code>程序使用<code>require</code>加载的模块。</strong>满足以下条件均可以称为<code>Module</code>：  </p>\n<ul>\n<li>一个文件夹包含<code>package.json</code>文件并指定了<code>main</code>字段  </li>\n<li>一个文件夹包含<code>index.js</code>文件  </li>\n<li>一个<code>javascript</code>文件  </li>\n</ul>\n<h4 id=\"大多数Package都是一个Module\"><a href=\"#大多数Package都是一个Module\" class=\"headerlink\" title=\"大多数Package都是一个Module\"></a>大多数<code>Package</code>都是一个<code>Module</code></h4><p>譬如说一些<code>cli</code>程序的<code>package</code>只包含一些可执行的命令行程序，并没有提供<code>main</code>字段来指定程序供外部使用。 这些<code>package</code>不是<code>module</code>。  </p>\n<hr>\n<h3 id=\"npm-v2解析包的依赖关系\"><a href=\"#npm-v2解析包的依赖关系\" class=\"headerlink\" title=\"npm v2解析包的依赖关系\"></a>npm v2解析包的依赖关系</h3><p>想像一下现在有三个模块<code>module A</code>、<code>module B</code>、<code>module C</code>。A依赖B的<code>V1</code>版本，C依赖于B的<code>V2</code>版本。<br><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/deps2.png\" alt=\"deps2\">  </p>\n<p>现在创建一个应用程序依赖<code>A</code>和<code>C</code>。<br><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/deps4.png\" alt=\"deps4\">  </p>\n<hr>\n<h4 id=\"模块依赖地狱-Dependency-Hell\"><a href=\"#模块依赖地狱-Dependency-Hell\" class=\"headerlink\" title=\"模块依赖地狱(Dependency Hell)\"></a>模块依赖地狱(Dependency Hell)</h4><p>包管理器必须必须提供一个<code>module B</code>的版本。在<code>nodejs</code>之前的<code>runtime</code>，都会尝试通过提供一个折中的版本来解决它。<br><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/deps3.png\" alt=\"deps3\">  </p>\n<p><code>npm</code>采取了另外一种方式，<strong>把依赖的模块包嵌入子目录：</strong><br><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/deps.png\" alt=\"deps\">  </p>\n<hr>\n<h3 id=\"npm-V3-解析包的依赖关系\"><a href=\"#npm-V3-解析包的依赖关系\" class=\"headerlink\" title=\"npm V3 解析包的依赖关系\"></a>npm V3 解析包的依赖关系</h3><p>npm3和npm2的不同之处在于：  </p>\n<blockquote>\n<p>npm2使用嵌套的方式来管理依赖包，<code>npm3</code>尝试缓和过长的包依赖路径问题。 把二级依赖的包安装在同一级目录下。  </p>\n</blockquote>\n<p>想像一下我们有一个模块<code>A</code>依赖模块<code>B</code>。我们在安装模块<code>A</code>的时候，在项目的<code>node_modules</code>文件夹下： 可以看到 <code>npm v2</code>与<code>npm v3</code>的差异：  </p>\n<p><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/npm3deps2.png\" alt=\"deps2deps3\">  </p>\n<p>现在我们需要安装一个模块<code>C</code>，模块<code>C</code>依赖模块<code>B</code>但是版本与模块<code>A</code>依赖的不同：  </p>\n<p><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/npm3deps3.png\" alt=\"deps3deps3\">  </p>\n<p>由于<code>B v1.0</code>已经安装在<code>node_modules</code>目录的根目录下了，不能把<code>B v2.0</code>也安装在根目录下。这个时候<code>npm v3</code>的处理方式和<code>npm v2</code>类似：  </p>\n<p><img src=\"http://7xsec6.com1.z0.glb.clouddn.com/npm3deps4.png\" alt=\"deps3deps4\">  </p>\n<p>通过 <code>npm ls</code>查看当前项目所有包的依赖关系。如果只是想看顶级包的依赖关系可以执行<code>npm ls --depth=0</code>。  </p>\n<hr>\n<h3 id=\"npm-v3去重\"><a href=\"#npm-v3去重\" class=\"headerlink\" title=\"npm v3去重\"></a><code>npm v3</code>去重</h3><p><strong>npm dedupe</strong></p>\n<p>该命令会删除<code>node_modules</code>顶级目录下没有被使用的模块，并且把被重复依赖的模块移动到顶级目录下。  </p>\n"},{"title":"vscode开发环境配置","_content":"\n## 初衷  \n\n一直一来都是`vim`编辑器的忠实用户，说来也没有什么特别的原因，只不过是因为用的久了，习惯罢了。\n改变已有的习惯就跟在学习新知识的时候刻意练习会带来同样的体会，会让你感觉不舒服。之所以想放弃使用多年的`vim`\n(也就3-4年罢了)转投`vscode`名下，只不过是想实践一下笑来老师的方法论，说来惭愧看到笑来老师写的关于编程系列的文章，自愧不如。一直觉得自己是一个慢调子的人，\n思维不够活跃，在朋友眼里属于脑子不够灵活的那类人吧！也就是那类不会来事的人！  \n\n不过这样也好，懒得跟他们争论。我知道自己有很多不足，我可以学习更多的方法论，不断的实践来总结提高自己。努力`成为那些会说话的人`。\n\n\n## 前言\n\n> \n学习任何东西都有一个有效的方法论：在了解了一些必要的知识之后，快速开始行动，\n刻意练习！在练习中不断总结提高！            --`李笑来`  \n\n科学研究者把人们应对一件事情分为3个步骤：\n- 1、认知该事件的方式方法。 \n- 2、通过何种方式方法可以完成该事情。\n- 3、实践该方法的步骤以及条件。\n\n一直以来都是`笑来`老师的忠实读者，拿学习这件事情来说，大多数人倡导需要强大的意志力、强烈的欲望、详细的计划来监督自己，达到学习的目的。\n而笑来老师倡导一个更为深入本质的看待学习这件事情的方式方法：`学习只是一种生活方式，不需要而外的动力，活着就应该不断的学习！`。站在这样\n的一个角度来看待学习这个问题，将会得到一个解脱，学习会变得跟吃饭睡觉一样自然。  \n   七年就是一辈子，加油吧！  \n\n## 安装编辑器\n\n在`github`上找到`vscode`仓库，简要的阅读一下`readme`文档，然后再阅读一下\n`How to build and run from source`。`vscode`是基于`electron`开发的，所以再安装过程中需要下载`electron`的平台包，考虑到墙的原因\n我们可以自己下载`electron` [electron](https://npm.taobao.org/mirrors/electron),放到`vscode`根目录的`.build`下的`electron`文件夹\n\n另外一种安装方式更为简便，到`vscode`官网下载安装包并安装。  \n\n## 阅读官方文档\n\n`vscode`官方网站是 `https://code.visualstudio.com`。阅读完`overview`以及`setup`下的平台环境完成安装。\n对于新手来说接下来应该认真阅读`EDITOR`一章。\n\n## vscode cheatsheet\n\n对于 任意一个软件来说，掌握好了快捷键会提升你的效率，让你有更多的时间专注于有价值的事情上。\n`vscode`按下`F1`快捷键，会提示所有的快捷键，还有一种方式：打开`File=>Preferences=>keyboard Shortcuts`\n列出所有的快捷键。另外这一章节的内容必须把它背下来：`https://code.visualstudio.com/docs/editor/editingevolved`。\n\n小结：\n- vscode `EDITOR`一章  \n- vscode cheatsheet  \n","source":"_posts/vscode开发环境配置.md","raw":"---\ntitle: vscode开发环境配置\ncategories: vscode\n---\n\n## 初衷  \n\n一直一来都是`vim`编辑器的忠实用户，说来也没有什么特别的原因，只不过是因为用的久了，习惯罢了。\n改变已有的习惯就跟在学习新知识的时候刻意练习会带来同样的体会，会让你感觉不舒服。之所以想放弃使用多年的`vim`\n(也就3-4年罢了)转投`vscode`名下，只不过是想实践一下笑来老师的方法论，说来惭愧看到笑来老师写的关于编程系列的文章，自愧不如。一直觉得自己是一个慢调子的人，\n思维不够活跃，在朋友眼里属于脑子不够灵活的那类人吧！也就是那类不会来事的人！  \n\n不过这样也好，懒得跟他们争论。我知道自己有很多不足，我可以学习更多的方法论，不断的实践来总结提高自己。努力`成为那些会说话的人`。\n\n\n## 前言\n\n> \n学习任何东西都有一个有效的方法论：在了解了一些必要的知识之后，快速开始行动，\n刻意练习！在练习中不断总结提高！            --`李笑来`  \n\n科学研究者把人们应对一件事情分为3个步骤：\n- 1、认知该事件的方式方法。 \n- 2、通过何种方式方法可以完成该事情。\n- 3、实践该方法的步骤以及条件。\n\n一直以来都是`笑来`老师的忠实读者，拿学习这件事情来说，大多数人倡导需要强大的意志力、强烈的欲望、详细的计划来监督自己，达到学习的目的。\n而笑来老师倡导一个更为深入本质的看待学习这件事情的方式方法：`学习只是一种生活方式，不需要而外的动力，活着就应该不断的学习！`。站在这样\n的一个角度来看待学习这个问题，将会得到一个解脱，学习会变得跟吃饭睡觉一样自然。  \n   七年就是一辈子，加油吧！  \n\n## 安装编辑器\n\n在`github`上找到`vscode`仓库，简要的阅读一下`readme`文档，然后再阅读一下\n`How to build and run from source`。`vscode`是基于`electron`开发的，所以再安装过程中需要下载`electron`的平台包，考虑到墙的原因\n我们可以自己下载`electron` [electron](https://npm.taobao.org/mirrors/electron),放到`vscode`根目录的`.build`下的`electron`文件夹\n\n另外一种安装方式更为简便，到`vscode`官网下载安装包并安装。  \n\n## 阅读官方文档\n\n`vscode`官方网站是 `https://code.visualstudio.com`。阅读完`overview`以及`setup`下的平台环境完成安装。\n对于新手来说接下来应该认真阅读`EDITOR`一章。\n\n## vscode cheatsheet\n\n对于 任意一个软件来说，掌握好了快捷键会提升你的效率，让你有更多的时间专注于有价值的事情上。\n`vscode`按下`F1`快捷键，会提示所有的快捷键，还有一种方式：打开`File=>Preferences=>keyboard Shortcuts`\n列出所有的快捷键。另外这一章节的内容必须把它背下来：`https://code.visualstudio.com/docs/editor/editingevolved`。\n\n小结：\n- vscode `EDITOR`一章  \n- vscode cheatsheet  \n","slug":"vscode开发环境配置","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhly0001u9co7nj50ft9l","content":"<h2 id=\"初衷\"><a href=\"#初衷\" class=\"headerlink\" title=\"初衷\"></a>初衷</h2><p>一直一来都是<code>vim</code>编辑器的忠实用户，说来也没有什么特别的原因，只不过是因为用的久了，习惯罢了。<br>改变已有的习惯就跟在学习新知识的时候刻意练习会带来同样的体会，会让你感觉不舒服。之所以想放弃使用多年的<code>vim</code><br>(也就3-4年罢了)转投<code>vscode</code>名下，只不过是想实践一下笑来老师的方法论，说来惭愧看到笑来老师写的关于编程系列的文章，自愧不如。一直觉得自己是一个慢调子的人，<br>思维不够活跃，在朋友眼里属于脑子不够灵活的那类人吧！也就是那类不会来事的人！  </p>\n<p>不过这样也好，懒得跟他们争论。我知道自己有很多不足，我可以学习更多的方法论，不断的实践来总结提高自己。努力<code>成为那些会说话的人</code>。</p>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><blockquote>\n<p>学习任何东西都有一个有效的方法论：在了解了一些必要的知识之后，快速开始行动，<br>刻意练习！在练习中不断总结提高！            –<code>李笑来</code>  </p>\n</blockquote>\n<p>科学研究者把人们应对一件事情分为3个步骤：</p>\n<ul>\n<li>1、认知该事件的方式方法。 </li>\n<li>2、通过何种方式方法可以完成该事情。</li>\n<li>3、实践该方法的步骤以及条件。</li>\n</ul>\n<p>一直以来都是<code>笑来</code>老师的忠实读者，拿学习这件事情来说，大多数人倡导需要强大的意志力、强烈的欲望、详细的计划来监督自己，达到学习的目的。<br>而笑来老师倡导一个更为深入本质的看待学习这件事情的方式方法：<code>学习只是一种生活方式，不需要而外的动力，活着就应该不断的学习！</code>。站在这样<br>的一个角度来看待学习这个问题，将会得到一个解脱，学习会变得跟吃饭睡觉一样自然。<br>   七年就是一辈子，加油吧！  </p>\n<h2 id=\"安装编辑器\"><a href=\"#安装编辑器\" class=\"headerlink\" title=\"安装编辑器\"></a>安装编辑器</h2><p>在<code>github</code>上找到<code>vscode</code>仓库，简要的阅读一下<code>readme</code>文档，然后再阅读一下<br><code>How to build and run from source</code>。<code>vscode</code>是基于<code>electron</code>开发的，所以再安装过程中需要下载<code>electron</code>的平台包，考虑到墙的原因<br>我们可以自己下载<code>electron</code> <a href=\"https://npm.taobao.org/mirrors/electron\" target=\"_blank\" rel=\"noopener\">electron</a>,放到<code>vscode</code>根目录的<code>.build</code>下的<code>electron</code>文件夹</p>\n<p>另外一种安装方式更为简便，到<code>vscode</code>官网下载安装包并安装。  </p>\n<h2 id=\"阅读官方文档\"><a href=\"#阅读官方文档\" class=\"headerlink\" title=\"阅读官方文档\"></a>阅读官方文档</h2><p><code>vscode</code>官方网站是 <code>https://code.visualstudio.com</code>。阅读完<code>overview</code>以及<code>setup</code>下的平台环境完成安装。<br>对于新手来说接下来应该认真阅读<code>EDITOR</code>一章。</p>\n<h2 id=\"vscode-cheatsheet\"><a href=\"#vscode-cheatsheet\" class=\"headerlink\" title=\"vscode cheatsheet\"></a>vscode cheatsheet</h2><p>对于 任意一个软件来说，掌握好了快捷键会提升你的效率，让你有更多的时间专注于有价值的事情上。<br><code>vscode</code>按下<code>F1</code>快捷键，会提示所有的快捷键，还有一种方式：打开<code>File=&gt;Preferences=&gt;keyboard Shortcuts</code><br>列出所有的快捷键。另外这一章节的内容必须把它背下来：<code>https://code.visualstudio.com/docs/editor/editingevolved</code>。</p>\n<p>小结：</p>\n<ul>\n<li>vscode <code>EDITOR</code>一章  </li>\n<li>vscode cheatsheet  </li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"初衷\"><a href=\"#初衷\" class=\"headerlink\" title=\"初衷\"></a>初衷</h2><p>一直一来都是<code>vim</code>编辑器的忠实用户，说来也没有什么特别的原因，只不过是因为用的久了，习惯罢了。<br>改变已有的习惯就跟在学习新知识的时候刻意练习会带来同样的体会，会让你感觉不舒服。之所以想放弃使用多年的<code>vim</code><br>(也就3-4年罢了)转投<code>vscode</code>名下，只不过是想实践一下笑来老师的方法论，说来惭愧看到笑来老师写的关于编程系列的文章，自愧不如。一直觉得自己是一个慢调子的人，<br>思维不够活跃，在朋友眼里属于脑子不够灵活的那类人吧！也就是那类不会来事的人！  </p>\n<p>不过这样也好，懒得跟他们争论。我知道自己有很多不足，我可以学习更多的方法论，不断的实践来总结提高自己。努力<code>成为那些会说话的人</code>。</p>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><blockquote>\n<p>学习任何东西都有一个有效的方法论：在了解了一些必要的知识之后，快速开始行动，<br>刻意练习！在练习中不断总结提高！            –<code>李笑来</code>  </p>\n</blockquote>\n<p>科学研究者把人们应对一件事情分为3个步骤：</p>\n<ul>\n<li>1、认知该事件的方式方法。 </li>\n<li>2、通过何种方式方法可以完成该事情。</li>\n<li>3、实践该方法的步骤以及条件。</li>\n</ul>\n<p>一直以来都是<code>笑来</code>老师的忠实读者，拿学习这件事情来说，大多数人倡导需要强大的意志力、强烈的欲望、详细的计划来监督自己，达到学习的目的。<br>而笑来老师倡导一个更为深入本质的看待学习这件事情的方式方法：<code>学习只是一种生活方式，不需要而外的动力，活着就应该不断的学习！</code>。站在这样<br>的一个角度来看待学习这个问题，将会得到一个解脱，学习会变得跟吃饭睡觉一样自然。<br>   七年就是一辈子，加油吧！  </p>\n<h2 id=\"安装编辑器\"><a href=\"#安装编辑器\" class=\"headerlink\" title=\"安装编辑器\"></a>安装编辑器</h2><p>在<code>github</code>上找到<code>vscode</code>仓库，简要的阅读一下<code>readme</code>文档，然后再阅读一下<br><code>How to build and run from source</code>。<code>vscode</code>是基于<code>electron</code>开发的，所以再安装过程中需要下载<code>electron</code>的平台包，考虑到墙的原因<br>我们可以自己下载<code>electron</code> <a href=\"https://npm.taobao.org/mirrors/electron\" target=\"_blank\" rel=\"noopener\">electron</a>,放到<code>vscode</code>根目录的<code>.build</code>下的<code>electron</code>文件夹</p>\n<p>另外一种安装方式更为简便，到<code>vscode</code>官网下载安装包并安装。  </p>\n<h2 id=\"阅读官方文档\"><a href=\"#阅读官方文档\" class=\"headerlink\" title=\"阅读官方文档\"></a>阅读官方文档</h2><p><code>vscode</code>官方网站是 <code>https://code.visualstudio.com</code>。阅读完<code>overview</code>以及<code>setup</code>下的平台环境完成安装。<br>对于新手来说接下来应该认真阅读<code>EDITOR</code>一章。</p>\n<h2 id=\"vscode-cheatsheet\"><a href=\"#vscode-cheatsheet\" class=\"headerlink\" title=\"vscode cheatsheet\"></a>vscode cheatsheet</h2><p>对于 任意一个软件来说，掌握好了快捷键会提升你的效率，让你有更多的时间专注于有价值的事情上。<br><code>vscode</code>按下<code>F1</code>快捷键，会提示所有的快捷键，还有一种方式：打开<code>File=&gt;Preferences=&gt;keyboard Shortcuts</code><br>列出所有的快捷键。另外这一章节的内容必须把它背下来：<code>https://code.visualstudio.com/docs/editor/editingevolved</code>。</p>\n<p>小结：</p>\n<ul>\n<li>vscode <code>EDITOR</code>一章  </li>\n<li>vscode cheatsheet  </li>\n</ul>\n"},{"title":"position","date":"2016-08-02T15:04:37.000Z","_content":"\n提到`web`控件的布局(`layout`)，`position`的概念必须理清楚。简单对`position`属性的基本概念做一个总结吧！\n以下文档参考了：[CSS-tricks](https://css-tricks.com/almanac/properties/p/position/)、[W3School](http://www.w3schools.com/css/css_positioning.asp)。\n\n---\n\n# `position`基本属性：\n\n- static\n- relative\n- absolute\n- fixed\n- inherits\n\n## static\n\n所有web element默认的`position`属性都为`static`。在`static`模式下，元素的`left`、`top`、`right`、`bottom`、`z-index`。**属性都不起作用**。\n也就是说，默认情况下，所有元素的这些属性都不能用！\n\n\n## relative\n\n`relative`顾名思义表示相对定位，相对元素在正常流中的位置做偏移。注意：**`relative`定位的元素参考的是该元素正常流氏布局的位置**。\n\n\n## absolute\n\n`absolute`又名绝对定位，该属性的元素在计算位置的时候参考的是最近的非`static`属性的祖先元素。如果不存在相应元素，则参考`body`定位。\n注意：`absolute`定位的元素会随着屏幕滚动。\n\n\n## fixed\n\n`fixed`意为固定，参考浏览器视口来定位(`viewport`)。不随屏幕滚动,所以在调出调式工具的时候依然可见。\n\n\n## inherits\n\n`position`属性非继承。所以可以显示的把父元素的属性强制继承过来。\n\n\n\n## 再所说`z-index`\n\n`z-index`表示元素元素所在的层级，默认为`0`，数字越大越贴近用户，当然也可以为负数。","source":"_posts/position.md","raw":"---\ntitle: position\ndate: 2016-08-02 23:04:37\ntags: position layout\ncategories: web\n---\n\n提到`web`控件的布局(`layout`)，`position`的概念必须理清楚。简单对`position`属性的基本概念做一个总结吧！\n以下文档参考了：[CSS-tricks](https://css-tricks.com/almanac/properties/p/position/)、[W3School](http://www.w3schools.com/css/css_positioning.asp)。\n\n---\n\n# `position`基本属性：\n\n- static\n- relative\n- absolute\n- fixed\n- inherits\n\n## static\n\n所有web element默认的`position`属性都为`static`。在`static`模式下，元素的`left`、`top`、`right`、`bottom`、`z-index`。**属性都不起作用**。\n也就是说，默认情况下，所有元素的这些属性都不能用！\n\n\n## relative\n\n`relative`顾名思义表示相对定位，相对元素在正常流中的位置做偏移。注意：**`relative`定位的元素参考的是该元素正常流氏布局的位置**。\n\n\n## absolute\n\n`absolute`又名绝对定位，该属性的元素在计算位置的时候参考的是最近的非`static`属性的祖先元素。如果不存在相应元素，则参考`body`定位。\n注意：`absolute`定位的元素会随着屏幕滚动。\n\n\n## fixed\n\n`fixed`意为固定，参考浏览器视口来定位(`viewport`)。不随屏幕滚动,所以在调出调式工具的时候依然可见。\n\n\n## inherits\n\n`position`属性非继承。所以可以显示的把父元素的属性强制继承过来。\n\n\n\n## 再所说`z-index`\n\n`z-index`表示元素元素所在的层级，默认为`0`，数字越大越贴近用户，当然也可以为负数。","slug":"position","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhly2001x9co7l3stlvag","content":"<p>提到<code>web</code>控件的布局(<code>layout</code>)，<code>position</code>的概念必须理清楚。简单对<code>position</code>属性的基本概念做一个总结吧！<br>以下文档参考了：<a href=\"https://css-tricks.com/almanac/properties/p/position/\" target=\"_blank\" rel=\"noopener\">CSS-tricks</a>、<a href=\"http://www.w3schools.com/css/css_positioning.asp\" target=\"_blank\" rel=\"noopener\">W3School</a>。</p>\n<hr>\n<h1 id=\"position基本属性：\"><a href=\"#position基本属性：\" class=\"headerlink\" title=\"position基本属性：\"></a><code>position</code>基本属性：</h1><ul>\n<li>static</li>\n<li>relative</li>\n<li>absolute</li>\n<li>fixed</li>\n<li>inherits</li>\n</ul>\n<h2 id=\"static\"><a href=\"#static\" class=\"headerlink\" title=\"static\"></a>static</h2><p>所有web element默认的<code>position</code>属性都为<code>static</code>。在<code>static</code>模式下，元素的<code>left</code>、<code>top</code>、<code>right</code>、<code>bottom</code>、<code>z-index</code>。<strong>属性都不起作用</strong>。<br>也就是说，默认情况下，所有元素的这些属性都不能用！</p>\n<h2 id=\"relative\"><a href=\"#relative\" class=\"headerlink\" title=\"relative\"></a>relative</h2><p><code>relative</code>顾名思义表示相对定位，相对元素在正常流中的位置做偏移。注意：<strong><code>relative</code>定位的元素参考的是该元素正常流氏布局的位置</strong>。</p>\n<h2 id=\"absolute\"><a href=\"#absolute\" class=\"headerlink\" title=\"absolute\"></a>absolute</h2><p><code>absolute</code>又名绝对定位，该属性的元素在计算位置的时候参考的是最近的非<code>static</code>属性的祖先元素。如果不存在相应元素，则参考<code>body</code>定位。<br>注意：<code>absolute</code>定位的元素会随着屏幕滚动。</p>\n<h2 id=\"fixed\"><a href=\"#fixed\" class=\"headerlink\" title=\"fixed\"></a>fixed</h2><p><code>fixed</code>意为固定，参考浏览器视口来定位(<code>viewport</code>)。不随屏幕滚动,所以在调出调式工具的时候依然可见。</p>\n<h2 id=\"inherits\"><a href=\"#inherits\" class=\"headerlink\" title=\"inherits\"></a>inherits</h2><p><code>position</code>属性非继承。所以可以显示的把父元素的属性强制继承过来。</p>\n<h2 id=\"再所说z-index\"><a href=\"#再所说z-index\" class=\"headerlink\" title=\"再所说z-index\"></a>再所说<code>z-index</code></h2><p><code>z-index</code>表示元素元素所在的层级，默认为<code>0</code>，数字越大越贴近用户，当然也可以为负数。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>提到<code>web</code>控件的布局(<code>layout</code>)，<code>position</code>的概念必须理清楚。简单对<code>position</code>属性的基本概念做一个总结吧！<br>以下文档参考了：<a href=\"https://css-tricks.com/almanac/properties/p/position/\" target=\"_blank\" rel=\"noopener\">CSS-tricks</a>、<a href=\"http://www.w3schools.com/css/css_positioning.asp\" target=\"_blank\" rel=\"noopener\">W3School</a>。</p>\n<hr>\n<h1 id=\"position基本属性：\"><a href=\"#position基本属性：\" class=\"headerlink\" title=\"position基本属性：\"></a><code>position</code>基本属性：</h1><ul>\n<li>static</li>\n<li>relative</li>\n<li>absolute</li>\n<li>fixed</li>\n<li>inherits</li>\n</ul>\n<h2 id=\"static\"><a href=\"#static\" class=\"headerlink\" title=\"static\"></a>static</h2><p>所有web element默认的<code>position</code>属性都为<code>static</code>。在<code>static</code>模式下，元素的<code>left</code>、<code>top</code>、<code>right</code>、<code>bottom</code>、<code>z-index</code>。<strong>属性都不起作用</strong>。<br>也就是说，默认情况下，所有元素的这些属性都不能用！</p>\n<h2 id=\"relative\"><a href=\"#relative\" class=\"headerlink\" title=\"relative\"></a>relative</h2><p><code>relative</code>顾名思义表示相对定位，相对元素在正常流中的位置做偏移。注意：<strong><code>relative</code>定位的元素参考的是该元素正常流氏布局的位置</strong>。</p>\n<h2 id=\"absolute\"><a href=\"#absolute\" class=\"headerlink\" title=\"absolute\"></a>absolute</h2><p><code>absolute</code>又名绝对定位，该属性的元素在计算位置的时候参考的是最近的非<code>static</code>属性的祖先元素。如果不存在相应元素，则参考<code>body</code>定位。<br>注意：<code>absolute</code>定位的元素会随着屏幕滚动。</p>\n<h2 id=\"fixed\"><a href=\"#fixed\" class=\"headerlink\" title=\"fixed\"></a>fixed</h2><p><code>fixed</code>意为固定，参考浏览器视口来定位(<code>viewport</code>)。不随屏幕滚动,所以在调出调式工具的时候依然可见。</p>\n<h2 id=\"inherits\"><a href=\"#inherits\" class=\"headerlink\" title=\"inherits\"></a>inherits</h2><p><code>position</code>属性非继承。所以可以显示的把父元素的属性强制继承过来。</p>\n<h2 id=\"再所说z-index\"><a href=\"#再所说z-index\" class=\"headerlink\" title=\"再所说z-index\"></a>再所说<code>z-index</code></h2><p><code>z-index</code>表示元素元素所在的层级，默认为<code>0</code>，数字越大越贴近用户，当然也可以为负数。</p>\n"},{"title":"从这个劫持页面我学到了什么?","date":"2016-09-07T11:37:24.000Z","_content":"\n\n## 移动端`input`默认样式\n\n清除样式：\n\n```css\nappearance: none;\n-moz-appearance: none;\n-webkit-appearance: none;\n```\n\n`appearance`属性用于给元素指定平台相关的默认样式。有时候这并不是我们想要的效果。\n\n---\n\n## 垂直居中的`flex`实现\n\n\n```html\n<body>\n  <div class=\"main\">\n  </div>\n</body>\n\n```\n\n```css\n  body {\n    display: flex;\n    min-height: 100vh;\n    align-items: center;\n    flex-direction: column;\n    justify-content: ;\n    background: blue;\n  }\n\n  .main {\n    width: 5em;\n    height: 5em;\n    background: gray;\n  }\n\n```\n\n>`flex-direction: column`把`flex`主轴方向设置在竖直方向，`align-items`控制元素在交叉轴线上(水平方向)的对齐方式。`justify-content`属性控制元素在主轴(竖直方向)的对齐方式。简单的实现了垂直和水平居中。\n\n---\n\n## 控制斜体文本\n\n```css\ninput::-webkit-input-placeholder{\n  font-style: italic;\n}\n```\n\n>输入框的`placeholder`文本是斜体字，根据不同平台，需要把`webkit`、`ms`、`o`、`moz`等前缀的伪元素的样式也一起设置。\n\n---","source":"_posts/从这个劫持页面我学到了什么.md","raw":"---\ntitle: 从这个劫持页面我学到了什么?\ndate: 2016-09-07 19:37:24\ntags: h5\ncategories: web\n---\n\n\n## 移动端`input`默认样式\n\n清除样式：\n\n```css\nappearance: none;\n-moz-appearance: none;\n-webkit-appearance: none;\n```\n\n`appearance`属性用于给元素指定平台相关的默认样式。有时候这并不是我们想要的效果。\n\n---\n\n## 垂直居中的`flex`实现\n\n\n```html\n<body>\n  <div class=\"main\">\n  </div>\n</body>\n\n```\n\n```css\n  body {\n    display: flex;\n    min-height: 100vh;\n    align-items: center;\n    flex-direction: column;\n    justify-content: ;\n    background: blue;\n  }\n\n  .main {\n    width: 5em;\n    height: 5em;\n    background: gray;\n  }\n\n```\n\n>`flex-direction: column`把`flex`主轴方向设置在竖直方向，`align-items`控制元素在交叉轴线上(水平方向)的对齐方式。`justify-content`属性控制元素在主轴(竖直方向)的对齐方式。简单的实现了垂直和水平居中。\n\n---\n\n## 控制斜体文本\n\n```css\ninput::-webkit-input-placeholder{\n  font-style: italic;\n}\n```\n\n>输入框的`placeholder`文本是斜体字，根据不同平台，需要把`webkit`、`ms`、`o`、`moz`等前缀的伪元素的样式也一起设置。\n\n---","slug":"从这个劫持页面我学到了什么","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhly300209co77zmu6tkg","content":"<h2 id=\"移动端input默认样式\"><a href=\"#移动端input默认样式\" class=\"headerlink\" title=\"移动端input默认样式\"></a>移动端<code>input</code>默认样式</h2><p>清除样式：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">appearance</span>: <span class=\"selector-tag\">none</span>;</span><br><span class=\"line\"><span class=\"selector-tag\">-moz-appearance</span>: <span class=\"selector-tag\">none</span>;</span><br><span class=\"line\"><span class=\"selector-tag\">-webkit-appearance</span>: <span class=\"selector-tag\">none</span>;</span><br></pre></td></tr></table></figure>\n<p><code>appearance</code>属性用于给元素指定平台相关的默认样式。有时候这并不是我们想要的效果。</p>\n<hr>\n<h2 id=\"垂直居中的flex实现\"><a href=\"#垂直居中的flex实现\" class=\"headerlink\" title=\"垂直居中的flex实现\"></a>垂直居中的<code>flex</code>实现</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"main\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">  <span class=\"attribute\">min-height</span>: <span class=\"number\">100vh</span>;</span><br><span class=\"line\">  <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">flex-direction</span>: column;</span><br><span class=\"line\">  <span class=\"attribute\">justify-content</span>: ;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: blue;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">5em</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">5em</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: gray;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><code>flex-direction: column</code>把<code>flex</code>主轴方向设置在竖直方向，<code>align-items</code>控制元素在交叉轴线上(水平方向)的对齐方式。<code>justify-content</code>属性控制元素在主轴(竖直方向)的对齐方式。简单的实现了垂直和水平居中。</p>\n</blockquote>\n<hr>\n<h2 id=\"控制斜体文本\"><a href=\"#控制斜体文本\" class=\"headerlink\" title=\"控制斜体文本\"></a>控制斜体文本</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-pseudo\">::-webkit-input-placeholder</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-style</span>: italic;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>输入框的<code>placeholder</code>文本是斜体字，根据不同平台，需要把<code>webkit</code>、<code>ms</code>、<code>o</code>、<code>moz</code>等前缀的伪元素的样式也一起设置。</p>\n</blockquote>\n<hr>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"移动端input默认样式\"><a href=\"#移动端input默认样式\" class=\"headerlink\" title=\"移动端input默认样式\"></a>移动端<code>input</code>默认样式</h2><p>清除样式：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">appearance</span>: <span class=\"selector-tag\">none</span>;</span><br><span class=\"line\"><span class=\"selector-tag\">-moz-appearance</span>: <span class=\"selector-tag\">none</span>;</span><br><span class=\"line\"><span class=\"selector-tag\">-webkit-appearance</span>: <span class=\"selector-tag\">none</span>;</span><br></pre></td></tr></table></figure>\n<p><code>appearance</code>属性用于给元素指定平台相关的默认样式。有时候这并不是我们想要的效果。</p>\n<hr>\n<h2 id=\"垂直居中的flex实现\"><a href=\"#垂直居中的flex实现\" class=\"headerlink\" title=\"垂直居中的flex实现\"></a>垂直居中的<code>flex</code>实现</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"main\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">  <span class=\"attribute\">min-height</span>: <span class=\"number\">100vh</span>;</span><br><span class=\"line\">  <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">flex-direction</span>: column;</span><br><span class=\"line\">  <span class=\"attribute\">justify-content</span>: ;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: blue;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">5em</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">5em</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: gray;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><code>flex-direction: column</code>把<code>flex</code>主轴方向设置在竖直方向，<code>align-items</code>控制元素在交叉轴线上(水平方向)的对齐方式。<code>justify-content</code>属性控制元素在主轴(竖直方向)的对齐方式。简单的实现了垂直和水平居中。</p>\n</blockquote>\n<hr>\n<h2 id=\"控制斜体文本\"><a href=\"#控制斜体文本\" class=\"headerlink\" title=\"控制斜体文本\"></a>控制斜体文本</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-pseudo\">::-webkit-input-placeholder</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-style</span>: italic;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>输入框的<code>placeholder</code>文本是斜体字，根据不同平台，需要把<code>webkit</code>、<code>ms</code>、<code>o</code>、<code>moz</code>等前缀的伪元素的样式也一起设置。</p>\n</blockquote>\n<hr>\n"},{"title":"vscode编辑器进阶","_content":"\n## 前言\n假定你已经阅读完成了`EDITOR`一章。现在开始来定制`vscode`。\n\n两个目的：  \n- 减少重复工作，把时间花费在有意义的事情上  \n- 可定制、可扩展、可积累  \n\n## 主题颜色字体\n`File>>Perfences=>corlor theme`选择一个舒服的主题，当然也可以按下`ctril+p`输入\n`ext install `安装喜欢的主题。字体通过用户配置文件来设置：按下`F1`输入`user`选择第一个条目按下回车。\n左边是默认配置，右边写入自定义配置。\n\n\n颜色字体这类属于无关紧要的细节，不需要在这方面浪费过多的时间，接下来说说`snippets`。\n\n## vscode snippets\n\n`vscode`针对不同的语言有不同的`snippets`。举个例子,新建一个`test.html`,输入：\n> html\n\n按下`ctrl+space`触发`snippets`。有两个选项可供选择，`html`标签以及`html`模板。\n选择`html模板`按下回车你会看到一下子多了很多东西：\n\n``` html\n<!DOCTYPE html>\n<html lang=\"en\">\n    <head>\n        <title></title>\n        <meta charset=\"UTF-8\">\n        <link href=\"css/style.css\" rel=\"stylesheet\">\n    </head>\n    <body>\n    \n    </body>\n</html>\n\n```\n光标默认停留在`en`的位置，按下`TAB`会在en、title、以及body之间切换，能这么做归功于`vscode`的`html snippets`扩展。\n项目地址：  \n>\nhttps://github.com/abusaidm/html-snippets/blob/master/snippets/snippets.json\n\n看看`snippets.json`的实现：  \n```\n\"html5\": {\n    \"prefix\": \"html5\",\n    \"body\": [\n        \"<!DOCTYPE html>\",\n        \"<html lang=\\\"$1en\\\">\",\n        \"\\t<head>\",\n        \"\\t\\t<title>$2</title>\",\n        \"\\t\\t<meta charset=\\\"UTF-8\\\">\",\n        \"\\t\\t<link href=\\\"$3css/style.css\\\" rel=\\\"stylesheet\\\">\",\n        \"\\t</head>\",\n        \"\\t<body>\",\n        \"\\t$4\",\n        \"\\t</body>\",\n        \"</html>\"\n        ],\n    \"description\": \"HTML - Defines a template for a html5 document\",\n    \"scope\": \"text.html\"\n    }\n```\n\n解释一下这个`snippets`:  \n- \"html5\"表示该`snippets`的名称，`prefix`后面的`html5`表示触发条件  \n- `body`表示`snippets`内容，是一个数组，数组元素最终会用换行符号链接起来  \n- `\\t`表示缩进  \n- `$数字`表示光标停留的次序，`$1`表示第一次停留位置，按下`Tab`键移到下一个位置  \n\n\n实在太方便了，工程师们就应该多动动脑子！！！  \n\n当然也可以定义自己的`snippets`，在`File=>Perfences=>User Snippets`选择语言然后会出现以下代码：  \n\n```\n/*\n\t // Place your snippets for Markdown here. Each snippet is defined under a snippet name and has a prefix, body and \n\t // description. The prefix is what is used to trigger the snippet and the body will be expanded and inserted. Possible variables are:\n\t // $1, $2 for tab stops, ${id} and ${id:label} and ${1:label} for variables. Variables with the same id are connected.\n\t // Example:\n\t \"Print to console\": {\n\t\t\"prefix\": \"log\",\n\t\t\"body\": [\n\t\t\t\"console.log('$1');\",\n\t\t\t\"$2\"\n\t\t],\n\t\t\"description\": \"Log output to console\"\n\t}\n*/\n```  \n\n以后你可以把自己的`snippet`放到这里。顺便说一句`vscode``snippet`格式遵循`textmate`,除了：   \n> \n 'regular expression replacements', 'interpolated shell code' and 'transformations'  \n> \nhttps://manual.macromates.com/en/snippets  \n\n你可以按下`ctrl+p`(快速打开)输入`ext install sni`,会列出一系列`snippet`。  \n`enjoy it :) `  \n\n> \n这里有个重要的建议：\n尽量不要直接使用别人写好的 Snippets，要自己写、自己敲；而别人写好的，尽量只用来参考。\n无论你学什么语言（或者框架），就一定要在学习的过程中不断添加积累自己关于那个语言（或者框架）的 Snippets，这是一个自己给自己“添麻烦”的过程，但这种所谓的“麻烦”，其实是一种刻意训练，不做其实是偷懒，偷懒这东西，真心不划算的。\n\n**引用自李笑来老师**  \n\n## 任务：  \n- 到https://marketplace.visualstudio.com/vscode找最常用的包试一试\n- 学习`snippet`基本语法，学会自己编写 snippet    \n","source":"_posts/vscode编辑器进阶.md","raw":"---\ntitle: vscode编辑器进阶\ncategories: vscode\n---\n\n## 前言\n假定你已经阅读完成了`EDITOR`一章。现在开始来定制`vscode`。\n\n两个目的：  \n- 减少重复工作，把时间花费在有意义的事情上  \n- 可定制、可扩展、可积累  \n\n## 主题颜色字体\n`File>>Perfences=>corlor theme`选择一个舒服的主题，当然也可以按下`ctril+p`输入\n`ext install `安装喜欢的主题。字体通过用户配置文件来设置：按下`F1`输入`user`选择第一个条目按下回车。\n左边是默认配置，右边写入自定义配置。\n\n\n颜色字体这类属于无关紧要的细节，不需要在这方面浪费过多的时间，接下来说说`snippets`。\n\n## vscode snippets\n\n`vscode`针对不同的语言有不同的`snippets`。举个例子,新建一个`test.html`,输入：\n> html\n\n按下`ctrl+space`触发`snippets`。有两个选项可供选择，`html`标签以及`html`模板。\n选择`html模板`按下回车你会看到一下子多了很多东西：\n\n``` html\n<!DOCTYPE html>\n<html lang=\"en\">\n    <head>\n        <title></title>\n        <meta charset=\"UTF-8\">\n        <link href=\"css/style.css\" rel=\"stylesheet\">\n    </head>\n    <body>\n    \n    </body>\n</html>\n\n```\n光标默认停留在`en`的位置，按下`TAB`会在en、title、以及body之间切换，能这么做归功于`vscode`的`html snippets`扩展。\n项目地址：  \n>\nhttps://github.com/abusaidm/html-snippets/blob/master/snippets/snippets.json\n\n看看`snippets.json`的实现：  \n```\n\"html5\": {\n    \"prefix\": \"html5\",\n    \"body\": [\n        \"<!DOCTYPE html>\",\n        \"<html lang=\\\"$1en\\\">\",\n        \"\\t<head>\",\n        \"\\t\\t<title>$2</title>\",\n        \"\\t\\t<meta charset=\\\"UTF-8\\\">\",\n        \"\\t\\t<link href=\\\"$3css/style.css\\\" rel=\\\"stylesheet\\\">\",\n        \"\\t</head>\",\n        \"\\t<body>\",\n        \"\\t$4\",\n        \"\\t</body>\",\n        \"</html>\"\n        ],\n    \"description\": \"HTML - Defines a template for a html5 document\",\n    \"scope\": \"text.html\"\n    }\n```\n\n解释一下这个`snippets`:  \n- \"html5\"表示该`snippets`的名称，`prefix`后面的`html5`表示触发条件  \n- `body`表示`snippets`内容，是一个数组，数组元素最终会用换行符号链接起来  \n- `\\t`表示缩进  \n- `$数字`表示光标停留的次序，`$1`表示第一次停留位置，按下`Tab`键移到下一个位置  \n\n\n实在太方便了，工程师们就应该多动动脑子！！！  \n\n当然也可以定义自己的`snippets`，在`File=>Perfences=>User Snippets`选择语言然后会出现以下代码：  \n\n```\n/*\n\t // Place your snippets for Markdown here. Each snippet is defined under a snippet name and has a prefix, body and \n\t // description. The prefix is what is used to trigger the snippet and the body will be expanded and inserted. Possible variables are:\n\t // $1, $2 for tab stops, ${id} and ${id:label} and ${1:label} for variables. Variables with the same id are connected.\n\t // Example:\n\t \"Print to console\": {\n\t\t\"prefix\": \"log\",\n\t\t\"body\": [\n\t\t\t\"console.log('$1');\",\n\t\t\t\"$2\"\n\t\t],\n\t\t\"description\": \"Log output to console\"\n\t}\n*/\n```  \n\n以后你可以把自己的`snippet`放到这里。顺便说一句`vscode``snippet`格式遵循`textmate`,除了：   \n> \n 'regular expression replacements', 'interpolated shell code' and 'transformations'  \n> \nhttps://manual.macromates.com/en/snippets  \n\n你可以按下`ctrl+p`(快速打开)输入`ext install sni`,会列出一系列`snippet`。  \n`enjoy it :) `  \n\n> \n这里有个重要的建议：\n尽量不要直接使用别人写好的 Snippets，要自己写、自己敲；而别人写好的，尽量只用来参考。\n无论你学什么语言（或者框架），就一定要在学习的过程中不断添加积累自己关于那个语言（或者框架）的 Snippets，这是一个自己给自己“添麻烦”的过程，但这种所谓的“麻烦”，其实是一种刻意训练，不做其实是偷懒，偷懒这东西，真心不划算的。\n\n**引用自李笑来老师**  \n\n## 任务：  \n- 到https://marketplace.visualstudio.com/vscode找最常用的包试一试\n- 学习`snippet`基本语法，学会自己编写 snippet    \n","slug":"vscode编辑器进阶","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhly400229co7z1d3kwva","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>假定你已经阅读完成了<code>EDITOR</code>一章。现在开始来定制<code>vscode</code>。</p>\n<p>两个目的：  </p>\n<ul>\n<li>减少重复工作，把时间花费在有意义的事情上  </li>\n<li>可定制、可扩展、可积累  </li>\n</ul>\n<h2 id=\"主题颜色字体\"><a href=\"#主题颜色字体\" class=\"headerlink\" title=\"主题颜色字体\"></a>主题颜色字体</h2><p><code>File&gt;&gt;Perfences=&gt;corlor theme</code>选择一个舒服的主题，当然也可以按下<code>ctril+p</code>输入<br><code>ext install</code>安装喜欢的主题。字体通过用户配置文件来设置：按下<code>F1</code>输入<code>user</code>选择第一个条目按下回车。<br>左边是默认配置，右边写入自定义配置。</p>\n<p>颜色字体这类属于无关紧要的细节，不需要在这方面浪费过多的时间，接下来说说<code>snippets</code>。</p>\n<h2 id=\"vscode-snippets\"><a href=\"#vscode-snippets\" class=\"headerlink\" title=\"vscode snippets\"></a>vscode snippets</h2><p><code>vscode</code>针对不同的语言有不同的<code>snippets</code>。举个例子,新建一个<code>test.html</code>,输入：</p>\n<blockquote>\n<p>html</p>\n</blockquote>\n<p>按下<code>ctrl+space</code>触发<code>snippets</code>。有两个选项可供选择，<code>html</code>标签以及<code>html</code>模板。<br>选择<code>html模板</code>按下回车你会看到一下子多了很多东西：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">\"css/style.css\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>光标默认停留在<code>en</code>的位置，按下<code>TAB</code>会在en、title、以及body之间切换，能这么做归功于<code>vscode</code>的<code>html snippets</code>扩展。<br>项目地址：<br>&gt;<br><a href=\"https://github.com/abusaidm/html-snippets/blob/master/snippets/snippets.json\" target=\"_blank\" rel=\"noopener\">https://github.com/abusaidm/html-snippets/blob/master/snippets/snippets.json</a></p>\n<p>看看<code>snippets.json</code>的实现：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;html5&quot;: &#123;</span><br><span class=\"line\">    &quot;prefix&quot;: &quot;html5&quot;,</span><br><span class=\"line\">    &quot;body&quot;: [</span><br><span class=\"line\">        &quot;&lt;!DOCTYPE html&gt;&quot;,</span><br><span class=\"line\">        &quot;&lt;html lang=\\&quot;$1en\\&quot;&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t&lt;head&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t\\t&lt;title&gt;$2&lt;/title&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t\\t&lt;meta charset=\\&quot;UTF-8\\&quot;&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t\\t&lt;link href=\\&quot;$3css/style.css\\&quot; rel=\\&quot;stylesheet\\&quot;&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t&lt;/head&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t&lt;body&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t$4&quot;,</span><br><span class=\"line\">        &quot;\\t&lt;/body&gt;&quot;,</span><br><span class=\"line\">        &quot;&lt;/html&gt;&quot;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">    &quot;description&quot;: &quot;HTML - Defines a template for a html5 document&quot;,</span><br><span class=\"line\">    &quot;scope&quot;: &quot;text.html&quot;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p>解释一下这个<code>snippets</code>:  </p>\n<ul>\n<li>“html5”表示该<code>snippets</code>的名称，<code>prefix</code>后面的<code>html5</code>表示触发条件  </li>\n<li><code>body</code>表示<code>snippets</code>内容，是一个数组，数组元素最终会用换行符号链接起来  </li>\n<li><code>\\t</code>表示缩进  </li>\n<li><code>$数字</code>表示光标停留的次序，<code>$1</code>表示第一次停留位置，按下<code>Tab</code>键移到下一个位置  </li>\n</ul>\n<p>实在太方便了，工程师们就应该多动动脑子！！！  </p>\n<p>当然也可以定义自己的<code>snippets</code>，在<code>File=&gt;Perfences=&gt;User Snippets</code>选择语言然后会出现以下代码：  </p>\n<pre><code>/*\n     // Place your snippets for Markdown here. Each snippet is defined under a snippet name and has a prefix, body and \n     // description. The prefix is what is used to trigger the snippet and the body will be expanded and inserted. Possible variables are:\n     // $1, $2 for tab stops, ${id} and ${id:label} and ${1:label} for variables. Variables with the same id are connected.\n     // Example:\n     &quot;Print to console&quot;: {\n        &quot;prefix&quot;: &quot;log&quot;,\n        &quot;body&quot;: [\n            &quot;console.log(&apos;$1&apos;);&quot;,\n            &quot;$2&quot;\n        ],\n        &quot;description&quot;: &quot;Log output to console&quot;\n    }\n*/\n</code></pre><p>以后你可以把自己的<code>snippet</code>放到这里。顺便说一句<code>vscode``snippet</code>格式遵循<code>textmate</code>,除了：   </p>\n<blockquote>\n<p> ‘regular expression replacements’, ‘interpolated shell code’ and ‘transformations’  </p>\n<p><a href=\"https://manual.macromates.com/en/snippets\" target=\"_blank\" rel=\"noopener\">https://manual.macromates.com/en/snippets</a>  </p>\n</blockquote>\n<p>你可以按下<code>ctrl+p</code>(快速打开)输入<code>ext install sni</code>,会列出一系列<code>snippet</code>。<br><code>enjoy it :)</code>  </p>\n<blockquote>\n<p>这里有个重要的建议：<br>尽量不要直接使用别人写好的 Snippets，要自己写、自己敲；而别人写好的，尽量只用来参考。<br>无论你学什么语言（或者框架），就一定要在学习的过程中不断添加积累自己关于那个语言（或者框架）的 Snippets，这是一个自己给自己“添麻烦”的过程，但这种所谓的“麻烦”，其实是一种刻意训练，不做其实是偷懒，偷懒这东西，真心不划算的。</p>\n</blockquote>\n<p><strong>引用自李笑来老师</strong>  </p>\n<h2 id=\"任务：\"><a href=\"#任务：\" class=\"headerlink\" title=\"任务：\"></a>任务：</h2><ul>\n<li>到<a href=\"https://marketplace.visualstudio.com/vscode找最常用的包试一试\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/vscode找最常用的包试一试</a></li>\n<li>学习<code>snippet</code>基本语法，学会自己编写 snippet    </li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>假定你已经阅读完成了<code>EDITOR</code>一章。现在开始来定制<code>vscode</code>。</p>\n<p>两个目的：  </p>\n<ul>\n<li>减少重复工作，把时间花费在有意义的事情上  </li>\n<li>可定制、可扩展、可积累  </li>\n</ul>\n<h2 id=\"主题颜色字体\"><a href=\"#主题颜色字体\" class=\"headerlink\" title=\"主题颜色字体\"></a>主题颜色字体</h2><p><code>File&gt;&gt;Perfences=&gt;corlor theme</code>选择一个舒服的主题，当然也可以按下<code>ctril+p</code>输入<br><code>ext install</code>安装喜欢的主题。字体通过用户配置文件来设置：按下<code>F1</code>输入<code>user</code>选择第一个条目按下回车。<br>左边是默认配置，右边写入自定义配置。</p>\n<p>颜色字体这类属于无关紧要的细节，不需要在这方面浪费过多的时间，接下来说说<code>snippets</code>。</p>\n<h2 id=\"vscode-snippets\"><a href=\"#vscode-snippets\" class=\"headerlink\" title=\"vscode snippets\"></a>vscode snippets</h2><p><code>vscode</code>针对不同的语言有不同的<code>snippets</code>。举个例子,新建一个<code>test.html</code>,输入：</p>\n<blockquote>\n<p>html</p>\n</blockquote>\n<p>按下<code>ctrl+space</code>触发<code>snippets</code>。有两个选项可供选择，<code>html</code>标签以及<code>html</code>模板。<br>选择<code>html模板</code>按下回车你会看到一下子多了很多东西：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">\"css/style.css\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>光标默认停留在<code>en</code>的位置，按下<code>TAB</code>会在en、title、以及body之间切换，能这么做归功于<code>vscode</code>的<code>html snippets</code>扩展。<br>项目地址：<br>&gt;<br><a href=\"https://github.com/abusaidm/html-snippets/blob/master/snippets/snippets.json\" target=\"_blank\" rel=\"noopener\">https://github.com/abusaidm/html-snippets/blob/master/snippets/snippets.json</a></p>\n<p>看看<code>snippets.json</code>的实现：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;html5&quot;: &#123;</span><br><span class=\"line\">    &quot;prefix&quot;: &quot;html5&quot;,</span><br><span class=\"line\">    &quot;body&quot;: [</span><br><span class=\"line\">        &quot;&lt;!DOCTYPE html&gt;&quot;,</span><br><span class=\"line\">        &quot;&lt;html lang=\\&quot;$1en\\&quot;&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t&lt;head&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t\\t&lt;title&gt;$2&lt;/title&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t\\t&lt;meta charset=\\&quot;UTF-8\\&quot;&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t\\t&lt;link href=\\&quot;$3css/style.css\\&quot; rel=\\&quot;stylesheet\\&quot;&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t&lt;/head&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t&lt;body&gt;&quot;,</span><br><span class=\"line\">        &quot;\\t$4&quot;,</span><br><span class=\"line\">        &quot;\\t&lt;/body&gt;&quot;,</span><br><span class=\"line\">        &quot;&lt;/html&gt;&quot;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">    &quot;description&quot;: &quot;HTML - Defines a template for a html5 document&quot;,</span><br><span class=\"line\">    &quot;scope&quot;: &quot;text.html&quot;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p>解释一下这个<code>snippets</code>:  </p>\n<ul>\n<li>“html5”表示该<code>snippets</code>的名称，<code>prefix</code>后面的<code>html5</code>表示触发条件  </li>\n<li><code>body</code>表示<code>snippets</code>内容，是一个数组，数组元素最终会用换行符号链接起来  </li>\n<li><code>\\t</code>表示缩进  </li>\n<li><code>$数字</code>表示光标停留的次序，<code>$1</code>表示第一次停留位置，按下<code>Tab</code>键移到下一个位置  </li>\n</ul>\n<p>实在太方便了，工程师们就应该多动动脑子！！！  </p>\n<p>当然也可以定义自己的<code>snippets</code>，在<code>File=&gt;Perfences=&gt;User Snippets</code>选择语言然后会出现以下代码：  </p>\n<pre><code>/*\n     // Place your snippets for Markdown here. Each snippet is defined under a snippet name and has a prefix, body and \n     // description. The prefix is what is used to trigger the snippet and the body will be expanded and inserted. Possible variables are:\n     // $1, $2 for tab stops, ${id} and ${id:label} and ${1:label} for variables. Variables with the same id are connected.\n     // Example:\n     &quot;Print to console&quot;: {\n        &quot;prefix&quot;: &quot;log&quot;,\n        &quot;body&quot;: [\n            &quot;console.log(&apos;$1&apos;);&quot;,\n            &quot;$2&quot;\n        ],\n        &quot;description&quot;: &quot;Log output to console&quot;\n    }\n*/\n</code></pre><p>以后你可以把自己的<code>snippet</code>放到这里。顺便说一句<code>vscode``snippet</code>格式遵循<code>textmate</code>,除了：   </p>\n<blockquote>\n<p> ‘regular expression replacements’, ‘interpolated shell code’ and ‘transformations’  </p>\n<p><a href=\"https://manual.macromates.com/en/snippets\" target=\"_blank\" rel=\"noopener\">https://manual.macromates.com/en/snippets</a>  </p>\n</blockquote>\n<p>你可以按下<code>ctrl+p</code>(快速打开)输入<code>ext install sni</code>,会列出一系列<code>snippet</code>。<br><code>enjoy it :)</code>  </p>\n<blockquote>\n<p>这里有个重要的建议：<br>尽量不要直接使用别人写好的 Snippets，要自己写、自己敲；而别人写好的，尽量只用来参考。<br>无论你学什么语言（或者框架），就一定要在学习的过程中不断添加积累自己关于那个语言（或者框架）的 Snippets，这是一个自己给自己“添麻烦”的过程，但这种所谓的“麻烦”，其实是一种刻意训练，不做其实是偷懒，偷懒这东西，真心不划算的。</p>\n</blockquote>\n<p><strong>引用自李笑来老师</strong>  </p>\n<h2 id=\"任务：\"><a href=\"#任务：\" class=\"headerlink\" title=\"任务：\"></a>任务：</h2><ul>\n<li>到<a href=\"https://marketplace.visualstudio.com/vscode找最常用的包试一试\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/vscode找最常用的包试一试</a></li>\n<li>学习<code>snippet</code>基本语法，学会自己编写 snippet    </li>\n</ul>\n"},{"title":"你不知道的Javascript上卷-阅读笔记","date":"2016-10-08T06:46:41.000Z","_content":"\n\n# SCOPE&CLOSURES--THIS&OBJECT-PROTOTYPES\n\n---\n\n## 作用域和闭包\n\n### 作用域是什么？\n\n#### *作用域的定义：*\n\n>需要一套良好的规则存储变量，并且之后可以找到这些变量，这套规则被称为作用域。\n\n编译原理基本步骤：\n\n- 词法分析，把代码块分解为词法单元\n- 语法分析，把词法单元转换为抽象语法树AST\n- 代码生成，将AST转换为可执行的代码(机器指令)\n\n对比传统的编译型语言，javascript编译发生在代码执行前的几微妙。javascript引擎用`JIT`来保证性能最佳。\n\n在代码生成的过程中，需要`引擎`、`编译器`、`作用域`三者协作完成。在编译的过程中，引擎会进行`LHS`,`RHS`操作。`RHS`表示取得变量的值，而`LHS`表示获取赋值操作的目标。\n\n#### *作用域嵌套：*\n\n> 引擎从当前执行作用域开始查找变量，如果找不到就会向上一级继续寻找，直到到达最外层作用域。\n\n作用域操作的异常：\n\n> `RHS`操作失败会抛出`ReferenceError`异常，而`LHS`操作没有找到目标变量，如果非严格模式下会创建一个全局变量，严格模式下会抛出`ReferenceError`。如果对`RHS`操作的变量的值进行不合理操作会抛出`TypeError`。\n\n---\n\n### 词法作用域\n\n词法作用域由书写代码时决定，通过一些方法如`eval`、`with`。可以在词法分析器处理之后修改作用域。\n\n在标示符查找的过程中同名的会发生屏蔽，全局变量会自动成为全局对象的属性，因此可以通过`window.a`的形式访问被屏蔽的全局变量。\n\n---\n\n#### 欺骗词法\n\n- eval\n\n把字符串参数当做代码运行，就好像代码原来就是在那个位置。通过这种方式来修改词法作用域。严格模式下`eval`在运行时有自己的词法作用域，意味着其中的声明无法修改所在的作用域。\n\n\n- with\n\n把一个对象处理为一个词法作用域，对象属性被定义为在这个作用域内的词法标示符。块内部的`var`声明会被添加到`with`所处的函数作用域中。\n\n不推荐使用`eval`和`with`：\n\n- 严格模式下禁止使用\n- 无法优化代码(作用域查找优化)\n\n---\n\n### 函数作用域和块作用域\n\n函数作用域分级的好处：\n\n- 隐藏内部实现\n\n- 避免冲突\n\n函数声明不可以是匿名的，函数表达式可以是匿名的。\n\n匿名函数缺点：\n\n- 匿名函数在栈上不会显示出有意义的函数名，调式困难\n\n- 没有函数名，只能通过`argument.callee`调用自身，在严格模式下不可用\n\n- 匿名函数可读行不高\n\n立即执行的函数表达式\n\n``` javascript\n\n(function foo() {\n  var a = 3;\n  console.log(a);\n})();\n\n```\n\n第一个括号用于把函数变成一个表达式，第二个括号用于执行这个函数。\n\nIIFE的作用：\n\n- 把它当做函数调用，可以传入参数\n\n- 解决`undefined`标示符默认值被覆盖问题\n\n- 倒置代码的运行顺序，`UMD`模式\n\n\n创建块作用域的方法：\n\n- with\n\n\n- try/catch\n\n`catch`分句会创建一个块作用域，其中声明的变量仅仅在`catch`内部有效。\n\n- let\n\n`es6`新语法关键字，`let`定义的变量不会在块作用域中进行提升。\n\n- const\n`es6`新语法关键字，`const`同样可以创建块作用域变量，其值是固定的。\n\n---\n\n### 提升\n\n>包括变量和函数在内的所有声明都会在任何代码被执行前首先被处理（编译阶段）。\n\n规则：\n\n- 只有声明会被提升、赋值不会\n- 函数表达式不会被提升\n- 函数首先被提升，然后才是变量\n- 重复声明被忽略\n\n---\n\n### 闭包\n\n>通过任何手段，将内部函数传递到所在的词法作用域以外，它都会持有对原始定义作用域的引用，无论在何处执行这个函数都会使用闭包。\n\n循环和闭包问题：\n>循环迭代的过程中引用同一个变量。\n\n解决办法：\n\n- 1、IIFE\n\n 新建一个块作用域，并且每次都把变量传递进来。\n\n- 2、let\n \n`for`循环头部的`let`声明有一个特殊行为： `变量在循环过程中不止声明一次。`\n\n\n#### 利用闭包构建模块\n\n模块模式的条件：\n\n- 必须有外部封闭的函数，该函数必须至少调用一次。\n\n- 封闭函数必须至少放回一个内部函数，这样内部函数才能在私有作用域内形成闭包，并且可以访问或者修改私有的状态。\n\n\n#### 箭头函数与词法作用域\n\n好处：\n\n- 用当前的词法作用域覆盖了`this`本来的值。\n\n问题：\n\n- 它是匿名的而非具名\n\n---\n\n## this和对象原型\n\n### `this`是什么\n\n>this既不指向自身，也不指向函数的词法作用域，`this`实际上是在函数调用时发生的绑定。\n\n---\n\n### 全面解析`this`\n\n`this`的绑定规则：\n\n- 默认绑定\n\n`this`指向全局对象。严格模式下无法使用（函数本身是严格模式）。\n\n- 隐式绑定\n\n对象属性引用炼只有最后一层会影响调用位置。\n\n- 显式绑定\n\n通过`apply`、`call`、`bind`来完成。\n\n- new 绑定\n\n`new`调用一个函数发生的操作：\n\n- 1、创建一个全新对象\n- 2、这个新对象会被执行[[原型]]连接\n- 3、这个新对象会绑定到函数调用的`this`\n- 4、如果这个函数没有放回其他对象，那么`new`表达式中的函数调用会自动返回这个新对象。\n\n绑定优先级：\n\n>默认绑定优先级最低，显式绑定优先级别高于隐式绑定。`new`绑定高于显式绑定。\n\n### 对象\n\njs基本类型：\n\n- string\n- number\n- boolean\n- null\n- undefined\n- object\n\n`null`由于语言本身的`BUG`执行`typeof`会返回`object`。\n\n内值对象子类型：\n\n- String\n- Number\n- Function\n- Object\n- Array\n- Boolean\n- Date\n- RegExp\n- Error\n\n#### 属性描述符号：\n\n- writable\n\n决定是否可以修改属性的值\n\n- configurable\n\n决定是否可以用`defineProperty`修改属性。`configurable:false`的属性，禁止删除。\n\n- enumerable\n\n决定是否出现在对象属性的枚举中。\n\n#### 不变性\n\n- 1、结合使用writable和configure\n\n- 2、禁止扩展\n\nObject.preventExtensions\n\n- 3、密封\n\nObject.seal=Object.preventExtensions + configurable:false\n但是可以修改属性\n\n- 4、冻结\n\nObject.freeze=Object.seal + writable:false;\n\n#### 属性的存在性\n\n- 1、in\n\n检查是否在元素本身，以及原型链中。\n\n- 2、hasOwnProperty\n\n检查是否在对象本身。\n\n- 3、peopertyIsEnumerable\n\n检查属性名是否直接存在于对象中，而且`enumerable:true`。\n\n- 4、Object.keys\n\n返回一个对象本身所有可以枚举的属性\n\n- 5、Object.getOwnPropertyNames\n\n返回对象包含的所有属性(不含原型链)，不论是否可以枚举。\n\n\n#### 遍历\n\n- 1、for in\n\n遍历对象可以枚举的属性，包含原型链。\n\n- 2、for\n\n遍历数组\n\n- 3、forEach\\some\\every\n\nES5添加的方法，用于遍历数组。\n\n- 4、for..of\n\n通过迭代器(Symbol.iterator)遍历数组或者对象。\n\n\n### 原型\n\n#### Object.prototype\n\n>所有的[[prototype]]最终指向`Object.prototype`。其提供了一些方法，如`valueOf`等等。\n\n`myObject.foo = \"bar\"`出现的情况：\n\n- 1、[[prototype]]存在`foo`,并且可以写，那么会在myObject新建一个`foo`属性。\n\n- 2、[[prototype]]存在`foo`,并且不可以写，严格模式报出错误。\n\n- 3、[[prototype]]存在`foo`且是一个`setter`,那就一定会调用这个`setter`,`foo`不被添加，而且调用这个`setter`。\n\n\n#### 基本原型关系：\n\n```javascript\n\nfunction Foo() {\n\n}\n\nvar foo = new Foo();\n\nFoo.prototype.__proto__ == Object.prototype\nFunction.prototype.__proto__ == Object.prototype\nArray.__proto__ == Function.prototype\nFoo.__proto__ == Function.prototype\nfoo.__proto__ == Foo.prototype\n\nFoo.constructor == Function\nfoo.constructor == Foo\n\n```\n\n","source":"_posts/你不知道的Javascript上卷-阅读笔记.md","raw":"---\ntitle: 你不知道的Javascript上卷-阅读笔记\ndate: 2016-10-08 14:46:41\ntags: javascript\ncategories: web\n---\n\n\n# SCOPE&CLOSURES--THIS&OBJECT-PROTOTYPES\n\n---\n\n## 作用域和闭包\n\n### 作用域是什么？\n\n#### *作用域的定义：*\n\n>需要一套良好的规则存储变量，并且之后可以找到这些变量，这套规则被称为作用域。\n\n编译原理基本步骤：\n\n- 词法分析，把代码块分解为词法单元\n- 语法分析，把词法单元转换为抽象语法树AST\n- 代码生成，将AST转换为可执行的代码(机器指令)\n\n对比传统的编译型语言，javascript编译发生在代码执行前的几微妙。javascript引擎用`JIT`来保证性能最佳。\n\n在代码生成的过程中，需要`引擎`、`编译器`、`作用域`三者协作完成。在编译的过程中，引擎会进行`LHS`,`RHS`操作。`RHS`表示取得变量的值，而`LHS`表示获取赋值操作的目标。\n\n#### *作用域嵌套：*\n\n> 引擎从当前执行作用域开始查找变量，如果找不到就会向上一级继续寻找，直到到达最外层作用域。\n\n作用域操作的异常：\n\n> `RHS`操作失败会抛出`ReferenceError`异常，而`LHS`操作没有找到目标变量，如果非严格模式下会创建一个全局变量，严格模式下会抛出`ReferenceError`。如果对`RHS`操作的变量的值进行不合理操作会抛出`TypeError`。\n\n---\n\n### 词法作用域\n\n词法作用域由书写代码时决定，通过一些方法如`eval`、`with`。可以在词法分析器处理之后修改作用域。\n\n在标示符查找的过程中同名的会发生屏蔽，全局变量会自动成为全局对象的属性，因此可以通过`window.a`的形式访问被屏蔽的全局变量。\n\n---\n\n#### 欺骗词法\n\n- eval\n\n把字符串参数当做代码运行，就好像代码原来就是在那个位置。通过这种方式来修改词法作用域。严格模式下`eval`在运行时有自己的词法作用域，意味着其中的声明无法修改所在的作用域。\n\n\n- with\n\n把一个对象处理为一个词法作用域，对象属性被定义为在这个作用域内的词法标示符。块内部的`var`声明会被添加到`with`所处的函数作用域中。\n\n不推荐使用`eval`和`with`：\n\n- 严格模式下禁止使用\n- 无法优化代码(作用域查找优化)\n\n---\n\n### 函数作用域和块作用域\n\n函数作用域分级的好处：\n\n- 隐藏内部实现\n\n- 避免冲突\n\n函数声明不可以是匿名的，函数表达式可以是匿名的。\n\n匿名函数缺点：\n\n- 匿名函数在栈上不会显示出有意义的函数名，调式困难\n\n- 没有函数名，只能通过`argument.callee`调用自身，在严格模式下不可用\n\n- 匿名函数可读行不高\n\n立即执行的函数表达式\n\n``` javascript\n\n(function foo() {\n  var a = 3;\n  console.log(a);\n})();\n\n```\n\n第一个括号用于把函数变成一个表达式，第二个括号用于执行这个函数。\n\nIIFE的作用：\n\n- 把它当做函数调用，可以传入参数\n\n- 解决`undefined`标示符默认值被覆盖问题\n\n- 倒置代码的运行顺序，`UMD`模式\n\n\n创建块作用域的方法：\n\n- with\n\n\n- try/catch\n\n`catch`分句会创建一个块作用域，其中声明的变量仅仅在`catch`内部有效。\n\n- let\n\n`es6`新语法关键字，`let`定义的变量不会在块作用域中进行提升。\n\n- const\n`es6`新语法关键字，`const`同样可以创建块作用域变量，其值是固定的。\n\n---\n\n### 提升\n\n>包括变量和函数在内的所有声明都会在任何代码被执行前首先被处理（编译阶段）。\n\n规则：\n\n- 只有声明会被提升、赋值不会\n- 函数表达式不会被提升\n- 函数首先被提升，然后才是变量\n- 重复声明被忽略\n\n---\n\n### 闭包\n\n>通过任何手段，将内部函数传递到所在的词法作用域以外，它都会持有对原始定义作用域的引用，无论在何处执行这个函数都会使用闭包。\n\n循环和闭包问题：\n>循环迭代的过程中引用同一个变量。\n\n解决办法：\n\n- 1、IIFE\n\n 新建一个块作用域，并且每次都把变量传递进来。\n\n- 2、let\n \n`for`循环头部的`let`声明有一个特殊行为： `变量在循环过程中不止声明一次。`\n\n\n#### 利用闭包构建模块\n\n模块模式的条件：\n\n- 必须有外部封闭的函数，该函数必须至少调用一次。\n\n- 封闭函数必须至少放回一个内部函数，这样内部函数才能在私有作用域内形成闭包，并且可以访问或者修改私有的状态。\n\n\n#### 箭头函数与词法作用域\n\n好处：\n\n- 用当前的词法作用域覆盖了`this`本来的值。\n\n问题：\n\n- 它是匿名的而非具名\n\n---\n\n## this和对象原型\n\n### `this`是什么\n\n>this既不指向自身，也不指向函数的词法作用域，`this`实际上是在函数调用时发生的绑定。\n\n---\n\n### 全面解析`this`\n\n`this`的绑定规则：\n\n- 默认绑定\n\n`this`指向全局对象。严格模式下无法使用（函数本身是严格模式）。\n\n- 隐式绑定\n\n对象属性引用炼只有最后一层会影响调用位置。\n\n- 显式绑定\n\n通过`apply`、`call`、`bind`来完成。\n\n- new 绑定\n\n`new`调用一个函数发生的操作：\n\n- 1、创建一个全新对象\n- 2、这个新对象会被执行[[原型]]连接\n- 3、这个新对象会绑定到函数调用的`this`\n- 4、如果这个函数没有放回其他对象，那么`new`表达式中的函数调用会自动返回这个新对象。\n\n绑定优先级：\n\n>默认绑定优先级最低，显式绑定优先级别高于隐式绑定。`new`绑定高于显式绑定。\n\n### 对象\n\njs基本类型：\n\n- string\n- number\n- boolean\n- null\n- undefined\n- object\n\n`null`由于语言本身的`BUG`执行`typeof`会返回`object`。\n\n内值对象子类型：\n\n- String\n- Number\n- Function\n- Object\n- Array\n- Boolean\n- Date\n- RegExp\n- Error\n\n#### 属性描述符号：\n\n- writable\n\n决定是否可以修改属性的值\n\n- configurable\n\n决定是否可以用`defineProperty`修改属性。`configurable:false`的属性，禁止删除。\n\n- enumerable\n\n决定是否出现在对象属性的枚举中。\n\n#### 不变性\n\n- 1、结合使用writable和configure\n\n- 2、禁止扩展\n\nObject.preventExtensions\n\n- 3、密封\n\nObject.seal=Object.preventExtensions + configurable:false\n但是可以修改属性\n\n- 4、冻结\n\nObject.freeze=Object.seal + writable:false;\n\n#### 属性的存在性\n\n- 1、in\n\n检查是否在元素本身，以及原型链中。\n\n- 2、hasOwnProperty\n\n检查是否在对象本身。\n\n- 3、peopertyIsEnumerable\n\n检查属性名是否直接存在于对象中，而且`enumerable:true`。\n\n- 4、Object.keys\n\n返回一个对象本身所有可以枚举的属性\n\n- 5、Object.getOwnPropertyNames\n\n返回对象包含的所有属性(不含原型链)，不论是否可以枚举。\n\n\n#### 遍历\n\n- 1、for in\n\n遍历对象可以枚举的属性，包含原型链。\n\n- 2、for\n\n遍历数组\n\n- 3、forEach\\some\\every\n\nES5添加的方法，用于遍历数组。\n\n- 4、for..of\n\n通过迭代器(Symbol.iterator)遍历数组或者对象。\n\n\n### 原型\n\n#### Object.prototype\n\n>所有的[[prototype]]最终指向`Object.prototype`。其提供了一些方法，如`valueOf`等等。\n\n`myObject.foo = \"bar\"`出现的情况：\n\n- 1、[[prototype]]存在`foo`,并且可以写，那么会在myObject新建一个`foo`属性。\n\n- 2、[[prototype]]存在`foo`,并且不可以写，严格模式报出错误。\n\n- 3、[[prototype]]存在`foo`且是一个`setter`,那就一定会调用这个`setter`,`foo`不被添加，而且调用这个`setter`。\n\n\n#### 基本原型关系：\n\n```javascript\n\nfunction Foo() {\n\n}\n\nvar foo = new Foo();\n\nFoo.prototype.__proto__ == Object.prototype\nFunction.prototype.__proto__ == Object.prototype\nArray.__proto__ == Function.prototype\nFoo.__proto__ == Function.prototype\nfoo.__proto__ == Foo.prototype\n\nFoo.constructor == Function\nfoo.constructor == Foo\n\n```\n\n","slug":"你不知道的Javascript上卷-阅读笔记","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhly600269co7n2qfc6gr","content":"<h1 id=\"SCOPE-amp-CLOSURES–THIS-amp-OBJECT-PROTOTYPES\"><a href=\"#SCOPE-amp-CLOSURES–THIS-amp-OBJECT-PROTOTYPES\" class=\"headerlink\" title=\"SCOPE&amp;CLOSURES–THIS&amp;OBJECT-PROTOTYPES\"></a>SCOPE&amp;CLOSURES–THIS&amp;OBJECT-PROTOTYPES</h1><hr>\n<h2 id=\"作用域和闭包\"><a href=\"#作用域和闭包\" class=\"headerlink\" title=\"作用域和闭包\"></a>作用域和闭包</h2><h3 id=\"作用域是什么？\"><a href=\"#作用域是什么？\" class=\"headerlink\" title=\"作用域是什么？\"></a>作用域是什么？</h3><h4 id=\"作用域的定义：\"><a href=\"#作用域的定义：\" class=\"headerlink\" title=\"作用域的定义：\"></a><em>作用域的定义：</em></h4><blockquote>\n<p>需要一套良好的规则存储变量，并且之后可以找到这些变量，这套规则被称为作用域。</p>\n</blockquote>\n<p>编译原理基本步骤：</p>\n<ul>\n<li>词法分析，把代码块分解为词法单元</li>\n<li>语法分析，把词法单元转换为抽象语法树AST</li>\n<li>代码生成，将AST转换为可执行的代码(机器指令)</li>\n</ul>\n<p>对比传统的编译型语言，javascript编译发生在代码执行前的几微妙。javascript引擎用<code>JIT</code>来保证性能最佳。</p>\n<p>在代码生成的过程中，需要<code>引擎</code>、<code>编译器</code>、<code>作用域</code>三者协作完成。在编译的过程中，引擎会进行<code>LHS</code>,<code>RHS</code>操作。<code>RHS</code>表示取得变量的值，而<code>LHS</code>表示获取赋值操作的目标。</p>\n<h4 id=\"作用域嵌套：\"><a href=\"#作用域嵌套：\" class=\"headerlink\" title=\"作用域嵌套：\"></a><em>作用域嵌套：</em></h4><blockquote>\n<p>引擎从当前执行作用域开始查找变量，如果找不到就会向上一级继续寻找，直到到达最外层作用域。</p>\n</blockquote>\n<p>作用域操作的异常：</p>\n<blockquote>\n<p><code>RHS</code>操作失败会抛出<code>ReferenceError</code>异常，而<code>LHS</code>操作没有找到目标变量，如果非严格模式下会创建一个全局变量，严格模式下会抛出<code>ReferenceError</code>。如果对<code>RHS</code>操作的变量的值进行不合理操作会抛出<code>TypeError</code>。</p>\n</blockquote>\n<hr>\n<h3 id=\"词法作用域\"><a href=\"#词法作用域\" class=\"headerlink\" title=\"词法作用域\"></a>词法作用域</h3><p>词法作用域由书写代码时决定，通过一些方法如<code>eval</code>、<code>with</code>。可以在词法分析器处理之后修改作用域。</p>\n<p>在标示符查找的过程中同名的会发生屏蔽，全局变量会自动成为全局对象的属性，因此可以通过<code>window.a</code>的形式访问被屏蔽的全局变量。</p>\n<hr>\n<h4 id=\"欺骗词法\"><a href=\"#欺骗词法\" class=\"headerlink\" title=\"欺骗词法\"></a>欺骗词法</h4><ul>\n<li>eval</li>\n</ul>\n<p>把字符串参数当做代码运行，就好像代码原来就是在那个位置。通过这种方式来修改词法作用域。严格模式下<code>eval</code>在运行时有自己的词法作用域，意味着其中的声明无法修改所在的作用域。</p>\n<ul>\n<li>with</li>\n</ul>\n<p>把一个对象处理为一个词法作用域，对象属性被定义为在这个作用域内的词法标示符。块内部的<code>var</code>声明会被添加到<code>with</code>所处的函数作用域中。</p>\n<p>不推荐使用<code>eval</code>和<code>with</code>：</p>\n<ul>\n<li>严格模式下禁止使用</li>\n<li>无法优化代码(作用域查找优化)</li>\n</ul>\n<hr>\n<h3 id=\"函数作用域和块作用域\"><a href=\"#函数作用域和块作用域\" class=\"headerlink\" title=\"函数作用域和块作用域\"></a>函数作用域和块作用域</h3><p>函数作用域分级的好处：</p>\n<ul>\n<li><p>隐藏内部实现</p>\n</li>\n<li><p>避免冲突</p>\n</li>\n</ul>\n<p>函数声明不可以是匿名的，函数表达式可以是匿名的。</p>\n<p>匿名函数缺点：</p>\n<ul>\n<li><p>匿名函数在栈上不会显示出有意义的函数名，调式困难</p>\n</li>\n<li><p>没有函数名，只能通过<code>argument.callee</code>调用自身，在严格模式下不可用</p>\n</li>\n<li><p>匿名函数可读行不高</p>\n</li>\n</ul>\n<p>立即执行的函数表达式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">3</span>;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<p>第一个括号用于把函数变成一个表达式，第二个括号用于执行这个函数。</p>\n<p>IIFE的作用：</p>\n<ul>\n<li><p>把它当做函数调用，可以传入参数</p>\n</li>\n<li><p>解决<code>undefined</code>标示符默认值被覆盖问题</p>\n</li>\n<li><p>倒置代码的运行顺序，<code>UMD</code>模式</p>\n</li>\n</ul>\n<p>创建块作用域的方法：</p>\n<ul>\n<li>with</li>\n</ul>\n<ul>\n<li>try/catch</li>\n</ul>\n<p><code>catch</code>分句会创建一个块作用域，其中声明的变量仅仅在<code>catch</code>内部有效。</p>\n<ul>\n<li>let</li>\n</ul>\n<p><code>es6</code>新语法关键字，<code>let</code>定义的变量不会在块作用域中进行提升。</p>\n<ul>\n<li>const<br><code>es6</code>新语法关键字，<code>const</code>同样可以创建块作用域变量，其值是固定的。</li>\n</ul>\n<hr>\n<h3 id=\"提升\"><a href=\"#提升\" class=\"headerlink\" title=\"提升\"></a>提升</h3><blockquote>\n<p>包括变量和函数在内的所有声明都会在任何代码被执行前首先被处理（编译阶段）。</p>\n</blockquote>\n<p>规则：</p>\n<ul>\n<li>只有声明会被提升、赋值不会</li>\n<li>函数表达式不会被提升</li>\n<li>函数首先被提升，然后才是变量</li>\n<li>重复声明被忽略</li>\n</ul>\n<hr>\n<h3 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h3><blockquote>\n<p>通过任何手段，将内部函数传递到所在的词法作用域以外，它都会持有对原始定义作用域的引用，无论在何处执行这个函数都会使用闭包。</p>\n</blockquote>\n<p>循环和闭包问题：</p>\n<blockquote>\n<p>循环迭代的过程中引用同一个变量。</p>\n</blockquote>\n<p>解决办法：</p>\n<ul>\n<li><p>1、IIFE</p>\n<p>新建一个块作用域，并且每次都把变量传递进来。</p>\n</li>\n<li><p>2、let</p>\n</li>\n</ul>\n<p><code>for</code>循环头部的<code>let</code>声明有一个特殊行为： <code>变量在循环过程中不止声明一次。</code></p>\n<h4 id=\"利用闭包构建模块\"><a href=\"#利用闭包构建模块\" class=\"headerlink\" title=\"利用闭包构建模块\"></a>利用闭包构建模块</h4><p>模块模式的条件：</p>\n<ul>\n<li><p>必须有外部封闭的函数，该函数必须至少调用一次。</p>\n</li>\n<li><p>封闭函数必须至少放回一个内部函数，这样内部函数才能在私有作用域内形成闭包，并且可以访问或者修改私有的状态。</p>\n</li>\n</ul>\n<h4 id=\"箭头函数与词法作用域\"><a href=\"#箭头函数与词法作用域\" class=\"headerlink\" title=\"箭头函数与词法作用域\"></a>箭头函数与词法作用域</h4><p>好处：</p>\n<ul>\n<li>用当前的词法作用域覆盖了<code>this</code>本来的值。</li>\n</ul>\n<p>问题：</p>\n<ul>\n<li>它是匿名的而非具名</li>\n</ul>\n<hr>\n<h2 id=\"this和对象原型\"><a href=\"#this和对象原型\" class=\"headerlink\" title=\"this和对象原型\"></a>this和对象原型</h2><h3 id=\"this是什么\"><a href=\"#this是什么\" class=\"headerlink\" title=\"this是什么\"></a><code>this</code>是什么</h3><blockquote>\n<p>this既不指向自身，也不指向函数的词法作用域，<code>this</code>实际上是在函数调用时发生的绑定。</p>\n</blockquote>\n<hr>\n<h3 id=\"全面解析this\"><a href=\"#全面解析this\" class=\"headerlink\" title=\"全面解析this\"></a>全面解析<code>this</code></h3><p><code>this</code>的绑定规则：</p>\n<ul>\n<li>默认绑定</li>\n</ul>\n<p><code>this</code>指向全局对象。严格模式下无法使用（函数本身是严格模式）。</p>\n<ul>\n<li>隐式绑定</li>\n</ul>\n<p>对象属性引用炼只有最后一层会影响调用位置。</p>\n<ul>\n<li>显式绑定</li>\n</ul>\n<p>通过<code>apply</code>、<code>call</code>、<code>bind</code>来完成。</p>\n<ul>\n<li>new 绑定</li>\n</ul>\n<p><code>new</code>调用一个函数发生的操作：</p>\n<ul>\n<li>1、创建一个全新对象</li>\n<li>2、这个新对象会被执行[[原型]]连接</li>\n<li>3、这个新对象会绑定到函数调用的<code>this</code></li>\n<li>4、如果这个函数没有放回其他对象，那么<code>new</code>表达式中的函数调用会自动返回这个新对象。</li>\n</ul>\n<p>绑定优先级：</p>\n<blockquote>\n<p>默认绑定优先级最低，显式绑定优先级别高于隐式绑定。<code>new</code>绑定高于显式绑定。</p>\n</blockquote>\n<h3 id=\"对象\"><a href=\"#对象\" class=\"headerlink\" title=\"对象\"></a>对象</h3><p>js基本类型：</p>\n<ul>\n<li>string</li>\n<li>number</li>\n<li>boolean</li>\n<li>null</li>\n<li>undefined</li>\n<li>object</li>\n</ul>\n<p><code>null</code>由于语言本身的<code>BUG</code>执行<code>typeof</code>会返回<code>object</code>。</p>\n<p>内值对象子类型：</p>\n<ul>\n<li>String</li>\n<li>Number</li>\n<li>Function</li>\n<li>Object</li>\n<li>Array</li>\n<li>Boolean</li>\n<li>Date</li>\n<li>RegExp</li>\n<li>Error</li>\n</ul>\n<h4 id=\"属性描述符号：\"><a href=\"#属性描述符号：\" class=\"headerlink\" title=\"属性描述符号：\"></a>属性描述符号：</h4><ul>\n<li>writable</li>\n</ul>\n<p>决定是否可以修改属性的值</p>\n<ul>\n<li>configurable</li>\n</ul>\n<p>决定是否可以用<code>defineProperty</code>修改属性。<code>configurable:false</code>的属性，禁止删除。</p>\n<ul>\n<li>enumerable</li>\n</ul>\n<p>决定是否出现在对象属性的枚举中。</p>\n<h4 id=\"不变性\"><a href=\"#不变性\" class=\"headerlink\" title=\"不变性\"></a>不变性</h4><ul>\n<li><p>1、结合使用writable和configure</p>\n</li>\n<li><p>2、禁止扩展</p>\n</li>\n</ul>\n<p>Object.preventExtensions</p>\n<ul>\n<li>3、密封</li>\n</ul>\n<p>Object.seal=Object.preventExtensions + configurable:false<br>但是可以修改属性</p>\n<ul>\n<li>4、冻结</li>\n</ul>\n<p>Object.freeze=Object.seal + writable:false;</p>\n<h4 id=\"属性的存在性\"><a href=\"#属性的存在性\" class=\"headerlink\" title=\"属性的存在性\"></a>属性的存在性</h4><ul>\n<li>1、in</li>\n</ul>\n<p>检查是否在元素本身，以及原型链中。</p>\n<ul>\n<li>2、hasOwnProperty</li>\n</ul>\n<p>检查是否在对象本身。</p>\n<ul>\n<li>3、peopertyIsEnumerable</li>\n</ul>\n<p>检查属性名是否直接存在于对象中，而且<code>enumerable:true</code>。</p>\n<ul>\n<li>4、Object.keys</li>\n</ul>\n<p>返回一个对象本身所有可以枚举的属性</p>\n<ul>\n<li>5、Object.getOwnPropertyNames</li>\n</ul>\n<p>返回对象包含的所有属性(不含原型链)，不论是否可以枚举。</p>\n<h4 id=\"遍历\"><a href=\"#遍历\" class=\"headerlink\" title=\"遍历\"></a>遍历</h4><ul>\n<li>1、for in</li>\n</ul>\n<p>遍历对象可以枚举的属性，包含原型链。</p>\n<ul>\n<li>2、for</li>\n</ul>\n<p>遍历数组</p>\n<ul>\n<li>3、forEach\\some\\every</li>\n</ul>\n<p>ES5添加的方法，用于遍历数组。</p>\n<ul>\n<li>4、for..of</li>\n</ul>\n<p>通过迭代器(Symbol.iterator)遍历数组或者对象。</p>\n<h3 id=\"原型\"><a href=\"#原型\" class=\"headerlink\" title=\"原型\"></a>原型</h3><h4 id=\"Object-prototype\"><a href=\"#Object-prototype\" class=\"headerlink\" title=\"Object.prototype\"></a>Object.prototype</h4><blockquote>\n<p>所有的[[prototype]]最终指向<code>Object.prototype</code>。其提供了一些方法，如<code>valueOf</code>等等。</p>\n</blockquote>\n<p><code>myObject.foo = &quot;bar&quot;</code>出现的情况：</p>\n<ul>\n<li><p>1、[[prototype]]存在<code>foo</code>,并且可以写，那么会在myObject新建一个<code>foo</code>属性。</p>\n</li>\n<li><p>2、[[prototype]]存在<code>foo</code>,并且不可以写，严格模式报出错误。</p>\n</li>\n<li><p>3、[[prototype]]存在<code>foo</code>且是一个<code>setter</code>,那就一定会调用这个<code>setter</code>,<code>foo</code>不被添加，而且调用这个<code>setter</code>。</p>\n</li>\n</ul>\n<h4 id=\"基本原型关系：\"><a href=\"#基本原型关系：\" class=\"headerlink\" title=\"基本原型关系：\"></a>基本原型关系：</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = <span class=\"keyword\">new</span> Foo();</span><br><span class=\"line\"></span><br><span class=\"line\">Foo.prototype.__proto__ == <span class=\"built_in\">Object</span>.prototype</span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.__proto__ == <span class=\"built_in\">Object</span>.prototype</span><br><span class=\"line\"><span class=\"built_in\">Array</span>.__proto__ == <span class=\"built_in\">Function</span>.prototype</span><br><span class=\"line\">Foo.__proto__ == <span class=\"built_in\">Function</span>.prototype</span><br><span class=\"line\">foo.__proto__ == Foo.prototype</span><br><span class=\"line\"></span><br><span class=\"line\">Foo.constructor == <span class=\"built_in\">Function</span></span><br><span class=\"line\">foo.constructor == Foo</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"SCOPE-amp-CLOSURES–THIS-amp-OBJECT-PROTOTYPES\"><a href=\"#SCOPE-amp-CLOSURES–THIS-amp-OBJECT-PROTOTYPES\" class=\"headerlink\" title=\"SCOPE&amp;CLOSURES–THIS&amp;OBJECT-PROTOTYPES\"></a>SCOPE&amp;CLOSURES–THIS&amp;OBJECT-PROTOTYPES</h1><hr>\n<h2 id=\"作用域和闭包\"><a href=\"#作用域和闭包\" class=\"headerlink\" title=\"作用域和闭包\"></a>作用域和闭包</h2><h3 id=\"作用域是什么？\"><a href=\"#作用域是什么？\" class=\"headerlink\" title=\"作用域是什么？\"></a>作用域是什么？</h3><h4 id=\"作用域的定义：\"><a href=\"#作用域的定义：\" class=\"headerlink\" title=\"作用域的定义：\"></a><em>作用域的定义：</em></h4><blockquote>\n<p>需要一套良好的规则存储变量，并且之后可以找到这些变量，这套规则被称为作用域。</p>\n</blockquote>\n<p>编译原理基本步骤：</p>\n<ul>\n<li>词法分析，把代码块分解为词法单元</li>\n<li>语法分析，把词法单元转换为抽象语法树AST</li>\n<li>代码生成，将AST转换为可执行的代码(机器指令)</li>\n</ul>\n<p>对比传统的编译型语言，javascript编译发生在代码执行前的几微妙。javascript引擎用<code>JIT</code>来保证性能最佳。</p>\n<p>在代码生成的过程中，需要<code>引擎</code>、<code>编译器</code>、<code>作用域</code>三者协作完成。在编译的过程中，引擎会进行<code>LHS</code>,<code>RHS</code>操作。<code>RHS</code>表示取得变量的值，而<code>LHS</code>表示获取赋值操作的目标。</p>\n<h4 id=\"作用域嵌套：\"><a href=\"#作用域嵌套：\" class=\"headerlink\" title=\"作用域嵌套：\"></a><em>作用域嵌套：</em></h4><blockquote>\n<p>引擎从当前执行作用域开始查找变量，如果找不到就会向上一级继续寻找，直到到达最外层作用域。</p>\n</blockquote>\n<p>作用域操作的异常：</p>\n<blockquote>\n<p><code>RHS</code>操作失败会抛出<code>ReferenceError</code>异常，而<code>LHS</code>操作没有找到目标变量，如果非严格模式下会创建一个全局变量，严格模式下会抛出<code>ReferenceError</code>。如果对<code>RHS</code>操作的变量的值进行不合理操作会抛出<code>TypeError</code>。</p>\n</blockquote>\n<hr>\n<h3 id=\"词法作用域\"><a href=\"#词法作用域\" class=\"headerlink\" title=\"词法作用域\"></a>词法作用域</h3><p>词法作用域由书写代码时决定，通过一些方法如<code>eval</code>、<code>with</code>。可以在词法分析器处理之后修改作用域。</p>\n<p>在标示符查找的过程中同名的会发生屏蔽，全局变量会自动成为全局对象的属性，因此可以通过<code>window.a</code>的形式访问被屏蔽的全局变量。</p>\n<hr>\n<h4 id=\"欺骗词法\"><a href=\"#欺骗词法\" class=\"headerlink\" title=\"欺骗词法\"></a>欺骗词法</h4><ul>\n<li>eval</li>\n</ul>\n<p>把字符串参数当做代码运行，就好像代码原来就是在那个位置。通过这种方式来修改词法作用域。严格模式下<code>eval</code>在运行时有自己的词法作用域，意味着其中的声明无法修改所在的作用域。</p>\n<ul>\n<li>with</li>\n</ul>\n<p>把一个对象处理为一个词法作用域，对象属性被定义为在这个作用域内的词法标示符。块内部的<code>var</code>声明会被添加到<code>with</code>所处的函数作用域中。</p>\n<p>不推荐使用<code>eval</code>和<code>with</code>：</p>\n<ul>\n<li>严格模式下禁止使用</li>\n<li>无法优化代码(作用域查找优化)</li>\n</ul>\n<hr>\n<h3 id=\"函数作用域和块作用域\"><a href=\"#函数作用域和块作用域\" class=\"headerlink\" title=\"函数作用域和块作用域\"></a>函数作用域和块作用域</h3><p>函数作用域分级的好处：</p>\n<ul>\n<li><p>隐藏内部实现</p>\n</li>\n<li><p>避免冲突</p>\n</li>\n</ul>\n<p>函数声明不可以是匿名的，函数表达式可以是匿名的。</p>\n<p>匿名函数缺点：</p>\n<ul>\n<li><p>匿名函数在栈上不会显示出有意义的函数名，调式困难</p>\n</li>\n<li><p>没有函数名，只能通过<code>argument.callee</code>调用自身，在严格模式下不可用</p>\n</li>\n<li><p>匿名函数可读行不高</p>\n</li>\n</ul>\n<p>立即执行的函数表达式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">3</span>;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<p>第一个括号用于把函数变成一个表达式，第二个括号用于执行这个函数。</p>\n<p>IIFE的作用：</p>\n<ul>\n<li><p>把它当做函数调用，可以传入参数</p>\n</li>\n<li><p>解决<code>undefined</code>标示符默认值被覆盖问题</p>\n</li>\n<li><p>倒置代码的运行顺序，<code>UMD</code>模式</p>\n</li>\n</ul>\n<p>创建块作用域的方法：</p>\n<ul>\n<li>with</li>\n</ul>\n<ul>\n<li>try/catch</li>\n</ul>\n<p><code>catch</code>分句会创建一个块作用域，其中声明的变量仅仅在<code>catch</code>内部有效。</p>\n<ul>\n<li>let</li>\n</ul>\n<p><code>es6</code>新语法关键字，<code>let</code>定义的变量不会在块作用域中进行提升。</p>\n<ul>\n<li>const<br><code>es6</code>新语法关键字，<code>const</code>同样可以创建块作用域变量，其值是固定的。</li>\n</ul>\n<hr>\n<h3 id=\"提升\"><a href=\"#提升\" class=\"headerlink\" title=\"提升\"></a>提升</h3><blockquote>\n<p>包括变量和函数在内的所有声明都会在任何代码被执行前首先被处理（编译阶段）。</p>\n</blockquote>\n<p>规则：</p>\n<ul>\n<li>只有声明会被提升、赋值不会</li>\n<li>函数表达式不会被提升</li>\n<li>函数首先被提升，然后才是变量</li>\n<li>重复声明被忽略</li>\n</ul>\n<hr>\n<h3 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h3><blockquote>\n<p>通过任何手段，将内部函数传递到所在的词法作用域以外，它都会持有对原始定义作用域的引用，无论在何处执行这个函数都会使用闭包。</p>\n</blockquote>\n<p>循环和闭包问题：</p>\n<blockquote>\n<p>循环迭代的过程中引用同一个变量。</p>\n</blockquote>\n<p>解决办法：</p>\n<ul>\n<li><p>1、IIFE</p>\n<p>新建一个块作用域，并且每次都把变量传递进来。</p>\n</li>\n<li><p>2、let</p>\n</li>\n</ul>\n<p><code>for</code>循环头部的<code>let</code>声明有一个特殊行为： <code>变量在循环过程中不止声明一次。</code></p>\n<h4 id=\"利用闭包构建模块\"><a href=\"#利用闭包构建模块\" class=\"headerlink\" title=\"利用闭包构建模块\"></a>利用闭包构建模块</h4><p>模块模式的条件：</p>\n<ul>\n<li><p>必须有外部封闭的函数，该函数必须至少调用一次。</p>\n</li>\n<li><p>封闭函数必须至少放回一个内部函数，这样内部函数才能在私有作用域内形成闭包，并且可以访问或者修改私有的状态。</p>\n</li>\n</ul>\n<h4 id=\"箭头函数与词法作用域\"><a href=\"#箭头函数与词法作用域\" class=\"headerlink\" title=\"箭头函数与词法作用域\"></a>箭头函数与词法作用域</h4><p>好处：</p>\n<ul>\n<li>用当前的词法作用域覆盖了<code>this</code>本来的值。</li>\n</ul>\n<p>问题：</p>\n<ul>\n<li>它是匿名的而非具名</li>\n</ul>\n<hr>\n<h2 id=\"this和对象原型\"><a href=\"#this和对象原型\" class=\"headerlink\" title=\"this和对象原型\"></a>this和对象原型</h2><h3 id=\"this是什么\"><a href=\"#this是什么\" class=\"headerlink\" title=\"this是什么\"></a><code>this</code>是什么</h3><blockquote>\n<p>this既不指向自身，也不指向函数的词法作用域，<code>this</code>实际上是在函数调用时发生的绑定。</p>\n</blockquote>\n<hr>\n<h3 id=\"全面解析this\"><a href=\"#全面解析this\" class=\"headerlink\" title=\"全面解析this\"></a>全面解析<code>this</code></h3><p><code>this</code>的绑定规则：</p>\n<ul>\n<li>默认绑定</li>\n</ul>\n<p><code>this</code>指向全局对象。严格模式下无法使用（函数本身是严格模式）。</p>\n<ul>\n<li>隐式绑定</li>\n</ul>\n<p>对象属性引用炼只有最后一层会影响调用位置。</p>\n<ul>\n<li>显式绑定</li>\n</ul>\n<p>通过<code>apply</code>、<code>call</code>、<code>bind</code>来完成。</p>\n<ul>\n<li>new 绑定</li>\n</ul>\n<p><code>new</code>调用一个函数发生的操作：</p>\n<ul>\n<li>1、创建一个全新对象</li>\n<li>2、这个新对象会被执行[[原型]]连接</li>\n<li>3、这个新对象会绑定到函数调用的<code>this</code></li>\n<li>4、如果这个函数没有放回其他对象，那么<code>new</code>表达式中的函数调用会自动返回这个新对象。</li>\n</ul>\n<p>绑定优先级：</p>\n<blockquote>\n<p>默认绑定优先级最低，显式绑定优先级别高于隐式绑定。<code>new</code>绑定高于显式绑定。</p>\n</blockquote>\n<h3 id=\"对象\"><a href=\"#对象\" class=\"headerlink\" title=\"对象\"></a>对象</h3><p>js基本类型：</p>\n<ul>\n<li>string</li>\n<li>number</li>\n<li>boolean</li>\n<li>null</li>\n<li>undefined</li>\n<li>object</li>\n</ul>\n<p><code>null</code>由于语言本身的<code>BUG</code>执行<code>typeof</code>会返回<code>object</code>。</p>\n<p>内值对象子类型：</p>\n<ul>\n<li>String</li>\n<li>Number</li>\n<li>Function</li>\n<li>Object</li>\n<li>Array</li>\n<li>Boolean</li>\n<li>Date</li>\n<li>RegExp</li>\n<li>Error</li>\n</ul>\n<h4 id=\"属性描述符号：\"><a href=\"#属性描述符号：\" class=\"headerlink\" title=\"属性描述符号：\"></a>属性描述符号：</h4><ul>\n<li>writable</li>\n</ul>\n<p>决定是否可以修改属性的值</p>\n<ul>\n<li>configurable</li>\n</ul>\n<p>决定是否可以用<code>defineProperty</code>修改属性。<code>configurable:false</code>的属性，禁止删除。</p>\n<ul>\n<li>enumerable</li>\n</ul>\n<p>决定是否出现在对象属性的枚举中。</p>\n<h4 id=\"不变性\"><a href=\"#不变性\" class=\"headerlink\" title=\"不变性\"></a>不变性</h4><ul>\n<li><p>1、结合使用writable和configure</p>\n</li>\n<li><p>2、禁止扩展</p>\n</li>\n</ul>\n<p>Object.preventExtensions</p>\n<ul>\n<li>3、密封</li>\n</ul>\n<p>Object.seal=Object.preventExtensions + configurable:false<br>但是可以修改属性</p>\n<ul>\n<li>4、冻结</li>\n</ul>\n<p>Object.freeze=Object.seal + writable:false;</p>\n<h4 id=\"属性的存在性\"><a href=\"#属性的存在性\" class=\"headerlink\" title=\"属性的存在性\"></a>属性的存在性</h4><ul>\n<li>1、in</li>\n</ul>\n<p>检查是否在元素本身，以及原型链中。</p>\n<ul>\n<li>2、hasOwnProperty</li>\n</ul>\n<p>检查是否在对象本身。</p>\n<ul>\n<li>3、peopertyIsEnumerable</li>\n</ul>\n<p>检查属性名是否直接存在于对象中，而且<code>enumerable:true</code>。</p>\n<ul>\n<li>4、Object.keys</li>\n</ul>\n<p>返回一个对象本身所有可以枚举的属性</p>\n<ul>\n<li>5、Object.getOwnPropertyNames</li>\n</ul>\n<p>返回对象包含的所有属性(不含原型链)，不论是否可以枚举。</p>\n<h4 id=\"遍历\"><a href=\"#遍历\" class=\"headerlink\" title=\"遍历\"></a>遍历</h4><ul>\n<li>1、for in</li>\n</ul>\n<p>遍历对象可以枚举的属性，包含原型链。</p>\n<ul>\n<li>2、for</li>\n</ul>\n<p>遍历数组</p>\n<ul>\n<li>3、forEach\\some\\every</li>\n</ul>\n<p>ES5添加的方法，用于遍历数组。</p>\n<ul>\n<li>4、for..of</li>\n</ul>\n<p>通过迭代器(Symbol.iterator)遍历数组或者对象。</p>\n<h3 id=\"原型\"><a href=\"#原型\" class=\"headerlink\" title=\"原型\"></a>原型</h3><h4 id=\"Object-prototype\"><a href=\"#Object-prototype\" class=\"headerlink\" title=\"Object.prototype\"></a>Object.prototype</h4><blockquote>\n<p>所有的[[prototype]]最终指向<code>Object.prototype</code>。其提供了一些方法，如<code>valueOf</code>等等。</p>\n</blockquote>\n<p><code>myObject.foo = &quot;bar&quot;</code>出现的情况：</p>\n<ul>\n<li><p>1、[[prototype]]存在<code>foo</code>,并且可以写，那么会在myObject新建一个<code>foo</code>属性。</p>\n</li>\n<li><p>2、[[prototype]]存在<code>foo</code>,并且不可以写，严格模式报出错误。</p>\n</li>\n<li><p>3、[[prototype]]存在<code>foo</code>且是一个<code>setter</code>,那就一定会调用这个<code>setter</code>,<code>foo</code>不被添加，而且调用这个<code>setter</code>。</p>\n</li>\n</ul>\n<h4 id=\"基本原型关系：\"><a href=\"#基本原型关系：\" class=\"headerlink\" title=\"基本原型关系：\"></a>基本原型关系：</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = <span class=\"keyword\">new</span> Foo();</span><br><span class=\"line\"></span><br><span class=\"line\">Foo.prototype.__proto__ == <span class=\"built_in\">Object</span>.prototype</span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.__proto__ == <span class=\"built_in\">Object</span>.prototype</span><br><span class=\"line\"><span class=\"built_in\">Array</span>.__proto__ == <span class=\"built_in\">Function</span>.prototype</span><br><span class=\"line\">Foo.__proto__ == <span class=\"built_in\">Function</span>.prototype</span><br><span class=\"line\">foo.__proto__ == Foo.prototype</span><br><span class=\"line\"></span><br><span class=\"line\">Foo.constructor == <span class=\"built_in\">Function</span></span><br><span class=\"line\">foo.constructor == Foo</span><br></pre></td></tr></table></figure>\n"},{"title":"你不知道的box-shadow","date":"2016-09-03T08:34:18.000Z","_content":"\n# box-shadow\n\n`box-shadow`是`CSS3`提出的一个重要属性用于给元素附加一层阴影。基本格式书写：\n\n>box-shadow: h-offset v-offset blur-radius spread\n\n- h-offset: 阴影距离元素水平方向的偏移,允许为负数\n- v-offset: 阴影距离元素垂直方向的偏移,允许为负数\n- blur-radius: 模糊半径\n- spared: 延展半径,允许为负数\n\n---\n\n## 基本使用\n\n{% jsfiddle nkr9vmzL css,result light 100% 400px %}\n\n>在`div`元素周围生成了黑色的阴影，这里我们只用到了三个参数，水平和垂直方向的偏移以及模糊半径。在这个例子中，四个方向的阴影长度大致为`5px`。\n\n### 加上偏移量\n\n{% jsfiddle yzbzvm15 css,result light 100% 400px %}\n\n>水平偏移`2px`垂直偏移`3px`，模糊半径`10px`，这个时候元素在四周依然有阴影存在，我们如何计算阴影的长度呢？答案在于：\n\n- 在顶部看到`7px`的投影(10px - 3px)\n- 在底部看到`13px`的投影(10px + 3px)\n- 在左边看到`8px`的投影(10px - 2px)\n- 在右边看到`12px`的投影(10px + 2px)\n\n---\n\n## 单个方向的投影\n\n知道了阴影半径的计算，那么如何设计一个单个方向的投影呢？这个时候就需要`spared`属性，`spared`属性用于扩大或者缩小投影的尺寸。\n{% jsfiddle uowdjmfe css,result light 100% 400px %}\n\n利用`spread`，可以把需要隐藏的投影缩小，实现呢单边投影的效果。\n\n---\n\n## 邻边投影\n\n把上面的例子稍微修改一下得到右边和下边都为`5px`的投影。\n\n{% jsfiddle 880t7xs3 css,result light 100% 400px %}\n\n---\n\n## 对边投影\n\n`box-shadow`属性允许指定多个阴影，越往后`z-order`越小。我们利用单边投影的方式轻松实现对边投影的效果。\n{% jsfiddle 2e3rqnL7 css,result light 100% 400px %}\n\n---\n\n## 总结\n\n投影实现步骤：\n\n- 在元素的上面，以元素原大小和指定颜色绘制一个矩形\n- 根据`h-offset`、`v-offset`偏移矩形\n- 根据`blur-radius`对元素模糊处理,在元素两边模糊的大小近似于模糊半径的两倍\n- 根据`spread`裁剪投影\n- 把投影和元素叠加的部分切除掉，完成了投影的过程","source":"_posts/你不知道的box-shadow.md","raw":"---\ntitle: 你不知道的box-shadow\ndate: 2016-09-03 16:34:18\ntags: box-shadow\ncategories: web\n---\n\n# box-shadow\n\n`box-shadow`是`CSS3`提出的一个重要属性用于给元素附加一层阴影。基本格式书写：\n\n>box-shadow: h-offset v-offset blur-radius spread\n\n- h-offset: 阴影距离元素水平方向的偏移,允许为负数\n- v-offset: 阴影距离元素垂直方向的偏移,允许为负数\n- blur-radius: 模糊半径\n- spared: 延展半径,允许为负数\n\n---\n\n## 基本使用\n\n{% jsfiddle nkr9vmzL css,result light 100% 400px %}\n\n>在`div`元素周围生成了黑色的阴影，这里我们只用到了三个参数，水平和垂直方向的偏移以及模糊半径。在这个例子中，四个方向的阴影长度大致为`5px`。\n\n### 加上偏移量\n\n{% jsfiddle yzbzvm15 css,result light 100% 400px %}\n\n>水平偏移`2px`垂直偏移`3px`，模糊半径`10px`，这个时候元素在四周依然有阴影存在，我们如何计算阴影的长度呢？答案在于：\n\n- 在顶部看到`7px`的投影(10px - 3px)\n- 在底部看到`13px`的投影(10px + 3px)\n- 在左边看到`8px`的投影(10px - 2px)\n- 在右边看到`12px`的投影(10px + 2px)\n\n---\n\n## 单个方向的投影\n\n知道了阴影半径的计算，那么如何设计一个单个方向的投影呢？这个时候就需要`spared`属性，`spared`属性用于扩大或者缩小投影的尺寸。\n{% jsfiddle uowdjmfe css,result light 100% 400px %}\n\n利用`spread`，可以把需要隐藏的投影缩小，实现呢单边投影的效果。\n\n---\n\n## 邻边投影\n\n把上面的例子稍微修改一下得到右边和下边都为`5px`的投影。\n\n{% jsfiddle 880t7xs3 css,result light 100% 400px %}\n\n---\n\n## 对边投影\n\n`box-shadow`属性允许指定多个阴影，越往后`z-order`越小。我们利用单边投影的方式轻松实现对边投影的效果。\n{% jsfiddle 2e3rqnL7 css,result light 100% 400px %}\n\n---\n\n## 总结\n\n投影实现步骤：\n\n- 在元素的上面，以元素原大小和指定颜色绘制一个矩形\n- 根据`h-offset`、`v-offset`偏移矩形\n- 根据`blur-radius`对元素模糊处理,在元素两边模糊的大小近似于模糊半径的两倍\n- 根据`spread`裁剪投影\n- 把投影和元素叠加的部分切除掉，完成了投影的过程","slug":"你不知道的box-shadow","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhly700289co77etjgon6","content":"<h1 id=\"box-shadow\"><a href=\"#box-shadow\" class=\"headerlink\" title=\"box-shadow\"></a>box-shadow</h1><p><code>box-shadow</code>是<code>CSS3</code>提出的一个重要属性用于给元素附加一层阴影。基本格式书写：</p>\n<blockquote>\n<p>box-shadow: h-offset v-offset blur-radius spread</p>\n</blockquote>\n<ul>\n<li>h-offset: 阴影距离元素水平方向的偏移,允许为负数</li>\n<li>v-offset: 阴影距离元素垂直方向的偏移,允许为负数</li>\n<li>blur-radius: 模糊半径</li>\n<li>spared: 延展半径,允许为负数</li>\n</ul>\n<hr>\n<h2 id=\"基本使用\"><a href=\"#基本使用\" class=\"headerlink\" title=\"基本使用\"></a>基本使用</h2><iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/nkr9vmzL/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<blockquote>\n<p>在<code>div</code>元素周围生成了黑色的阴影，这里我们只用到了三个参数，水平和垂直方向的偏移以及模糊半径。在这个例子中，四个方向的阴影长度大致为<code>5px</code>。</p>\n</blockquote>\n<h3 id=\"加上偏移量\"><a href=\"#加上偏移量\" class=\"headerlink\" title=\"加上偏移量\"></a>加上偏移量</h3><iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/yzbzvm15/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<blockquote>\n<p>水平偏移<code>2px</code>垂直偏移<code>3px</code>，模糊半径<code>10px</code>，这个时候元素在四周依然有阴影存在，我们如何计算阴影的长度呢？答案在于：</p>\n</blockquote>\n<ul>\n<li>在顶部看到<code>7px</code>的投影(10px - 3px)</li>\n<li>在底部看到<code>13px</code>的投影(10px + 3px)</li>\n<li>在左边看到<code>8px</code>的投影(10px - 2px)</li>\n<li>在右边看到<code>12px</code>的投影(10px + 2px)</li>\n</ul>\n<hr>\n<h2 id=\"单个方向的投影\"><a href=\"#单个方向的投影\" class=\"headerlink\" title=\"单个方向的投影\"></a>单个方向的投影</h2><p>知道了阴影半径的计算，那么如何设计一个单个方向的投影呢？这个时候就需要<code>spared</code>属性，<code>spared</code>属性用于扩大或者缩小投影的尺寸。<br><iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/uowdjmfe/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe></p>\n<p>利用<code>spread</code>，可以把需要隐藏的投影缩小，实现呢单边投影的效果。</p>\n<hr>\n<h2 id=\"邻边投影\"><a href=\"#邻边投影\" class=\"headerlink\" title=\"邻边投影\"></a>邻边投影</h2><p>把上面的例子稍微修改一下得到右边和下边都为<code>5px</code>的投影。</p>\n<iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/880t7xs3/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<hr>\n<h2 id=\"对边投影\"><a href=\"#对边投影\" class=\"headerlink\" title=\"对边投影\"></a>对边投影</h2><p><code>box-shadow</code>属性允许指定多个阴影，越往后<code>z-order</code>越小。我们利用单边投影的方式轻松实现对边投影的效果。<br><iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/2e3rqnL7/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe></p>\n<hr>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>投影实现步骤：</p>\n<ul>\n<li>在元素的上面，以元素原大小和指定颜色绘制一个矩形</li>\n<li>根据<code>h-offset</code>、<code>v-offset</code>偏移矩形</li>\n<li>根据<code>blur-radius</code>对元素模糊处理,在元素两边模糊的大小近似于模糊半径的两倍</li>\n<li>根据<code>spread</code>裁剪投影</li>\n<li>把投影和元素叠加的部分切除掉，完成了投影的过程</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"box-shadow\"><a href=\"#box-shadow\" class=\"headerlink\" title=\"box-shadow\"></a>box-shadow</h1><p><code>box-shadow</code>是<code>CSS3</code>提出的一个重要属性用于给元素附加一层阴影。基本格式书写：</p>\n<blockquote>\n<p>box-shadow: h-offset v-offset blur-radius spread</p>\n</blockquote>\n<ul>\n<li>h-offset: 阴影距离元素水平方向的偏移,允许为负数</li>\n<li>v-offset: 阴影距离元素垂直方向的偏移,允许为负数</li>\n<li>blur-radius: 模糊半径</li>\n<li>spared: 延展半径,允许为负数</li>\n</ul>\n<hr>\n<h2 id=\"基本使用\"><a href=\"#基本使用\" class=\"headerlink\" title=\"基本使用\"></a>基本使用</h2><iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/nkr9vmzL/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<blockquote>\n<p>在<code>div</code>元素周围生成了黑色的阴影，这里我们只用到了三个参数，水平和垂直方向的偏移以及模糊半径。在这个例子中，四个方向的阴影长度大致为<code>5px</code>。</p>\n</blockquote>\n<h3 id=\"加上偏移量\"><a href=\"#加上偏移量\" class=\"headerlink\" title=\"加上偏移量\"></a>加上偏移量</h3><iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/yzbzvm15/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<blockquote>\n<p>水平偏移<code>2px</code>垂直偏移<code>3px</code>，模糊半径<code>10px</code>，这个时候元素在四周依然有阴影存在，我们如何计算阴影的长度呢？答案在于：</p>\n</blockquote>\n<ul>\n<li>在顶部看到<code>7px</code>的投影(10px - 3px)</li>\n<li>在底部看到<code>13px</code>的投影(10px + 3px)</li>\n<li>在左边看到<code>8px</code>的投影(10px - 2px)</li>\n<li>在右边看到<code>12px</code>的投影(10px + 2px)</li>\n</ul>\n<hr>\n<h2 id=\"单个方向的投影\"><a href=\"#单个方向的投影\" class=\"headerlink\" title=\"单个方向的投影\"></a>单个方向的投影</h2><p>知道了阴影半径的计算，那么如何设计一个单个方向的投影呢？这个时候就需要<code>spared</code>属性，<code>spared</code>属性用于扩大或者缩小投影的尺寸。<br><iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/uowdjmfe/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe></p>\n<p>利用<code>spread</code>，可以把需要隐藏的投影缩小，实现呢单边投影的效果。</p>\n<hr>\n<h2 id=\"邻边投影\"><a href=\"#邻边投影\" class=\"headerlink\" title=\"邻边投影\"></a>邻边投影</h2><p>把上面的例子稍微修改一下得到右边和下边都为<code>5px</code>的投影。</p>\n<iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/880t7xs3/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe>\n<hr>\n<h2 id=\"对边投影\"><a href=\"#对边投影\" class=\"headerlink\" title=\"对边投影\"></a>对边投影</h2><p><code>box-shadow</code>属性允许指定多个阴影，越往后<code>z-order</code>越小。我们利用单边投影的方式轻松实现对边投影的效果。<br><iframe scrolling=\"no\" width=\"100%\" height=\"400px\" src=\"//jsfiddle.net/2e3rqnL7/embedded/css,result/light\" frameborder=\"0\" allowfullscreen></iframe></p>\n<hr>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>投影实现步骤：</p>\n<ul>\n<li>在元素的上面，以元素原大小和指定颜色绘制一个矩形</li>\n<li>根据<code>h-offset</code>、<code>v-offset</code>偏移矩形</li>\n<li>根据<code>blur-radius</code>对元素模糊处理,在元素两边模糊的大小近似于模糊半径的两倍</li>\n<li>根据<code>spread</code>裁剪投影</li>\n<li>把投影和元素叠加的部分切除掉，完成了投影的过程</li>\n</ul>\n"},{"title":"关于express下session的几个注意事项","_content":"使用nodejs开发web应用之所以快，其中一个重要原因是非常齐全的第三方模块，你几乎可以找到任何想要的`module`。`express-session`是`express`WEB框架常用的`session`管理包。其主要有如下几个配置选项：  \n- cookie : 用于设置sessionID cookie选项，如过期时间，cookie适用的路径等。  \n- name  : sessionID 对应的cookie名。  \n- resave  :  强制把session写入存储，即使session在整个请求过程中都没有被修改。  \n- saveUninitialized  : 保存新建的但没有被改动的session。  \n- secret : 加密sessionID cookie的密钥。  \n\n\n---  \n\n###1、 session并发问题  \n`resave`选项如果配置为`true`，而实际的运用场景有并发请求并且依赖`session`的情况下就得注意了。因为问题在于，一个请求设置得数据可能被另外一个请求重写覆盖了。 对于一些有并发的服务器，需要把该选项配置为`false`。当然这只能解决`session`信息覆盖的问题。 并不能很好解决`session`数据一致性问题，比如说：用户首先发送一个更新`session`的请求，该请求依赖于其他服务器的应答，而后续的其他请求依赖于最新得`session`信息否则必须给以错误得应答。这个时候我们必须手动更新`session`的信息，把依赖于更新`session`信息的并发请求串行化。  \n\n``` javascript\n    Promise.resolve()\n    .then(function() {\n        req.session.user.gameKey = null;\n        req.session.user.companyId = null;\n        return syncUserSession(req);\n    })\n    .then(function() {\n      //....\n    });\n\n    function updateUserInfo(user) {\n        return new Promise(function(resolve, reject) {\n        user.gameKey = gameKey;\n        user.companyId = user.companyIdSrc;\n        user.save(function() {\n            req.session.user = user;\n        });\n        });\n    }\n\n```  \n\n\n###2、 合理搭配中间件得顺序  \n`express-session`作为几个基础中间件，每次请求都有创建对象，分配内存，保存数据等一系列操作。实际上，服务器上一些资源得应答没有使用到`session`。所以我们可以把它提前。当然也可以把没有使用到`session`得用户中间件提前。  \n\n``` javascript  \n//静态资源\napp.use('/public', express.static(staticDir));  \napp.use(require('cookie-parser')(config.session_secret));\napp.use(session({\n\tsecret: config.session_secret,\n\tstore: new RedisStore({\n\t\tport: config.redis_port,\n\t\thost: config.redis_host\n\t}),\n    resave: false,\n\tsaveUninitialized: true\n}));\n\n```  \n\n`cookie-parser`模块解析`cookie`数据，随后得`session`模块根据`sessionID cookie`管理会话数据。 把静态资源服务提前避免不必要得`session`操作。\n\n\n\n\n\n","source":"_posts/关于express下session的几个注意事项.md","raw":"---\ntitle: 关于express下session的几个注意事项\ncategories: server\n---\n使用nodejs开发web应用之所以快，其中一个重要原因是非常齐全的第三方模块，你几乎可以找到任何想要的`module`。`express-session`是`express`WEB框架常用的`session`管理包。其主要有如下几个配置选项：  \n- cookie : 用于设置sessionID cookie选项，如过期时间，cookie适用的路径等。  \n- name  : sessionID 对应的cookie名。  \n- resave  :  强制把session写入存储，即使session在整个请求过程中都没有被修改。  \n- saveUninitialized  : 保存新建的但没有被改动的session。  \n- secret : 加密sessionID cookie的密钥。  \n\n\n---  \n\n###1、 session并发问题  \n`resave`选项如果配置为`true`，而实际的运用场景有并发请求并且依赖`session`的情况下就得注意了。因为问题在于，一个请求设置得数据可能被另外一个请求重写覆盖了。 对于一些有并发的服务器，需要把该选项配置为`false`。当然这只能解决`session`信息覆盖的问题。 并不能很好解决`session`数据一致性问题，比如说：用户首先发送一个更新`session`的请求，该请求依赖于其他服务器的应答，而后续的其他请求依赖于最新得`session`信息否则必须给以错误得应答。这个时候我们必须手动更新`session`的信息，把依赖于更新`session`信息的并发请求串行化。  \n\n``` javascript\n    Promise.resolve()\n    .then(function() {\n        req.session.user.gameKey = null;\n        req.session.user.companyId = null;\n        return syncUserSession(req);\n    })\n    .then(function() {\n      //....\n    });\n\n    function updateUserInfo(user) {\n        return new Promise(function(resolve, reject) {\n        user.gameKey = gameKey;\n        user.companyId = user.companyIdSrc;\n        user.save(function() {\n            req.session.user = user;\n        });\n        });\n    }\n\n```  \n\n\n###2、 合理搭配中间件得顺序  \n`express-session`作为几个基础中间件，每次请求都有创建对象，分配内存，保存数据等一系列操作。实际上，服务器上一些资源得应答没有使用到`session`。所以我们可以把它提前。当然也可以把没有使用到`session`得用户中间件提前。  \n\n``` javascript  \n//静态资源\napp.use('/public', express.static(staticDir));  \napp.use(require('cookie-parser')(config.session_secret));\napp.use(session({\n\tsecret: config.session_secret,\n\tstore: new RedisStore({\n\t\tport: config.redis_port,\n\t\thost: config.redis_host\n\t}),\n    resave: false,\n\tsaveUninitialized: true\n}));\n\n```  \n\n`cookie-parser`模块解析`cookie`数据，随后得`session`模块根据`sessionID cookie`管理会话数据。 把静态资源服务提前避免不必要得`session`操作。\n\n\n\n\n\n","slug":"关于express下session的几个注意事项","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhly8002b9co7z4i0pw6p","content":"<p>使用nodejs开发web应用之所以快，其中一个重要原因是非常齐全的第三方模块，你几乎可以找到任何想要的<code>module</code>。<code>express-session</code>是<code>express</code>WEB框架常用的<code>session</code>管理包。其主要有如下几个配置选项：  </p>\n<ul>\n<li>cookie : 用于设置sessionID cookie选项，如过期时间，cookie适用的路径等。  </li>\n<li>name  : sessionID 对应的cookie名。  </li>\n<li>resave  :  强制把session写入存储，即使session在整个请求过程中都没有被修改。  </li>\n<li>saveUninitialized  : 保存新建的但没有被改动的session。  </li>\n<li>secret : 加密sessionID cookie的密钥。  </li>\n</ul>\n<hr>\n<p>###1、 session并发问题<br><code>resave</code>选项如果配置为<code>true</code>，而实际的运用场景有并发请求并且依赖<code>session</code>的情况下就得注意了。因为问题在于，一个请求设置得数据可能被另外一个请求重写覆盖了。 对于一些有并发的服务器，需要把该选项配置为<code>false</code>。当然这只能解决<code>session</code>信息覆盖的问题。 并不能很好解决<code>session</code>数据一致性问题，比如说：用户首先发送一个更新<code>session</code>的请求，该请求依赖于其他服务器的应答，而后续的其他请求依赖于最新得<code>session</code>信息否则必须给以错误得应答。这个时候我们必须手动更新<code>session</code>的信息，把依赖于更新<code>session</code>信息的并发请求串行化。  </p>\n<pre><code class=\"javascript\"><span class=\"built_in\">Promise</span>.resolve()\n.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n    req.session.user.gameKey = <span class=\"literal\">null</span>;\n    req.session.user.companyId = <span class=\"literal\">null</span>;\n    <span class=\"keyword\">return</span> syncUserSession(req);\n})\n.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n  <span class=\"comment\">//....</span>\n});\n\n<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateUserInfo</span>(<span class=\"params\">user</span>) </span>{\n    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>{\n    user.gameKey = gameKey;\n    user.companyId = user.companyIdSrc;\n    user.save(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n        req.session.user = user;\n    });\n    });\n}\n</code></pre>\n<p>###2、 合理搭配中间件得顺序<br><code>express-session</code>作为几个基础中间件，每次请求都有创建对象，分配内存，保存数据等一系列操作。实际上，服务器上一些资源得应答没有使用到<code>session</code>。所以我们可以把它提前。当然也可以把没有使用到<code>session</code>得用户中间件提前。  </p>\n<pre><code class=\"javascript\"><span class=\"comment\">//静态资源</span>\napp.use(<span class=\"string\">'/public'</span>, express.static(staticDir));  \napp.use(<span class=\"built_in\">require</span>(<span class=\"string\">'cookie-parser'</span>)(config.session_secret));\napp.use(session({\n    secret: config.session_secret,\n    store: <span class=\"keyword\">new</span> RedisStore({\n        port: config.redis_port,\n        host: config.redis_host\n    }),\n    resave: <span class=\"literal\">false</span>,\n    saveUninitialized: <span class=\"literal\">true</span>\n}));\n</code></pre>\n<p><code>cookie-parser</code>模块解析<code>cookie</code>数据，随后得<code>session</code>模块根据<code>sessionID cookie</code>管理会话数据。 把静态资源服务提前避免不必要得<code>session</code>操作。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>使用nodejs开发web应用之所以快，其中一个重要原因是非常齐全的第三方模块，你几乎可以找到任何想要的<code>module</code>。<code>express-session</code>是<code>express</code>WEB框架常用的<code>session</code>管理包。其主要有如下几个配置选项：  </p>\n<ul>\n<li>cookie : 用于设置sessionID cookie选项，如过期时间，cookie适用的路径等。  </li>\n<li>name  : sessionID 对应的cookie名。  </li>\n<li>resave  :  强制把session写入存储，即使session在整个请求过程中都没有被修改。  </li>\n<li>saveUninitialized  : 保存新建的但没有被改动的session。  </li>\n<li>secret : 加密sessionID cookie的密钥。  </li>\n</ul>\n<hr>\n<p>###1、 session并发问题<br><code>resave</code>选项如果配置为<code>true</code>，而实际的运用场景有并发请求并且依赖<code>session</code>的情况下就得注意了。因为问题在于，一个请求设置得数据可能被另外一个请求重写覆盖了。 对于一些有并发的服务器，需要把该选项配置为<code>false</code>。当然这只能解决<code>session</code>信息覆盖的问题。 并不能很好解决<code>session</code>数据一致性问题，比如说：用户首先发送一个更新<code>session</code>的请求，该请求依赖于其他服务器的应答，而后续的其他请求依赖于最新得<code>session</code>信息否则必须给以错误得应答。这个时候我们必须手动更新<code>session</code>的信息，把依赖于更新<code>session</code>信息的并发请求串行化。  </p>\n<pre><code class=\"javascript\"><span class=\"built_in\">Promise</span>.resolve()\n.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n    req.session.user.gameKey = <span class=\"literal\">null</span>;\n    req.session.user.companyId = <span class=\"literal\">null</span>;\n    <span class=\"keyword\">return</span> syncUserSession(req);\n})\n.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n  <span class=\"comment\">//....</span>\n});\n\n<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateUserInfo</span>(<span class=\"params\">user</span>) </span>{\n    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>{\n    user.gameKey = gameKey;\n    user.companyId = user.companyIdSrc;\n    user.save(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{\n        req.session.user = user;\n    });\n    });\n}\n</code></pre>\n<p>###2、 合理搭配中间件得顺序<br><code>express-session</code>作为几个基础中间件，每次请求都有创建对象，分配内存，保存数据等一系列操作。实际上，服务器上一些资源得应答没有使用到<code>session</code>。所以我们可以把它提前。当然也可以把没有使用到<code>session</code>得用户中间件提前。  </p>\n<pre><code class=\"javascript\"><span class=\"comment\">//静态资源</span>\napp.use(<span class=\"string\">'/public'</span>, express.static(staticDir));  \napp.use(<span class=\"built_in\">require</span>(<span class=\"string\">'cookie-parser'</span>)(config.session_secret));\napp.use(session({\n    secret: config.session_secret,\n    store: <span class=\"keyword\">new</span> RedisStore({\n        port: config.redis_port,\n        host: config.redis_host\n    }),\n    resave: <span class=\"literal\">false</span>,\n    saveUninitialized: <span class=\"literal\">true</span>\n}));\n</code></pre>\n<p><code>cookie-parser</code>模块解析<code>cookie</code>数据，随后得<code>session</code>模块根据<code>sessionID cookie</code>管理会话数据。 把静态资源服务提前避免不必要得<code>session</code>操作。</p>\n"},{"title":"使用passport管理第三方授权认证","_content":"`passport`是一个为`Nodejs`设计的，兼容`Express`的认证中间件。通过第三方插件的形式(以下称为`strategy`)，可以应对各式各样的认证请求。`passport`具有高度的灵活性，并不依赖于任何一个路由，或者指定的数据存储，这样给上层开发者提供的极大的便利性。`passport`提供的接口也相对简单，只需要给它一个认证请求，`passport`会提供一个钩子函数(`hook`)告诉你请求失败了或者成功了。\n\n---\n\n### 1. passport的设计思路\n`passport`基于一个高度灵活的设计结构，主要由四个模块组成：`passport`插件(strategy)管理模块、`执行认证操作的授权模块`、`framewark适配模块`、`session管理模块`。其结构框图如下：\n\n![系统框图](http://www.tangide.com/storage/read.php?path=wechat/o/oSjbMs7GPu-gH9dZ4tsoo52y4gmo/blog/passport%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png)\n\n\n授权流程(引用`github oath2.0`来举例)\n\n![授权流程](http://www.tangide.com/storage/read.php?path=wechat/o/oSjbMs7GPu-gH9dZ4tsoo52y4gmo/blog/passport-%E6%8E%88%E6%9D%83%E6%B5%81%E7%A8%8B.png)\n\n+ 1.授权插件体系  \n所有的`passport`插件都继承自`passport-strategy`，紧接着根据不同的授权流程又细分为OAuth2.0授权中间件、OPENID类的授权中间件、以及帐号密码类的授权中间件。这些基本的中间件官方已经有了标准的实现。开发者需要做的是去继承这些授权中间件，针对不同的业务需求，配置特定的部分参数。就可以完成一整个授权的流程。常见的OAth2.0标准的授权插件有：`passport-github`、`passport-twitter`。这些针对不同厂商的第三方`Strategy`体量都非常小，基本在100行代码内可以搞定，因为大部分工作都交给标准的`strategy`来做了。\n\n\n+ 2.framework适配  \n`passport`官方的实现基于标准的`Express`形式的风格，也就是说，中间件的函数风格类似于：\n> function authenticate(req, res, next)\n>//如果需要适配其他的框架需要实现特定风格的`authenticate`函数。 \n\n\n\n+ 3.session管理  \n`passport`提供session的功能，如果开启该功能，则需要提供序列化，以及反序列化接口。`express-session`是一个很好的session管理包，所以还是让`passport`专注于授权认证吧！\n\n--- \n\n### 2. passport使用\n\n+ 1. 注入第三方`strategy`\n\n```javascript\n\nfunction verifyProfile(accessToken, refreshToken, profile, done) {\n  profile.accessToken = accessToken;\n   done(null, profile);\n}\n\npassport.use(new GithubStrategy({\nclientID: '123-456-789',\nclientSecret: 'easdasjdklasjd',\ncallbackURL: 'http://www.example.com/auth/github/callback'\n}), verifyProfile);\n\n```  \npassport提供`use`函数用于注入授权认证的插件、`unuse`用于注销认证插件。`verifyProfile`接口是一个`hook`，用来验证用户信息的有效性。\n\n\n+ 2. 授权认证  \n```javascript  \n\n//请求授权码\napp.get('/user/login/github', passport.authenricate('github', {scope: 'wl_scope'}));\n//获取accessToken以及请求用户信息，关闭session功能\napp.get('/auth/github/callback', passport.authenricate('github', {session: false, failureRedirect: '/'}));\n\n```  \n---\n\n### 3. passport源码分析\n\n+ 1. 授权认证入口函数  \n``` javascript\n\nAuthenticator.prototype.authenticate = function(strategy, options, callback) {\n  return this._framework.authenticate(this, strategy, options, callback);\n};\n\n```\n\n+ 2. express 风格的认证函数\n```javascript\n\nmodule.exports = function authenticate(passport, name, options, callback) {\n  if (typeof options == 'function') {\n    callback = options;\n    options = {};\n  }\n\n  return function authenticate(req, res, next) {\n\n     function allFailed() {\n      if (callback) {\n        if (!multi) {\n          return callback(null, false, failures[0].challenge, failures[0].status);\n        } else {\n          var challenges = failures.map(function(f) { return f.challenge; });\n          var statuses = failures.map(function(f) { return f.status; });\n          return callback(null, false, challenges, statuses);\n        }\n      }\n      ....\n    }\n    (function attempt(i) {\n      var layer = name[i];\n      // If no more strategies exist in the chain, authentication has failed.\n      if (!layer) { return allFailed(); }\n      var prototype = passport._strategy(layer);\n      if (!prototype) { return next(new Error('Unknown authentication strategy \"' + layer + '\"')); }\n    \n      var strategy = Object.create(prototype);\n      strategy.success = function(user, info) {\n        if (callback) {\n          return callback(null, user, info);\n        }\n        ....\n         req.logIn(user, options, function(err) {\n          if (err) { return next(err); }\n          \n          function complete() {\n            if (options.successReturnToOrRedirect) {\n              var url = options.successReturnToOrRedirect;\n              if (req.session && req.session.returnTo) {\n                url = req.session.returnTo;\n                delete req.session.returnTo;\n              }\n              return res.redirect(url);\n            }\n            if (options.successRedirect) {\n              return res.redirect(options.successRedirect);\n            }\n            next();\n          }\n          complete();\n      }\n       ....\n     //调用oauth2.0认证函数\n     strategy.authenticate(req, options);\n  })(0);\n\n\n```\n\n+ 3. Oauth2.0 认证函数\n\n```javascript\n\nOAuth2Strategy.prototype.authenticate = function(req, options) {\n  options = options || {};\n  var self = this;\n  \n  if (req.query && req.query.error) {\n    if (req.query.error == 'access_denied') {\n      return this.fail({ message: req.query.error_description });\n    } else {\n      return this.error(new AuthorizationError(req.query.error_description, req.query.error, req.query.error_uri));\n    }\n  }\n  \n  var callbackURL = options.callbackURL || this._callbackURL;\n  if (callbackURL) {\n    var parsed = url.parse(callbackURL);\n    if (!parsed.protocol) {\n      // The callback URL is relative, resolve a fully qualified URL from the\n      // URL of the originating request.\n      callbackURL = url.resolve(utils.originalURL(req, { proxy: this._trustProxy }), callbackURL);\n    }\n  }\n  \n  if (req.query && req.query.code) {\n   //根据授权码获取accessToken以及用户信息\n    var code = req.query.code;\n\n    var params = this.tokenParams(options);\n    params.grant_type = 'authorization_code';\n    params.redirect_uri = callbackURL;\n\n    this._oauth2.getOAuthAccessToken(code, params,\n      function(err, accessToken, refreshToken, params) {\n        if (err) { return self.error(self._createOAuthError('Failed to obtain access token', err)); }\n        \n        self._loadUserProfile(accessToken, function(err, profile) {\n          if (err) { return self.error(err); }\n          \n          function verified(err, user, info) {\n            if (err) { return self.error(err); }\n            if (!user) { return self.fail(info); }\n            self.success(user, info);\n          }\n          \n          try {\n            //_verify 就是注入插件的时候指定的用户信息校验函数只有通过该函数校验，认证才算完成，用户信息被`success`挂在req.user。\n            if (self._passReqToCallback) {\n              var arity = self._verify.length;\n              if (arity == 6) {\n                self._verify(req, accessToken, refreshToken, params, profile, verified);\n              } else { // arity == 5\n                self._verify(req, accessToken, refreshToken, profile, verified);\n              }\n            } else {\n              var arity = self._verify.length;\n              if (arity == 5) {\n                self._verify(accessToken, refreshToken, params, profile, verified);\n              } else { // arity == 4\n                self._verify(accessToken, refreshToken, profile, verified);\n              }\n            }\n          } catch (ex) {\n            return self.error(ex);\n          }\n        });\n      }\n    );\n  } else {\n   //获取授权码\n    var params = this.authorizationParams(options);\n    params.response_type = 'code';\n    params.redirect_uri = callbackURL;\n    var scope = options.scope || this._scope;\n    if (scope) {\n      if (Array.isArray(scope)) { scope = scope.join(this._scopeSeparator); }\n      params.scope = scope;\n    }\n\n    var location = this._oauth2.getAuthorizeUrl(params);\n    this.redirect(location);\n  }\n};\n\n```\n\n+ 4. 获取用户信息\n```javascript\n\nOAuth2Strategy.prototype._loadUserProfile = function(accessToken, done) {\n  var self = this;\n  \n  function loadIt() {\n    return self.userProfile(accessToken, done);\n  }\n  function skipIt() {\n    return done(null);\n  }\n  //通过_skipUserProfile参数跳过不需要获取用户信息的认证。\n  if (typeof this._skipUserProfile == 'function' && this._skipUserProfile.length > 1) {\n    // async\n    this._skipUserProfile(accessToken, function(err, skip) {\n      if (err) { return done(err); }\n      if (!skip) { return loadIt(); }\n      return skipIt();\n    });\n  } else {\n    var skip = (typeof this._skipUserProfile == 'function') ? this._skipUserProfile() : this._skipUserProfile;\n    if (!skip) { return loadIt(); }\n    return skipIt();\n  }\n};\n\n//第三方插件需要重载该接口实现用户信息的获取，`passport`把该接口完全开放给开发者。\nOAuth2Strategy.prototype.userProfile = function(accessToken, done) {\n  return done(null, {});\n};\n\n```\n\n--- \n\n### 4. 实现自己的`strategy`实现\n\n实现自己的第三方`passport-strategy`主要有三个步骤：\n\n+ 1. 继承`passport-oauth2`\n``` javascript\nfunction Strategy(options, verify) {\n  options = options || {};\n  options.authorizationURL = options.authorizationURL || 'https://github.com/login/oauth/authorize';\n  options.tokenURL = options.tokenURL || 'https://github.com/login/oauth/access_token';\n  options.scopeSeparator = options.scopeSeparator || ',';\n  options.customHeaders = options.customHeaders || {};\n\n  if (!options.customHeaders['User-Agent']) {\n    options.customHeaders['User-Agent'] = options.userAgent || 'passport-github';\n  }\n\n  OAuth2Strategy.call(this, options, verify);\n  this.name = 'github';\n  this._userProfileURL = options.userProfileURL || 'https://api.github.com/user';\n  this._oauth2.useAuthorizationHeaderforGET(true);\n}\n\n/**\n * Inherit from `OAuth2Strategy`.\n */\nutil.inherits(Strategy, OAuth2Strategy);\n```\n\n+ 2. 实现获取用户信息接口\n``` javascript  \nStrategy.prototype.userProfile = function(accessToken, done) {\n  this._oauth2.get(this._userProfileURL, accessToken, function (err, body, res) {\n    var json;\n    \n    if (err) {\n      return done(new InternalOAuthError('Failed to fetch user profile', err));\n    }\n    \n    try {\n      json = JSON.parse(body);\n    } catch (ex) {\n      return done(new Error('Failed to parse user profile'));\n    }\n    \n    var profile = Profile.parse(json);\n    profile.provider  = 'github';\n    profile._raw = body;\n    profile._json = json;\n    \n    done(null, profile);\n  });\n}\n```\n\n+ 3. 解析用户信息函数实现\n``` javascript\nvar parse = function(json) {\n  if ('string' == typeof json) {\n    json = JSON.parse(json);\n  }\n  \n  var profile = {};\n  profile.id = String(json.id);\n  profile.displayName = json.name;\n  profile.username = json.login;\n  profile.profileUrl = json.html_url;\n  if (json.email) {\n    profile.emails = [{ value: json.email }];\n  }\n  \n  return profile;\n};\n```\n\n---\n\n**只需要三步骤，轻松实现授权认证！，`passport`官网已经有非常多的第三方认证实现，为了避免重复造轮子，请先查找是否有你要的插件: [Search Strategy](http://passportjs.org/)**\n\n","source":"_posts/使用passport管理第三方授权认证.md","raw":"---\ntitle: 使用passport管理第三方授权认证\ncategories: server\n---\n`passport`是一个为`Nodejs`设计的，兼容`Express`的认证中间件。通过第三方插件的形式(以下称为`strategy`)，可以应对各式各样的认证请求。`passport`具有高度的灵活性，并不依赖于任何一个路由，或者指定的数据存储，这样给上层开发者提供的极大的便利性。`passport`提供的接口也相对简单，只需要给它一个认证请求，`passport`会提供一个钩子函数(`hook`)告诉你请求失败了或者成功了。\n\n---\n\n### 1. passport的设计思路\n`passport`基于一个高度灵活的设计结构，主要由四个模块组成：`passport`插件(strategy)管理模块、`执行认证操作的授权模块`、`framewark适配模块`、`session管理模块`。其结构框图如下：\n\n![系统框图](http://www.tangide.com/storage/read.php?path=wechat/o/oSjbMs7GPu-gH9dZ4tsoo52y4gmo/blog/passport%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png)\n\n\n授权流程(引用`github oath2.0`来举例)\n\n![授权流程](http://www.tangide.com/storage/read.php?path=wechat/o/oSjbMs7GPu-gH9dZ4tsoo52y4gmo/blog/passport-%E6%8E%88%E6%9D%83%E6%B5%81%E7%A8%8B.png)\n\n+ 1.授权插件体系  \n所有的`passport`插件都继承自`passport-strategy`，紧接着根据不同的授权流程又细分为OAuth2.0授权中间件、OPENID类的授权中间件、以及帐号密码类的授权中间件。这些基本的中间件官方已经有了标准的实现。开发者需要做的是去继承这些授权中间件，针对不同的业务需求，配置特定的部分参数。就可以完成一整个授权的流程。常见的OAth2.0标准的授权插件有：`passport-github`、`passport-twitter`。这些针对不同厂商的第三方`Strategy`体量都非常小，基本在100行代码内可以搞定，因为大部分工作都交给标准的`strategy`来做了。\n\n\n+ 2.framework适配  \n`passport`官方的实现基于标准的`Express`形式的风格，也就是说，中间件的函数风格类似于：\n> function authenticate(req, res, next)\n>//如果需要适配其他的框架需要实现特定风格的`authenticate`函数。 \n\n\n\n+ 3.session管理  \n`passport`提供session的功能，如果开启该功能，则需要提供序列化，以及反序列化接口。`express-session`是一个很好的session管理包，所以还是让`passport`专注于授权认证吧！\n\n--- \n\n### 2. passport使用\n\n+ 1. 注入第三方`strategy`\n\n```javascript\n\nfunction verifyProfile(accessToken, refreshToken, profile, done) {\n  profile.accessToken = accessToken;\n   done(null, profile);\n}\n\npassport.use(new GithubStrategy({\nclientID: '123-456-789',\nclientSecret: 'easdasjdklasjd',\ncallbackURL: 'http://www.example.com/auth/github/callback'\n}), verifyProfile);\n\n```  \npassport提供`use`函数用于注入授权认证的插件、`unuse`用于注销认证插件。`verifyProfile`接口是一个`hook`，用来验证用户信息的有效性。\n\n\n+ 2. 授权认证  \n```javascript  \n\n//请求授权码\napp.get('/user/login/github', passport.authenricate('github', {scope: 'wl_scope'}));\n//获取accessToken以及请求用户信息，关闭session功能\napp.get('/auth/github/callback', passport.authenricate('github', {session: false, failureRedirect: '/'}));\n\n```  \n---\n\n### 3. passport源码分析\n\n+ 1. 授权认证入口函数  \n``` javascript\n\nAuthenticator.prototype.authenticate = function(strategy, options, callback) {\n  return this._framework.authenticate(this, strategy, options, callback);\n};\n\n```\n\n+ 2. express 风格的认证函数\n```javascript\n\nmodule.exports = function authenticate(passport, name, options, callback) {\n  if (typeof options == 'function') {\n    callback = options;\n    options = {};\n  }\n\n  return function authenticate(req, res, next) {\n\n     function allFailed() {\n      if (callback) {\n        if (!multi) {\n          return callback(null, false, failures[0].challenge, failures[0].status);\n        } else {\n          var challenges = failures.map(function(f) { return f.challenge; });\n          var statuses = failures.map(function(f) { return f.status; });\n          return callback(null, false, challenges, statuses);\n        }\n      }\n      ....\n    }\n    (function attempt(i) {\n      var layer = name[i];\n      // If no more strategies exist in the chain, authentication has failed.\n      if (!layer) { return allFailed(); }\n      var prototype = passport._strategy(layer);\n      if (!prototype) { return next(new Error('Unknown authentication strategy \"' + layer + '\"')); }\n    \n      var strategy = Object.create(prototype);\n      strategy.success = function(user, info) {\n        if (callback) {\n          return callback(null, user, info);\n        }\n        ....\n         req.logIn(user, options, function(err) {\n          if (err) { return next(err); }\n          \n          function complete() {\n            if (options.successReturnToOrRedirect) {\n              var url = options.successReturnToOrRedirect;\n              if (req.session && req.session.returnTo) {\n                url = req.session.returnTo;\n                delete req.session.returnTo;\n              }\n              return res.redirect(url);\n            }\n            if (options.successRedirect) {\n              return res.redirect(options.successRedirect);\n            }\n            next();\n          }\n          complete();\n      }\n       ....\n     //调用oauth2.0认证函数\n     strategy.authenticate(req, options);\n  })(0);\n\n\n```\n\n+ 3. Oauth2.0 认证函数\n\n```javascript\n\nOAuth2Strategy.prototype.authenticate = function(req, options) {\n  options = options || {};\n  var self = this;\n  \n  if (req.query && req.query.error) {\n    if (req.query.error == 'access_denied') {\n      return this.fail({ message: req.query.error_description });\n    } else {\n      return this.error(new AuthorizationError(req.query.error_description, req.query.error, req.query.error_uri));\n    }\n  }\n  \n  var callbackURL = options.callbackURL || this._callbackURL;\n  if (callbackURL) {\n    var parsed = url.parse(callbackURL);\n    if (!parsed.protocol) {\n      // The callback URL is relative, resolve a fully qualified URL from the\n      // URL of the originating request.\n      callbackURL = url.resolve(utils.originalURL(req, { proxy: this._trustProxy }), callbackURL);\n    }\n  }\n  \n  if (req.query && req.query.code) {\n   //根据授权码获取accessToken以及用户信息\n    var code = req.query.code;\n\n    var params = this.tokenParams(options);\n    params.grant_type = 'authorization_code';\n    params.redirect_uri = callbackURL;\n\n    this._oauth2.getOAuthAccessToken(code, params,\n      function(err, accessToken, refreshToken, params) {\n        if (err) { return self.error(self._createOAuthError('Failed to obtain access token', err)); }\n        \n        self._loadUserProfile(accessToken, function(err, profile) {\n          if (err) { return self.error(err); }\n          \n          function verified(err, user, info) {\n            if (err) { return self.error(err); }\n            if (!user) { return self.fail(info); }\n            self.success(user, info);\n          }\n          \n          try {\n            //_verify 就是注入插件的时候指定的用户信息校验函数只有通过该函数校验，认证才算完成，用户信息被`success`挂在req.user。\n            if (self._passReqToCallback) {\n              var arity = self._verify.length;\n              if (arity == 6) {\n                self._verify(req, accessToken, refreshToken, params, profile, verified);\n              } else { // arity == 5\n                self._verify(req, accessToken, refreshToken, profile, verified);\n              }\n            } else {\n              var arity = self._verify.length;\n              if (arity == 5) {\n                self._verify(accessToken, refreshToken, params, profile, verified);\n              } else { // arity == 4\n                self._verify(accessToken, refreshToken, profile, verified);\n              }\n            }\n          } catch (ex) {\n            return self.error(ex);\n          }\n        });\n      }\n    );\n  } else {\n   //获取授权码\n    var params = this.authorizationParams(options);\n    params.response_type = 'code';\n    params.redirect_uri = callbackURL;\n    var scope = options.scope || this._scope;\n    if (scope) {\n      if (Array.isArray(scope)) { scope = scope.join(this._scopeSeparator); }\n      params.scope = scope;\n    }\n\n    var location = this._oauth2.getAuthorizeUrl(params);\n    this.redirect(location);\n  }\n};\n\n```\n\n+ 4. 获取用户信息\n```javascript\n\nOAuth2Strategy.prototype._loadUserProfile = function(accessToken, done) {\n  var self = this;\n  \n  function loadIt() {\n    return self.userProfile(accessToken, done);\n  }\n  function skipIt() {\n    return done(null);\n  }\n  //通过_skipUserProfile参数跳过不需要获取用户信息的认证。\n  if (typeof this._skipUserProfile == 'function' && this._skipUserProfile.length > 1) {\n    // async\n    this._skipUserProfile(accessToken, function(err, skip) {\n      if (err) { return done(err); }\n      if (!skip) { return loadIt(); }\n      return skipIt();\n    });\n  } else {\n    var skip = (typeof this._skipUserProfile == 'function') ? this._skipUserProfile() : this._skipUserProfile;\n    if (!skip) { return loadIt(); }\n    return skipIt();\n  }\n};\n\n//第三方插件需要重载该接口实现用户信息的获取，`passport`把该接口完全开放给开发者。\nOAuth2Strategy.prototype.userProfile = function(accessToken, done) {\n  return done(null, {});\n};\n\n```\n\n--- \n\n### 4. 实现自己的`strategy`实现\n\n实现自己的第三方`passport-strategy`主要有三个步骤：\n\n+ 1. 继承`passport-oauth2`\n``` javascript\nfunction Strategy(options, verify) {\n  options = options || {};\n  options.authorizationURL = options.authorizationURL || 'https://github.com/login/oauth/authorize';\n  options.tokenURL = options.tokenURL || 'https://github.com/login/oauth/access_token';\n  options.scopeSeparator = options.scopeSeparator || ',';\n  options.customHeaders = options.customHeaders || {};\n\n  if (!options.customHeaders['User-Agent']) {\n    options.customHeaders['User-Agent'] = options.userAgent || 'passport-github';\n  }\n\n  OAuth2Strategy.call(this, options, verify);\n  this.name = 'github';\n  this._userProfileURL = options.userProfileURL || 'https://api.github.com/user';\n  this._oauth2.useAuthorizationHeaderforGET(true);\n}\n\n/**\n * Inherit from `OAuth2Strategy`.\n */\nutil.inherits(Strategy, OAuth2Strategy);\n```\n\n+ 2. 实现获取用户信息接口\n``` javascript  \nStrategy.prototype.userProfile = function(accessToken, done) {\n  this._oauth2.get(this._userProfileURL, accessToken, function (err, body, res) {\n    var json;\n    \n    if (err) {\n      return done(new InternalOAuthError('Failed to fetch user profile', err));\n    }\n    \n    try {\n      json = JSON.parse(body);\n    } catch (ex) {\n      return done(new Error('Failed to parse user profile'));\n    }\n    \n    var profile = Profile.parse(json);\n    profile.provider  = 'github';\n    profile._raw = body;\n    profile._json = json;\n    \n    done(null, profile);\n  });\n}\n```\n\n+ 3. 解析用户信息函数实现\n``` javascript\nvar parse = function(json) {\n  if ('string' == typeof json) {\n    json = JSON.parse(json);\n  }\n  \n  var profile = {};\n  profile.id = String(json.id);\n  profile.displayName = json.name;\n  profile.username = json.login;\n  profile.profileUrl = json.html_url;\n  if (json.email) {\n    profile.emails = [{ value: json.email }];\n  }\n  \n  return profile;\n};\n```\n\n---\n\n**只需要三步骤，轻松实现授权认证！，`passport`官网已经有非常多的第三方认证实现，为了避免重复造轮子，请先查找是否有你要的插件: [Search Strategy](http://passportjs.org/)**\n\n","slug":"使用passport管理第三方授权认证","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlya002e9co7p9jqggtb","content":"<p><code>passport</code>是一个为<code>Nodejs</code>设计的，兼容<code>Express</code>的认证中间件。通过第三方插件的形式(以下称为<code>strategy</code>)，可以应对各式各样的认证请求。<code>passport</code>具有高度的灵活性，并不依赖于任何一个路由，或者指定的数据存储，这样给上层开发者提供的极大的便利性。<code>passport</code>提供的接口也相对简单，只需要给它一个认证请求，<code>passport</code>会提供一个钩子函数(<code>hook</code>)告诉你请求失败了或者成功了。</p>\n<hr>\n<h3 id=\"1-passport的设计思路\"><a href=\"#1-passport的设计思路\" class=\"headerlink\" title=\"1. passport的设计思路\"></a>1. passport的设计思路</h3><p><code>passport</code>基于一个高度灵活的设计结构，主要由四个模块组成：<code>passport</code>插件(strategy)管理模块、<code>执行认证操作的授权模块</code>、<code>framewark适配模块</code>、<code>session管理模块</code>。其结构框图如下：</p>\n<p><img src=\"http://www.tangide.com/storage/read.php?path=wechat/o/oSjbMs7GPu-gH9dZ4tsoo52y4gmo/blog/passport%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png\" alt=\"系统框图\"></p>\n<p>授权流程(引用<code>github oath2.0</code>来举例)</p>\n<p><img src=\"http://www.tangide.com/storage/read.php?path=wechat/o/oSjbMs7GPu-gH9dZ4tsoo52y4gmo/blog/passport-%E6%8E%88%E6%9D%83%E6%B5%81%E7%A8%8B.png\" alt=\"授权流程\"></p>\n<ul>\n<li>1.授权插件体系<br>所有的<code>passport</code>插件都继承自<code>passport-strategy</code>，紧接着根据不同的授权流程又细分为OAuth2.0授权中间件、OPENID类的授权中间件、以及帐号密码类的授权中间件。这些基本的中间件官方已经有了标准的实现。开发者需要做的是去继承这些授权中间件，针对不同的业务需求，配置特定的部分参数。就可以完成一整个授权的流程。常见的OAth2.0标准的授权插件有：<code>passport-github</code>、<code>passport-twitter</code>。这些针对不同厂商的第三方<code>Strategy</code>体量都非常小，基本在100行代码内可以搞定，因为大部分工作都交给标准的<code>strategy</code>来做了。</li>\n</ul>\n<ul>\n<li>2.framework适配<br><code>passport</code>官方的实现基于标准的<code>Express</code>形式的风格，也就是说，中间件的函数风格类似于：<blockquote>\n<p>function authenticate(req, res, next)<br>//如果需要适配其他的框架需要实现特定风格的<code>authenticate</code>函数。 </p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>3.session管理<br><code>passport</code>提供session的功能，如果开启该功能，则需要提供序列化，以及反序列化接口。<code>express-session</code>是一个很好的session管理包，所以还是让<code>passport</code>专注于授权认证吧！</li>\n</ul>\n<hr>\n<h3 id=\"2-passport使用\"><a href=\"#2-passport使用\" class=\"headerlink\" title=\"2. passport使用\"></a>2. passport使用</h3><ul>\n<li><ol>\n<li>注入第三方<code>strategy</code></li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">verifyProfile</span>(<span class=\"params\">accessToken, refreshToken, profile, done</span>) </span>&#123;</span><br><span class=\"line\">  profile.accessToken = accessToken;</span><br><span class=\"line\">   done(<span class=\"literal\">null</span>, profile);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">passport.use(<span class=\"keyword\">new</span> GithubStrategy(&#123;</span><br><span class=\"line\">clientID: <span class=\"string\">'123-456-789'</span>,</span><br><span class=\"line\">clientSecret: <span class=\"string\">'easdasjdklasjd'</span>,</span><br><span class=\"line\">callbackURL: <span class=\"string\">'http://www.example.com/auth/github/callback'</span></span><br><span class=\"line\">&#125;), verifyProfile);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">passport提供`</span>use<span class=\"string\">`函数用于注入授权认证的插件、`</span>unuse<span class=\"string\">`用于注销认证插件。`</span>verifyProfile<span class=\"string\">`接口是一个`</span>hook<span class=\"string\">`，用来验证用户信息的有效性。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">+ 2. 授权认证  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//请求授权码</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/user/login/github'</span>, passport.authenricate(<span class=\"string\">'github'</span>, &#123;<span class=\"attr\">scope</span>: <span class=\"string\">'wl_scope'</span>&#125;));</span><br><span class=\"line\"><span class=\"comment\">//获取accessToken以及请求用户信息，关闭session功能</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/auth/github/callback'</span>, passport.authenricate(<span class=\"string\">'github'</span>, &#123;<span class=\"attr\">session</span>: <span class=\"literal\">false</span>, <span class=\"attr\">failureRedirect</span>: <span class=\"string\">'/'</span>&#125;));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">---</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 3. passport源码分析</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">+ 1. 授权认证入口函数  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span> javascript</span><br><span class=\"line\"></span><br><span class=\"line\">Authenticator.prototype.authenticate = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">strategy, options, callback</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>._framework.authenticate(<span class=\"keyword\">this</span>, strategy, options, callback);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><ol>\n<li>express 风格的认证函数<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">authenticate</span>(<span class=\"params\">passport, name, options, callback</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> options == <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">    callback = options;</span><br><span class=\"line\">    options = &#123;&#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">authenticate</span>(<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">allFailed</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (callback) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!multi) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> callback(<span class=\"literal\">null</span>, <span class=\"literal\">false</span>, failures[<span class=\"number\">0</span>].challenge, failures[<span class=\"number\">0</span>].status);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> challenges = failures.map(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">f</span>) </span>&#123; <span class=\"keyword\">return</span> f.challenge; &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">var</span> statuses = failures.map(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">f</span>) </span>&#123; <span class=\"keyword\">return</span> f.status; &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">return</span> callback(<span class=\"literal\">null</span>, <span class=\"literal\">false</span>, challenges, statuses);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      ....</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">attempt</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> layer = name[i];</span><br><span class=\"line\">      <span class=\"comment\">// If no more strategies exist in the chain, authentication has failed.</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!layer) &#123; <span class=\"keyword\">return</span> allFailed(); &#125;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> prototype = passport._strategy(layer);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!prototype) &#123; <span class=\"keyword\">return</span> next(<span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Unknown authentication strategy \"'</span> + layer + <span class=\"string\">'\"'</span>)); &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">      <span class=\"keyword\">var</span> strategy = <span class=\"built_in\">Object</span>.create(prototype);</span><br><span class=\"line\">      strategy.success = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">user, info</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (callback) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> callback(<span class=\"literal\">null</span>, user, info);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ....</span><br><span class=\"line\">         req.logIn(user, options, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (err) &#123; <span class=\"keyword\">return</span> next(err); &#125;</span><br><span class=\"line\">          </span><br><span class=\"line\">          <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">complete</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (options.successReturnToOrRedirect) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">var</span> url = options.successReturnToOrRedirect;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (req.session &amp;&amp; req.session.returnTo) &#123;</span><br><span class=\"line\">                url = req.session.returnTo;</span><br><span class=\"line\">                <span class=\"keyword\">delete</span> req.session.returnTo;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> res.redirect(url);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (options.successRedirect) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> res.redirect(options.successRedirect);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            next();</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          complete();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">       ....</span><br><span class=\"line\">     <span class=\"comment\">//调用oauth2.0认证函数</span></span><br><span class=\"line\">     strategy.authenticate(req, options);</span><br><span class=\"line\">  &#125;)(<span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><ol>\n<li>Oauth2.0 认证函数</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">OAuth2Strategy.prototype.authenticate = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, options</span>) </span>&#123;</span><br><span class=\"line\">  options = options || &#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (req.query &amp;&amp; req.query.error) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (req.query.error == <span class=\"string\">'access_denied'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.fail(&#123; <span class=\"attr\">message</span>: req.query.error_description &#125;);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.error(<span class=\"keyword\">new</span> AuthorizationError(req.query.error_description, req.query.error, req.query.error_uri));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> callbackURL = options.callbackURL || <span class=\"keyword\">this</span>._callbackURL;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (callbackURL) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> parsed = url.parse(callbackURL);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!parsed.protocol) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// The callback URL is relative, resolve a fully qualified URL from the</span></span><br><span class=\"line\">      <span class=\"comment\">// URL of the originating request.</span></span><br><span class=\"line\">      callbackURL = url.resolve(utils.originalURL(req, &#123; <span class=\"attr\">proxy</span>: <span class=\"keyword\">this</span>._trustProxy &#125;), callbackURL);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (req.query &amp;&amp; req.query.code) &#123;</span><br><span class=\"line\">   <span class=\"comment\">//根据授权码获取accessToken以及用户信息</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> code = req.query.code;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> params = <span class=\"keyword\">this</span>.tokenParams(options);</span><br><span class=\"line\">    params.grant_type = <span class=\"string\">'authorization_code'</span>;</span><br><span class=\"line\">    params.redirect_uri = callbackURL;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>._oauth2.getOAuthAccessToken(code, params,</span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, accessToken, refreshToken, params</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err) &#123; <span class=\"keyword\">return</span> self.error(self._createOAuthError(<span class=\"string\">'Failed to obtain access token'</span>, err)); &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        self._loadUserProfile(accessToken, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, profile</span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (err) &#123; <span class=\"keyword\">return</span> self.error(err); &#125;</span><br><span class=\"line\">          </span><br><span class=\"line\">          <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">verified</span>(<span class=\"params\">err, user, info</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (err) &#123; <span class=\"keyword\">return</span> self.error(err); &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!user) &#123; <span class=\"keyword\">return</span> self.fail(info); &#125;</span><br><span class=\"line\">            self.success(user, info);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          </span><br><span class=\"line\">          <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//_verify 就是注入插件的时候指定的用户信息校验函数只有通过该函数校验，认证才算完成，用户信息被`success`挂在req.user。</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (self._passReqToCallback) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">var</span> arity = self._verify.length;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (arity == <span class=\"number\">6</span>) &#123;</span><br><span class=\"line\">                self._verify(req, accessToken, refreshToken, params, profile, verified);</span><br><span class=\"line\">              &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// arity == 5</span></span><br><span class=\"line\">                self._verify(req, accessToken, refreshToken, profile, verified);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">              <span class=\"keyword\">var</span> arity = self._verify.length;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (arity == <span class=\"number\">5</span>) &#123;</span><br><span class=\"line\">                self._verify(accessToken, refreshToken, params, profile, verified);</span><br><span class=\"line\">              &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// arity == 4</span></span><br><span class=\"line\">                self._verify(accessToken, refreshToken, profile, verified);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125; <span class=\"keyword\">catch</span> (ex) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self.error(ex);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">   <span class=\"comment\">//获取授权码</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> params = <span class=\"keyword\">this</span>.authorizationParams(options);</span><br><span class=\"line\">    params.response_type = <span class=\"string\">'code'</span>;</span><br><span class=\"line\">    params.redirect_uri = callbackURL;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> scope = options.scope || <span class=\"keyword\">this</span>._scope;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (scope) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Array</span>.isArray(scope)) &#123; scope = scope.join(<span class=\"keyword\">this</span>._scopeSeparator); &#125;</span><br><span class=\"line\">      params.scope = scope;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> location = <span class=\"keyword\">this</span>._oauth2.getAuthorizeUrl(params);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.redirect(location);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><ol>\n<li>获取用户信息<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">OAuth2Strategy.prototype._loadUserProfile = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">accessToken, done</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loadIt</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> self.userProfile(accessToken, done);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">skipIt</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> done(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//通过_skipUserProfile参数跳过不需要获取用户信息的认证。</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span>._skipUserProfile == <span class=\"string\">'function'</span> &amp;&amp; <span class=\"keyword\">this</span>._skipUserProfile.length &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// async</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>._skipUserProfile(accessToken, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, skip</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123; <span class=\"keyword\">return</span> done(err); &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!skip) &#123; <span class=\"keyword\">return</span> loadIt(); &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> skipIt();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> skip = (<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span>._skipUserProfile == <span class=\"string\">'function'</span>) ? <span class=\"keyword\">this</span>._skipUserProfile() : <span class=\"keyword\">this</span>._skipUserProfile;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!skip) &#123; <span class=\"keyword\">return</span> loadIt(); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> skipIt();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//第三方插件需要重载该接口实现用户信息的获取，`passport`把该接口完全开放给开发者。</span></span><br><span class=\"line\">OAuth2Strategy.prototype.userProfile = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">accessToken, done</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> done(<span class=\"literal\">null</span>, &#123;&#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n</ul>\n<hr>\n<h3 id=\"4-实现自己的strategy实现\"><a href=\"#4-实现自己的strategy实现\" class=\"headerlink\" title=\"4. 实现自己的strategy实现\"></a>4. 实现自己的<code>strategy</code>实现</h3><p>实现自己的第三方<code>passport-strategy</code>主要有三个步骤：</p>\n<ul>\n<li><ol>\n<li>继承<code>passport-oauth2</code><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Strategy</span>(<span class=\"params\">options, verify</span>) </span>&#123;</span><br><span class=\"line\">  options = options || &#123;&#125;;</span><br><span class=\"line\">  options.authorizationURL = options.authorizationURL || <span class=\"string\">'https://github.com/login/oauth/authorize'</span>;</span><br><span class=\"line\">  options.tokenURL = options.tokenURL || <span class=\"string\">'https://github.com/login/oauth/access_token'</span>;</span><br><span class=\"line\">  options.scopeSeparator = options.scopeSeparator || <span class=\"string\">','</span>;</span><br><span class=\"line\">  options.customHeaders = options.customHeaders || &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!options.customHeaders[<span class=\"string\">'User-Agent'</span>]) &#123;</span><br><span class=\"line\">    options.customHeaders[<span class=\"string\">'User-Agent'</span>] = options.userAgent || <span class=\"string\">'passport-github'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  OAuth2Strategy.call(<span class=\"keyword\">this</span>, options, verify);</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = <span class=\"string\">'github'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>._userProfileURL = options.userProfileURL || <span class=\"string\">'https://api.github.com/user'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>._oauth2.useAuthorizationHeaderforGET(<span class=\"literal\">true</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Inherit from `OAuth2Strategy`.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">util.inherits(Strategy, OAuth2Strategy);</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><ol>\n<li>实现获取用户信息接口<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Strategy.prototype.userProfile = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">accessToken, done</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>._oauth2.get(<span class=\"keyword\">this</span>._userProfileURL, accessToken, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, body, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> json;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> done(<span class=\"keyword\">new</span> InternalOAuthError(<span class=\"string\">'Failed to fetch user profile'</span>, err));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      json = <span class=\"built_in\">JSON</span>.parse(body);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (ex) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> done(<span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Failed to parse user profile'</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> profile = Profile.parse(json);</span><br><span class=\"line\">    profile.provider  = <span class=\"string\">'github'</span>;</span><br><span class=\"line\">    profile._raw = body;</span><br><span class=\"line\">    profile._json = json;</span><br><span class=\"line\">    </span><br><span class=\"line\">    done(<span class=\"literal\">null</span>, profile);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><ol>\n<li>解析用户信息函数实现<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> parse = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">json</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"string\">'string'</span> == <span class=\"keyword\">typeof</span> json) &#123;</span><br><span class=\"line\">    json = <span class=\"built_in\">JSON</span>.parse(json);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> profile = &#123;&#125;;</span><br><span class=\"line\">  profile.id = <span class=\"built_in\">String</span>(json.id);</span><br><span class=\"line\">  profile.displayName = json.name;</span><br><span class=\"line\">  profile.username = json.login;</span><br><span class=\"line\">  profile.profileUrl = json.html_url;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (json.email) &#123;</span><br><span class=\"line\">    profile.emails = [&#123; <span class=\"attr\">value</span>: json.email &#125;];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> profile;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n</ul>\n<hr>\n<p><strong>只需要三步骤，轻松实现授权认证！，<code>passport</code>官网已经有非常多的第三方认证实现，为了避免重复造轮子，请先查找是否有你要的插件: <a href=\"http://passportjs.org/\" target=\"_blank\" rel=\"noopener\">Search Strategy</a></strong></p>\n","site":{"data":{}},"excerpt":"","more":"<p><code>passport</code>是一个为<code>Nodejs</code>设计的，兼容<code>Express</code>的认证中间件。通过第三方插件的形式(以下称为<code>strategy</code>)，可以应对各式各样的认证请求。<code>passport</code>具有高度的灵活性，并不依赖于任何一个路由，或者指定的数据存储，这样给上层开发者提供的极大的便利性。<code>passport</code>提供的接口也相对简单，只需要给它一个认证请求，<code>passport</code>会提供一个钩子函数(<code>hook</code>)告诉你请求失败了或者成功了。</p>\n<hr>\n<h3 id=\"1-passport的设计思路\"><a href=\"#1-passport的设计思路\" class=\"headerlink\" title=\"1. passport的设计思路\"></a>1. passport的设计思路</h3><p><code>passport</code>基于一个高度灵活的设计结构，主要由四个模块组成：<code>passport</code>插件(strategy)管理模块、<code>执行认证操作的授权模块</code>、<code>framewark适配模块</code>、<code>session管理模块</code>。其结构框图如下：</p>\n<p><img src=\"http://www.tangide.com/storage/read.php?path=wechat/o/oSjbMs7GPu-gH9dZ4tsoo52y4gmo/blog/passport%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png\" alt=\"系统框图\"></p>\n<p>授权流程(引用<code>github oath2.0</code>来举例)</p>\n<p><img src=\"http://www.tangide.com/storage/read.php?path=wechat/o/oSjbMs7GPu-gH9dZ4tsoo52y4gmo/blog/passport-%E6%8E%88%E6%9D%83%E6%B5%81%E7%A8%8B.png\" alt=\"授权流程\"></p>\n<ul>\n<li>1.授权插件体系<br>所有的<code>passport</code>插件都继承自<code>passport-strategy</code>，紧接着根据不同的授权流程又细分为OAuth2.0授权中间件、OPENID类的授权中间件、以及帐号密码类的授权中间件。这些基本的中间件官方已经有了标准的实现。开发者需要做的是去继承这些授权中间件，针对不同的业务需求，配置特定的部分参数。就可以完成一整个授权的流程。常见的OAth2.0标准的授权插件有：<code>passport-github</code>、<code>passport-twitter</code>。这些针对不同厂商的第三方<code>Strategy</code>体量都非常小，基本在100行代码内可以搞定，因为大部分工作都交给标准的<code>strategy</code>来做了。</li>\n</ul>\n<ul>\n<li>2.framework适配<br><code>passport</code>官方的实现基于标准的<code>Express</code>形式的风格，也就是说，中间件的函数风格类似于：<blockquote>\n<p>function authenticate(req, res, next)<br>//如果需要适配其他的框架需要实现特定风格的<code>authenticate</code>函数。 </p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>3.session管理<br><code>passport</code>提供session的功能，如果开启该功能，则需要提供序列化，以及反序列化接口。<code>express-session</code>是一个很好的session管理包，所以还是让<code>passport</code>专注于授权认证吧！</li>\n</ul>\n<hr>\n<h3 id=\"2-passport使用\"><a href=\"#2-passport使用\" class=\"headerlink\" title=\"2. passport使用\"></a>2. passport使用</h3><ul>\n<li><ol>\n<li>注入第三方<code>strategy</code></li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">verifyProfile</span>(<span class=\"params\">accessToken, refreshToken, profile, done</span>) </span>&#123;</span><br><span class=\"line\">  profile.accessToken = accessToken;</span><br><span class=\"line\">   done(<span class=\"literal\">null</span>, profile);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">passport.use(<span class=\"keyword\">new</span> GithubStrategy(&#123;</span><br><span class=\"line\">clientID: <span class=\"string\">'123-456-789'</span>,</span><br><span class=\"line\">clientSecret: <span class=\"string\">'easdasjdklasjd'</span>,</span><br><span class=\"line\">callbackURL: <span class=\"string\">'http://www.example.com/auth/github/callback'</span></span><br><span class=\"line\">&#125;), verifyProfile);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">passport提供`</span>use<span class=\"string\">`函数用于注入授权认证的插件、`</span>unuse<span class=\"string\">`用于注销认证插件。`</span>verifyProfile<span class=\"string\">`接口是一个`</span>hook<span class=\"string\">`，用来验证用户信息的有效性。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">+ 2. 授权认证  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//请求授权码</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/user/login/github'</span>, passport.authenricate(<span class=\"string\">'github'</span>, &#123;<span class=\"attr\">scope</span>: <span class=\"string\">'wl_scope'</span>&#125;));</span><br><span class=\"line\"><span class=\"comment\">//获取accessToken以及请求用户信息，关闭session功能</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/auth/github/callback'</span>, passport.authenricate(<span class=\"string\">'github'</span>, &#123;<span class=\"attr\">session</span>: <span class=\"literal\">false</span>, <span class=\"attr\">failureRedirect</span>: <span class=\"string\">'/'</span>&#125;));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\">---</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 3. passport源码分析</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">+ 1. 授权认证入口函数  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span> javascript</span><br><span class=\"line\"></span><br><span class=\"line\">Authenticator.prototype.authenticate = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">strategy, options, callback</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>._framework.authenticate(<span class=\"keyword\">this</span>, strategy, options, callback);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><ol>\n<li>express 风格的认证函数<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">authenticate</span>(<span class=\"params\">passport, name, options, callback</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> options == <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">    callback = options;</span><br><span class=\"line\">    options = &#123;&#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">authenticate</span>(<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">allFailed</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (callback) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!multi) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> callback(<span class=\"literal\">null</span>, <span class=\"literal\">false</span>, failures[<span class=\"number\">0</span>].challenge, failures[<span class=\"number\">0</span>].status);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> challenges = failures.map(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">f</span>) </span>&#123; <span class=\"keyword\">return</span> f.challenge; &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">var</span> statuses = failures.map(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">f</span>) </span>&#123; <span class=\"keyword\">return</span> f.status; &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">return</span> callback(<span class=\"literal\">null</span>, <span class=\"literal\">false</span>, challenges, statuses);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      ....</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">attempt</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> layer = name[i];</span><br><span class=\"line\">      <span class=\"comment\">// If no more strategies exist in the chain, authentication has failed.</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!layer) &#123; <span class=\"keyword\">return</span> allFailed(); &#125;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> prototype = passport._strategy(layer);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!prototype) &#123; <span class=\"keyword\">return</span> next(<span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Unknown authentication strategy \"'</span> + layer + <span class=\"string\">'\"'</span>)); &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">      <span class=\"keyword\">var</span> strategy = <span class=\"built_in\">Object</span>.create(prototype);</span><br><span class=\"line\">      strategy.success = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">user, info</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (callback) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> callback(<span class=\"literal\">null</span>, user, info);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ....</span><br><span class=\"line\">         req.logIn(user, options, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (err) &#123; <span class=\"keyword\">return</span> next(err); &#125;</span><br><span class=\"line\">          </span><br><span class=\"line\">          <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">complete</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (options.successReturnToOrRedirect) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">var</span> url = options.successReturnToOrRedirect;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (req.session &amp;&amp; req.session.returnTo) &#123;</span><br><span class=\"line\">                url = req.session.returnTo;</span><br><span class=\"line\">                <span class=\"keyword\">delete</span> req.session.returnTo;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> res.redirect(url);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (options.successRedirect) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> res.redirect(options.successRedirect);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            next();</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          complete();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">       ....</span><br><span class=\"line\">     <span class=\"comment\">//调用oauth2.0认证函数</span></span><br><span class=\"line\">     strategy.authenticate(req, options);</span><br><span class=\"line\">  &#125;)(<span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><ol>\n<li>Oauth2.0 认证函数</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">OAuth2Strategy.prototype.authenticate = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, options</span>) </span>&#123;</span><br><span class=\"line\">  options = options || &#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (req.query &amp;&amp; req.query.error) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (req.query.error == <span class=\"string\">'access_denied'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.fail(&#123; <span class=\"attr\">message</span>: req.query.error_description &#125;);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.error(<span class=\"keyword\">new</span> AuthorizationError(req.query.error_description, req.query.error, req.query.error_uri));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> callbackURL = options.callbackURL || <span class=\"keyword\">this</span>._callbackURL;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (callbackURL) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> parsed = url.parse(callbackURL);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!parsed.protocol) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// The callback URL is relative, resolve a fully qualified URL from the</span></span><br><span class=\"line\">      <span class=\"comment\">// URL of the originating request.</span></span><br><span class=\"line\">      callbackURL = url.resolve(utils.originalURL(req, &#123; <span class=\"attr\">proxy</span>: <span class=\"keyword\">this</span>._trustProxy &#125;), callbackURL);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (req.query &amp;&amp; req.query.code) &#123;</span><br><span class=\"line\">   <span class=\"comment\">//根据授权码获取accessToken以及用户信息</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> code = req.query.code;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> params = <span class=\"keyword\">this</span>.tokenParams(options);</span><br><span class=\"line\">    params.grant_type = <span class=\"string\">'authorization_code'</span>;</span><br><span class=\"line\">    params.redirect_uri = callbackURL;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>._oauth2.getOAuthAccessToken(code, params,</span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, accessToken, refreshToken, params</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err) &#123; <span class=\"keyword\">return</span> self.error(self._createOAuthError(<span class=\"string\">'Failed to obtain access token'</span>, err)); &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        self._loadUserProfile(accessToken, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, profile</span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (err) &#123; <span class=\"keyword\">return</span> self.error(err); &#125;</span><br><span class=\"line\">          </span><br><span class=\"line\">          <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">verified</span>(<span class=\"params\">err, user, info</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (err) &#123; <span class=\"keyword\">return</span> self.error(err); &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!user) &#123; <span class=\"keyword\">return</span> self.fail(info); &#125;</span><br><span class=\"line\">            self.success(user, info);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          </span><br><span class=\"line\">          <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//_verify 就是注入插件的时候指定的用户信息校验函数只有通过该函数校验，认证才算完成，用户信息被`success`挂在req.user。</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (self._passReqToCallback) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">var</span> arity = self._verify.length;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (arity == <span class=\"number\">6</span>) &#123;</span><br><span class=\"line\">                self._verify(req, accessToken, refreshToken, params, profile, verified);</span><br><span class=\"line\">              &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// arity == 5</span></span><br><span class=\"line\">                self._verify(req, accessToken, refreshToken, profile, verified);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">              <span class=\"keyword\">var</span> arity = self._verify.length;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (arity == <span class=\"number\">5</span>) &#123;</span><br><span class=\"line\">                self._verify(accessToken, refreshToken, params, profile, verified);</span><br><span class=\"line\">              &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// arity == 4</span></span><br><span class=\"line\">                self._verify(accessToken, refreshToken, profile, verified);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125; <span class=\"keyword\">catch</span> (ex) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self.error(ex);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">   <span class=\"comment\">//获取授权码</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> params = <span class=\"keyword\">this</span>.authorizationParams(options);</span><br><span class=\"line\">    params.response_type = <span class=\"string\">'code'</span>;</span><br><span class=\"line\">    params.redirect_uri = callbackURL;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> scope = options.scope || <span class=\"keyword\">this</span>._scope;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (scope) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Array</span>.isArray(scope)) &#123; scope = scope.join(<span class=\"keyword\">this</span>._scopeSeparator); &#125;</span><br><span class=\"line\">      params.scope = scope;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> location = <span class=\"keyword\">this</span>._oauth2.getAuthorizeUrl(params);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.redirect(location);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><ol>\n<li>获取用户信息<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">OAuth2Strategy.prototype._loadUserProfile = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">accessToken, done</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loadIt</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> self.userProfile(accessToken, done);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">skipIt</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> done(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//通过_skipUserProfile参数跳过不需要获取用户信息的认证。</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span>._skipUserProfile == <span class=\"string\">'function'</span> &amp;&amp; <span class=\"keyword\">this</span>._skipUserProfile.length &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// async</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>._skipUserProfile(accessToken, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, skip</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123; <span class=\"keyword\">return</span> done(err); &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!skip) &#123; <span class=\"keyword\">return</span> loadIt(); &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> skipIt();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> skip = (<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span>._skipUserProfile == <span class=\"string\">'function'</span>) ? <span class=\"keyword\">this</span>._skipUserProfile() : <span class=\"keyword\">this</span>._skipUserProfile;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!skip) &#123; <span class=\"keyword\">return</span> loadIt(); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> skipIt();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//第三方插件需要重载该接口实现用户信息的获取，`passport`把该接口完全开放给开发者。</span></span><br><span class=\"line\">OAuth2Strategy.prototype.userProfile = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">accessToken, done</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> done(<span class=\"literal\">null</span>, &#123;&#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n</ul>\n<hr>\n<h3 id=\"4-实现自己的strategy实现\"><a href=\"#4-实现自己的strategy实现\" class=\"headerlink\" title=\"4. 实现自己的strategy实现\"></a>4. 实现自己的<code>strategy</code>实现</h3><p>实现自己的第三方<code>passport-strategy</code>主要有三个步骤：</p>\n<ul>\n<li><ol>\n<li>继承<code>passport-oauth2</code><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Strategy</span>(<span class=\"params\">options, verify</span>) </span>&#123;</span><br><span class=\"line\">  options = options || &#123;&#125;;</span><br><span class=\"line\">  options.authorizationURL = options.authorizationURL || <span class=\"string\">'https://github.com/login/oauth/authorize'</span>;</span><br><span class=\"line\">  options.tokenURL = options.tokenURL || <span class=\"string\">'https://github.com/login/oauth/access_token'</span>;</span><br><span class=\"line\">  options.scopeSeparator = options.scopeSeparator || <span class=\"string\">','</span>;</span><br><span class=\"line\">  options.customHeaders = options.customHeaders || &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!options.customHeaders[<span class=\"string\">'User-Agent'</span>]) &#123;</span><br><span class=\"line\">    options.customHeaders[<span class=\"string\">'User-Agent'</span>] = options.userAgent || <span class=\"string\">'passport-github'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  OAuth2Strategy.call(<span class=\"keyword\">this</span>, options, verify);</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = <span class=\"string\">'github'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>._userProfileURL = options.userProfileURL || <span class=\"string\">'https://api.github.com/user'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>._oauth2.useAuthorizationHeaderforGET(<span class=\"literal\">true</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Inherit from `OAuth2Strategy`.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">util.inherits(Strategy, OAuth2Strategy);</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><ol>\n<li>实现获取用户信息接口<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Strategy.prototype.userProfile = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">accessToken, done</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>._oauth2.get(<span class=\"keyword\">this</span>._userProfileURL, accessToken, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, body, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> json;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> done(<span class=\"keyword\">new</span> InternalOAuthError(<span class=\"string\">'Failed to fetch user profile'</span>, err));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      json = <span class=\"built_in\">JSON</span>.parse(body);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (ex) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> done(<span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Failed to parse user profile'</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> profile = Profile.parse(json);</span><br><span class=\"line\">    profile.provider  = <span class=\"string\">'github'</span>;</span><br><span class=\"line\">    profile._raw = body;</span><br><span class=\"line\">    profile._json = json;</span><br><span class=\"line\">    </span><br><span class=\"line\">    done(<span class=\"literal\">null</span>, profile);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><ol>\n<li>解析用户信息函数实现<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> parse = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">json</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"string\">'string'</span> == <span class=\"keyword\">typeof</span> json) &#123;</span><br><span class=\"line\">    json = <span class=\"built_in\">JSON</span>.parse(json);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> profile = &#123;&#125;;</span><br><span class=\"line\">  profile.id = <span class=\"built_in\">String</span>(json.id);</span><br><span class=\"line\">  profile.displayName = json.name;</span><br><span class=\"line\">  profile.username = json.login;</span><br><span class=\"line\">  profile.profileUrl = json.html_url;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (json.email) &#123;</span><br><span class=\"line\">    profile.emails = [&#123; <span class=\"attr\">value</span>: json.email &#125;];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> profile;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n</ul>\n<hr>\n<p><strong>只需要三步骤，轻松实现授权认证！，<code>passport</code>官网已经有非常多的第三方认证实现，为了避免重复造轮子，请先查找是否有你要的插件: <a href=\"http://passportjs.org/\" target=\"_blank\" rel=\"noopener\">Search Strategy</a></strong></p>\n"},{"title":"修复npm安装全局模块权限问题","_content":"> **我们曾经可能都遇到过安装某个模块包的过程中提示`EACCESS`的错误问题。这是由于`npm`全局安装模块的默认路径没有权限导致的。**\n\n---  \n有三个方式可以解决该问题：  \n- 修改全局安装路径的权限  \n- 修改默认安装路径  \n- 借助第三方工具安装`node`  \n\n\n#### 修改安装路径的权限  \n\n- 查看默认全局安装路径  \n\n> npm config get prefix  \n\n对于大多数系统显示目录为：`/usr/local`  \n\n**警告：如果默认路径是在/usr/请跳过该步骤，否则你会搞乱系统权限。**  \n\n- 修改路径权限  \n\n> sudo chown -R $(whoami) $(npm config get prefix)/{lib/node_modules,bin,share}\n\n执行完毕将会把`/usr/local`下的`lib/node_modules`、`bin`、`share`所有权更改为当前用户。  \n\n---  \n\n#### 修改默认全局安装路径  \n\n当你不想修改默认安装路径的权限，因为由此可能会带来一些额外问题，譬如说，修改权限后无法跟当前系统其他用户共享。这个时候可以考虑修改默认的安装路径。\n\n在示例下，我把默认全局安装路径修改到当前用户的`home`目录下面：  \n\n- 1、新建一个全局安装的路径  \n\n> mkdir ~/.npm-global  \n\n- 2、配置`npm`使用新的路径  \n\n> npm config set prefix '~/.npm-global'  \n\n- 3、打开或者新建`~/.profile`，加入下面一行  \n\n> export PATH=~/.npm-global/bin:$PATH  \n\n- 4、更新系统环境变量  \n\n> source ~/.profile  \n\n安装一个全局包试一试：  \n\n> npm install -g jshint \n\n``` javascript \n[luncher@localhost aaa]$ ls ~/.npm-global/bin/\njshint\n[luncher@localhost aaa]$ \n```  \n\n---  \n\n#### 借助第三方工具安装`node`  \n\n- mac系统借助brew安装`node`  \n\n> brew install node  \n\n- centos借助yum工具安装`node`  \n\n> yum install node \n","source":"_posts/修复npm安装全局模块权限问题.md","raw":"---\ntitle: 修复npm安装全局模块权限问题\ncategories: server\n---\n> **我们曾经可能都遇到过安装某个模块包的过程中提示`EACCESS`的错误问题。这是由于`npm`全局安装模块的默认路径没有权限导致的。**\n\n---  \n有三个方式可以解决该问题：  \n- 修改全局安装路径的权限  \n- 修改默认安装路径  \n- 借助第三方工具安装`node`  \n\n\n#### 修改安装路径的权限  \n\n- 查看默认全局安装路径  \n\n> npm config get prefix  \n\n对于大多数系统显示目录为：`/usr/local`  \n\n**警告：如果默认路径是在/usr/请跳过该步骤，否则你会搞乱系统权限。**  \n\n- 修改路径权限  \n\n> sudo chown -R $(whoami) $(npm config get prefix)/{lib/node_modules,bin,share}\n\n执行完毕将会把`/usr/local`下的`lib/node_modules`、`bin`、`share`所有权更改为当前用户。  \n\n---  \n\n#### 修改默认全局安装路径  \n\n当你不想修改默认安装路径的权限，因为由此可能会带来一些额外问题，譬如说，修改权限后无法跟当前系统其他用户共享。这个时候可以考虑修改默认的安装路径。\n\n在示例下，我把默认全局安装路径修改到当前用户的`home`目录下面：  \n\n- 1、新建一个全局安装的路径  \n\n> mkdir ~/.npm-global  \n\n- 2、配置`npm`使用新的路径  \n\n> npm config set prefix '~/.npm-global'  \n\n- 3、打开或者新建`~/.profile`，加入下面一行  \n\n> export PATH=~/.npm-global/bin:$PATH  \n\n- 4、更新系统环境变量  \n\n> source ~/.profile  \n\n安装一个全局包试一试：  \n\n> npm install -g jshint \n\n``` javascript \n[luncher@localhost aaa]$ ls ~/.npm-global/bin/\njshint\n[luncher@localhost aaa]$ \n```  \n\n---  \n\n#### 借助第三方工具安装`node`  \n\n- mac系统借助brew安装`node`  \n\n> brew install node  \n\n- centos借助yum工具安装`node`  \n\n> yum install node \n","slug":"修复npm安装全局模块权限问题","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlyb002h9co7nn20dtde","content":"<blockquote>\n<p><strong>我们曾经可能都遇到过安装某个模块包的过程中提示<code>EACCESS</code>的错误问题。这是由于<code>npm</code>全局安装模块的默认路径没有权限导致的。</strong></p>\n</blockquote>\n<hr>\n<p>有三个方式可以解决该问题：  </p>\n<ul>\n<li>修改全局安装路径的权限  </li>\n<li>修改默认安装路径  </li>\n<li>借助第三方工具安装<code>node</code>  </li>\n</ul>\n<h4 id=\"修改安装路径的权限\"><a href=\"#修改安装路径的权限\" class=\"headerlink\" title=\"修改安装路径的权限\"></a>修改安装路径的权限</h4><ul>\n<li>查看默认全局安装路径  </li>\n</ul>\n<blockquote>\n<p>npm config get prefix  </p>\n</blockquote>\n<p>对于大多数系统显示目录为：<code>/usr/local</code>  </p>\n<p><strong>警告：如果默认路径是在/usr/请跳过该步骤，否则你会搞乱系统权限。</strong>  </p>\n<ul>\n<li>修改路径权限  </li>\n</ul>\n<blockquote>\n<p>sudo chown -R $(whoami) $(npm config get prefix)/{lib/node_modules,bin,share}</p>\n</blockquote>\n<p>执行完毕将会把<code>/usr/local</code>下的<code>lib/node_modules</code>、<code>bin</code>、<code>share</code>所有权更改为当前用户。  </p>\n<hr>\n<h4 id=\"修改默认全局安装路径\"><a href=\"#修改默认全局安装路径\" class=\"headerlink\" title=\"修改默认全局安装路径\"></a>修改默认全局安装路径</h4><p>当你不想修改默认安装路径的权限，因为由此可能会带来一些额外问题，譬如说，修改权限后无法跟当前系统其他用户共享。这个时候可以考虑修改默认的安装路径。</p>\n<p>在示例下，我把默认全局安装路径修改到当前用户的<code>home</code>目录下面：  </p>\n<ul>\n<li>1、新建一个全局安装的路径  </li>\n</ul>\n<blockquote>\n<p>mkdir ~/.npm-global  </p>\n</blockquote>\n<ul>\n<li>2、配置<code>npm</code>使用新的路径  </li>\n</ul>\n<blockquote>\n<p>npm config set prefix ‘~/.npm-global’  </p>\n</blockquote>\n<ul>\n<li>3、打开或者新建<code>~/.profile</code>，加入下面一行  </li>\n</ul>\n<blockquote>\n<p>export PATH=~/.npm-global/bin:$PATH  </p>\n</blockquote>\n<ul>\n<li>4、更新系统环境变量  </li>\n</ul>\n<blockquote>\n<p>source ~/.profile  </p>\n</blockquote>\n<p>安装一个全局包试一试：  </p>\n<blockquote>\n<p>npm install -g jshint </p>\n</blockquote>\n<pre><code class=\"javascript\">[luncher@localhost aaa]$ ls ~<span class=\"regexp\">/.npm-global/</span>bin/\njshint\n[luncher@localhost aaa]$\n</code></pre>\n<hr>\n<h4 id=\"借助第三方工具安装node\"><a href=\"#借助第三方工具安装node\" class=\"headerlink\" title=\"借助第三方工具安装node\"></a>借助第三方工具安装<code>node</code></h4><ul>\n<li>mac系统借助brew安装<code>node</code>  </li>\n</ul>\n<blockquote>\n<p>brew install node  </p>\n</blockquote>\n<ul>\n<li>centos借助yum工具安装<code>node</code>  </li>\n</ul>\n<blockquote>\n<p>yum install node </p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p><strong>我们曾经可能都遇到过安装某个模块包的过程中提示<code>EACCESS</code>的错误问题。这是由于<code>npm</code>全局安装模块的默认路径没有权限导致的。</strong></p>\n</blockquote>\n<hr>\n<p>有三个方式可以解决该问题：  </p>\n<ul>\n<li>修改全局安装路径的权限  </li>\n<li>修改默认安装路径  </li>\n<li>借助第三方工具安装<code>node</code>  </li>\n</ul>\n<h4 id=\"修改安装路径的权限\"><a href=\"#修改安装路径的权限\" class=\"headerlink\" title=\"修改安装路径的权限\"></a>修改安装路径的权限</h4><ul>\n<li>查看默认全局安装路径  </li>\n</ul>\n<blockquote>\n<p>npm config get prefix  </p>\n</blockquote>\n<p>对于大多数系统显示目录为：<code>/usr/local</code>  </p>\n<p><strong>警告：如果默认路径是在/usr/请跳过该步骤，否则你会搞乱系统权限。</strong>  </p>\n<ul>\n<li>修改路径权限  </li>\n</ul>\n<blockquote>\n<p>sudo chown -R $(whoami) $(npm config get prefix)/{lib/node_modules,bin,share}</p>\n</blockquote>\n<p>执行完毕将会把<code>/usr/local</code>下的<code>lib/node_modules</code>、<code>bin</code>、<code>share</code>所有权更改为当前用户。  </p>\n<hr>\n<h4 id=\"修改默认全局安装路径\"><a href=\"#修改默认全局安装路径\" class=\"headerlink\" title=\"修改默认全局安装路径\"></a>修改默认全局安装路径</h4><p>当你不想修改默认安装路径的权限，因为由此可能会带来一些额外问题，譬如说，修改权限后无法跟当前系统其他用户共享。这个时候可以考虑修改默认的安装路径。</p>\n<p>在示例下，我把默认全局安装路径修改到当前用户的<code>home</code>目录下面：  </p>\n<ul>\n<li>1、新建一个全局安装的路径  </li>\n</ul>\n<blockquote>\n<p>mkdir ~/.npm-global  </p>\n</blockquote>\n<ul>\n<li>2、配置<code>npm</code>使用新的路径  </li>\n</ul>\n<blockquote>\n<p>npm config set prefix ‘~/.npm-global’  </p>\n</blockquote>\n<ul>\n<li>3、打开或者新建<code>~/.profile</code>，加入下面一行  </li>\n</ul>\n<blockquote>\n<p>export PATH=~/.npm-global/bin:$PATH  </p>\n</blockquote>\n<ul>\n<li>4、更新系统环境变量  </li>\n</ul>\n<blockquote>\n<p>source ~/.profile  </p>\n</blockquote>\n<p>安装一个全局包试一试：  </p>\n<blockquote>\n<p>npm install -g jshint </p>\n</blockquote>\n<pre><code class=\"javascript\">[luncher@localhost aaa]$ ls ~<span class=\"regexp\">/.npm-global/</span>bin/\njshint\n[luncher@localhost aaa]$\n</code></pre>\n<hr>\n<h4 id=\"借助第三方工具安装node\"><a href=\"#借助第三方工具安装node\" class=\"headerlink\" title=\"借助第三方工具安装node\"></a>借助第三方工具安装<code>node</code></h4><ul>\n<li>mac系统借助brew安装<code>node</code>  </li>\n</ul>\n<blockquote>\n<p>brew install node  </p>\n</blockquote>\n<ul>\n<li>centos借助yum工具安装<code>node</code>  </li>\n</ul>\n<blockquote>\n<p>yum install node </p>\n</blockquote>\n"},{"title":"块级元素于行内元素","date":"2016-08-12T10:21:03.000Z","_content":"\n# 块级元素与行内元素区别以及联系\n\n>为了更好的进行`CSS`样式布局，`html`元素可以分为两类：块级元素以及行内元素。按照\n元素内容的显示方式又可以分为替换元素与非替换元素，把这几个概念搞清楚，`CSS`应该算入门了吧！\n\n\n## 块级元素\n\n块级元素汇总(含`HTML5`)：\n>address、 article、aside、blockquote、canvas、\ndd、div、dl、fieldset、figcaption、figure、footer、\nform、h[1-6]、header、hgroup、hr、li、main、nav、\nnoscript、ol、output、p、pre、section、table、tfoot、\nul、video\n\n\n块级元素基本特性：\n\n- 1、如果没有设置宽度将会填充父级控件\n- 2、可以设置内边距、外边距属性\n- 3、在没有浮动定位的情况下，块级元素的高度将会根据子控件的高度做相应的扩展\n- 4、在没有浮动定位的情况下，块级元素将会放置在前一个元素的下边一行,后一个元素也会在新行开始\n- 5、忽略`vertical-align`属性\n- 6、遵从`text-align`属性\n\n所以说，如果希望块级元素水平填充父及控件，没有必要给它设置一个宽度为`100%`。因为这样可能会导致一些\n意想不到的问题。\n\n---\n\n## 行内元素\n\n行内元素汇总(含HTML5)：\n>b, big, i, small, tt\nabbr, acronym, cite, code, dfn, em, kbd, strong, samp, time, var\na, bdo, br, img, map, object, q, script, span, sub, sup\nbutton, input, label, select, textarea\n\n行类元素基本特性：\n\n- 1、跟随文本内容来布局\n- 2、不会类似于块元素换行\n- 3、布局的时候考虑字符间隔宽度设定\n- 4、忽略上下外边距、但可以设置左右外边距以及内边距\n- 5、忽略宽度、高度设置\n- 6、如果被浮动了将会自动变成一个块级元素，遵从块级元素特性\n- 7、遵从`vertical-align`属性设置\n- 8、忽略`text-align`属性\n\n---\n\n## 替换元素\n\n常见替换元素：\n>img,object,input,select,textarea,button\n\n替换元素基本性质：\n\n- 1、可以有自己的固有尺寸(通过元素本身设置)\n- 2、有视觉格式化需求、类似于块级元素\n- 3、可以为`行内替换元素`设置宽、高\n\n替换元素的具体显示以及尺寸通过外部资源来设定。除了替换元素，其他元素都称为非替换元素。\n","source":"_posts/块级元素于行内元素.md","raw":"---\ntitle: 块级元素于行内元素\ndate: 2016-08-12 18:21:03\ntags: inline element, block element\ncategories: web\n---\n\n# 块级元素与行内元素区别以及联系\n\n>为了更好的进行`CSS`样式布局，`html`元素可以分为两类：块级元素以及行内元素。按照\n元素内容的显示方式又可以分为替换元素与非替换元素，把这几个概念搞清楚，`CSS`应该算入门了吧！\n\n\n## 块级元素\n\n块级元素汇总(含`HTML5`)：\n>address、 article、aside、blockquote、canvas、\ndd、div、dl、fieldset、figcaption、figure、footer、\nform、h[1-6]、header、hgroup、hr、li、main、nav、\nnoscript、ol、output、p、pre、section、table、tfoot、\nul、video\n\n\n块级元素基本特性：\n\n- 1、如果没有设置宽度将会填充父级控件\n- 2、可以设置内边距、外边距属性\n- 3、在没有浮动定位的情况下，块级元素的高度将会根据子控件的高度做相应的扩展\n- 4、在没有浮动定位的情况下，块级元素将会放置在前一个元素的下边一行,后一个元素也会在新行开始\n- 5、忽略`vertical-align`属性\n- 6、遵从`text-align`属性\n\n所以说，如果希望块级元素水平填充父及控件，没有必要给它设置一个宽度为`100%`。因为这样可能会导致一些\n意想不到的问题。\n\n---\n\n## 行内元素\n\n行内元素汇总(含HTML5)：\n>b, big, i, small, tt\nabbr, acronym, cite, code, dfn, em, kbd, strong, samp, time, var\na, bdo, br, img, map, object, q, script, span, sub, sup\nbutton, input, label, select, textarea\n\n行类元素基本特性：\n\n- 1、跟随文本内容来布局\n- 2、不会类似于块元素换行\n- 3、布局的时候考虑字符间隔宽度设定\n- 4、忽略上下外边距、但可以设置左右外边距以及内边距\n- 5、忽略宽度、高度设置\n- 6、如果被浮动了将会自动变成一个块级元素，遵从块级元素特性\n- 7、遵从`vertical-align`属性设置\n- 8、忽略`text-align`属性\n\n---\n\n## 替换元素\n\n常见替换元素：\n>img,object,input,select,textarea,button\n\n替换元素基本性质：\n\n- 1、可以有自己的固有尺寸(通过元素本身设置)\n- 2、有视觉格式化需求、类似于块级元素\n- 3、可以为`行内替换元素`设置宽、高\n\n替换元素的具体显示以及尺寸通过外部资源来设定。除了替换元素，其他元素都称为非替换元素。\n","slug":"块级元素于行内元素","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlyc002k9co7soihqcnf","content":"<h1 id=\"块级元素与行内元素区别以及联系\"><a href=\"#块级元素与行内元素区别以及联系\" class=\"headerlink\" title=\"块级元素与行内元素区别以及联系\"></a>块级元素与行内元素区别以及联系</h1><blockquote>\n<p>为了更好的进行<code>CSS</code>样式布局，<code>html</code>元素可以分为两类：块级元素以及行内元素。按照<br>元素内容的显示方式又可以分为替换元素与非替换元素，把这几个概念搞清楚，<code>CSS</code>应该算入门了吧！</p>\n</blockquote>\n<h2 id=\"块级元素\"><a href=\"#块级元素\" class=\"headerlink\" title=\"块级元素\"></a>块级元素</h2><p>块级元素汇总(含<code>HTML5</code>)：</p>\n<blockquote>\n<p>address、 article、aside、blockquote、canvas、<br>dd、div、dl、fieldset、figcaption、figure、footer、<br>form、h[1-6]、header、hgroup、hr、li、main、nav、<br>noscript、ol、output、p、pre、section、table、tfoot、<br>ul、video</p>\n</blockquote>\n<p>块级元素基本特性：</p>\n<ul>\n<li>1、如果没有设置宽度将会填充父级控件</li>\n<li>2、可以设置内边距、外边距属性</li>\n<li>3、在没有浮动定位的情况下，块级元素的高度将会根据子控件的高度做相应的扩展</li>\n<li>4、在没有浮动定位的情况下，块级元素将会放置在前一个元素的下边一行,后一个元素也会在新行开始</li>\n<li>5、忽略<code>vertical-align</code>属性</li>\n<li>6、遵从<code>text-align</code>属性</li>\n</ul>\n<p>所以说，如果希望块级元素水平填充父及控件，没有必要给它设置一个宽度为<code>100%</code>。因为这样可能会导致一些<br>意想不到的问题。</p>\n<hr>\n<h2 id=\"行内元素\"><a href=\"#行内元素\" class=\"headerlink\" title=\"行内元素\"></a>行内元素</h2><p>行内元素汇总(含HTML5)：</p>\n<blockquote>\n<p>b, big, i, small, tt<br>abbr, acronym, cite, code, dfn, em, kbd, strong, samp, time, var<br>a, bdo, br, img, map, object, q, script, span, sub, sup<br>button, input, label, select, textarea</p>\n</blockquote>\n<p>行类元素基本特性：</p>\n<ul>\n<li>1、跟随文本内容来布局</li>\n<li>2、不会类似于块元素换行</li>\n<li>3、布局的时候考虑字符间隔宽度设定</li>\n<li>4、忽略上下外边距、但可以设置左右外边距以及内边距</li>\n<li>5、忽略宽度、高度设置</li>\n<li>6、如果被浮动了将会自动变成一个块级元素，遵从块级元素特性</li>\n<li>7、遵从<code>vertical-align</code>属性设置</li>\n<li>8、忽略<code>text-align</code>属性</li>\n</ul>\n<hr>\n<h2 id=\"替换元素\"><a href=\"#替换元素\" class=\"headerlink\" title=\"替换元素\"></a>替换元素</h2><p>常见替换元素：</p>\n<blockquote>\n<p>img,object,input,select,textarea,button</p>\n</blockquote>\n<p>替换元素基本性质：</p>\n<ul>\n<li>1、可以有自己的固有尺寸(通过元素本身设置)</li>\n<li>2、有视觉格式化需求、类似于块级元素</li>\n<li>3、可以为<code>行内替换元素</code>设置宽、高</li>\n</ul>\n<p>替换元素的具体显示以及尺寸通过外部资源来设定。除了替换元素，其他元素都称为非替换元素。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"块级元素与行内元素区别以及联系\"><a href=\"#块级元素与行内元素区别以及联系\" class=\"headerlink\" title=\"块级元素与行内元素区别以及联系\"></a>块级元素与行内元素区别以及联系</h1><blockquote>\n<p>为了更好的进行<code>CSS</code>样式布局，<code>html</code>元素可以分为两类：块级元素以及行内元素。按照<br>元素内容的显示方式又可以分为替换元素与非替换元素，把这几个概念搞清楚，<code>CSS</code>应该算入门了吧！</p>\n</blockquote>\n<h2 id=\"块级元素\"><a href=\"#块级元素\" class=\"headerlink\" title=\"块级元素\"></a>块级元素</h2><p>块级元素汇总(含<code>HTML5</code>)：</p>\n<blockquote>\n<p>address、 article、aside、blockquote、canvas、<br>dd、div、dl、fieldset、figcaption、figure、footer、<br>form、h[1-6]、header、hgroup、hr、li、main、nav、<br>noscript、ol、output、p、pre、section、table、tfoot、<br>ul、video</p>\n</blockquote>\n<p>块级元素基本特性：</p>\n<ul>\n<li>1、如果没有设置宽度将会填充父级控件</li>\n<li>2、可以设置内边距、外边距属性</li>\n<li>3、在没有浮动定位的情况下，块级元素的高度将会根据子控件的高度做相应的扩展</li>\n<li>4、在没有浮动定位的情况下，块级元素将会放置在前一个元素的下边一行,后一个元素也会在新行开始</li>\n<li>5、忽略<code>vertical-align</code>属性</li>\n<li>6、遵从<code>text-align</code>属性</li>\n</ul>\n<p>所以说，如果希望块级元素水平填充父及控件，没有必要给它设置一个宽度为<code>100%</code>。因为这样可能会导致一些<br>意想不到的问题。</p>\n<hr>\n<h2 id=\"行内元素\"><a href=\"#行内元素\" class=\"headerlink\" title=\"行内元素\"></a>行内元素</h2><p>行内元素汇总(含HTML5)：</p>\n<blockquote>\n<p>b, big, i, small, tt<br>abbr, acronym, cite, code, dfn, em, kbd, strong, samp, time, var<br>a, bdo, br, img, map, object, q, script, span, sub, sup<br>button, input, label, select, textarea</p>\n</blockquote>\n<p>行类元素基本特性：</p>\n<ul>\n<li>1、跟随文本内容来布局</li>\n<li>2、不会类似于块元素换行</li>\n<li>3、布局的时候考虑字符间隔宽度设定</li>\n<li>4、忽略上下外边距、但可以设置左右外边距以及内边距</li>\n<li>5、忽略宽度、高度设置</li>\n<li>6、如果被浮动了将会自动变成一个块级元素，遵从块级元素特性</li>\n<li>7、遵从<code>vertical-align</code>属性设置</li>\n<li>8、忽略<code>text-align</code>属性</li>\n</ul>\n<hr>\n<h2 id=\"替换元素\"><a href=\"#替换元素\" class=\"headerlink\" title=\"替换元素\"></a>替换元素</h2><p>常见替换元素：</p>\n<blockquote>\n<p>img,object,input,select,textarea,button</p>\n</blockquote>\n<p>替换元素基本性质：</p>\n<ul>\n<li>1、可以有自己的固有尺寸(通过元素本身设置)</li>\n<li>2、有视觉格式化需求、类似于块级元素</li>\n<li>3、可以为<code>行内替换元素</code>设置宽、高</li>\n</ul>\n<p>替换元素的具体显示以及尺寸通过外部资源来设定。除了替换元素，其他元素都称为非替换元素。</p>\n"},{"title":"如何设计一个数据字典","_content":"数据字典在`Javascript`语言里面随处可见，对象本身就可以看成一个数据字典，通过给对象设置属性与方法，达到一个字典的目的。  \n```javascript  \nvar dict = new Dict();\n\nobj.pro1 = \"hello world!!!\";\nobj.pro2 = function () {\n    console.log(\"I'am pro2\");\n};\n\n```  \n\n先来看一个常见的数据字典的设计：  \n\n```javascript\n\nfunction Dict() {\n}\n\nDict.prototype.count = function() {\n    let n = 0;\n    for(let k in this) {\n        n++;\n    };\n    return n;\n};\n\n//\nlet dict = new Dict();\ndict.paul = 3;\ndict.lebron = 23;\n\ndict.count() // 3  \n```   \n\n为什么给设置了两个属性，通过`count`计算得出的结果是`3`呢？这里比较容易看出来，因为`for in`会遍历原型链上的可枚举的属性，例如上面的`count`方法。为了避免这种由于遍历原型链导致的错误结果，实现一个改进版本：  \n\n```javascript  \nvar dict = {};\n\ndict.diwy = 3;\ndict.love = 10;\n\nlet n = 0;\nfor(let k in dict) {\n   n++;\n}\nconsole.log(n)  //2\n```   \n\n通过这种改进虽然能够得出正确的结果，但是我们把这一切能够正常运行的希望寄托于`Object.prototype`原型没有受到`污染`。这种假设通常伴随一定的风险，如果和其他人协同开发产品，你不能保证其他人也和你一样遵循相应的规范。  \n\n了解到潜在的原型污染问题之后，可以想到的做法是，构造一个对象，不依赖于常规的原型对象：  \n\n```javascript\nfunction C() {}\nC.prototype = null;\n```  \n\n来测试一下：  \n```javascript\nvar c = new C();\nObject.getPropertyOf(c) === null;//false\nObject.getPropertyOf(c) === Object.prototype; //true\n```  \n\n遗憾的是`c`对象的原型依然是`Object.prototype`。`ES5`提供了一个方法来创建一个没有原型的对象：  \n```javascript  \nvar dict = Object.create(null);\nObject.getPropertyOf(dict) === null; // true\n```  \n\n通过创建一个没有原型的对象，可以很好的规避原型污染问题。但是如果你既需要对象原型，又想保证字典枚举的安全性，那就得改造一些字典的设计。  \n\n使用`hasOwnProperty`来判断对象的实体属性，而不是原型熟悉。  \n```javascript  \nvar dict = {};\ndict.name = 'lebron';\ndict.hasOwnPropertyOf(\"name\") //true;\ndict.hasOwnPropertyOf(\"valueOf\") //false\n\"valudeOf\" in dict //true\n```  \n\n为了避免设置`hasOwnPropertyOf`这样奇怪的属性，我们需要在任何安全的位置提取出`hasOwnPropertyOf`方法。  \n```javascript\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n//或者  \nvar hasOwnProperty = {}.hasOwnProperty;  \n\nhasOwnProperty.call(dict, \"name\"); //true\n```  \n\n一个安全的数据字典实现：  \n```javascript  \n\nfunction Dict(elements) {\n  this.elements = elements || {};\n}\n\nDict.property.has = function(key) {\n  return {}.hasOwnPropertyOf(key);\n};\n\nDict.property.get = function(key) {\n  return this.has(key) ? this.elements[key] : undefined;\n};\n\nDict.property.set = function(key, value) {\n  this.elements[key] = value;\n};\n\nDict.property.remove = function(key) {\n  delete this.elements[key];\n};\n\n```  \n\n在一些`javascript`环境中，特殊的属性名`__proto__`可能会导致自身的污染问题(修改对象的原型)。我们必须把它优化掉：  \n\n```javascript\nfunction Dict(elements) {\n  this.elements = elements || {};\n  this.specialPropValue = undefined;\n  this.specialProp = \"__proto__\";\n  this.hasSpecialProp = false;\n}\n\nDict.prototype.has = function(key) {\n  if(key === this.specialProp) {\n    return this.hasSpecialProp;\n  }\n  return {}.hasOwnPropertyOf.call(this.elements, key);\n};\n\nDict.prototype.get = function(key) {\n  if(key === this.specialProp) {\n    return this.specialProp;\n  }\n  return this.has(key) ? this.elements[key] : undefined;\n};\n\nDict.prototype.set = function(key, value) {\n  if(key === this.specialProp) {\n    this.specialPropValue = value;\n  }\n  else {\n    this.elements[key] = value;\n  }\n};\n\n```\n\n这样`javascript`环境是否处理`__proto__`属性，该实现均能保证是可工作的，以上也算是数据字典比较好的一个设计吧！。\n\n\n\n\n\n","source":"_posts/如何设计一个数据字典.md","raw":"---\ntitle: 如何设计一个数据字典\ncategories: server\n---\n数据字典在`Javascript`语言里面随处可见，对象本身就可以看成一个数据字典，通过给对象设置属性与方法，达到一个字典的目的。  \n```javascript  \nvar dict = new Dict();\n\nobj.pro1 = \"hello world!!!\";\nobj.pro2 = function () {\n    console.log(\"I'am pro2\");\n};\n\n```  \n\n先来看一个常见的数据字典的设计：  \n\n```javascript\n\nfunction Dict() {\n}\n\nDict.prototype.count = function() {\n    let n = 0;\n    for(let k in this) {\n        n++;\n    };\n    return n;\n};\n\n//\nlet dict = new Dict();\ndict.paul = 3;\ndict.lebron = 23;\n\ndict.count() // 3  \n```   \n\n为什么给设置了两个属性，通过`count`计算得出的结果是`3`呢？这里比较容易看出来，因为`for in`会遍历原型链上的可枚举的属性，例如上面的`count`方法。为了避免这种由于遍历原型链导致的错误结果，实现一个改进版本：  \n\n```javascript  \nvar dict = {};\n\ndict.diwy = 3;\ndict.love = 10;\n\nlet n = 0;\nfor(let k in dict) {\n   n++;\n}\nconsole.log(n)  //2\n```   \n\n通过这种改进虽然能够得出正确的结果，但是我们把这一切能够正常运行的希望寄托于`Object.prototype`原型没有受到`污染`。这种假设通常伴随一定的风险，如果和其他人协同开发产品，你不能保证其他人也和你一样遵循相应的规范。  \n\n了解到潜在的原型污染问题之后，可以想到的做法是，构造一个对象，不依赖于常规的原型对象：  \n\n```javascript\nfunction C() {}\nC.prototype = null;\n```  \n\n来测试一下：  \n```javascript\nvar c = new C();\nObject.getPropertyOf(c) === null;//false\nObject.getPropertyOf(c) === Object.prototype; //true\n```  \n\n遗憾的是`c`对象的原型依然是`Object.prototype`。`ES5`提供了一个方法来创建一个没有原型的对象：  \n```javascript  \nvar dict = Object.create(null);\nObject.getPropertyOf(dict) === null; // true\n```  \n\n通过创建一个没有原型的对象，可以很好的规避原型污染问题。但是如果你既需要对象原型，又想保证字典枚举的安全性，那就得改造一些字典的设计。  \n\n使用`hasOwnProperty`来判断对象的实体属性，而不是原型熟悉。  \n```javascript  \nvar dict = {};\ndict.name = 'lebron';\ndict.hasOwnPropertyOf(\"name\") //true;\ndict.hasOwnPropertyOf(\"valueOf\") //false\n\"valudeOf\" in dict //true\n```  \n\n为了避免设置`hasOwnPropertyOf`这样奇怪的属性，我们需要在任何安全的位置提取出`hasOwnPropertyOf`方法。  \n```javascript\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n//或者  \nvar hasOwnProperty = {}.hasOwnProperty;  \n\nhasOwnProperty.call(dict, \"name\"); //true\n```  \n\n一个安全的数据字典实现：  \n```javascript  \n\nfunction Dict(elements) {\n  this.elements = elements || {};\n}\n\nDict.property.has = function(key) {\n  return {}.hasOwnPropertyOf(key);\n};\n\nDict.property.get = function(key) {\n  return this.has(key) ? this.elements[key] : undefined;\n};\n\nDict.property.set = function(key, value) {\n  this.elements[key] = value;\n};\n\nDict.property.remove = function(key) {\n  delete this.elements[key];\n};\n\n```  \n\n在一些`javascript`环境中，特殊的属性名`__proto__`可能会导致自身的污染问题(修改对象的原型)。我们必须把它优化掉：  \n\n```javascript\nfunction Dict(elements) {\n  this.elements = elements || {};\n  this.specialPropValue = undefined;\n  this.specialProp = \"__proto__\";\n  this.hasSpecialProp = false;\n}\n\nDict.prototype.has = function(key) {\n  if(key === this.specialProp) {\n    return this.hasSpecialProp;\n  }\n  return {}.hasOwnPropertyOf.call(this.elements, key);\n};\n\nDict.prototype.get = function(key) {\n  if(key === this.specialProp) {\n    return this.specialProp;\n  }\n  return this.has(key) ? this.elements[key] : undefined;\n};\n\nDict.prototype.set = function(key, value) {\n  if(key === this.specialProp) {\n    this.specialPropValue = value;\n  }\n  else {\n    this.elements[key] = value;\n  }\n};\n\n```\n\n这样`javascript`环境是否处理`__proto__`属性，该实现均能保证是可工作的，以上也算是数据字典比较好的一个设计吧！。\n\n\n\n\n\n","slug":"如何设计一个数据字典","published":1,"date":"2018-01-28T15:57:08.000Z","updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlyd002n9co7nninkmt9","content":"<p>数据字典在<code>Javascript</code>语言里面随处可见，对象本身就可以看成一个数据字典，通过给对象设置属性与方法，达到一个字典的目的。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> dict = <span class=\"keyword\">new</span> Dict();</span><br><span class=\"line\"></span><br><span class=\"line\">obj.pro1 = <span class=\"string\">\"hello world!!!\"</span>;</span><br><span class=\"line\">obj.pro2 = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"I'am pro2\"</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">先来看一个常见的数据字典的设计：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Dict</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.prototype.count = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> k <span class=\"keyword\">in</span> <span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">        n++;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> n;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> dict = <span class=\"keyword\">new</span> Dict();</span><br><span class=\"line\">dict.paul = <span class=\"number\">3</span>;</span><br><span class=\"line\">dict.lebron = <span class=\"number\">23</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">dict.count() <span class=\"comment\">// 3  </span></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`   </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">为什么给设置了两个属性，通过`</span>count<span class=\"string\">`计算得出的结果是`</span><span class=\"number\">3</span><span class=\"string\">`呢？这里比较容易看出来，因为`</span><span class=\"keyword\">for</span> <span class=\"keyword\">in</span><span class=\"string\">`会遍历原型链上的可枚举的属性，例如上面的`</span>count<span class=\"string\">`方法。为了避免这种由于遍历原型链导致的错误结果，实现一个改进版本：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"keyword\">var</span> dict = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">dict.diwy = <span class=\"number\">3</span>;</span><br><span class=\"line\">dict.love = <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> k <span class=\"keyword\">in</span> dict) &#123;</span><br><span class=\"line\">   n++;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(n)  <span class=\"comment\">//2</span></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`   </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">通过这种改进虽然能够得出正确的结果，但是我们把这一切能够正常运行的希望寄托于`</span><span class=\"built_in\">Object</span>.prototype<span class=\"string\">`原型没有受到`</span>污染<span class=\"string\">`。这种假设通常伴随一定的风险，如果和其他人协同开发产品，你不能保证其他人也和你一样遵循相应的规范。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">了解到潜在的原型污染问题之后，可以想到的做法是，构造一个对象，不依赖于常规的原型对象：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">C</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\">C.prototype = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">来测试一下：  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> C();</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.getPropertyOf(c) === <span class=\"literal\">null</span>;<span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.getPropertyOf(c) === <span class=\"built_in\">Object</span>.prototype; <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">遗憾的是`</span>c<span class=\"string\">`对象的原型依然是`</span><span class=\"built_in\">Object</span>.prototype<span class=\"string\">`。`</span>ES5<span class=\"string\">`提供了一个方法来创建一个没有原型的对象：  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"keyword\">var</span> dict = <span class=\"built_in\">Object</span>.create(<span class=\"literal\">null</span>);</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.getPropertyOf(dict) === <span class=\"literal\">null</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">通过创建一个没有原型的对象，可以很好的规避原型污染问题。但是如果你既需要对象原型，又想保证字典枚举的安全性，那就得改造一些字典的设计。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">使用`</span>hasOwnProperty<span class=\"string\">`来判断对象的实体属性，而不是原型熟悉。  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"keyword\">var</span> dict = &#123;&#125;;</span><br><span class=\"line\">dict.name = <span class=\"string\">'lebron'</span>;</span><br><span class=\"line\">dict.hasOwnPropertyOf(<span class=\"string\">\"name\"</span>) <span class=\"comment\">//true;</span></span><br><span class=\"line\">dict.hasOwnPropertyOf(<span class=\"string\">\"valueOf\"</span>) <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"string\">\"valudeOf\"</span> <span class=\"keyword\">in</span> dict <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">为了避免设置`</span>hasOwnPropertyOf<span class=\"string\">`这样奇怪的属性，我们需要在任何安全的位置提取出`</span>hasOwnPropertyOf<span class=\"string\">`方法。  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"keyword\">var</span> hasOwnProperty = <span class=\"built_in\">Object</span>.prototype.hasOwnProperty;</span><br><span class=\"line\"><span class=\"comment\">//或者  </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> hasOwnProperty = &#123;&#125;.hasOwnProperty;  </span><br><span class=\"line\"></span><br><span class=\"line\">hasOwnProperty.call(dict, <span class=\"string\">\"name\"</span>); <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">一个安全的数据字典实现：  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Dict</span>(<span class=\"params\">elements</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.elements = elements || &#123;&#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.property.has = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;&#125;.hasOwnPropertyOf(key);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.property.get = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.has(key) ? <span class=\"keyword\">this</span>.elements[key] : <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.property.set = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.elements[key] = value;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.property.remove = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">delete</span> <span class=\"keyword\">this</span>.elements[key];</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">在一些`</span>javascript<span class=\"string\">`环境中，特殊的属性名`</span>__proto__<span class=\"string\">`可能会导致自身的污染问题(修改对象的原型)。我们必须把它优化掉：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Dict</span>(<span class=\"params\">elements</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.elements = elements || &#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.specialPropValue = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.specialProp = <span class=\"string\">\"__proto__\"</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.hasSpecialProp = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.prototype.has = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(key === <span class=\"keyword\">this</span>.specialProp) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.hasSpecialProp;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;&#125;.hasOwnPropertyOf.call(<span class=\"keyword\">this</span>.elements, key);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.prototype.get = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(key === <span class=\"keyword\">this</span>.specialProp) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.specialProp;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.has(key) ? <span class=\"keyword\">this</span>.elements[key] : <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.prototype.set = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(key === <span class=\"keyword\">this</span>.specialProp) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.specialPropValue = value;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.elements[key] = value;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>这样<code>javascript</code>环境是否处理<code>__proto__</code>属性，该实现均能保证是可工作的，以上也算是数据字典比较好的一个设计吧！。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>数据字典在<code>Javascript</code>语言里面随处可见，对象本身就可以看成一个数据字典，通过给对象设置属性与方法，达到一个字典的目的。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> dict = <span class=\"keyword\">new</span> Dict();</span><br><span class=\"line\"></span><br><span class=\"line\">obj.pro1 = <span class=\"string\">\"hello world!!!\"</span>;</span><br><span class=\"line\">obj.pro2 = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"I'am pro2\"</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">先来看一个常见的数据字典的设计：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Dict</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.prototype.count = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> k <span class=\"keyword\">in</span> <span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">        n++;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> n;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> dict = <span class=\"keyword\">new</span> Dict();</span><br><span class=\"line\">dict.paul = <span class=\"number\">3</span>;</span><br><span class=\"line\">dict.lebron = <span class=\"number\">23</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">dict.count() <span class=\"comment\">// 3  </span></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`   </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">为什么给设置了两个属性，通过`</span>count<span class=\"string\">`计算得出的结果是`</span><span class=\"number\">3</span><span class=\"string\">`呢？这里比较容易看出来，因为`</span><span class=\"keyword\">for</span> <span class=\"keyword\">in</span><span class=\"string\">`会遍历原型链上的可枚举的属性，例如上面的`</span>count<span class=\"string\">`方法。为了避免这种由于遍历原型链导致的错误结果，实现一个改进版本：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"keyword\">var</span> dict = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">dict.diwy = <span class=\"number\">3</span>;</span><br><span class=\"line\">dict.love = <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> k <span class=\"keyword\">in</span> dict) &#123;</span><br><span class=\"line\">   n++;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(n)  <span class=\"comment\">//2</span></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`   </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">通过这种改进虽然能够得出正确的结果，但是我们把这一切能够正常运行的希望寄托于`</span><span class=\"built_in\">Object</span>.prototype<span class=\"string\">`原型没有受到`</span>污染<span class=\"string\">`。这种假设通常伴随一定的风险，如果和其他人协同开发产品，你不能保证其他人也和你一样遵循相应的规范。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">了解到潜在的原型污染问题之后，可以想到的做法是，构造一个对象，不依赖于常规的原型对象：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">C</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\">C.prototype = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">来测试一下：  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> C();</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.getPropertyOf(c) === <span class=\"literal\">null</span>;<span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.getPropertyOf(c) === <span class=\"built_in\">Object</span>.prototype; <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">遗憾的是`</span>c<span class=\"string\">`对象的原型依然是`</span><span class=\"built_in\">Object</span>.prototype<span class=\"string\">`。`</span>ES5<span class=\"string\">`提供了一个方法来创建一个没有原型的对象：  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"keyword\">var</span> dict = <span class=\"built_in\">Object</span>.create(<span class=\"literal\">null</span>);</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.getPropertyOf(dict) === <span class=\"literal\">null</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">通过创建一个没有原型的对象，可以很好的规避原型污染问题。但是如果你既需要对象原型，又想保证字典枚举的安全性，那就得改造一些字典的设计。  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">使用`</span>hasOwnProperty<span class=\"string\">`来判断对象的实体属性，而不是原型熟悉。  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"><span class=\"keyword\">var</span> dict = &#123;&#125;;</span><br><span class=\"line\">dict.name = <span class=\"string\">'lebron'</span>;</span><br><span class=\"line\">dict.hasOwnPropertyOf(<span class=\"string\">\"name\"</span>) <span class=\"comment\">//true;</span></span><br><span class=\"line\">dict.hasOwnPropertyOf(<span class=\"string\">\"valueOf\"</span>) <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"string\">\"valudeOf\"</span> <span class=\"keyword\">in</span> dict <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">为了避免设置`</span>hasOwnPropertyOf<span class=\"string\">`这样奇怪的属性，我们需要在任何安全的位置提取出`</span>hasOwnPropertyOf<span class=\"string\">`方法。  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"keyword\">var</span> hasOwnProperty = <span class=\"built_in\">Object</span>.prototype.hasOwnProperty;</span><br><span class=\"line\"><span class=\"comment\">//或者  </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> hasOwnProperty = &#123;&#125;.hasOwnProperty;  </span><br><span class=\"line\"></span><br><span class=\"line\">hasOwnProperty.call(dict, <span class=\"string\">\"name\"</span>); <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">一个安全的数据字典实现：  </span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Dict</span>(<span class=\"params\">elements</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.elements = elements || &#123;&#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.property.has = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;&#125;.hasOwnPropertyOf(key);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.property.get = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.has(key) ? <span class=\"keyword\">this</span>.elements[key] : <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.property.set = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.elements[key] = value;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.property.remove = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">delete</span> <span class=\"keyword\">this</span>.elements[key];</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">在一些`</span>javascript<span class=\"string\">`环境中，特殊的属性名`</span>__proto__<span class=\"string\">`可能会导致自身的污染问题(修改对象的原型)。我们必须把它优化掉：  </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Dict</span>(<span class=\"params\">elements</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.elements = elements || &#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.specialPropValue = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.specialProp = <span class=\"string\">\"__proto__\"</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.hasSpecialProp = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.prototype.has = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(key === <span class=\"keyword\">this</span>.specialProp) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.hasSpecialProp;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;&#125;.hasOwnPropertyOf.call(<span class=\"keyword\">this</span>.elements, key);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.prototype.get = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(key === <span class=\"keyword\">this</span>.specialProp) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.specialProp;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.has(key) ? <span class=\"keyword\">this</span>.elements[key] : <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Dict.prototype.set = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(key === <span class=\"keyword\">this</span>.specialProp) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.specialPropValue = value;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.elements[key] = value;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>这样<code>javascript</code>环境是否处理<code>__proto__</code>属性，该实现均能保证是可工作的，以上也算是数据字典比较好的一个设计吧！。</p>\n"},{"title":"译-视觉格式化模型的细节","date":"2016-09-05T05:21:15.000Z","_content":"\n# 123\n\n## 包含块的定义\n\n元素位置以及尺寸的计算有时候涉及到一个固定的矩形，这个矩形称之为元素的`包含块`。元素的包含块定义如下：\n\n- 1、`根元素`所在的包含块是一个矩形，称之为：初始包含块。对于连续介质或页面媒体，有包含尺寸大小的视口，锚定在画布的初始位置。初始包含块的方向属性等同于根元素。\n\n- 2、对于其他元素，如果元素的`position`属性是`relative`或`static`,那么它的包含块被放置在最近的块容器祖先盒子的内容区边缘。\n\n- 3、如果元素的`position`属性设置为`fixed`，那么它的包含块依据在连续介质的情况下或在页面媒体的情况下的页区域的视口来建立。\n\n- 4、如果元素的`position`属性设置为`absolute`，那么它的包含块依据最近的，且`positon`属性被设置为`absolute`、`relative`、`fixed`,的祖先来建立。步骤如下：\n\n  - 1、如果祖先是一个行内元素，那么它的包含块是一个边界盒子包围第一个以及最后一个元素的内边距。在`CSS2.1`,如果行内元素跨多行，那么其包含块是未定义的。\n  - 2、否则，包含块根据其祖先的`padding edge`来格式化。\n  - 3、如果没有找到这样的祖先元素，那么其包含块就是最初的包含块。\n\n在页面媒体下，一个绝对定位元素的位置关联到它的包含块，忽略任何的分页(好像页面是连续的)，元素可能被分到多个页面。\n\n对于绝对定位的内容，被解析到页面的某个位置，而不是页面被布局的位置，或者解析到当前已经被渲染或者打印的页面，打印机或许会放置内容。\n\n- 当前页面的其他位置\n- 在随后的页面，或者\n- 省略它\n\n>注意：一个块级元素超过了多个页或许会在不同的页有不同的宽度，或许会设备自身的限制。\n\n\n\n```html\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\">\n<HTML>\n   <HEAD>\n      <TITLE>Illustration of containing blocks</TITLE>\n   </HEAD>\n   <BODY id=\"body\">\n      <DIV id=\"div1\">\n      <P id=\"p1\">This is text in the first paragraph...</P>\n      <P id=\"p2\">This is text <EM id=\"em1\"> in the \n      <STRONG id=\"strong1\">second</STRONG> paragraph.</EM></P>\n      </DIV>\n   </BODY>\n</HTML>\n```\n\n没有定位，上面文档将建立如下的包含块：\n\n| For box generated by | C.B is established by      |\n| -------------------- |:---------------------------|\n| html                 |  initial C.B(UA-dependent) |\n| body                 | html                       |\n| div1                 | body                       |\n| p1                   | div1                       |\n| p2                   | div1                       |\n| em1                  | p2                         |\n| strong1              | p2                         |\n\n如果我们修改`div1`的`position`属性：\n\n```css\n  #div {positon: absolute; left: 50px; top: 50px}\n```\n\n那么它的包含块将不再是`body`,而是变成了最初的包含块(因为没有被定位的祖先盒子)。\n\n如果我们把`em1`的`position`属性也修改了：\n\n```css\n  #div {position: absolute; left: 50px; top: 50px}\n  #em1 {position: absolute; left: 100px; top: 100px}\n```\n\n包含块表格现在变成了：\n\n| For box generated by | C.B is established by      |\n| -------------------- |:---------------------------|\n| html                 | initial C.B(UA-dependent)  |\n| body                 | html                       |\n| div1                 | initial C.B                |\n| p1                   | div1                       |\n| p2                   | div1                       |\n| em1                  | div1                       |\n| strong1              | em1                        |\n\n通过修改`em1`的`positon`属性，它的包含块变成了最近的已经定位的祖先盒子(这里是`div1`生成的盒子)。\n\n---\n\n## 内容区的宽度：`width`属性\n\n`width`\n  可选值:  \\<<u>length</u>\\>|\\<<u>percentage</u>\\>|auto|inherit  \n  初始值: auto  \n  适用对像: 所有除了行内非替换元素的对象,包括表格行、和表格行组。\n  百分比: 根据包含块的宽度计算  \n  媒体: 视觉的  \n  计算值: 百分比或者`auto`或者绝对长度\n\n该属性指定了盒子的内容区域宽度。\n\n这个属性不适用于行内非替换元素。行内非替换元素的盒子宽度将由其绘制的内容决定。顺便说一下，行内盒子依照多个盒子的行线摆放。在同一行的多个盒子的宽度通过包含块指定，但是也可以通过浮动来设置。\n\n属性值有如下含义：\n\n- <u>length</u>  \n  指定内容区域长度，使用一个长度单位。\n\n- <u>percentage</u>  \n  指定一个百分比宽度，百分比依照生成元素盒子的包含块的宽度计算。如果包含块宽度依赖于元素宽度，那么布局是未定以的。\n\n- auto \n  宽度依赖于其他属性，下面会讨论。\n\n给`width`属性设置负数是非法的。\n\n---\n\n## 计算宽度以及外边距\n\n元素的`width`、`margin-right`、`margin-left`和`left`、`right`属性用于布局，取决于生成盒子的类型。(属性值用于布局，有时被称之为被使用的值。)原则上，属性值和计算值类似，通过`auto`替换为恰当的值，百分比基于包含块来计算，但是它们是特殊的。以下情况需要被区分开来：\n\n- 1、行内非替换元素\n\n- 2、行内替换元素\n\n- 3、在正常流中的块级非替换元素\n\n- 4、在正常流中的块级替换元素\n\n- 5、浮动非替换元素\n\n- 6、浮动替换元素\n\n- 7、绝对定位，非替换元素\n\n- 8、绝对定位，替换元素\n\n- 9、在正常流中的`inlin-block`,非替换元素\n\n- 10、在正常流中的`inline-block`,替换元素\n\n对于`1-6`和`9-10`,`left`和`right`属性值，如果是相对请为的情况下，由[section 9.4.3.](https://www.w3.org/TR/CSS2/visuren.html#relative-positioning),定义。\n\n---\n\n### 行内非替换元素\n\n`width`属性不起作用，如果给`margin-left`、`margin-right`设置为`auto`,将会计算为`0`.\n\n### 行内替换元素\n\n如果给`margin-left`、`margin-right`设置为`auto`,将会计算为`0`.\n如果`height`和`width`属性都设置为`auto`,并且元素有固有宽度，那么固有宽度作为`width`属性的值。\n\n如果`height`和`width`设置为`auto`,并且元素没有固有宽度，但是元素有固有高度以及固有比率；或者如果`width`属性值设置为`auto`,`height`有其他计算值，并且元素有固有比率，那么元素宽度计算为：\n\n>(used height) * (intrinsic ratio)\n\n如果`height`和`width`属性都设置为`auto`,并且元素有固有比率，但是没有固有的宽度或者高度，`CSS2.1`定义该情况下`width`的值未定义。但是其建议如下：\n如果包含块宽度本身并不依赖于替换元素的宽度，那么`width`的值的计算和正常流中的块级非替换元素类似。\n\n否则，如果`width`的值设置为`auto`,元素有固有宽度，那么固有宽度作为元素宽度。\n\n否则，如果`width`的值设置为`auto`,但是以下情况都不满足，`width`属性值为`300px`,如果`300px`对于设备来说太宽，用户代理将使用最大矩形的宽度：比率为`2:1`，适配设备。\n\n### 正常流中的块级非替换元素\n\n下面的约束必须配置其他属性进行：\n>'margin-left' + 'border-left-width' + 'padding-left' + 'width' + 'padding-right' + 'border-right-width' + 'margin-right' = width of containing block\n\n如果`width`不是`auto`,并且'border-left-width' + 'padding-left' + 'width' + 'padding-right' + 'border-right-width' (加上 不为`auto`的 'margin-left' 或者 'margin-right' 的值)。大于包含块的宽度，那么任何属性值设置为`auto`的`margin-left`或者`margin-right`, 遵循以下规则，设置为`0`.\n\n如果以上属性有一个计算值，而不是`auto`,这被称之为超过限制，那么其中一个属性值必须调整不同于其计算值。如果包含块的方向从左到右，那么指定给`margin-right`的特定值会被忽略，重置一个值，以适配等式成立。反之，如果包含块的方向从右到左，同理。\n\n如果有一个值被指定为`auto`,其值根据等式计算。\n\n如果`width`设置为`auto`,任何其他设置为`auto`的属性值变为`auto`,并且`width`属性值根据等式计算。\n\n如果`margin-left`和`margin-right`设置为`auto`,那么它们实际的值是相等的，用于把元素相对于包含块水平居中。\n\n### 正常流中的块级替换元素\n\n`width`属性的实际值类似于：`行内替换元素`.而外边距的值依据:`非替换块级元素决定`。\n\n### 浮动，非替换元素\n\n如果`margin-left`或者`margin-right`设置为`auto`,那么世纪值计算为`0`.\n如果`width`设置为`auto`,那么实际值将收缩适应元素.\n\n计算收缩适应的宽度类似于计算`table cell`的宽度，使用自动表布局算法。粗略的说：通过格式化内容区不换行，除非遇到换行符，得到一个优选宽度，并且计算一个恰当的最小宽度，例如：尝试任何可能的换行.`CSS2.1`没有定义具体的算法.第三，找到可用的宽度：在这种情况下，宽度为包含块减去另外六个盒模型属性以及可能的滚动条的宽度。\n\n自适应宽度取: min(max(最小宽度，可用宽度)，自适应宽度).\n\n### 浮动，替换元素\n\n如果`margin-left`或者`margin-right`设置为`auto`,实际值为`0`.`width`属性的实际值参照`行内替换元素`。\n\n### 绝对定位，非替换元素\n\n这个章节和下面一个章节的目的，术语`静态位置`参考，粗略的说，一个元素的位置必须在正常流中.清晰的定义：\n\n- 静态位置的包含块是一个假想的盒子，如果`position`属性设置为`static`，并且`float`属性设置为`none`,那么将作为元素的第一个盒子。(由于[section 9.7](https://www.w3.org/TR/CSS2/visuren.html#dis-pos-flo)的限制，这个假想计算或许需要给`display`属性指定一个特殊值.)\n- 如果`position`属性设置为`static`，并且`float`属性设置为`none`, 静态位置的`left`属性计算从包含块的左边缘到假想外边距的左边,这将作为元素的第一个盒子。其值将是负数，如果假想盒位于包含块的左边。\n- 静态位置的`right`属性计算从包含块的右边缘到假想盒的右边缘，同上。如果假想盒子位于包含块的左边，其值将会是正数。\n\n但不是实际的计算假想盒子的尺寸，用户代理会自由猜测其可能的位置。\n\n","source":"_posts/译-视觉格式化模型的细节.md","raw":"---\ntitle: 译-视觉格式化模型的细节\ndate: 2016-09-05 13:21:15\ntags: visual formatting model\ncategories: web\n---\n\n# 123\n\n## 包含块的定义\n\n元素位置以及尺寸的计算有时候涉及到一个固定的矩形，这个矩形称之为元素的`包含块`。元素的包含块定义如下：\n\n- 1、`根元素`所在的包含块是一个矩形，称之为：初始包含块。对于连续介质或页面媒体，有包含尺寸大小的视口，锚定在画布的初始位置。初始包含块的方向属性等同于根元素。\n\n- 2、对于其他元素，如果元素的`position`属性是`relative`或`static`,那么它的包含块被放置在最近的块容器祖先盒子的内容区边缘。\n\n- 3、如果元素的`position`属性设置为`fixed`，那么它的包含块依据在连续介质的情况下或在页面媒体的情况下的页区域的视口来建立。\n\n- 4、如果元素的`position`属性设置为`absolute`，那么它的包含块依据最近的，且`positon`属性被设置为`absolute`、`relative`、`fixed`,的祖先来建立。步骤如下：\n\n  - 1、如果祖先是一个行内元素，那么它的包含块是一个边界盒子包围第一个以及最后一个元素的内边距。在`CSS2.1`,如果行内元素跨多行，那么其包含块是未定义的。\n  - 2、否则，包含块根据其祖先的`padding edge`来格式化。\n  - 3、如果没有找到这样的祖先元素，那么其包含块就是最初的包含块。\n\n在页面媒体下，一个绝对定位元素的位置关联到它的包含块，忽略任何的分页(好像页面是连续的)，元素可能被分到多个页面。\n\n对于绝对定位的内容，被解析到页面的某个位置，而不是页面被布局的位置，或者解析到当前已经被渲染或者打印的页面，打印机或许会放置内容。\n\n- 当前页面的其他位置\n- 在随后的页面，或者\n- 省略它\n\n>注意：一个块级元素超过了多个页或许会在不同的页有不同的宽度，或许会设备自身的限制。\n\n\n\n```html\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\">\n<HTML>\n   <HEAD>\n      <TITLE>Illustration of containing blocks</TITLE>\n   </HEAD>\n   <BODY id=\"body\">\n      <DIV id=\"div1\">\n      <P id=\"p1\">This is text in the first paragraph...</P>\n      <P id=\"p2\">This is text <EM id=\"em1\"> in the \n      <STRONG id=\"strong1\">second</STRONG> paragraph.</EM></P>\n      </DIV>\n   </BODY>\n</HTML>\n```\n\n没有定位，上面文档将建立如下的包含块：\n\n| For box generated by | C.B is established by      |\n| -------------------- |:---------------------------|\n| html                 |  initial C.B(UA-dependent) |\n| body                 | html                       |\n| div1                 | body                       |\n| p1                   | div1                       |\n| p2                   | div1                       |\n| em1                  | p2                         |\n| strong1              | p2                         |\n\n如果我们修改`div1`的`position`属性：\n\n```css\n  #div {positon: absolute; left: 50px; top: 50px}\n```\n\n那么它的包含块将不再是`body`,而是变成了最初的包含块(因为没有被定位的祖先盒子)。\n\n如果我们把`em1`的`position`属性也修改了：\n\n```css\n  #div {position: absolute; left: 50px; top: 50px}\n  #em1 {position: absolute; left: 100px; top: 100px}\n```\n\n包含块表格现在变成了：\n\n| For box generated by | C.B is established by      |\n| -------------------- |:---------------------------|\n| html                 | initial C.B(UA-dependent)  |\n| body                 | html                       |\n| div1                 | initial C.B                |\n| p1                   | div1                       |\n| p2                   | div1                       |\n| em1                  | div1                       |\n| strong1              | em1                        |\n\n通过修改`em1`的`positon`属性，它的包含块变成了最近的已经定位的祖先盒子(这里是`div1`生成的盒子)。\n\n---\n\n## 内容区的宽度：`width`属性\n\n`width`\n  可选值:  \\<<u>length</u>\\>|\\<<u>percentage</u>\\>|auto|inherit  \n  初始值: auto  \n  适用对像: 所有除了行内非替换元素的对象,包括表格行、和表格行组。\n  百分比: 根据包含块的宽度计算  \n  媒体: 视觉的  \n  计算值: 百分比或者`auto`或者绝对长度\n\n该属性指定了盒子的内容区域宽度。\n\n这个属性不适用于行内非替换元素。行内非替换元素的盒子宽度将由其绘制的内容决定。顺便说一下，行内盒子依照多个盒子的行线摆放。在同一行的多个盒子的宽度通过包含块指定，但是也可以通过浮动来设置。\n\n属性值有如下含义：\n\n- <u>length</u>  \n  指定内容区域长度，使用一个长度单位。\n\n- <u>percentage</u>  \n  指定一个百分比宽度，百分比依照生成元素盒子的包含块的宽度计算。如果包含块宽度依赖于元素宽度，那么布局是未定以的。\n\n- auto \n  宽度依赖于其他属性，下面会讨论。\n\n给`width`属性设置负数是非法的。\n\n---\n\n## 计算宽度以及外边距\n\n元素的`width`、`margin-right`、`margin-left`和`left`、`right`属性用于布局，取决于生成盒子的类型。(属性值用于布局，有时被称之为被使用的值。)原则上，属性值和计算值类似，通过`auto`替换为恰当的值，百分比基于包含块来计算，但是它们是特殊的。以下情况需要被区分开来：\n\n- 1、行内非替换元素\n\n- 2、行内替换元素\n\n- 3、在正常流中的块级非替换元素\n\n- 4、在正常流中的块级替换元素\n\n- 5、浮动非替换元素\n\n- 6、浮动替换元素\n\n- 7、绝对定位，非替换元素\n\n- 8、绝对定位，替换元素\n\n- 9、在正常流中的`inlin-block`,非替换元素\n\n- 10、在正常流中的`inline-block`,替换元素\n\n对于`1-6`和`9-10`,`left`和`right`属性值，如果是相对请为的情况下，由[section 9.4.3.](https://www.w3.org/TR/CSS2/visuren.html#relative-positioning),定义。\n\n---\n\n### 行内非替换元素\n\n`width`属性不起作用，如果给`margin-left`、`margin-right`设置为`auto`,将会计算为`0`.\n\n### 行内替换元素\n\n如果给`margin-left`、`margin-right`设置为`auto`,将会计算为`0`.\n如果`height`和`width`属性都设置为`auto`,并且元素有固有宽度，那么固有宽度作为`width`属性的值。\n\n如果`height`和`width`设置为`auto`,并且元素没有固有宽度，但是元素有固有高度以及固有比率；或者如果`width`属性值设置为`auto`,`height`有其他计算值，并且元素有固有比率，那么元素宽度计算为：\n\n>(used height) * (intrinsic ratio)\n\n如果`height`和`width`属性都设置为`auto`,并且元素有固有比率，但是没有固有的宽度或者高度，`CSS2.1`定义该情况下`width`的值未定义。但是其建议如下：\n如果包含块宽度本身并不依赖于替换元素的宽度，那么`width`的值的计算和正常流中的块级非替换元素类似。\n\n否则，如果`width`的值设置为`auto`,元素有固有宽度，那么固有宽度作为元素宽度。\n\n否则，如果`width`的值设置为`auto`,但是以下情况都不满足，`width`属性值为`300px`,如果`300px`对于设备来说太宽，用户代理将使用最大矩形的宽度：比率为`2:1`，适配设备。\n\n### 正常流中的块级非替换元素\n\n下面的约束必须配置其他属性进行：\n>'margin-left' + 'border-left-width' + 'padding-left' + 'width' + 'padding-right' + 'border-right-width' + 'margin-right' = width of containing block\n\n如果`width`不是`auto`,并且'border-left-width' + 'padding-left' + 'width' + 'padding-right' + 'border-right-width' (加上 不为`auto`的 'margin-left' 或者 'margin-right' 的值)。大于包含块的宽度，那么任何属性值设置为`auto`的`margin-left`或者`margin-right`, 遵循以下规则，设置为`0`.\n\n如果以上属性有一个计算值，而不是`auto`,这被称之为超过限制，那么其中一个属性值必须调整不同于其计算值。如果包含块的方向从左到右，那么指定给`margin-right`的特定值会被忽略，重置一个值，以适配等式成立。反之，如果包含块的方向从右到左，同理。\n\n如果有一个值被指定为`auto`,其值根据等式计算。\n\n如果`width`设置为`auto`,任何其他设置为`auto`的属性值变为`auto`,并且`width`属性值根据等式计算。\n\n如果`margin-left`和`margin-right`设置为`auto`,那么它们实际的值是相等的，用于把元素相对于包含块水平居中。\n\n### 正常流中的块级替换元素\n\n`width`属性的实际值类似于：`行内替换元素`.而外边距的值依据:`非替换块级元素决定`。\n\n### 浮动，非替换元素\n\n如果`margin-left`或者`margin-right`设置为`auto`,那么世纪值计算为`0`.\n如果`width`设置为`auto`,那么实际值将收缩适应元素.\n\n计算收缩适应的宽度类似于计算`table cell`的宽度，使用自动表布局算法。粗略的说：通过格式化内容区不换行，除非遇到换行符，得到一个优选宽度，并且计算一个恰当的最小宽度，例如：尝试任何可能的换行.`CSS2.1`没有定义具体的算法.第三，找到可用的宽度：在这种情况下，宽度为包含块减去另外六个盒模型属性以及可能的滚动条的宽度。\n\n自适应宽度取: min(max(最小宽度，可用宽度)，自适应宽度).\n\n### 浮动，替换元素\n\n如果`margin-left`或者`margin-right`设置为`auto`,实际值为`0`.`width`属性的实际值参照`行内替换元素`。\n\n### 绝对定位，非替换元素\n\n这个章节和下面一个章节的目的，术语`静态位置`参考，粗略的说，一个元素的位置必须在正常流中.清晰的定义：\n\n- 静态位置的包含块是一个假想的盒子，如果`position`属性设置为`static`，并且`float`属性设置为`none`,那么将作为元素的第一个盒子。(由于[section 9.7](https://www.w3.org/TR/CSS2/visuren.html#dis-pos-flo)的限制，这个假想计算或许需要给`display`属性指定一个特殊值.)\n- 如果`position`属性设置为`static`，并且`float`属性设置为`none`, 静态位置的`left`属性计算从包含块的左边缘到假想外边距的左边,这将作为元素的第一个盒子。其值将是负数，如果假想盒位于包含块的左边。\n- 静态位置的`right`属性计算从包含块的右边缘到假想盒的右边缘，同上。如果假想盒子位于包含块的左边，其值将会是正数。\n\n但不是实际的计算假想盒子的尺寸，用户代理会自由猜测其可能的位置。\n\n","slug":"译-视觉格式化模型的细节","published":1,"updated":"2018-01-28T15:57:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcyzhlye002q9co7ygi0pr33","content":"<h1 id=\"123\"><a href=\"#123\" class=\"headerlink\" title=\"123\"></a>123</h1><h2 id=\"包含块的定义\"><a href=\"#包含块的定义\" class=\"headerlink\" title=\"包含块的定义\"></a>包含块的定义</h2><p>元素位置以及尺寸的计算有时候涉及到一个固定的矩形，这个矩形称之为元素的<code>包含块</code>。元素的包含块定义如下：</p>\n<ul>\n<li><p>1、<code>根元素</code>所在的包含块是一个矩形，称之为：初始包含块。对于连续介质或页面媒体，有包含尺寸大小的视口，锚定在画布的初始位置。初始包含块的方向属性等同于根元素。</p>\n</li>\n<li><p>2、对于其他元素，如果元素的<code>position</code>属性是<code>relative</code>或<code>static</code>,那么它的包含块被放置在最近的块容器祖先盒子的内容区边缘。</p>\n</li>\n<li><p>3、如果元素的<code>position</code>属性设置为<code>fixed</code>，那么它的包含块依据在连续介质的情况下或在页面媒体的情况下的页区域的视口来建立。</p>\n</li>\n<li><p>4、如果元素的<code>position</code>属性设置为<code>absolute</code>，那么它的包含块依据最近的，且<code>positon</code>属性被设置为<code>absolute</code>、<code>relative</code>、<code>fixed</code>,的祖先来建立。步骤如下：</p>\n<ul>\n<li>1、如果祖先是一个行内元素，那么它的包含块是一个边界盒子包围第一个以及最后一个元素的内边距。在<code>CSS2.1</code>,如果行内元素跨多行，那么其包含块是未定义的。</li>\n<li>2、否则，包含块根据其祖先的<code>padding edge</code>来格式化。</li>\n<li>3、如果没有找到这样的祖先元素，那么其包含块就是最初的包含块。</li>\n</ul>\n</li>\n</ul>\n<p>在页面媒体下，一个绝对定位元素的位置关联到它的包含块，忽略任何的分页(好像页面是连续的)，元素可能被分到多个页面。</p>\n<p>对于绝对定位的内容，被解析到页面的某个位置，而不是页面被布局的位置，或者解析到当前已经被渲染或者打印的页面，打印机或许会放置内容。</p>\n<ul>\n<li>当前页面的其他位置</li>\n<li>在随后的页面，或者</li>\n<li>省略它</li>\n</ul>\n<blockquote>\n<p>注意：一个块级元素超过了多个页或许会在不同的页有不同的宽度，或许会设备自身的限制。</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">HTML</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">HEAD</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">TITLE</span>&gt;</span>Illustration of containing blocks<span class=\"tag\">&lt;/<span class=\"name\">TITLE</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">HEAD</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">BODY</span> <span class=\"attr\">id</span>=<span class=\"string\">\"body\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">DIV</span> <span class=\"attr\">id</span>=<span class=\"string\">\"div1\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">P</span> <span class=\"attr\">id</span>=<span class=\"string\">\"p1\"</span>&gt;</span>This is text in the first paragraph...<span class=\"tag\">&lt;/<span class=\"name\">P</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">P</span> <span class=\"attr\">id</span>=<span class=\"string\">\"p2\"</span>&gt;</span>This is text <span class=\"tag\">&lt;<span class=\"name\">EM</span> <span class=\"attr\">id</span>=<span class=\"string\">\"em1\"</span>&gt;</span> in the </span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">STRONG</span> <span class=\"attr\">id</span>=<span class=\"string\">\"strong1\"</span>&gt;</span>second<span class=\"tag\">&lt;/<span class=\"name\">STRONG</span>&gt;</span> paragraph.<span class=\"tag\">&lt;/<span class=\"name\">EM</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">P</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">DIV</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">BODY</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">HTML</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>没有定位，上面文档将建立如下的包含块：</p>\n<table>\n<thead>\n<tr>\n<th>For box generated by</th>\n<th style=\"text-align:left\">C.B is established by</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>html</td>\n<td style=\"text-align:left\">initial C.B(UA-dependent)</td>\n</tr>\n<tr>\n<td>body</td>\n<td style=\"text-align:left\">html</td>\n</tr>\n<tr>\n<td>div1</td>\n<td style=\"text-align:left\">body</td>\n</tr>\n<tr>\n<td>p1</td>\n<td style=\"text-align:left\">div1</td>\n</tr>\n<tr>\n<td>p2</td>\n<td style=\"text-align:left\">div1</td>\n</tr>\n<tr>\n<td>em1</td>\n<td style=\"text-align:left\">p2</td>\n</tr>\n<tr>\n<td>strong1</td>\n<td style=\"text-align:left\">p2</td>\n</tr>\n</tbody>\n</table>\n<p>如果我们修改<code>div1</code>的<code>position</code>属性：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-id\">#div</span> &#123;<span class=\"attribute\">positon</span>: absolute; <span class=\"attribute\">left</span>: <span class=\"number\">50px</span>; <span class=\"attribute\">top</span>: <span class=\"number\">50px</span>&#125;</span><br></pre></td></tr></table></figure>\n<p>那么它的包含块将不再是<code>body</code>,而是变成了最初的包含块(因为没有被定位的祖先盒子)。</p>\n<p>如果我们把<code>em1</code>的<code>position</code>属性也修改了：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-id\">#div</span> &#123;<span class=\"attribute\">position</span>: absolute; <span class=\"attribute\">left</span>: <span class=\"number\">50px</span>; <span class=\"attribute\">top</span>: <span class=\"number\">50px</span>&#125;</span><br><span class=\"line\"><span class=\"selector-id\">#em1</span> &#123;<span class=\"attribute\">position</span>: absolute; <span class=\"attribute\">left</span>: <span class=\"number\">100px</span>; <span class=\"attribute\">top</span>: <span class=\"number\">100px</span>&#125;</span><br></pre></td></tr></table></figure>\n<p>包含块表格现在变成了：</p>\n<table>\n<thead>\n<tr>\n<th>For box generated by</th>\n<th style=\"text-align:left\">C.B is established by</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>html</td>\n<td style=\"text-align:left\">initial C.B(UA-dependent)</td>\n</tr>\n<tr>\n<td>body</td>\n<td style=\"text-align:left\">html</td>\n</tr>\n<tr>\n<td>div1</td>\n<td style=\"text-align:left\">initial C.B</td>\n</tr>\n<tr>\n<td>p1</td>\n<td style=\"text-align:left\">div1</td>\n</tr>\n<tr>\n<td>p2</td>\n<td style=\"text-align:left\">div1</td>\n</tr>\n<tr>\n<td>em1</td>\n<td style=\"text-align:left\">div1</td>\n</tr>\n<tr>\n<td>strong1</td>\n<td style=\"text-align:left\">em1</td>\n</tr>\n</tbody>\n</table>\n<p>通过修改<code>em1</code>的<code>positon</code>属性，它的包含块变成了最近的已经定位的祖先盒子(这里是<code>div1</code>生成的盒子)。</p>\n<hr>\n<h2 id=\"内容区的宽度：width属性\"><a href=\"#内容区的宽度：width属性\" class=\"headerlink\" title=\"内容区的宽度：width属性\"></a>内容区的宽度：<code>width</code>属性</h2><p><code>width</code><br>  可选值:  \\&lt;<u>length</u>>|\\&lt;<u>percentage</u>>|auto|inherit<br>  初始值: auto<br>  适用对像: 所有除了行内非替换元素的对象,包括表格行、和表格行组。<br>  百分比: 根据包含块的宽度计算<br>  媒体: 视觉的<br>  计算值: 百分比或者<code>auto</code>或者绝对长度</p>\n<p>该属性指定了盒子的内容区域宽度。</p>\n<p>这个属性不适用于行内非替换元素。行内非替换元素的盒子宽度将由其绘制的内容决定。顺便说一下，行内盒子依照多个盒子的行线摆放。在同一行的多个盒子的宽度通过包含块指定，但是也可以通过浮动来设置。</p>\n<p>属性值有如下含义：</p>\n<ul>\n<li><p><u>length</u><br>指定内容区域长度，使用一个长度单位。</p>\n</li>\n<li><p><u>percentage</u><br>指定一个百分比宽度，百分比依照生成元素盒子的包含块的宽度计算。如果包含块宽度依赖于元素宽度，那么布局是未定以的。</p>\n</li>\n<li><p>auto<br>宽度依赖于其他属性，下面会讨论。</p>\n</li>\n</ul>\n<p>给<code>width</code>属性设置负数是非法的。</p>\n<hr>\n<h2 id=\"计算宽度以及外边距\"><a href=\"#计算宽度以及外边距\" class=\"headerlink\" title=\"计算宽度以及外边距\"></a>计算宽度以及外边距</h2><p>元素的<code>width</code>、<code>margin-right</code>、<code>margin-left</code>和<code>left</code>、<code>right</code>属性用于布局，取决于生成盒子的类型。(属性值用于布局，有时被称之为被使用的值。)原则上，属性值和计算值类似，通过<code>auto</code>替换为恰当的值，百分比基于包含块来计算，但是它们是特殊的。以下情况需要被区分开来：</p>\n<ul>\n<li><p>1、行内非替换元素</p>\n</li>\n<li><p>2、行内替换元素</p>\n</li>\n<li><p>3、在正常流中的块级非替换元素</p>\n</li>\n<li><p>4、在正常流中的块级替换元素</p>\n</li>\n<li><p>5、浮动非替换元素</p>\n</li>\n<li><p>6、浮动替换元素</p>\n</li>\n<li><p>7、绝对定位，非替换元素</p>\n</li>\n<li><p>8、绝对定位，替换元素</p>\n</li>\n<li><p>9、在正常流中的<code>inlin-block</code>,非替换元素</p>\n</li>\n<li><p>10、在正常流中的<code>inline-block</code>,替换元素</p>\n</li>\n</ul>\n<p>对于<code>1-6</code>和<code>9-10</code>,<code>left</code>和<code>right</code>属性值，如果是相对请为的情况下，由<a href=\"https://www.w3.org/TR/CSS2/visuren.html#relative-positioning\" target=\"_blank\" rel=\"noopener\">section 9.4.3.</a>,定义。</p>\n<hr>\n<h3 id=\"行内非替换元素\"><a href=\"#行内非替换元素\" class=\"headerlink\" title=\"行内非替换元素\"></a>行内非替换元素</h3><p><code>width</code>属性不起作用，如果给<code>margin-left</code>、<code>margin-right</code>设置为<code>auto</code>,将会计算为<code>0</code>.</p>\n<h3 id=\"行内替换元素\"><a href=\"#行内替换元素\" class=\"headerlink\" title=\"行内替换元素\"></a>行内替换元素</h3><p>如果给<code>margin-left</code>、<code>margin-right</code>设置为<code>auto</code>,将会计算为<code>0</code>.<br>如果<code>height</code>和<code>width</code>属性都设置为<code>auto</code>,并且元素有固有宽度，那么固有宽度作为<code>width</code>属性的值。</p>\n<p>如果<code>height</code>和<code>width</code>设置为<code>auto</code>,并且元素没有固有宽度，但是元素有固有高度以及固有比率；或者如果<code>width</code>属性值设置为<code>auto</code>,<code>height</code>有其他计算值，并且元素有固有比率，那么元素宽度计算为：</p>\n<blockquote>\n<p>(used height) * (intrinsic ratio)</p>\n</blockquote>\n<p>如果<code>height</code>和<code>width</code>属性都设置为<code>auto</code>,并且元素有固有比率，但是没有固有的宽度或者高度，<code>CSS2.1</code>定义该情况下<code>width</code>的值未定义。但是其建议如下：<br>如果包含块宽度本身并不依赖于替换元素的宽度，那么<code>width</code>的值的计算和正常流中的块级非替换元素类似。</p>\n<p>否则，如果<code>width</code>的值设置为<code>auto</code>,元素有固有宽度，那么固有宽度作为元素宽度。</p>\n<p>否则，如果<code>width</code>的值设置为<code>auto</code>,但是以下情况都不满足，<code>width</code>属性值为<code>300px</code>,如果<code>300px</code>对于设备来说太宽，用户代理将使用最大矩形的宽度：比率为<code>2:1</code>，适配设备。</p>\n<h3 id=\"正常流中的块级非替换元素\"><a href=\"#正常流中的块级非替换元素\" class=\"headerlink\" title=\"正常流中的块级非替换元素\"></a>正常流中的块级非替换元素</h3><p>下面的约束必须配置其他属性进行：</p>\n<blockquote>\n<p>‘margin-left’ + ‘border-left-width’ + ‘padding-left’ + ‘width’ + ‘padding-right’ + ‘border-right-width’ + ‘margin-right’ = width of containing block</p>\n</blockquote>\n<p>如果<code>width</code>不是<code>auto</code>,并且’border-left-width’ + ‘padding-left’ + ‘width’ + ‘padding-right’ + ‘border-right-width’ (加上 不为<code>auto</code>的 ‘margin-left’ 或者 ‘margin-right’ 的值)。大于包含块的宽度，那么任何属性值设置为<code>auto</code>的<code>margin-left</code>或者<code>margin-right</code>, 遵循以下规则，设置为<code>0</code>.</p>\n<p>如果以上属性有一个计算值，而不是<code>auto</code>,这被称之为超过限制，那么其中一个属性值必须调整不同于其计算值。如果包含块的方向从左到右，那么指定给<code>margin-right</code>的特定值会被忽略，重置一个值，以适配等式成立。反之，如果包含块的方向从右到左，同理。</p>\n<p>如果有一个值被指定为<code>auto</code>,其值根据等式计算。</p>\n<p>如果<code>width</code>设置为<code>auto</code>,任何其他设置为<code>auto</code>的属性值变为<code>auto</code>,并且<code>width</code>属性值根据等式计算。</p>\n<p>如果<code>margin-left</code>和<code>margin-right</code>设置为<code>auto</code>,那么它们实际的值是相等的，用于把元素相对于包含块水平居中。</p>\n<h3 id=\"正常流中的块级替换元素\"><a href=\"#正常流中的块级替换元素\" class=\"headerlink\" title=\"正常流中的块级替换元素\"></a>正常流中的块级替换元素</h3><p><code>width</code>属性的实际值类似于：<code>行内替换元素</code>.而外边距的值依据:<code>非替换块级元素决定</code>。</p>\n<h3 id=\"浮动，非替换元素\"><a href=\"#浮动，非替换元素\" class=\"headerlink\" title=\"浮动，非替换元素\"></a>浮动，非替换元素</h3><p>如果<code>margin-left</code>或者<code>margin-right</code>设置为<code>auto</code>,那么世纪值计算为<code>0</code>.<br>如果<code>width</code>设置为<code>auto</code>,那么实际值将收缩适应元素.</p>\n<p>计算收缩适应的宽度类似于计算<code>table cell</code>的宽度，使用自动表布局算法。粗略的说：通过格式化内容区不换行，除非遇到换行符，得到一个优选宽度，并且计算一个恰当的最小宽度，例如：尝试任何可能的换行.<code>CSS2.1</code>没有定义具体的算法.第三，找到可用的宽度：在这种情况下，宽度为包含块减去另外六个盒模型属性以及可能的滚动条的宽度。</p>\n<p>自适应宽度取: min(max(最小宽度，可用宽度)，自适应宽度).</p>\n<h3 id=\"浮动，替换元素\"><a href=\"#浮动，替换元素\" class=\"headerlink\" title=\"浮动，替换元素\"></a>浮动，替换元素</h3><p>如果<code>margin-left</code>或者<code>margin-right</code>设置为<code>auto</code>,实际值为<code>0</code>.<code>width</code>属性的实际值参照<code>行内替换元素</code>。</p>\n<h3 id=\"绝对定位，非替换元素\"><a href=\"#绝对定位，非替换元素\" class=\"headerlink\" title=\"绝对定位，非替换元素\"></a>绝对定位，非替换元素</h3><p>这个章节和下面一个章节的目的，术语<code>静态位置</code>参考，粗略的说，一个元素的位置必须在正常流中.清晰的定义：</p>\n<ul>\n<li>静态位置的包含块是一个假想的盒子，如果<code>position</code>属性设置为<code>static</code>，并且<code>float</code>属性设置为<code>none</code>,那么将作为元素的第一个盒子。(由于<a href=\"https://www.w3.org/TR/CSS2/visuren.html#dis-pos-flo\" target=\"_blank\" rel=\"noopener\">section 9.7</a>的限制，这个假想计算或许需要给<code>display</code>属性指定一个特殊值.)</li>\n<li>如果<code>position</code>属性设置为<code>static</code>，并且<code>float</code>属性设置为<code>none</code>, 静态位置的<code>left</code>属性计算从包含块的左边缘到假想外边距的左边,这将作为元素的第一个盒子。其值将是负数，如果假想盒位于包含块的左边。</li>\n<li>静态位置的<code>right</code>属性计算从包含块的右边缘到假想盒的右边缘，同上。如果假想盒子位于包含块的左边，其值将会是正数。</li>\n</ul>\n<p>但不是实际的计算假想盒子的尺寸，用户代理会自由猜测其可能的位置。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"123\"><a href=\"#123\" class=\"headerlink\" title=\"123\"></a>123</h1><h2 id=\"包含块的定义\"><a href=\"#包含块的定义\" class=\"headerlink\" title=\"包含块的定义\"></a>包含块的定义</h2><p>元素位置以及尺寸的计算有时候涉及到一个固定的矩形，这个矩形称之为元素的<code>包含块</code>。元素的包含块定义如下：</p>\n<ul>\n<li><p>1、<code>根元素</code>所在的包含块是一个矩形，称之为：初始包含块。对于连续介质或页面媒体，有包含尺寸大小的视口，锚定在画布的初始位置。初始包含块的方向属性等同于根元素。</p>\n</li>\n<li><p>2、对于其他元素，如果元素的<code>position</code>属性是<code>relative</code>或<code>static</code>,那么它的包含块被放置在最近的块容器祖先盒子的内容区边缘。</p>\n</li>\n<li><p>3、如果元素的<code>position</code>属性设置为<code>fixed</code>，那么它的包含块依据在连续介质的情况下或在页面媒体的情况下的页区域的视口来建立。</p>\n</li>\n<li><p>4、如果元素的<code>position</code>属性设置为<code>absolute</code>，那么它的包含块依据最近的，且<code>positon</code>属性被设置为<code>absolute</code>、<code>relative</code>、<code>fixed</code>,的祖先来建立。步骤如下：</p>\n<ul>\n<li>1、如果祖先是一个行内元素，那么它的包含块是一个边界盒子包围第一个以及最后一个元素的内边距。在<code>CSS2.1</code>,如果行内元素跨多行，那么其包含块是未定义的。</li>\n<li>2、否则，包含块根据其祖先的<code>padding edge</code>来格式化。</li>\n<li>3、如果没有找到这样的祖先元素，那么其包含块就是最初的包含块。</li>\n</ul>\n</li>\n</ul>\n<p>在页面媒体下，一个绝对定位元素的位置关联到它的包含块，忽略任何的分页(好像页面是连续的)，元素可能被分到多个页面。</p>\n<p>对于绝对定位的内容，被解析到页面的某个位置，而不是页面被布局的位置，或者解析到当前已经被渲染或者打印的页面，打印机或许会放置内容。</p>\n<ul>\n<li>当前页面的其他位置</li>\n<li>在随后的页面，或者</li>\n<li>省略它</li>\n</ul>\n<blockquote>\n<p>注意：一个块级元素超过了多个页或许会在不同的页有不同的宽度，或许会设备自身的限制。</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">HTML</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">HEAD</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">TITLE</span>&gt;</span>Illustration of containing blocks<span class=\"tag\">&lt;/<span class=\"name\">TITLE</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">HEAD</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">BODY</span> <span class=\"attr\">id</span>=<span class=\"string\">\"body\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">DIV</span> <span class=\"attr\">id</span>=<span class=\"string\">\"div1\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">P</span> <span class=\"attr\">id</span>=<span class=\"string\">\"p1\"</span>&gt;</span>This is text in the first paragraph...<span class=\"tag\">&lt;/<span class=\"name\">P</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">P</span> <span class=\"attr\">id</span>=<span class=\"string\">\"p2\"</span>&gt;</span>This is text <span class=\"tag\">&lt;<span class=\"name\">EM</span> <span class=\"attr\">id</span>=<span class=\"string\">\"em1\"</span>&gt;</span> in the </span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">STRONG</span> <span class=\"attr\">id</span>=<span class=\"string\">\"strong1\"</span>&gt;</span>second<span class=\"tag\">&lt;/<span class=\"name\">STRONG</span>&gt;</span> paragraph.<span class=\"tag\">&lt;/<span class=\"name\">EM</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">P</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">DIV</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">BODY</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">HTML</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>没有定位，上面文档将建立如下的包含块：</p>\n<table>\n<thead>\n<tr>\n<th>For box generated by</th>\n<th style=\"text-align:left\">C.B is established by</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>html</td>\n<td style=\"text-align:left\">initial C.B(UA-dependent)</td>\n</tr>\n<tr>\n<td>body</td>\n<td style=\"text-align:left\">html</td>\n</tr>\n<tr>\n<td>div1</td>\n<td style=\"text-align:left\">body</td>\n</tr>\n<tr>\n<td>p1</td>\n<td style=\"text-align:left\">div1</td>\n</tr>\n<tr>\n<td>p2</td>\n<td style=\"text-align:left\">div1</td>\n</tr>\n<tr>\n<td>em1</td>\n<td style=\"text-align:left\">p2</td>\n</tr>\n<tr>\n<td>strong1</td>\n<td style=\"text-align:left\">p2</td>\n</tr>\n</tbody>\n</table>\n<p>如果我们修改<code>div1</code>的<code>position</code>属性：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-id\">#div</span> &#123;<span class=\"attribute\">positon</span>: absolute; <span class=\"attribute\">left</span>: <span class=\"number\">50px</span>; <span class=\"attribute\">top</span>: <span class=\"number\">50px</span>&#125;</span><br></pre></td></tr></table></figure>\n<p>那么它的包含块将不再是<code>body</code>,而是变成了最初的包含块(因为没有被定位的祖先盒子)。</p>\n<p>如果我们把<code>em1</code>的<code>position</code>属性也修改了：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-id\">#div</span> &#123;<span class=\"attribute\">position</span>: absolute; <span class=\"attribute\">left</span>: <span class=\"number\">50px</span>; <span class=\"attribute\">top</span>: <span class=\"number\">50px</span>&#125;</span><br><span class=\"line\"><span class=\"selector-id\">#em1</span> &#123;<span class=\"attribute\">position</span>: absolute; <span class=\"attribute\">left</span>: <span class=\"number\">100px</span>; <span class=\"attribute\">top</span>: <span class=\"number\">100px</span>&#125;</span><br></pre></td></tr></table></figure>\n<p>包含块表格现在变成了：</p>\n<table>\n<thead>\n<tr>\n<th>For box generated by</th>\n<th style=\"text-align:left\">C.B is established by</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>html</td>\n<td style=\"text-align:left\">initial C.B(UA-dependent)</td>\n</tr>\n<tr>\n<td>body</td>\n<td style=\"text-align:left\">html</td>\n</tr>\n<tr>\n<td>div1</td>\n<td style=\"text-align:left\">initial C.B</td>\n</tr>\n<tr>\n<td>p1</td>\n<td style=\"text-align:left\">div1</td>\n</tr>\n<tr>\n<td>p2</td>\n<td style=\"text-align:left\">div1</td>\n</tr>\n<tr>\n<td>em1</td>\n<td style=\"text-align:left\">div1</td>\n</tr>\n<tr>\n<td>strong1</td>\n<td style=\"text-align:left\">em1</td>\n</tr>\n</tbody>\n</table>\n<p>通过修改<code>em1</code>的<code>positon</code>属性，它的包含块变成了最近的已经定位的祖先盒子(这里是<code>div1</code>生成的盒子)。</p>\n<hr>\n<h2 id=\"内容区的宽度：width属性\"><a href=\"#内容区的宽度：width属性\" class=\"headerlink\" title=\"内容区的宽度：width属性\"></a>内容区的宽度：<code>width</code>属性</h2><p><code>width</code><br>  可选值:  \\&lt;<u>length</u>>|\\&lt;<u>percentage</u>>|auto|inherit<br>  初始值: auto<br>  适用对像: 所有除了行内非替换元素的对象,包括表格行、和表格行组。<br>  百分比: 根据包含块的宽度计算<br>  媒体: 视觉的<br>  计算值: 百分比或者<code>auto</code>或者绝对长度</p>\n<p>该属性指定了盒子的内容区域宽度。</p>\n<p>这个属性不适用于行内非替换元素。行内非替换元素的盒子宽度将由其绘制的内容决定。顺便说一下，行内盒子依照多个盒子的行线摆放。在同一行的多个盒子的宽度通过包含块指定，但是也可以通过浮动来设置。</p>\n<p>属性值有如下含义：</p>\n<ul>\n<li><p><u>length</u><br>指定内容区域长度，使用一个长度单位。</p>\n</li>\n<li><p><u>percentage</u><br>指定一个百分比宽度，百分比依照生成元素盒子的包含块的宽度计算。如果包含块宽度依赖于元素宽度，那么布局是未定以的。</p>\n</li>\n<li><p>auto<br>宽度依赖于其他属性，下面会讨论。</p>\n</li>\n</ul>\n<p>给<code>width</code>属性设置负数是非法的。</p>\n<hr>\n<h2 id=\"计算宽度以及外边距\"><a href=\"#计算宽度以及外边距\" class=\"headerlink\" title=\"计算宽度以及外边距\"></a>计算宽度以及外边距</h2><p>元素的<code>width</code>、<code>margin-right</code>、<code>margin-left</code>和<code>left</code>、<code>right</code>属性用于布局，取决于生成盒子的类型。(属性值用于布局，有时被称之为被使用的值。)原则上，属性值和计算值类似，通过<code>auto</code>替换为恰当的值，百分比基于包含块来计算，但是它们是特殊的。以下情况需要被区分开来：</p>\n<ul>\n<li><p>1、行内非替换元素</p>\n</li>\n<li><p>2、行内替换元素</p>\n</li>\n<li><p>3、在正常流中的块级非替换元素</p>\n</li>\n<li><p>4、在正常流中的块级替换元素</p>\n</li>\n<li><p>5、浮动非替换元素</p>\n</li>\n<li><p>6、浮动替换元素</p>\n</li>\n<li><p>7、绝对定位，非替换元素</p>\n</li>\n<li><p>8、绝对定位，替换元素</p>\n</li>\n<li><p>9、在正常流中的<code>inlin-block</code>,非替换元素</p>\n</li>\n<li><p>10、在正常流中的<code>inline-block</code>,替换元素</p>\n</li>\n</ul>\n<p>对于<code>1-6</code>和<code>9-10</code>,<code>left</code>和<code>right</code>属性值，如果是相对请为的情况下，由<a href=\"https://www.w3.org/TR/CSS2/visuren.html#relative-positioning\" target=\"_blank\" rel=\"noopener\">section 9.4.3.</a>,定义。</p>\n<hr>\n<h3 id=\"行内非替换元素\"><a href=\"#行内非替换元素\" class=\"headerlink\" title=\"行内非替换元素\"></a>行内非替换元素</h3><p><code>width</code>属性不起作用，如果给<code>margin-left</code>、<code>margin-right</code>设置为<code>auto</code>,将会计算为<code>0</code>.</p>\n<h3 id=\"行内替换元素\"><a href=\"#行内替换元素\" class=\"headerlink\" title=\"行内替换元素\"></a>行内替换元素</h3><p>如果给<code>margin-left</code>、<code>margin-right</code>设置为<code>auto</code>,将会计算为<code>0</code>.<br>如果<code>height</code>和<code>width</code>属性都设置为<code>auto</code>,并且元素有固有宽度，那么固有宽度作为<code>width</code>属性的值。</p>\n<p>如果<code>height</code>和<code>width</code>设置为<code>auto</code>,并且元素没有固有宽度，但是元素有固有高度以及固有比率；或者如果<code>width</code>属性值设置为<code>auto</code>,<code>height</code>有其他计算值，并且元素有固有比率，那么元素宽度计算为：</p>\n<blockquote>\n<p>(used height) * (intrinsic ratio)</p>\n</blockquote>\n<p>如果<code>height</code>和<code>width</code>属性都设置为<code>auto</code>,并且元素有固有比率，但是没有固有的宽度或者高度，<code>CSS2.1</code>定义该情况下<code>width</code>的值未定义。但是其建议如下：<br>如果包含块宽度本身并不依赖于替换元素的宽度，那么<code>width</code>的值的计算和正常流中的块级非替换元素类似。</p>\n<p>否则，如果<code>width</code>的值设置为<code>auto</code>,元素有固有宽度，那么固有宽度作为元素宽度。</p>\n<p>否则，如果<code>width</code>的值设置为<code>auto</code>,但是以下情况都不满足，<code>width</code>属性值为<code>300px</code>,如果<code>300px</code>对于设备来说太宽，用户代理将使用最大矩形的宽度：比率为<code>2:1</code>，适配设备。</p>\n<h3 id=\"正常流中的块级非替换元素\"><a href=\"#正常流中的块级非替换元素\" class=\"headerlink\" title=\"正常流中的块级非替换元素\"></a>正常流中的块级非替换元素</h3><p>下面的约束必须配置其他属性进行：</p>\n<blockquote>\n<p>‘margin-left’ + ‘border-left-width’ + ‘padding-left’ + ‘width’ + ‘padding-right’ + ‘border-right-width’ + ‘margin-right’ = width of containing block</p>\n</blockquote>\n<p>如果<code>width</code>不是<code>auto</code>,并且’border-left-width’ + ‘padding-left’ + ‘width’ + ‘padding-right’ + ‘border-right-width’ (加上 不为<code>auto</code>的 ‘margin-left’ 或者 ‘margin-right’ 的值)。大于包含块的宽度，那么任何属性值设置为<code>auto</code>的<code>margin-left</code>或者<code>margin-right</code>, 遵循以下规则，设置为<code>0</code>.</p>\n<p>如果以上属性有一个计算值，而不是<code>auto</code>,这被称之为超过限制，那么其中一个属性值必须调整不同于其计算值。如果包含块的方向从左到右，那么指定给<code>margin-right</code>的特定值会被忽略，重置一个值，以适配等式成立。反之，如果包含块的方向从右到左，同理。</p>\n<p>如果有一个值被指定为<code>auto</code>,其值根据等式计算。</p>\n<p>如果<code>width</code>设置为<code>auto</code>,任何其他设置为<code>auto</code>的属性值变为<code>auto</code>,并且<code>width</code>属性值根据等式计算。</p>\n<p>如果<code>margin-left</code>和<code>margin-right</code>设置为<code>auto</code>,那么它们实际的值是相等的，用于把元素相对于包含块水平居中。</p>\n<h3 id=\"正常流中的块级替换元素\"><a href=\"#正常流中的块级替换元素\" class=\"headerlink\" title=\"正常流中的块级替换元素\"></a>正常流中的块级替换元素</h3><p><code>width</code>属性的实际值类似于：<code>行内替换元素</code>.而外边距的值依据:<code>非替换块级元素决定</code>。</p>\n<h3 id=\"浮动，非替换元素\"><a href=\"#浮动，非替换元素\" class=\"headerlink\" title=\"浮动，非替换元素\"></a>浮动，非替换元素</h3><p>如果<code>margin-left</code>或者<code>margin-right</code>设置为<code>auto</code>,那么世纪值计算为<code>0</code>.<br>如果<code>width</code>设置为<code>auto</code>,那么实际值将收缩适应元素.</p>\n<p>计算收缩适应的宽度类似于计算<code>table cell</code>的宽度，使用自动表布局算法。粗略的说：通过格式化内容区不换行，除非遇到换行符，得到一个优选宽度，并且计算一个恰当的最小宽度，例如：尝试任何可能的换行.<code>CSS2.1</code>没有定义具体的算法.第三，找到可用的宽度：在这种情况下，宽度为包含块减去另外六个盒模型属性以及可能的滚动条的宽度。</p>\n<p>自适应宽度取: min(max(最小宽度，可用宽度)，自适应宽度).</p>\n<h3 id=\"浮动，替换元素\"><a href=\"#浮动，替换元素\" class=\"headerlink\" title=\"浮动，替换元素\"></a>浮动，替换元素</h3><p>如果<code>margin-left</code>或者<code>margin-right</code>设置为<code>auto</code>,实际值为<code>0</code>.<code>width</code>属性的实际值参照<code>行内替换元素</code>。</p>\n<h3 id=\"绝对定位，非替换元素\"><a href=\"#绝对定位，非替换元素\" class=\"headerlink\" title=\"绝对定位，非替换元素\"></a>绝对定位，非替换元素</h3><p>这个章节和下面一个章节的目的，术语<code>静态位置</code>参考，粗略的说，一个元素的位置必须在正常流中.清晰的定义：</p>\n<ul>\n<li>静态位置的包含块是一个假想的盒子，如果<code>position</code>属性设置为<code>static</code>，并且<code>float</code>属性设置为<code>none</code>,那么将作为元素的第一个盒子。(由于<a href=\"https://www.w3.org/TR/CSS2/visuren.html#dis-pos-flo\" target=\"_blank\" rel=\"noopener\">section 9.7</a>的限制，这个假想计算或许需要给<code>display</code>属性指定一个特殊值.)</li>\n<li>如果<code>position</code>属性设置为<code>static</code>，并且<code>float</code>属性设置为<code>none</code>, 静态位置的<code>left</code>属性计算从包含块的左边缘到假想外边距的左边,这将作为元素的第一个盒子。其值将是负数，如果假想盒位于包含块的左边。</li>\n<li>静态位置的<code>right</code>属性计算从包含块的右边缘到假想盒的右边缘，同上。如果假想盒子位于包含块的左边，其值将会是正数。</li>\n</ul>\n<p>但不是实际的计算假想盒子的尺寸，用户代理会自由猜测其可能的位置。</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cjcyzhlwu00069co7x4vwrtsf","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlx7000c9co71dzoqfem"},{"post_id":"cjcyzhlwa00009co7v0iqnxks","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlx9000h9co7cjsewf7y"},{"post_id":"cjcyzhlwz00089co7drd6z7cr","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlxc000j9co7eh5qpqu7"},{"post_id":"cjcyzhlx3000a9co7n7cpnttv","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlxd000m9co7se5dxmn5"},{"post_id":"cjcyzhlwj00029co7cjtru4j6","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlxf000p9co7kx0votls"},{"post_id":"cjcyzhlx5000b9co71zbc8quz","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlxg000t9co7lm1k7v5a"},{"post_id":"cjcyzhlx8000g9co74qirr8xt","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlxh000w9co7p4op0qjt"},{"post_id":"cjcyzhlwq00059co7xt2i4tuy","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlxm00109co70ke4uzfw"},{"post_id":"cjcyzhlxb000i9co7uuf78g2d","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlxn00139co7eeheawd8"},{"post_id":"cjcyzhlxh000v9co74v6ti8b0","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlxq00179co7ma6q4zxu"},{"post_id":"cjcyzhlxd000l9co7eerwidco","category_id":"cjcyzhlxf000r9co7w7s1jhwg","_id":"cjcyzhlxr001a9co7mafdfgam"},{"post_id":"cjcyzhlxj000y9co73bq3jr5g","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlxr001c9co7kgybq2wz"},{"post_id":"cjcyzhlxd000o9co7x3phb9l2","category_id":"cjcyzhlxf000r9co7w7s1jhwg","_id":"cjcyzhlxu001h9co7jvgaav6b"},{"post_id":"cjcyzhlxo00159co7yyq1hkpi","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlxw001j9co7eekytusj"},{"post_id":"cjcyzhlxq00199co7pcs5kjeo","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlxx001m9co7xmo5jfbl"},{"post_id":"cjcyzhlxf000s9co7fwe9r84p","category_id":"cjcyzhlxq00169co7cxo0wy5q","_id":"cjcyzhlxy001p9co76nqw3x4l"},{"post_id":"cjcyzhlxr001b9co7hfdzlhvw","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhly0001s9co78m8uet65"},{"post_id":"cjcyzhlxt001g9co78m4t09l3","category_id":"cjcyzhlxf000r9co7w7s1jhwg","_id":"cjcyzhly1001v9co7xokbjwbp"},{"post_id":"cjcyzhlxm00129co70j1yoyy4","category_id":"cjcyzhlxs001e9co7y1qlez06","_id":"cjcyzhly2001y9co7hmhmvbpe"},{"post_id":"cjcyzhlxv001i9co7ppknpkxz","category_id":"cjcyzhlxf000r9co7w7s1jhwg","_id":"cjcyzhly400219co7udw4lb8m"},{"post_id":"cjcyzhlxw001l9co7bg6dk69i","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhly500239co7flunf6p0"},{"post_id":"cjcyzhlxx001o9co7nn692are","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhly700279co78f7phijp"},{"post_id":"cjcyzhlxy001r9co7vmutj2tf","category_id":"cjcyzhlxf000r9co7w7s1jhwg","_id":"cjcyzhly700299co7f3ds1ad3"},{"post_id":"cjcyzhly0001u9co7nj50ft9l","category_id":"cjcyzhlxq00169co7cxo0wy5q","_id":"cjcyzhlya002c9co7l29vpznb"},{"post_id":"cjcyzhly2001x9co7l3stlvag","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlyb002f9co7wx5io3ho"},{"post_id":"cjcyzhly300209co77zmu6tkg","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlyc002i9co7gl64e2lw"},{"post_id":"cjcyzhly400229co7z1d3kwva","category_id":"cjcyzhlxq00169co7cxo0wy5q","_id":"cjcyzhlyd002l9co7643ya15w"},{"post_id":"cjcyzhly600269co7n2qfc6gr","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlye002o9co7uv67ggf3"},{"post_id":"cjcyzhly700289co77etjgon6","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlyf002r9co7z6hbe4su"},{"post_id":"cjcyzhly8002b9co7z4i0pw6p","category_id":"cjcyzhlxf000r9co7w7s1jhwg","_id":"cjcyzhlyf002s9co77tk8s4en"},{"post_id":"cjcyzhlya002e9co7p9jqggtb","category_id":"cjcyzhlxf000r9co7w7s1jhwg","_id":"cjcyzhlyf002v9co7xlurk95u"},{"post_id":"cjcyzhlyb002h9co7nn20dtde","category_id":"cjcyzhlxf000r9co7w7s1jhwg","_id":"cjcyzhlyf002w9co7pzohh6ss"},{"post_id":"cjcyzhlyc002k9co7soihqcnf","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlyg002y9co7662glpf0"},{"post_id":"cjcyzhlyd002n9co7nninkmt9","category_id":"cjcyzhlxf000r9co7w7s1jhwg","_id":"cjcyzhlyg00309co7979bi0d1"},{"post_id":"cjcyzhlye002q9co7ygi0pr33","category_id":"cjcyzhlwm00049co72o2mgua5","_id":"cjcyzhlyg00329co72uzw0d0q"}],"PostTag":[{"post_id":"cjcyzhlwq00059co7xt2i4tuy","tag_id":"cjcyzhlwy00079co7vnpe5mkp","_id":"cjcyzhlx8000f9co7613175gn"},{"post_id":"cjcyzhlwu00069co7x4vwrtsf","tag_id":"cjcyzhlx7000d9co7ja1r5zgm","_id":"cjcyzhlxd000n9co7uc05gi50"},{"post_id":"cjcyzhlwz00089co7drd6z7cr","tag_id":"cjcyzhlxc000k9co7fzd6qt6d","_id":"cjcyzhlxh000u9co7xcsuyxcj"},{"post_id":"cjcyzhlx3000a9co7n7cpnttv","tag_id":"cjcyzhlxf000q9co7wv56axqo","_id":"cjcyzhlxm00119co7yk8bkz5c"},{"post_id":"cjcyzhlx5000b9co71zbc8quz","tag_id":"cjcyzhlx7000d9co7ja1r5zgm","_id":"cjcyzhlxq00189co7a396tlng"},{"post_id":"cjcyzhlx8000g9co74qirr8xt","tag_id":"cjcyzhlxo00149co7at9m3vgx","_id":"cjcyzhlxt001f9co7ldqzi6zx"},{"post_id":"cjcyzhlxb000i9co7uuf78g2d","tag_id":"cjcyzhlxr001d9co7bsexrz17","_id":"cjcyzhlxx001n9co7socc9v6u"},{"post_id":"cjcyzhlxj000y9co73bq3jr5g","tag_id":"cjcyzhlxw001k9co7zvdqgwpg","_id":"cjcyzhly0001t9co790u1pmpp"},{"post_id":"cjcyzhlxm00129co70j1yoyy4","tag_id":"cjcyzhlxy001q9co78ko368pr","_id":"cjcyzhly3001z9co7jtwb76fh"},{"post_id":"cjcyzhlxr001b9co7hfdzlhvw","tag_id":"cjcyzhly1001w9co7m6efrbkw","_id":"cjcyzhly600259co7yudthkok"},{"post_id":"cjcyzhlxw001l9co7bg6dk69i","tag_id":"cjcyzhly500249co7nc9sor76","_id":"cjcyzhlya002d9co7qy7cj4xh"},{"post_id":"cjcyzhlxx001o9co7nn692are","tag_id":"cjcyzhly7002a9co7k36n7yxq","_id":"cjcyzhlyc002j9co7f9lv8x9w"},{"post_id":"cjcyzhly2001x9co7l3stlvag","tag_id":"cjcyzhlyb002g9co7wr1vv5ru","_id":"cjcyzhlye002p9co74eaoevqr"},{"post_id":"cjcyzhly300209co77zmu6tkg","tag_id":"cjcyzhlyd002m9co7zuzg9ayr","_id":"cjcyzhlyf002u9co77mq162mp"},{"post_id":"cjcyzhly600269co7n2qfc6gr","tag_id":"cjcyzhlyf002t9co7kxc97tn3","_id":"cjcyzhlyg002z9co75e8z8sfu"},{"post_id":"cjcyzhly700289co77etjgon6","tag_id":"cjcyzhlyg002x9co7dnngn854","_id":"cjcyzhlyg00339co7plaisjx6"},{"post_id":"cjcyzhlyc002k9co7soihqcnf","tag_id":"cjcyzhlyg00319co771nybht7","_id":"cjcyzhlyh00359co7lr2h80pr"},{"post_id":"cjcyzhlye002q9co7ygi0pr33","tag_id":"cjcyzhlyh00349co72wvau30c","_id":"cjcyzhlyh00369co7s7oqdezb"}],"Tag":[{"name":"css background","_id":"cjcyzhlwy00079co7vnpe5mkp"},{"name":"css-mastery","_id":"cjcyzhlx7000d9co7ja1r5zgm"},{"name":"transition animation","_id":"cjcyzhlxc000k9co7fzd6qt6d"},{"name":"css CSSMastery","_id":"cjcyzhlxf000q9co7wv56axqo"},{"name":"SVG","_id":"cjcyzhlxo00149co7at9m3vgx"},{"name":"css scrollTo","_id":"cjcyzhlxr001d9co7bsexrz17"},{"name":"line box inline block","_id":"cjcyzhlxw001k9co7zvdqgwpg"},{"name":"love","_id":"cjcyzhlxy001q9co78ko368pr"},{"name":"flexbox xmind","_id":"cjcyzhly1001w9co7m6efrbkw"},{"name":"AMD、CMD、commonjs","_id":"cjcyzhly500249co7nc9sor76"},{"name":"css html table","_id":"cjcyzhly7002a9co7k36n7yxq"},{"name":"position layout","_id":"cjcyzhlyb002g9co7wr1vv5ru"},{"name":"h5","_id":"cjcyzhlyd002m9co7zuzg9ayr"},{"name":"javascript","_id":"cjcyzhlyf002t9co7kxc97tn3"},{"name":"box-shadow","_id":"cjcyzhlyg002x9co7dnngn854"},{"name":"inline element, block element","_id":"cjcyzhlyg00319co771nybht7"},{"name":"visual formatting model","_id":"cjcyzhlyh00349co72wvau30c"}]}}